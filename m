Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 9AD59C1A730
	for <lists+qemu-devel@lfdr.de>; Wed, 29 Oct 2025 13:59:59 +0100 (CET)
Received: from localhost ([::1] helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces@nongnu.org>)
	id 1vE5lJ-0006pq-ER; Wed, 29 Oct 2025 08:58:49 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10])
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <karthikab1623@gmail.com>)
 id 1vE1uD-0000QZ-GC
 for qemu-devel@nongnu.org; Wed, 29 Oct 2025 04:51:46 -0400
Received: from mail-yx1-xb131.google.com ([2607:f8b0:4864:20::b131])
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.90_1) (envelope-from <karthikab1623@gmail.com>)
 id 1vE1u6-0001gY-6S
 for qemu-devel@nongnu.org; Wed, 29 Oct 2025 04:51:45 -0400
Received: by mail-yx1-xb131.google.com with SMTP id
 956f58d0204a3-63e330a1360so7652566d50.3
 for <qemu-devel@nongnu.org>; Wed, 29 Oct 2025 01:51:34 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20230601; t=1761727891; x=1762332691; darn=nongnu.org;
 h=cc:to:subject:message-id:date:from:mime-version:from:to:cc:subject
 :date:message-id:reply-to;
 bh=gU6tgUgdYZuCxLGg84ceWaP0I8/ff7TQ/2TG+vWRmSk=;
 b=M2+9UPs2w4I/bvlY8Yz7EOZAo3WxvTXf5QzO7p5Sy2+GaDq5Ee3hXPUPHBvkeBkt2N
 ccKTLB8vvmku7WhkKvlfOJI29nt/Rzajkf5LBxNYnarnQu83JaKW7aGCbO2r5X9xzvSm
 wE8yz5VHQ+3YQ0bNOr6tSbQqC83+M+0hEGvk7GfwnsjZKBF4713mFdeMj2widdjsyAOC
 108NqdyfHt+W8bcQJL/UEQODZdY68HqWa4qH21JyAOAFHR1QbY3Amsf8kejzPkTmC34w
 LP1V0W6eMStyx0D+2hoJtn6oWSQzvxndao5dVX3eNHmMmwAs12KEcgfzWpN6EOo8mavp
 EONw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20230601; t=1761727891; x=1762332691;
 h=cc:to:subject:message-id:date:from:mime-version:x-gm-message-state
 :from:to:cc:subject:date:message-id:reply-to;
 bh=gU6tgUgdYZuCxLGg84ceWaP0I8/ff7TQ/2TG+vWRmSk=;
 b=Vc7vzB3eug3IvmDFOyUg1TLrbXIB3vkIxut+zv85GU5/GcaWJCdWYTr4tQgC/0WnSg
 7YtT5Nrkob4m7kcb0+AcXbRap/RI9aMoYqLALIJeuMacQdaIwSGhVdt1Rfg7hWOiEFro
 2uJIF6B8P4l/Cyr8wPyudpvNBCurQUEF2Q/yf7GwrDl9SyhuKwa6Dp8yj9bGHEI0eUkU
 hRV+pI13ni7aJPMB+9AwLZxaMv88oY96vmhlr54ha1BxHD6qEj1KhGhangeW4f8OkBJf
 BYS1iqb1a68vhwjH85pOWG0BR9ioSHSQKrSq4i6C3B72xL5tabQhWZqe0xDjm+oYUHwU
 bg/w==
X-Gm-Message-State: AOJu0Yyzsqn/i1B7Kii9su4Ah40YiR43rX3CXpD1ndT15Iq+foYXkKIB
 bfg1W+vGlG01ULzYZKuLAuGKsryKynqfu3yJLWqiMNGyTVGQ0P4m8uRQR1r6BLbF/KafhgcP43R
 OHUlhNr53Anev0znYZ50YtPdObEgqsvnkDwg0
X-Gm-Gg: ASbGnctHVunp+fhUg3LTUFvm/JY018SP1wWpAkeCZaOmMn7uXnwgjFCNhOE7blIyMd+
 bdGEWMQf3GCZ3LLw9acbYNAX98KSnJvnZxzOAonVNzp+DNF9brscylOVsKkc8cmbdbfnNUCdSNj
 RtP7y9ZRbHdfBoKQSIcuT60aNR151AFEW73TWT5+JNB635d397UtHr6SBE6OJ7dZz8bEgox8/CX
 eGkDRBsLZf1dgoNw1cmthAgTAx2/lNoH2Y0JUjJxynvB6gbhnXg1cdNB8al7XWtIIWdsWhJ
X-Google-Smtp-Source: AGHT+IHFTk4p86bJAwkDuphhQrJ9PBXHcwH77SPhq+1PHGKzU+20lJu5kW6Rc7x/mPyP6Tje/XQJCcSHWRMpEATz9Ic=
X-Received: by 2002:a05:690e:4198:b0:63f:4011:4fe1 with SMTP id
 956f58d0204a3-63f76d23d27mr1653268d50.24.1761727891503; Wed, 29 Oct 2025
 01:51:31 -0700 (PDT)
MIME-Version: 1.0
From: Karthika B <karthikab1623@gmail.com>
Date: Wed, 29 Oct 2025 14:37:37 +0530
X-Gm-Features: AWmQ_bkfTcBaLhVuP2dkH_5QW0XajCjEWcGpa_2AcawI9oPbvzVL5cQeytkEvL4
Message-ID: <CAOOGzQJqfoF7Cy87nZWsrKcDSr5QOWUpoZ2rN3q4tRU5cOVZNA@mail.gmail.com>
Subject: [PATCH] RISC-V: Add Vega machine support for upstream QEMU
To: qemu-devel@nongnu.org
Cc: qemu-riscv@nongnu.org, sreenadh@cdac.in, raokk@cdac.in
Content-Type: multipart/mixed; boundary="0000000000002aa26f0642483da3"
Received-SPF: pass client-ip=2607:f8b0:4864:20::b131;
 envelope-from=karthikab1623@gmail.com; helo=mail-yx1-xb131.google.com
X-Spam_score_int: -17
X-Spam_score: -1.8
X-Spam_bar: -
X-Spam_report: (-1.8 / 5.0 requ) BAYES_00=-1.9, DKIM_SIGNED=0.1,
 DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 FREEMAIL_ENVFROM_END_DIGIT=0.25, FREEMAIL_FROM=0.001, HTML_MESSAGE=0.001,
 RCVD_IN_DNSWL_NONE=-0.0001, SPF_HELO_NONE=0.001,
 SPF_PASS=-0.001 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-Mailman-Approved-At: Wed, 29 Oct 2025 08:57:49 -0400
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org

--0000000000002aa26f0642483da3
Content-Type: multipart/alternative; boundary="0000000000002aa26f0642483da1"

--0000000000002aa26f0642483da1
Content-Type: text/plain; charset="UTF-8"

Dear QEMU Maintainers,

This patch adds support for the Vega RISC-V machine model, developed as part
of the Vega multicore platform at C-DAC, Thiruvananthapuram.

The Vega machine includes:
 - Multi-core CPU configuration
 - PLIC and ACLINT interrupt controllers
 - DRAM and MMIO memory mapping
 - UART and timer initialization

The Vega platform functionality was verified on the 64-bit QEMU build by:
 - Successfully booting a Linux image using the Berkeley Boot Loader (BBL)
 - Running bare-metal example programs from the Vega SDK

Signed-off-by: Karthika B <karthika.b@cdac.in>

---

For reference:
This patch submission is being sent to the official QEMU mailing list
(qemu-devel@nongnu.org, qemu-riscv@nongnu.org) as part of our effort to
upstream the Vega RISC-V machine model developed under the Microprocessor
Development Programme.




*Best regards,  Karthika B  Project Engineer, HDGC-DAC, Thiruvananthapuram*

--0000000000002aa26f0642483da1
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Dear QEMU Maintainers,<br><br>This patch adds support for =
the Vega RISC-V machine model, developed as part<br>of the Vega multicore p=
latform at C-DAC, Thiruvananthapuram.<br><br>The Vega machine includes:<br>=
=C2=A0- Multi-core CPU configuration<br>=C2=A0- PLIC and ACLINT interrupt c=
ontrollers<br>=C2=A0- DRAM and MMIO memory mapping<br>=C2=A0- UART and time=
r initialization<br><br>The Vega platform functionality was verified on the=
 64-bit QEMU build by:<br>=C2=A0- Successfully booting a Linux image using =
the Berkeley Boot Loader (BBL)<br>=C2=A0- Running bare-metal example progra=
ms from the Vega SDK<br><br>Signed-off-by: Karthika B &lt;<a href=3D"mailto=
:karthika.b@cdac.in">karthika.b@cdac.in</a>&gt;<br><br>---<br><br>For refer=
ence:<br>This patch submission is being sent to the official QEMU mailing l=
ist<br>(<a href=3D"mailto:qemu-devel@nongnu.org">qemu-devel@nongnu.org</a>,=
 <a href=3D"mailto:qemu-riscv@nongnu.org">qemu-riscv@nongnu.org</a>) as par=
t of our effort to<br>upstream the Vega RISC-V machine model developed unde=
r the Microprocessor Development Programme.<br><br><b>Best regards, =C2=A0<=
br>Karthika B=C2=A0=C2=A0<br>Project Engineer, HDG<br>C-DAC, Thiruvananthap=
uram</b> =C2=A0<br></div>

--0000000000002aa26f0642483da1--

--0000000000002aa26f0642483da3
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0001-riscv-Add-Vega-board-support.patch"
Content-Disposition: attachment; 
	filename="0001-riscv-Add-Vega-board-support.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_mhbqja5e0>
X-Attachment-Id: f_mhbqja5e0

RnJvbSBjODIxOGE3ZmM3MjdiMzBmNDU1MTZmZmUyYmFlZWE4MTlhOWQ1ZGYzIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBLYXJ0aGlrYSBCIDxrYXJ0aGlrYS5iQGNkYWMuaW4+CkRhdGU6
IFRodSwgMjMgT2N0IDIwMjUgMTU6MDc6NTcgKzA1MzAKU3ViamVjdDogW1BBVENIXSByaXNjdjog
QWRkIFZlZ2EgYm9hcmQgc3VwcG9ydAoKVGhpcyBwYXRjaCBhZGRzIHN1cHBvcnQgZm9yIHRoZSBW
ZWdhIFJJU0MtViBtYWNoaW5lIG1vZGVsLgoKVGhlIFZlZ2EgbWFjaGluZSBpbmNsdWRlczoKIC0g
TXVsdGktY29yZSBDUFUgY29uZmlndXJhdGlvbgogLSBQTElDIGFuZCBBQ0xJTlQgaW50ZXJydXB0
IGNvbnRyb2xsZXJzCiAtIERSQU0gYW5kIE1NSU8gbWVtb3J5IG1hcHBpbmcKIC0gVUFSVCBhbmQg
dGltZXIgaW5pdGlhbGl6YXRpb24KClRoZSBWZWdhIHBsYXRmb3JtIHdhcyB2ZXJpZmllZCB0byBi
b290IFZlZ2EgU0RLIGltYWdlcwpzdWNjZXNzZnVsbHkgb24gYm90aCAzMi1iaXQgYW5kIDY0LWJp
dCBRRU1VIGJ1aWxkcy4KClNpZ25lZC1vZmYtYnk6IEthcnRoaWthIEIgPGthcnRoaWthLmJAY2Rh
Yy5pbj4KLS0tCiBSRUFETUUubWQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwg
ICA1NSArCiBjb25maWdzL2RldmljZXMvcmlzY3Y2NC1zb2Z0bW11L2RlZmF1bHQubWFrIHwgICAg
MSArCiBody9pbnRjL0tjb25maWcgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgNyAr
CiBody9pbnRjL21lc29uLmJ1aWxkICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgMiArCiBo
dy9pbnRjL3ZlZ2FfYWNsaW50LmMgICAgICAgICAgICAgICAgICAgICAgIHwgIDU1MSArKysrKwog
aHcvaW50Yy92ZWdhX3BsaWMuYyAgICAgICAgICAgICAgICAgICAgICAgICB8ICA0OTYgKysrKysK
IGh3L3Jpc2N2L0tjb25maWcgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIDI4ICsKIGh3
L3Jpc2N2L21lc29uLmJ1aWxkICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAxICsKIGh3L3Jp
c2N2L3ZlZ2EuYyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAyMDc2ICsrKysrKysrKysr
KysrKysrKysKIGluY2x1ZGUvaHcvaW50Yy92ZWdhX2FjbGludC5oICAgICAgICAgICAgICAgfCAg
IDY3ICsKIGluY2x1ZGUvaHcvaW50Yy92ZWdhX3BsaWMuaCAgICAgICAgICAgICAgICAgfCAgIDcw
ICsKIGluY2x1ZGUvaHcvcmlzY3YvdmVnYS5oICAgICAgICAgICAgICAgICAgICAgfCAgMTY2ICsr
CiAxMiBmaWxlcyBjaGFuZ2VkLCAzNTIwIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBSRUFETUUubWQKIGNyZWF0ZSBtb2RlIDEwMDY0NCBody9pbnRjL3ZlZ2FfYWNsaW50LmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBody9pbnRjL3ZlZ2FfcGxpYy5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
aHcvcmlzY3YvdmVnYS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgaW5jbHVkZS9ody9pbnRjL3ZlZ2Ff
YWNsaW50LmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNsdWRlL2h3L2ludGMvdmVnYV9wbGljLmgK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNsdWRlL2h3L3Jpc2N2L3ZlZ2EuaAoKZGlmZiAtLWdpdCBh
L1JFQURNRS5tZCBiL1JFQURNRS5tZApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MDAwLi5lZTlmYjM3MDdiCi0tLSAvZGV2L251bGwKKysrIGIvUkVBRE1FLm1kCkBAIC0wLDAgKzEs
NTUgQEAKKyMgUUVNVSBmb3IgVmVnYSBNYWNoaW5lCis9PT09PT09PT09PT09PT09PT09PT09PT09
CisKK1RoaXMgaXMgYSBjdXN0b20gUUVNVSBmb3JrIGZvciBzaW11bGF0aW5nIHRoZSBSSVNDLVYg
VmVnYSBtdWx0aWNvcmUgcGxhdGZvcm0uCisKKyMjIEZlYXR1cmVzCis9PT09PT09PT09PT0KKy0g
Q3VzdG9tIGB2ZWdhYCBtYWNoaW5lIHdpdGggbXVsdGktaGFydCBzdXBwb3J0CistIFN1cHBvcnQg
Zm9yIGJhcmUtbWV0YWwgYW5kIExpbnV4IGtlcm5lbCBib290CistIEN1c3RvbSBBQ0xJTlQgYW5k
IFBMSUMgaW50ZWdyYXRpb24KKy0gYC1NIHZlZ2EsYmFyZW1ldGFsPW9uYCBydW50aW1lIG9wdGlv
biBmb3Igc2VsZWN0aW5nIFVBUlQgSVJRCistICBkcmFtLWJhc2U9MHgwIHJ1bnRpbWUgb3B0aW9u
IGZvciBkcmFtIGJhc2UgYWRkcmVzcworCisjIyBVc2FnZQorPT09PT09PT0KKworI0J1aWxkIFFF
TVUgZm9yIDY0LWJpdCBzeXN0ZW0KKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisuL2Nv
bmZpZ3VyZSAtLXRhcmdldC1saXN0PXJpc2N2NjQtc29mdG1tdQorbWFrZQorCisjRk9SIEJBUkUg
TUVUQUwgUFJPR1JBTSBARFJBTV9CQVNFIDBYODAwMDAwMDAKKy0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisuL2J1aWxkL3FlbXUtc3lzdGVtLXJpc2N2NjQgLU0g
dmVnYSxkcmFtLWJhc2U9MHg4MDAwMDAwMCxiYXJlbWV0YWwtbW9kZT1vbiAtc21wIDEgLW0gMkcg
LWtlcm5lbCBzcGlrZWRiZ184YyAtYmlvcyBub25lIC1kaXNwbGF5IG5vbmUgLXNlcmlhbCBzdGRp
bworCisjRk9SIEJBUkUgTUVUQUwgUFJPR1JBTSBARFJBTV9CQVNFIDBYNDAwMDAwMDAwCistLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKy4vYnVpbGQvcWVtdS1z
eXN0ZW0tcmlzY3Y2NCAtTSB2ZWdhLGRyYW0tYmFzZT0weDQwMDAwMDAwMCxiYXJlbWV0YWwtbW9k
ZT1vbiAtc21wIDEgLW0gMkcgLWtlcm5lbCBzcGlrZWRiZ180MGMgLWJpb3Mgbm9uZSAtZGlzcGxh
eSBub25lIC1zZXJpYWwgc3RkaW8KKworI0ZPUiBCT09USU5HIExJTlVYKGJibCkgQERSQU1fQkFT
RSAwWDgwMDAwMDAwCistLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LQorLi9idWlsZC9xZW11LXN5c3RlbS1yaXNjdjY0IC1NIHZlZ2EsZHJhbS1iYXNlPTB4ODAwMDAw
MDAgIC1zbXAgNCAtbSAyRyAgICAgLWRpc3BsYXkgbm9uZSAtc2VyaWFsIHN0ZGlvICAgICAtYmlv
cyBub25lIC1rZXJuZWwgYmJsXzhjICAgICAtaW5pdHJkIHJvb3Rmcy5jcGlvICAgICAtYXBwZW5k
ICJyb290PS9kZXYvcmFtIiAtY3B1IHJ2YTIzczY0CisKKyNGT1IgQk9PVElORyBMSU5VWChiYmwp
IEBEUkFNX0JBU0UgMFg0MDAwMDAwMDAKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQorLi9idWlsZC9xZW11LXN5c3RlbS1yaXNjdjY0IC1NIHZlZ2EsZHJhbS1i
YXNlPTB4NDAwMDAwMDAwICAtc21wIDQgLW0gMkcgICAgIC1kaXNwbGF5IG5vbmUgLXNlcmlhbCBz
dGRpbyAgICAgLWJpb3Mgbm9uZSAta2VybmVsIGJibF80MGMgICAgIC1pbml0cmQgcm9vdGZzLmNw
aW8gICAgIC1hcHBlbmQgInJvb3Q9L2Rldi9yYW0iIC1jcHUgcnZhMjNzNjQKKworIyNGT1IgQk9P
VElORyBVLUJPT1QgKDIwMjUuMDcpIEBEUkFNX0JBU0UgMFg4MDAwMDAwMAorLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorLi9idWlsZF82NC9xZW11
LXN5c3RlbS1yaXNjdjY0IC1NIHZlZ2EsYmFyZW1ldGFsLW1vZGU9b24sZHJhbS1iYXNlPTB4ODAw
MDAwMDAgLXNtcCAxIC1tIDJHIC1rZXJuZWwgZndfcGF5bG9hZC5lbGYgLWJpb3Mgbm9uZSAtZGlz
cGxheSBub25lIC1zZXJpYWwgc3RkaW8gLWNwdSBydmEyM3M2NAorCisKKyNCdWlsZCBRRU1VIGZv
ciAzMi1iaXQgc3lzdGVtCistLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisuL2NvbmZpZ3Vy
ZSAtLXRhcmdldC1saXN0PXJpc2N2MzItc29mdG1tdQorbWFrZQorCisjRk9SIEJBUkUgTUVUQUwg
UFJPR1JBTSBARFJBTV9CQVNFIDB4MjAwMDAwIChGT1IgQVJJRVMpCistLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKy4vYnVpbGQvcWVtdS1zeXN0
ZW0tcmlzY3YzMiAtTSB2ZWdhLGRyYW0tYmFzZT0weDIwMDAwMCxiYXJlbWV0YWwtbW9kZT1vbiAt
c21wIDEgLW0gMkcgLWtlcm5lbCBoZWxsby5lbGYgLWJpb3Mgbm9uZSAtZGlzcGxheSBub25lIC1z
ZXJpYWwgc3RkaW8KKworIyNEZWJ1ZyBpbiBRZW11IHdpdGggR0RCIHN1cHBvcnQKKz09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09CitSZWZlciB0aGUgdXNlciBndWlkZSBpbiB0aGUgZm9s
ZGVyIGRlYnVnX2d1aWRlLyAoTk9UIFVQREFURUQpCisKZGlmZiAtLWdpdCBhL2NvbmZpZ3MvZGV2
aWNlcy9yaXNjdjY0LXNvZnRtbXUvZGVmYXVsdC5tYWsgYi9jb25maWdzL2RldmljZXMvcmlzY3Y2
NC1zb2Z0bW11L2RlZmF1bHQubWFrCmluZGV4IGU0ODViYmQxYTMuLjk3MjA1ZDNiM2YgMTAwNjQ0
Ci0tLSBhL2NvbmZpZ3MvZGV2aWNlcy9yaXNjdjY0LXNvZnRtbXUvZGVmYXVsdC5tYWsKKysrIGIv
Y29uZmlncy9kZXZpY2VzL3Jpc2N2NjQtc29mdG1tdS9kZWZhdWx0Lm1hawpAQCAtMTIsMyArMTIs
NCBAQAogIyBDT05GSUdfTUlDUk9DSElQX1BGU09DPW4KICMgQ09ORklHX1NIQUtUSV9DPW4KICMg
Q09ORklHX1hJQU5HU0hBTl9LVU5NSU5HSFU9bgorIyBDT05GSUdfVkVHQT1uCmRpZmYgLS1naXQg
YS9ody9pbnRjL0tjb25maWcgYi9ody9pbnRjL0tjb25maWcKaW5kZXggNzU0NzUyOGYyYy4uZGMy
MDJjMjFhZCAxMDA2NDQKLS0tIGEvaHcvaW50Yy9LY29uZmlnCisrKyBiL2h3L2ludGMvS2NvbmZp
ZwpAQCAtMTA5LDMgKzEwOSwxMCBAQCBjb25maWcgTE9PTkdBUkNIX1BDSF9NU0kKIAogY29uZmln
IExPT05HQVJDSF9FWFRJT0kKICAgICBib29sCisKK2NvbmZpZyBWRUdBX0FDTElOVCAgICAgIAor
ICAgIGJvb2wKKworY29uZmlnIFZFR0FfUExJQyAgICAgICAgCisgICAgYm9vbAorICAgIHNlbGVj
dCBNU0lfTk9OQlJPS0VOCmRpZmYgLS1naXQgYS9ody9pbnRjL21lc29uLmJ1aWxkIGIvaHcvaW50
Yy9tZXNvbi5idWlsZAppbmRleCAzMTM3NTIxYTRhLi5kMDcyYmQyOGZiIDEwMDY0NAotLS0gYS9o
dy9pbnRjL21lc29uLmJ1aWxkCisrKyBiL2h3L2ludGMvbWVzb24uYnVpbGQKQEAgLTYxLDYgKzYx
LDggQEAgc3BlY2lmaWNfc3MuYWRkKHdoZW46ICdDT05GSUdfUklTQ1ZfQVBMSUMnLCBpZl90cnVl
OiBmaWxlcygncmlzY3ZfYXBsaWMuYycpKQogc3BlY2lmaWNfc3MuYWRkKHdoZW46ICdDT05GSUdf
UklTQ1ZfSU1TSUMnLCBpZl90cnVlOiBmaWxlcygncmlzY3ZfaW1zaWMuYycpKQogc3BlY2lmaWNf
c3MuYWRkKHdoZW46ICdDT05GSUdfU0lGSVZFX1BMSUMnLCBpZl90cnVlOiBmaWxlcygnc2lmaXZl
X3BsaWMuYycpKQogc3BlY2lmaWNfc3MuYWRkKHdoZW46ICdDT05GSUdfWElDUycsIGlmX3RydWU6
IGZpbGVzKCd4aWNzLmMnLCAneGl2ZTIuYycpKQorc3BlY2lmaWNfc3MuYWRkKHdoZW46ICdDT05G
SUdfVkVHQV9BQ0xJTlQnLCBpZl90cnVlOiBmaWxlcygndmVnYV9hY2xpbnQuYycpKSAgCitzcGVj
aWZpY19zcy5hZGQod2hlbjogJ0NPTkZJR19WRUdBX1BMSUMnLCBpZl90cnVlOiBmaWxlcygndmVn
YV9wbGljLmMnKSkgICAgICAKIHNwZWNpZmljX3NzLmFkZCh3aGVuOiBbJ0NPTkZJR19LVk0nLCAn
Q09ORklHX1hJQ1MnXSwKIAkJaWZfdHJ1ZTogZmlsZXMoJ3hpY3Nfa3ZtLmMnKSkKIHNwZWNpZmlj
X3NzLmFkZCh3aGVuOiAnQ09ORklHX1BTRVJJRVMnLCBpZl90cnVlOiBmaWxlcygneGljc19zcGFw
ci5jJywgJ3NwYXByX3hpdmUuYycpKQpkaWZmIC0tZ2l0IGEvaHcvaW50Yy92ZWdhX2FjbGludC5j
IGIvaHcvaW50Yy92ZWdhX2FjbGludC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAw
MDAwMDAuLjlmZTc2ZDZkNTAKLS0tIC9kZXYvbnVsbAorKysgYi9ody9pbnRjL3ZlZ2FfYWNsaW50
LmMKQEAgLTAsMCArMSw1NTEgQEAKKy8qCisgKiBWRUdBIEFDTElOVCAoQWR2YW5jZWQgQ29yZSBM
b2NhbCBJbnRlcnJ1cHRvcikKKyovCisjaW5jbHVkZSAicWVtdS9vc2RlcC5oIgorI2luY2x1ZGUg
InFhcGkvZXJyb3IuaCIKKyNpbmNsdWRlICJxZW11L2Vycm9yLXJlcG9ydC5oIgorI2luY2x1ZGUg
InFlbXUvbG9nLmgiCisjaW5jbHVkZSAicWVtdS9tb2R1bGUuaCIKKyNpbmNsdWRlICJody9zeXNi
dXMuaCIKKyNpbmNsdWRlICJ0YXJnZXQvcmlzY3YvY3B1LmgiCisjaW5jbHVkZSAidGFyZ2V0L3Jp
c2N2L3RpbWVfaGVscGVyLmgiCisjaW5jbHVkZSAiaHcvcWRldi1wcm9wZXJ0aWVzLmgiCisjaW5j
bHVkZSAiaHcvaW50Yy92ZWdhX2FjbGludC5oIgorI2luY2x1ZGUgInFlbXUvdGltZXIuaCIKKyNp
bmNsdWRlICJody9pcnEuaCIKKyNpbmNsdWRlICJtaWdyYXRpb24vdm1zdGF0ZS5oIgorCit0eXBl
ZGVmIHN0cnVjdCB2ZWdhX2FjbGludF9tdGltZXJfY2FsbGJhY2sgeworICAgIFZFR0FBY2xpbnRN
VGltZXJTdGF0ZSAqczsKKyAgICBpbnQgbnVtOworfSB2ZWdhX2FjbGludF9tdGltZXJfY2FsbGJh
Y2s7CisKK3N0YXRpYyB1aW50NjRfdCBjcHVfdmVnYV9yZWFkX3J0Y19yYXcodWludDMyX3QgdGlt
ZWJhc2VfZnJlcSkKK3sKKyAgICByZXR1cm4gbXVsZGl2NjQocWVtdV9jbG9ja19nZXRfbnMoUUVN
VV9DTE9DS19WSVJUVUFMKSwKKyAgICAgICAgdGltZWJhc2VfZnJlcSwgTkFOT1NFQ09ORFNfUEVS
X1NFQ09ORCk7Cit9CisKK3N0YXRpYyB1aW50NjRfdCBjcHVfdmVnYV9yZWFkX3J0Yyh2b2lkICpv
cGFxdWUpCit7CisgICAgVkVHQUFjbGludE1UaW1lclN0YXRlICptdGltZXIgPSBvcGFxdWU7Cisg
ICAgcmV0dXJuIGNwdV92ZWdhX3JlYWRfcnRjX3JhdyhtdGltZXItPnRpbWViYXNlX2ZyZXEpICsg
bXRpbWVyLT50aW1lX2RlbHRhOworfQorCisvKgorICogQ2FsbGVkIHdoZW4gdGltZWNtcCBpcyB3
cml0dGVuIHRvIHVwZGF0ZSB0aGUgUUVNVSB0aW1lciBvciBpbW1lZGlhdGVseQorICogdHJpZ2dl
ciB0aW1lciBpbnRlcnJ1cHQgaWYgbXRpbWVjbXAgPD0gY3VycmVudCB0aW1lciB2YWx1ZS4KKyAq
Lworc3RhdGljIHZvaWQgdmVnYV9hY2xpbnRfbXRpbWVyX3dyaXRlX3RpbWVjbXAoVkVHQUFjbGlu
dE1UaW1lclN0YXRlICptdGltZXIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUklTQ1ZDUFUgKmNwdSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBpbnQgaGFydGlkLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IHZhbHVlKQoreworICAgIHVpbnQzMl90IHRpbWVi
YXNlX2ZyZXEgPSBtdGltZXItPnRpbWViYXNlX2ZyZXE7CisgICAgdWludDY0X3QgbmV4dDsKKyAg
ICB1aW50NjRfdCBkaWZmOworCisgICAgdWludDY0X3QgcnRjID0gY3B1X3ZlZ2FfcmVhZF9ydGMo
bXRpbWVyKTsKKworICAgIC8qIENvbXB1dGUgdGhlIHJlbGF0aXZlIGhhcnRpZCB3LnIudCB0aGUg
c29ja2V0ICovCisgICAgaGFydGlkID0gaGFydGlkIC0gbXRpbWVyLT5oYXJ0aWRfYmFzZTsKKwor
ICAgIG10aW1lci0+dGltZWNtcFtoYXJ0aWRdID0gdmFsdWU7CisgICAgaWYgKG10aW1lci0+dGlt
ZWNtcFtoYXJ0aWRdIDw9IHJ0YykgeworICAgICAgICAvKgorICAgICAgICAgKiBJZiB3ZSdyZSBz
ZXR0aW5nIGFuIE1USU1FQ01QIHZhbHVlIGluIHRoZSAicGFzdCIsCisgICAgICAgICAqIGltbWVk
aWF0ZWx5IHJhaXNlIHRoZSB0aW1lciBpbnRlcnJ1cHQKKyAgICAgICAgICovCisgICAgICAgIHFl
bXVfaXJxX3JhaXNlKG10aW1lci0+dGltZXJfaXJxc1toYXJ0aWRdKTsKKyAgICAgICAgcmV0dXJu
OworICAgIH0KKworICAgIC8qIG90aGVyd2lzZSwgc2V0IHVwIHRoZSBmdXR1cmUgdGltZXIgaW50
ZXJydXB0ICovCisgICAgcWVtdV9pcnFfbG93ZXIobXRpbWVyLT50aW1lcl9pcnFzW2hhcnRpZF0p
OworICAgIGRpZmYgPSBtdGltZXItPnRpbWVjbXBbaGFydGlkXSAtIHJ0YzsKKyAgICAvKiBiYWNr
IHRvIG5zIChub3RlIGFyZ3Mgc3dpdGNoZWQgaW4gbXVsZGl2NjQpICovCisgICAgdWludDY0X3Qg
bnNfZGlmZiA9IG11bGRpdjY0KGRpZmYsIE5BTk9TRUNPTkRTX1BFUl9TRUNPTkQsIHRpbWViYXNl
X2ZyZXEpOworCisgICAgLyoKKyAgICAgKiBjaGVjayBpZiBuc19kaWZmIG92ZXJmbG93ZWQgYW5k
IGNoZWNrIGlmIHRoZSBhZGRpdGlvbiB3b3VsZCBwb3RlbnRpYWxseQorICAgICAqIG92ZXJmbG93
CisgICAgICovCisgICAgaWYgKChOQU5PU0VDT05EU19QRVJfU0VDT05EID4gdGltZWJhc2VfZnJl
cSAmJiBuc19kaWZmIDwgZGlmZikgfHwKKyAgICAgICAgbnNfZGlmZiA+IElOVDY0X01BWCkgewor
ICAgICAgICBuZXh0ID0gSU5UNjRfTUFYOworICAgIH0gZWxzZSB7CisgICAgICAgIC8qCisgICAg
ICAgICAqIGFzIGl0IGlzIHZlcnkgdW5saWtlbHkgcWVtdV9jbG9ja19nZXRfbnMgd2lsbCByZXR1
cm4gYSB2YWx1ZQorICAgICAgICAgKiBncmVhdGVyIHRoYW4gSU5UNjRfTUFYLCBubyBhZGRpdGlv
bmFsIGNoZWNrIGlzIG5lZWRlZCBmb3IgYW4KKyAgICAgICAgICogdW5zaWduZWQgaW50ZWdlciBv
dmVyZmxvdy4KKyAgICAgICAgICovCisgICAgICAgIG5leHQgPSBxZW11X2Nsb2NrX2dldF9ucyhR
RU1VX0NMT0NLX1ZJUlRVQUwpICsgbnNfZGlmZjsKKyAgICAgICAgLyoKKyAgICAgICAgICogaWYg
bnNfZGlmZiBpcyBJTlQ2NF9NQVggbmV4dCBtYXkgc3RpbGwgYmUgb3V0c2lkZSB0aGUgcmFuZ2UK
KyAgICAgICAgICogb2YgYSBzaWduZWQgaW50ZWdlci4KKyAgICAgICAgICovCisgICAgICAgIG5l
eHQgPSBNSU4obmV4dCwgSU5UNjRfTUFYKTsKKyAgICB9CisKKyAgICB0aW1lcl9tb2QobXRpbWVy
LT50aW1lcnNbaGFydGlkXSwgbmV4dCk7Cit9CisKKy8qCisgKiBDYWxsYmFjayB1c2VkIHdoZW4g
dGhlIHRpbWVyIHNldCB1c2luZyB0aW1lcl9tb2QgZXhwaXJlcy4KKyAqIFNob3VsZCByYWlzZSB0
aGUgdGltZXIgaW50ZXJydXB0IGxpbmUKKyAqLworc3RhdGljIHZvaWQgdmVnYV9hY2xpbnRfbXRp
bWVyX2NiKHZvaWQgKm9wYXF1ZSkKK3sKKyAgICB2ZWdhX2FjbGludF9tdGltZXJfY2FsbGJhY2sg
KnN0YXRlID0gb3BhcXVlOworCisgICAgcWVtdV9pcnFfcmFpc2Uoc3RhdGUtPnMtPnRpbWVyX2ly
cXNbc3RhdGUtPm51bV0pOworfQorCisvKiBDUFUgcmVhZCBNVElNRVIgcmVnaXN0ZXIgKi8KK3N0
YXRpYyB1aW50NjRfdCB2ZWdhX2FjbGludF9tdGltZXJfcmVhZCh2b2lkICpvcGFxdWUsIGh3YWRk
ciBhZGRyLAorICAgIHVuc2lnbmVkIHNpemUpCit7CisgICAgVkVHQUFjbGludE1UaW1lclN0YXRl
ICptdGltZXIgPSBvcGFxdWU7CisKKyAgICBpZiAoYWRkciA+PSBtdGltZXItPnRpbWVjbXBfYmFz
ZSAmJgorICAgICAgICBhZGRyIDwgKG10aW1lci0+dGltZWNtcF9iYXNlICsgKG10aW1lci0+bnVt
X2hhcnRzIDw8IDMpKSkgeworICAgICAgICBzaXplX3QgaGFydGlkID0gbXRpbWVyLT5oYXJ0aWRf
YmFzZSArCisgICAgICAgICAgICAgICAgICAgICAgICAoKGFkZHIgLSBtdGltZXItPnRpbWVjbXBf
YmFzZSkgPj4gMyk7CisgICAgICAgIENQVVN0YXRlICpjcHUgPSBjcHVfYnlfYXJjaF9pZChoYXJ0
aWQpOworICAgICAgICBDUFVSSVNDVlN0YXRlICplbnYgPSBjcHUgPyBjcHVfZW52KGNwdSkgOiBO
VUxMOworICAgICAgICBpZiAoIWVudikgeworICAgICAgICAgICAgcWVtdV9sb2dfbWFzayhMT0df
R1VFU1RfRVJST1IsCisgICAgICAgICAgICAgICAgICAgICAgICAgICJhY2xpbnQtbXRpbWVyOiBp
bnZhbGlkIGhhcnRpZDogJXp1IiwgaGFydGlkKTsKKyAgICAgICAgfSBlbHNlIGlmICgoYWRkciAm
IDB4NykgPT0gMCkgeworICAgICAgICAgICAgLyogdGltZWNtcF9sbyBmb3IgUlYzMi9SVjY0IG9y
IHRpbWVjbXAgZm9yIFJWNjQgKi8KKyAgICAgICAgICAgIHVpbnQ2NF90IHRpbWVjbXAgPSBtdGlt
ZXItPnRpbWVjbXBbaGFydGlkXTsKKyAgICAgICAgICAgIHJldHVybiAoc2l6ZSA9PSA0KSA/ICh0
aW1lY21wICYgMHhGRkZGRkZGRikgOiB0aW1lY21wOworICAgICAgICB9IGVsc2UgaWYgKChhZGRy
ICYgMHg3KSA9PSA0KSB7CisgICAgICAgICAgICAvKiB0aW1lY21wX2hpICovCisgICAgICAgICAg
ICB1aW50NjRfdCB0aW1lY21wID0gbXRpbWVyLT50aW1lY21wW2hhcnRpZF07CisgICAgICAgICAg
ICByZXR1cm4gKHRpbWVjbXAgPj4gMzIpICYgMHhGRkZGRkZGRjsKKyAgICAgICAgfSBlbHNlIHsK
KyAgICAgICAgICAgIHFlbXVfbG9nX21hc2soTE9HX1VOSU1QLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAiYWNsaW50LW10aW1lcjogaW52YWxpZCByZWFkOiAlMDh4IiwgKHVpbnQzMl90KWFk
ZHIpOworICAgICAgICAgICAgcmV0dXJuIDA7CisgICAgICAgIH0KKyAgICB9IGVsc2UgaWYgKGFk
ZHIgPT0gbXRpbWVyLT50aW1lX2Jhc2UpIHsKKyAgICAgICAgLyogdGltZV9sbyBmb3IgUlYzMi9S
VjY0IG9yIHRpbWVjbXAgZm9yIFJWNjQgKi8KKyAgICAgICAgdWludDY0X3QgcnRjID0gY3B1X3Zl
Z2FfcmVhZF9ydGMobXRpbWVyKTsKKyAgICAgICAgcmV0dXJuIChzaXplID09IDQpID8gKHJ0YyAm
IDB4RkZGRkZGRkYpIDogcnRjOworICAgIH0gZWxzZSBpZiAoYWRkciA9PSBtdGltZXItPnRpbWVf
YmFzZSArIDQpIHsKKyAgICAgICAgLyogdGltZV9oaSAqLworICAgICAgICByZXR1cm4gKGNwdV92
ZWdhX3JlYWRfcnRjKG10aW1lcikgPj4gMzIpICYgMHhGRkZGRkZGRjsKKyAgICB9CisKKyAgICBx
ZW11X2xvZ19tYXNrKExPR19VTklNUCwKKyAgICAgICAgICAgICAgICAgICJhY2xpbnQtbXRpbWVy
OiBpbnZhbGlkIHJlYWQ6ICUwOHgiLCAodWludDMyX3QpYWRkcik7CisgICAgcmV0dXJuIDA7Cit9
CisKKy8qIENQVSB3cml0ZSBNVElNRVIgcmVnaXN0ZXIgKi8KK3N0YXRpYyB2b2lkIHZlZ2FfYWNs
aW50X210aW1lcl93cml0ZSh2b2lkICpvcGFxdWUsIGh3YWRkciBhZGRyLAorICAgIHVpbnQ2NF90
IHZhbHVlLCB1bnNpZ25lZCBzaXplKQoreworICAgIFZFR0FBY2xpbnRNVGltZXJTdGF0ZSAqbXRp
bWVyID0gb3BhcXVlOworICAgIGludCBpOworCisgICAgaWYgKGFkZHIgPj0gbXRpbWVyLT50aW1l
Y21wX2Jhc2UgJiYKKyAgICAgICAgYWRkciA8IChtdGltZXItPnRpbWVjbXBfYmFzZSArIChtdGlt
ZXItPm51bV9oYXJ0cyA8PCA1KSkpIHsKKyAgICAgICAgc2l6ZV90IGhhcnRpZCA9IG10aW1lci0+
aGFydGlkX2Jhc2UgKworICAgICAgICAgICAgICAgICAgICAgICAgKChhZGRyIC0gbXRpbWVyLT50
aW1lY21wX2Jhc2UpID4+IDUpOworCisgICAgICAgIENQVVN0YXRlICpjcHUgPSBjcHVfYnlfYXJj
aF9pZChoYXJ0aWQpOworICAgICAgICBDUFVSSVNDVlN0YXRlICplbnYgPSBjcHUgPyBjcHVfZW52
KGNwdSkgOiBOVUxMOworICAgICAgICBpZiAoIWVudikgeworICAgICAgICAgICAgcWVtdV9sb2df
bWFzayhMT0dfR1VFU1RfRVJST1IsCisgICAgICAgICAgICAgICAgICAgICAgICAgICJhY2xpbnQt
bXRpbWVyOiBpbnZhbGlkIGhhcnRpZDogJXp1IiwgaGFydGlkKTsKKyAgICAgICAgfSBlbHNlIGlm
ICgoYWRkciAmIDB4NykgPT0gMCkgeworICAgICAgICAgICAgaWYgKHNpemUgPT0gNCkgeworICAg
ICAgICAgICAgICAgIC8qIHRpbWVjbXBfbG8gZm9yIFJWMzIvUlY2NCAqLworICAgICAgICAgICAg
ICAgIHVpbnQ2NF90IHRpbWVjbXBfaGkgPSBtdGltZXItPnRpbWVjbXBbaGFydGlkXSA+PiAzMjsK
KyAgICAgICAgICAgICAgICB2ZWdhX2FjbGludF9tdGltZXJfd3JpdGVfdGltZWNtcChtdGltZXIs
IFJJU0NWX0NQVShjcHUpLCBoYXJ0aWQsCisgICAgICAgICAgICAgICAgICAgIHRpbWVjbXBfaGkg
PDwgMzIgfCAodmFsdWUgJiAweEZGRkZGRkZGKSk7CisgICAgICAgICAgICB9IGVsc2UgeworICAg
ICAgICAgICAgICAgIC8qIHRpbWVjbXAgZm9yIFJWNjQgKi8KKyAgICAgICAgICAgICAgICB2ZWdh
X2FjbGludF9tdGltZXJfd3JpdGVfdGltZWNtcChtdGltZXIsIFJJU0NWX0NQVShjcHUpLCBoYXJ0
aWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZh
bHVlKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIGlmICgoYWRkciAmIDB4NykgPT0g
NCkgeworICAgICAgICAgICAgaWYgKHNpemUgPT0gNCkgeworICAgICAgICAgICAgICAgIC8qIHRp
bWVjbXBfaGkgZm9yIFJWMzIvUlY2NCAqLworICAgICAgICAgICAgICAgIHVpbnQ2NF90IHRpbWVj
bXBfbG8gPSBtdGltZXItPnRpbWVjbXBbaGFydGlkXTsKKyAgICAgICAgICAgICAgICB2ZWdhX2Fj
bGludF9tdGltZXJfd3JpdGVfdGltZWNtcChtdGltZXIsIFJJU0NWX0NQVShjcHUpLCBoYXJ0aWQs
CisgICAgICAgICAgICAgICAgICAgIHZhbHVlIDw8IDMyIHwgKHRpbWVjbXBfbG8gJiAweEZGRkZG
RkZGKSk7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIHFlbXVfbG9nX21h
c2soTE9HX0dVRVNUX0VSUk9SLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFjbGlu
dC1tdGltZXI6IGludmFsaWQgdGltZWNtcF9oaSB3cml0ZTogJTA4eCIsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAodWludDMyX3QpYWRkcik7CisgICAgICAgICAgICB9CisgICAgICAg
IH0gZWxzZSB7CisgICAgICAgICAgICBxZW11X2xvZ19tYXNrKExPR19VTklNUCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgImFjbGludC1tdGltZXI6IGludmFsaWQgdGltZWNtcCB3cml0ZTog
JTA4eCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICh1aW50MzJfdClhZGRyKTsKKyAgICAg
ICAgfQorICAgICAgICByZXR1cm47CisgICAgfSBlbHNlIGlmIChhZGRyID09IG10aW1lci0+dGlt
ZV9iYXNlIHx8IGFkZHIgPT0gbXRpbWVyLT50aW1lX2Jhc2UgKyA0KSB7CisgICAgICAgIHVpbnQ2
NF90IHJ0Y19yID0gY3B1X3ZlZ2FfcmVhZF9ydGNfcmF3KG10aW1lci0+dGltZWJhc2VfZnJlcSk7
CisgICAgICAgIHVpbnQ2NF90IHJ0YyA9IGNwdV92ZWdhX3JlYWRfcnRjKG10aW1lcik7CisKKyAg
ICAgICAgaWYgKGFkZHIgPT0gbXRpbWVyLT50aW1lX2Jhc2UpIHsKKyAgICAgICAgICAgIGlmIChz
aXplID09IDQpIHsKKyAgICAgICAgICAgICAgICAvKiB0aW1lX2xvIGZvciBSVjMyL1JWNjQgKi8K
KyAgICAgICAgICAgICAgICBtdGltZXItPnRpbWVfZGVsdGEgPSAoKHJ0YyAmIH4weEZGRkZGRkZG
VUxMKSB8IHZhbHVlKSAtIHJ0Y19yOworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAg
ICAgICAvKiB0aW1lIGZvciBSVjY0ICovCisgICAgICAgICAgICAgICAgbXRpbWVyLT50aW1lX2Rl
bHRhID0gdmFsdWUgLSBydGNfcjsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIHsKKyAg
ICAgICAgICAgIGlmIChzaXplID09IDQpIHsKKyAgICAgICAgICAgICAgICAvKiB0aW1lX2hpIGZv
ciBSVjMyL1JWNjQgKi8KKyAgICAgICAgICAgICAgICBtdGltZXItPnRpbWVfZGVsdGEgPSAodmFs
dWUgPDwgMzIgfCAocnRjICYgMHhGRkZGRkZGRikpIC0gcnRjX3I7CisgICAgICAgICAgICB9IGVs
c2UgeworICAgICAgICAgICAgICAgIHFlbXVfbG9nX21hc2soTE9HX0dVRVNUX0VSUk9SLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgImFjbGludC1tdGltZXI6IGludmFsaWQgdGltZV9o
aSB3cml0ZTogJTA4eCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodWludDMyX3Qp
YWRkcik7CisgICAgICAgICAgICAgICAgcmV0dXJuOworICAgICAgICAgICAgfQorICAgICAgICB9
CisKKyAgICAgICAgLyogQ2hlY2sgaWYgdGltZXIgaW50ZXJydXB0IGlzIHRyaWdnZXJlZCBmb3Ig
ZWFjaCBoYXJ0LiAqLworICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbXRpbWVyLT5udW1faGFydHM7
IGkrKykgeworICAgICAgICAgICAgQ1BVU3RhdGUgKmNwdSA9IGNwdV9ieV9hcmNoX2lkKG10aW1l
ci0+aGFydGlkX2Jhc2UgKyBpKTsKKyAgICAgICAgICAgIENQVVJJU0NWU3RhdGUgKmVudiA9IGNw
dSA/IGNwdV9lbnYoY3B1KSA6IE5VTEw7CisgICAgICAgICAgICBpZiAoIWVudikgeworICAgICAg
ICAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAgICAgfQorICAgICAgICAgICAgdmVnYV9hY2xp
bnRfbXRpbWVyX3dyaXRlX3RpbWVjbXAobXRpbWVyLCBSSVNDVl9DUFUoY3B1KSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdGltZXItPmhhcnRpZF9iYXNl
ICsgaSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdGlt
ZXItPnRpbWVjbXBbaV0pOworICAgICAgICAgICAgcmlzY3ZfdGltZXJfd3JpdGVfdGltZWNtcChl
bnYsIGVudi0+c3RpbWVyLCBlbnYtPnN0aW1lY21wLCAwLCBNSVBfU1RJUCk7CisgICAgICAgICAg
ICByaXNjdl90aW1lcl93cml0ZV90aW1lY21wKGVudiwgZW52LT52c3RpbWVyLCBlbnYtPnZzdGlt
ZWNtcCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW52LT5odGltZWRl
bHRhLCBNSVBfVlNUSVApOworCisgICAgICAgIH0KKyAgICAgICAgcmV0dXJuOworICAgIH0KKwor
ICAgIHFlbXVfbG9nX21hc2soTE9HX1VOSU1QLAorICAgICAgICAgICAgICAgICAgImFjbGludC1t
dGltZXI6IGludmFsaWQgd3JpdGU6ICUwOHgiLCAodWludDMyX3QpYWRkcik7Cit9CisKK3N0YXRp
YyBjb25zdCBNZW1vcnlSZWdpb25PcHMgdmVnYV9hY2xpbnRfbXRpbWVyX29wcyA9IHsKKyAgICAu
cmVhZCA9IHZlZ2FfYWNsaW50X210aW1lcl9yZWFkLAorICAgIC53cml0ZSA9IHZlZ2FfYWNsaW50
X210aW1lcl93cml0ZSwKKyAgICAuZW5kaWFubmVzcyA9IERFVklDRV9MSVRUTEVfRU5ESUFOLAor
ICAgIC52YWxpZCA9IHsKKyAgICAgICAgLm1pbl9hY2Nlc3Nfc2l6ZSA9IDQsCisgICAgICAgIC5t
YXhfYWNjZXNzX3NpemUgPSA4CisgICAgfSwKKyAgICAuaW1wbCA9IHsKKyAgICAgICAgLm1pbl9h
Y2Nlc3Nfc2l6ZSA9IDQsCisgICAgICAgIC5tYXhfYWNjZXNzX3NpemUgPSA4LAorICAgIH0KK307
CisKK3N0YXRpYyBjb25zdCBQcm9wZXJ0eSB2ZWdhX2FjbGludF9tdGltZXJfcHJvcGVydGllc1td
ID0geworICAgIERFRklORV9QUk9QX1VJTlQzMigiaGFydGlkLWJhc2UiLCBWRUdBQWNsaW50TVRp
bWVyU3RhdGUsCisgICAgICAgIGhhcnRpZF9iYXNlLCAwKSwKKyAgICBERUZJTkVfUFJPUF9VSU5U
MzIoIm51bS1oYXJ0cyIsIFZFR0FBY2xpbnRNVGltZXJTdGF0ZSwgbnVtX2hhcnRzLCAxKSwKKyAg
ICBERUZJTkVfUFJPUF9VSU5UMzIoInRpbWVjbXAtYmFzZSIsIFZFR0FBY2xpbnRNVGltZXJTdGF0
ZSwKKyAgICAgICAgdGltZWNtcF9iYXNlLCBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FQ01QKSwK
KyAgICBERUZJTkVfUFJPUF9VSU5UMzIoInRpbWUtYmFzZSIsIFZFR0FBY2xpbnRNVGltZXJTdGF0
ZSwKKyAgICAgICAgdGltZV9iYXNlLCBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FKSwKKyAgICBE
RUZJTkVfUFJPUF9VSU5UMzIoImFwZXJ0dXJlLXNpemUiLCBWRUdBQWNsaW50TVRpbWVyU3RhdGUs
CisgICAgICAgIGFwZXJ0dXJlX3NpemUsIFZFR0FfQUNMSU5UX0RFRkFVTFRfTVRJTUVSX1NJWkUp
LAorICAgIERFRklORV9QUk9QX1VJTlQzMigidGltZWJhc2UtZnJlcSIsIFZFR0FBY2xpbnRNVGlt
ZXJTdGF0ZSwKKyAgICAgICAgdGltZWJhc2VfZnJlcSwgMCksCit9OworCitzdGF0aWMgdm9pZCB2
ZWdhX2FjbGludF9tdGltZXJfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnAp
Cit7CisgICAgVkVHQUFjbGludE1UaW1lclN0YXRlICpzID0gVkVHQV9BQ0xJTlRfTVRJTUVSKGRl
dik7CisgICAgaW50IGk7CisKKyAgICBtZW1vcnlfcmVnaW9uX2luaXRfaW8oJnMtPm1taW8sIE9C
SkVDVChkZXYpLCAmdmVnYV9hY2xpbnRfbXRpbWVyX29wcywKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgcywgVFlQRV9WRUdBX0FDTElOVF9NVElNRVIsIHMtPmFwZXJ0dXJlX3NpemUpOworICAg
IHN5c2J1c19pbml0X21taW8oU1lTX0JVU19ERVZJQ0UoZGV2KSwgJnMtPm1taW8pOworCisgICAg
cy0+dGltZXJfaXJxcyA9IGdfbmV3KHFlbXVfaXJxLCBzLT5udW1faGFydHMpOworICAgIHFkZXZf
aW5pdF9ncGlvX291dChkZXYsIHMtPnRpbWVyX2lycXMsIHMtPm51bV9oYXJ0cyk7CisKKyAgICBz
LT50aW1lcnMgPSBnX25ldzAoUUVNVVRpbWVyICosIHMtPm51bV9oYXJ0cyk7CisgICAgcy0+dGlt
ZWNtcCA9IGdfbmV3MCh1aW50NjRfdCwgcy0+bnVtX2hhcnRzKTsKKyAgICAvKiBDbGFpbSB0aW1l
ciBpbnRlcnJ1cHQgYml0cyAqLworICAgIGZvciAoaSA9IDA7IGkgPCBzLT5udW1faGFydHM7IGkr
KykgeworICAgICAgICBSSVNDVkNQVSAqY3B1ID0gUklTQ1ZfQ1BVKGNwdV9ieV9hcmNoX2lkKHMt
PmhhcnRpZF9iYXNlICsgaSkpOworICAgICAgICBpZiAocmlzY3ZfY3B1X2NsYWltX2ludGVycnVw
dHMoY3B1LCBNSVBfTVRJUCkgPCAwKSB7CisgICAgICAgICAgICBlcnJvcl9yZXBvcnQoIk1USVAg
YWxyZWFkeSBjbGFpbWVkIik7CisgICAgICAgICAgICBleGl0KDEpOworICAgICAgICB9CisgICAg
fQorfQorCitzdGF0aWMgdm9pZCB2ZWdhX2FjbGludF9tdGltZXJfcmVzZXRfZW50ZXIoT2JqZWN0
ICpvYmosIFJlc2V0VHlwZSB0eXBlKQoreworICAgIC8qCisgICAgICogQWNjb3JkaW5nIHRvIFJJ
U0MtViBBQ0xJTlQgc3BlYzoKKyAgICAgKiAgIC0gT24gTVRJTUVSIGRldmljZSByZXNldCwgdGhl
IE1USU1FIHJlZ2lzdGVyIGlzIGNsZWFyZWQgdG8gemVyby4KKyAgICAgKiAgIC0gT24gTVRJTUVS
IGRldmljZSByZXNldCwgdGhlIE1USU1FQ01QIHJlZ2lzdGVycyBhcmUgaW4gdW5rbm93biBzdGF0
ZS4KKyAgICAgKi8KKyAgICBWRUdBQWNsaW50TVRpbWVyU3RhdGUgKm10aW1lciA9IFZFR0FfQUNM
SU5UX01USU1FUihvYmopOworCisgICAgLyoKKyAgICAgKiBDbGVhciBtdGltZSByZWdpc3RlciBi
eSB3cml0aW5nIHRvIDAgaXQuCisgICAgICogUGVuZGluZyBtdGltZSBpbnRlcnJ1cHRzIHdpbGwg
YWxzbyBiZSBjbGVhcmVkIGF0IHRoZSBzYW1lIHRpbWUuCisgICAgICovCisgICAgdmVnYV9hY2xp
bnRfbXRpbWVyX3dyaXRlKG10aW1lciwgbXRpbWVyLT50aW1lX2Jhc2UsIDAsIDgpOworfQorCitz
dGF0aWMgY29uc3QgVk1TdGF0ZURlc2NyaXB0aW9uIHZtc3RhdGVfdmVnYV9tdGltZXIgPSB7Cisg
ICAgLm5hbWUgPSAidmVnYV9tdGltZXIiLAorICAgIC52ZXJzaW9uX2lkID0gMSwKKyAgICAubWlu
aW11bV92ZXJzaW9uX2lkID0gMSwKKyAgICAuZmllbGRzID0gKGNvbnN0IFZNU3RhdGVGaWVsZFtd
KSB7CisgICAgICAgICAgICBWTVNUQVRFX1ZBUlJBWV9VSU5UMzIodGltZWNtcCwgVkVHQUFjbGlu
dE1UaW1lclN0YXRlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bV9oYXJ0
cywgMCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bXN0YXRlX2luZm9fdWlu
dDY0LCB1aW50NjRfdCksCisgICAgICAgICAgICBWTVNUQVRFX0VORF9PRl9MSVNUKCkKKyAgICAg
ICAgfQorfTsKKworc3RhdGljIHZvaWQgdmVnYV9hY2xpbnRfbXRpbWVyX2NsYXNzX2luaXQoT2Jq
ZWN0Q2xhc3MgKmtsYXNzLCBjb25zdCB2b2lkICpkYXRhKQoreworICAgIERldmljZUNsYXNzICpk
YyA9IERFVklDRV9DTEFTUyhrbGFzcyk7CisgICAgZGMtPnJlYWxpemUgPSB2ZWdhX2FjbGludF9t
dGltZXJfcmVhbGl6ZTsKKyAgICBkZXZpY2VfY2xhc3Nfc2V0X3Byb3BzKGRjLCB2ZWdhX2FjbGlu
dF9tdGltZXJfcHJvcGVydGllcyk7CisgICAgUmVzZXR0YWJsZUNsYXNzICpyYyA9IFJFU0VUVEFC
TEVfQ0xBU1Moa2xhc3MpOworICAgIHJjLT5waGFzZXMuZW50ZXIgPSB2ZWdhX2FjbGludF9tdGlt
ZXJfcmVzZXRfZW50ZXI7CisgICAgZGMtPnZtc2QgPSAmdm1zdGF0ZV92ZWdhX210aW1lcjsKK30K
Kworc3RhdGljIGNvbnN0IFR5cGVJbmZvIHZlZ2FfYWNsaW50X210aW1lcl9pbmZvID0geworICAg
IC5uYW1lICAgICAgICAgID0gVFlQRV9WRUdBX0FDTElOVF9NVElNRVIsCisgICAgLnBhcmVudCAg
ICAgICAgPSBUWVBFX1NZU19CVVNfREVWSUNFLAorICAgIC5pbnN0YW5jZV9zaXplID0gc2l6ZW9m
KFZFR0FBY2xpbnRNVGltZXJTdGF0ZSksCisgICAgLmNsYXNzX2luaXQgICAgPSB2ZWdhX2FjbGlu
dF9tdGltZXJfY2xhc3NfaW5pdCwKK307CisKKy8qCisgKiBDcmVhdGUgQUNMSU5UIE1USU1FUiBk
ZXZpY2UuCisgKi8KK0RldmljZVN0YXRlICp2ZWdhX2FjbGludF9tdGltZXJfY3JlYXRlKGh3YWRk
ciBhZGRyLCBod2FkZHIgc2l6ZSwKKyAgICB1aW50MzJfdCBoYXJ0aWRfYmFzZSwgdWludDMyX3Qg
bnVtX2hhcnRzLAorICAgIHVpbnQzMl90IHRpbWVjbXBfYmFzZSwgdWludDMyX3QgdGltZV9iYXNl
LCB1aW50MzJfdCB0aW1lYmFzZV9mcmVxLAorICAgIGJvb2wgcHJvdmlkZV9yZHRpbWUpCit7Cisg
ICAgaW50IGk7CisgICAgRGV2aWNlU3RhdGUgKmRldiA9IHFkZXZfbmV3KFRZUEVfVkVHQV9BQ0xJ
TlRfTVRJTUVSKTsKKyAgICBWRUdBQWNsaW50TVRpbWVyU3RhdGUgKnMgPSBWRUdBX0FDTElOVF9N
VElNRVIoZGV2KTsKKworICAgIGFzc2VydChudW1faGFydHMgPD0gVkVHQV9BQ0xJTlRfTUFYX0hB
UlRTKTsKKyAgICBhc3NlcnQoIShhZGRyICYgMHg3KSk7CisgICAgYXNzZXJ0KCEodGltZWNtcF9i
YXNlICYgMHg3KSk7CisgICAgYXNzZXJ0KCEodGltZV9iYXNlICYgMHg3KSk7CisKKyAgICBxZGV2
X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJoYXJ0aWQtYmFzZSIsIGhhcnRpZF9iYXNlKTsKKyAgICBx
ZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJudW0taGFydHMiLCBudW1faGFydHMpOworICAgIHFk
ZXZfcHJvcF9zZXRfdWludDMyKGRldiwgInRpbWVjbXAtYmFzZSIsIHRpbWVjbXBfYmFzZSk7Cisg
ICAgcWRldl9wcm9wX3NldF91aW50MzIoZGV2LCAidGltZS1iYXNlIiwgdGltZV9iYXNlKTsKKyAg
ICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJhcGVydHVyZS1zaXplIiwgc2l6ZSk7CisgICAg
cWRldl9wcm9wX3NldF91aW50MzIoZGV2LCAidGltZWJhc2UtZnJlcSIsIHRpbWViYXNlX2ZyZXEp
OworICAgIHN5c2J1c19yZWFsaXplX2FuZF91bnJlZihTWVNfQlVTX0RFVklDRShkZXYpLCAmZXJy
b3JfZmF0YWwpOworICAgIHN5c2J1c19tbWlvX21hcChTWVNfQlVTX0RFVklDRShkZXYpLCAwLCBh
ZGRyKTsKKworICAgIGZvciAoaSA9IDA7IGkgPCBudW1faGFydHM7IGkrKykgeworICAgICAgICBD
UFVTdGF0ZSAqY3B1ID0gY3B1X2J5X2FyY2hfaWQoaGFydGlkX2Jhc2UgKyBpKTsKKyAgICAgICAg
UklTQ1ZDUFUgKnJ2Y3B1ID0gUklTQ1ZfQ1BVKGNwdSk7CisgICAgICAgIENQVVJJU0NWU3RhdGUg
KmVudiA9IGNwdSA/IGNwdV9lbnYoY3B1KSA6IE5VTEw7CisgICAgICAgIHZlZ2FfYWNsaW50X210
aW1lcl9jYWxsYmFjayAqY2IgPQorICAgICAgICAgICAgZ19uZXcwKHZlZ2FfYWNsaW50X210aW1l
cl9jYWxsYmFjaywgMSk7CisKKyAgICAgICAgaWYgKCFlbnYpIHsKKyAgICAgICAgICAgIGdfZnJl
ZShjYik7CisgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgfQorICAgICAgICBpZiAocHJv
dmlkZV9yZHRpbWUpIHsKKyAgICAgICAgICAgIHJpc2N2X2NwdV9zZXRfcmR0aW1lX2ZuKGVudiwg
Y3B1X3ZlZ2FfcmVhZF9ydGMsIGRldik7CisgICAgICAgIH0KKworICAgICAgICBjYi0+cyA9IHM7
CisgICAgICAgIGNiLT5udW0gPSBpOworICAgICAgICBzLT50aW1lcnNbaV0gPSB0aW1lcl9uZXdf
bnMoUUVNVV9DTE9DS19WSVJUVUFMLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZ2ZWdhX2FjbGludF9tdGltZXJfY2IsIGNiKTsKKyAgICAgICAgcy0+dGltZWNtcFtpXSA9IDA7
CisKKyAgICAgICAgcWRldl9jb25uZWN0X2dwaW9fb3V0KGRldiwgaSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHFkZXZfZ2V0X2dwaW9faW4oREVWSUNFKHJ2Y3B1KSwgSVJRX01fVElN
RVIpKTsKKyAgICB9CisKKyAgICByZXR1cm4gZGV2OworfQorCisvKiBDUFUgcmVhZCBbTXxTXVNX
SSByZWdpc3RlciAqLworc3RhdGljIHVpbnQ2NF90IHZlZ2FfYWNsaW50X3N3aV9yZWFkKHZvaWQg
Km9wYXF1ZSwgaHdhZGRyIGFkZHIsCisgICAgdW5zaWduZWQgc2l6ZSkKK3sKKyAgICBWRUdBQWNs
aW50U3dpU3RhdGUgKnN3aSA9IG9wYXF1ZTsKKworICAgIGlmIChhZGRyIDwgKHN3aS0+bnVtX2hh
cnRzIDw8IDQpKSB7CisgICAgICAgIHNpemVfdCBoYXJ0aWQgPSBzd2ktPmhhcnRpZF9iYXNlICsg
KGFkZHIgPj4gNCk7CisgICAgICAgIENQVVN0YXRlICpjcHUgPSBjcHVfYnlfYXJjaF9pZChoYXJ0
aWQpOworICAgICAgICBDUFVSSVNDVlN0YXRlICplbnYgPSBjcHUgPyBjcHVfZW52KGNwdSkgOiBO
VUxMOworICAgICAgICBpZiAoIWVudikgeworICAgICAgICAgICAgcWVtdV9sb2dfbWFzayhMT0df
R1VFU1RfRVJST1IsCisgICAgICAgICAgICAgICAgICAgICAgICAgICJhY2xpbnQtc3dpOiBpbnZh
bGlkIGhhcnRpZDogJXp1IiwgaGFydGlkKTsKKyAgICAgICAgfSBlbHNlIGlmICgoYWRkciAmIDB4
MykgPT0gMCkgeworICAgICAgICAgICAgcmV0dXJuIChzd2ktPnNzd2kpID8gMCA6ICgoZW52LT5t
aXAgJiBNSVBfTVNJUCkgPiAwKTsKKyAgICAgICAgfQorICAgIH0KKworICAgIHFlbXVfbG9nX21h
c2soTE9HX1VOSU1QLAorICAgICAgICAgICAgICAgICAgImFjbGludC1zd2k6IGludmFsaWQgcmVh
ZDogJTA4eCIsICh1aW50MzJfdClhZGRyKTsKKyAgICByZXR1cm4gMDsKK30KKworLyogQ1BVIHdy
aXRlIFtNfFNdU1dJIHJlZ2lzdGVyICovCitzdGF0aWMgdm9pZCB2ZWdhX2FjbGludF9zd2lfd3Jp
dGUodm9pZCAqb3BhcXVlLCBod2FkZHIgYWRkciwgdWludDY0X3QgdmFsdWUsCisgICAgICAgIHVu
c2lnbmVkIHNpemUpCit7CisgICAgVkVHQUFjbGludFN3aVN0YXRlICpzd2kgPSBvcGFxdWU7CisK
KyAgICBpZiAoYWRkciA8IChzd2ktPm51bV9oYXJ0cyA8PCA0KSkgeworICAgICAgICBzaXplX3Qg
aGFydGlkID0gc3dpLT5oYXJ0aWRfYmFzZSArIChhZGRyID4+IDQpOworCisgICAgICAgIENQVVN0
YXRlICpjcHUgPSBjcHVfYnlfYXJjaF9pZChoYXJ0aWQpOworICAgICAgICBDUFVSSVNDVlN0YXRl
ICplbnYgPSBjcHUgPyBjcHVfZW52KGNwdSkgOiBOVUxMOworICAgICAgICBpZiAoIWVudikgewor
ICAgICAgICAgICAgcWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICJhY2xpbnQtc3dpOiBpbnZhbGlkIGhhcnRpZDogJXp1IiwgaGFydGlkKTsK
KyAgICAgICAgfSBlbHNlIGlmICgoYWRkciAmIDB4MykgPT0gMCkgeworICAgICAgICAgICAgaWYg
KHZhbHVlICYgMHgxKSB7CisgICAgICAgICAgICAgICAgcWVtdV9pcnFfcmFpc2Uoc3dpLT5zb2Z0
X2lycXNbaGFydGlkIC0gc3dpLT5oYXJ0aWRfYmFzZV0pOworICAgICAgICAgICAgfSBlbHNlIHsK
KyAgICAgICAgICAgICAgICBpZiAoIXN3aS0+c3N3aSkgeworICAgICAgICAgICAgICAgICAgICBx
ZW11X2lycV9sb3dlcihzd2ktPnNvZnRfaXJxc1toYXJ0aWQgLSBzd2ktPmhhcnRpZF9iYXNlXSk7
CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICAgICAgcmV0dXJuOwor
ICAgICAgICB9CisgICAgfQorCisgICAgcWVtdV9sb2dfbWFzayhMT0dfVU5JTVAsCisgICAgICAg
ICAgICAgICAgICAiYWNsaW50LXN3aTogaW52YWxpZCB3cml0ZTogJTA4eCIsICh1aW50MzJfdClh
ZGRyKTsKK30KKworc3RhdGljIGNvbnN0IE1lbW9yeVJlZ2lvbk9wcyB2ZWdhX2FjbGludF9zd2lf
b3BzID0geworICAgIC5yZWFkID0gdmVnYV9hY2xpbnRfc3dpX3JlYWQsCisgICAgLndyaXRlID0g
dmVnYV9hY2xpbnRfc3dpX3dyaXRlLAorICAgIC5lbmRpYW5uZXNzID0gREVWSUNFX0xJVFRMRV9F
TkRJQU4sCisgICAgLnZhbGlkID0geworICAgICAgICAubWluX2FjY2Vzc19zaXplID0gNCwKKyAg
ICAgICAgLm1heF9hY2Nlc3Nfc2l6ZSA9IDQKKyAgICB9Cit9OworCitzdGF0aWMgY29uc3QgUHJv
cGVydHkgdmVnYV9hY2xpbnRfc3dpX3Byb3BlcnRpZXNbXSA9IHsKKyAgICBERUZJTkVfUFJPUF9V
SU5UMzIoImhhcnRpZC1iYXNlIiwgVkVHQUFjbGludFN3aVN0YXRlLCBoYXJ0aWRfYmFzZSwgMCks
CisgICAgREVGSU5FX1BST1BfVUlOVDMyKCJudW0taGFydHMiLCBWRUdBQWNsaW50U3dpU3RhdGUs
IG51bV9oYXJ0cywgMSksCisgICAgREVGSU5FX1BST1BfVUlOVDMyKCJzc3dpIiwgVkVHQUFjbGlu
dFN3aVN0YXRlLCBzc3dpLCBmYWxzZSksCit9OworCitzdGF0aWMgdm9pZCB2ZWdhX2FjbGludF9z
d2lfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCit7CisgICAgVkVHQUFj
bGludFN3aVN0YXRlICpzd2kgPSBWRUdBX0FDTElOVF9TV0koZGV2KTsKKyAgICBpbnQgaTsKKwor
ICAgIG1lbW9yeV9yZWdpb25faW5pdF9pbygmc3dpLT5tbWlvLCBPQkpFQ1QoZGV2KSwgJnZlZ2Ff
YWNsaW50X3N3aV9vcHMsIHN3aSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgVFlQRV9WRUdB
X0FDTElOVF9TV0ksIFZFR0FfQUNMSU5UX1NXSV9TSVpFKTsKKyAgICBzeXNidXNfaW5pdF9tbWlv
KFNZU19CVVNfREVWSUNFKGRldiksICZzd2ktPm1taW8pOworCisgICAgc3dpLT5zb2Z0X2lycXMg
PSBnX25ldyhxZW11X2lycSwgc3dpLT5udW1faGFydHMpOworICAgIHFkZXZfaW5pdF9ncGlvX291
dChkZXYsIHN3aS0+c29mdF9pcnFzLCBzd2ktPm51bV9oYXJ0cyk7CisKKyAgICAvKiBDbGFpbSBz
b2Z0d2FyZSBpbnRlcnJ1cHQgYml0cyAqLworICAgIGZvciAoaSA9IDA7IGkgPCBzd2ktPm51bV9o
YXJ0czsgaSsrKSB7CisgICAgICAgIFJJU0NWQ1BVICpjcHUgPSBSSVNDVl9DUFUocWVtdV9nZXRf
Y3B1KHN3aS0+aGFydGlkX2Jhc2UgKyBpKSk7CisgICAgICAgIC8qIFdlIGRvbid0IGNsYWltIG1p
cC5TU0lQIGJlY2F1c2UgaXQgaXMgd3JpdGFibGUgYnkgc29mdHdhcmUgKi8KKyAgICAgICAgaWYg
KHJpc2N2X2NwdV9jbGFpbV9pbnRlcnJ1cHRzKGNwdSwgc3dpLT5zc3dpID8gMCA6IE1JUF9NU0lQ
KSA8IDApIHsKKyAgICAgICAgICAgIGVycm9yX3JlcG9ydCgiTVNJUCBhbHJlYWR5IGNsYWltZWQi
KTsKKyAgICAgICAgICAgIGV4aXQoMSk7CisgICAgICAgIH0KKyAgICB9Cit9CisKK3N0YXRpYyB2
b2lkIHZlZ2FfYWNsaW50X3N3aV9yZXNldF9lbnRlcihPYmplY3QgKm9iaiwgUmVzZXRUeXBlIHR5
cGUpCit7CisgICAgLyoKKyAgICAgKiBBY2NvcmRpbmcgdG8gUklTQy1WIEFDTElOVCBzcGVjOgor
ICAgICAqICAgLSBPbiBNU1dJIGRldmljZSByZXNldCwgZWFjaCBNU0lQIHJlZ2lzdGVyIGlzIGNs
ZWFyZWQgdG8gemVyby4KKyAgICAgKgorICAgICAqIHAucy4gU1NXSSBkZXZpY2UgcmVzZXQgZG9l
cyBub3RoaW5nIHNpbmNlIFNFVFNJUCByZWdpc3RlciBhbHdheXMgcmVhZHMgMC4KKyAgICAgKi8K
KyAgICBWRUdBQWNsaW50U3dpU3RhdGUgKnN3aSA9IFZFR0FfQUNMSU5UX1NXSShvYmopOworICAg
IGludCBpOworCisgICAgaWYgKCFzd2ktPnNzd2kpIHsKKyAgICAgICAgZm9yIChpID0gMDsgaSA8
IHN3aS0+bnVtX2hhcnRzOyBpKyspIHsKKyAgICAgICAgICAgIC8qIENsZWFyIE1TSVAgcmVnaXN0
ZXJzIGJ5IGxvd2VyaW5nIHNvZnR3YXJlIGludGVycnVwdHMuICovCisgICAgICAgICAgICBxZW11
X2lycV9sb3dlcihzd2ktPnNvZnRfaXJxc1tpXSk7CisgICAgICAgIH0KKyAgICB9Cit9CisKK3N0
YXRpYyB2b2lkIHZlZ2FfYWNsaW50X3N3aV9jbGFzc19pbml0KE9iamVjdENsYXNzICprbGFzcywg
Y29uc3Qgdm9pZCAqZGF0YSkKK3sKKyAgICBEZXZpY2VDbGFzcyAqZGMgPSBERVZJQ0VfQ0xBU1Mo
a2xhc3MpOworICAgIGRjLT5yZWFsaXplID0gdmVnYV9hY2xpbnRfc3dpX3JlYWxpemU7CisgICAg
ZGV2aWNlX2NsYXNzX3NldF9wcm9wcyhkYywgdmVnYV9hY2xpbnRfc3dpX3Byb3BlcnRpZXMpOwor
ICAgIFJlc2V0dGFibGVDbGFzcyAqcmMgPSBSRVNFVFRBQkxFX0NMQVNTKGtsYXNzKTsKKyAgICBy
Yy0+cGhhc2VzLmVudGVyID0gdmVnYV9hY2xpbnRfc3dpX3Jlc2V0X2VudGVyOworfQorCitzdGF0
aWMgY29uc3QgVHlwZUluZm8gdmVnYV9hY2xpbnRfc3dpX2luZm8gPSB7CisgICAgLm5hbWUgICAg
ICAgICAgPSBUWVBFX1ZFR0FfQUNMSU5UX1NXSSwKKyAgICAucGFyZW50ICAgICAgICA9IFRZUEVf
U1lTX0JVU19ERVZJQ0UsCisgICAgLmluc3RhbmNlX3NpemUgPSBzaXplb2YoVkVHQUFjbGludFN3
aVN0YXRlKSwKKyAgICAuY2xhc3NfaW5pdCAgICA9IHZlZ2FfYWNsaW50X3N3aV9jbGFzc19pbml0
LAorfTsKKworLyoKKyAqIENyZWF0ZSBBQ0xJTlQgW018U11TV0kgZGV2aWNlLgorICovCitEZXZp
Y2VTdGF0ZSAqdmVnYV9hY2xpbnRfc3dpX2NyZWF0ZShod2FkZHIgYWRkciwgdWludDMyX3QgaGFy
dGlkX2Jhc2UsCisgICAgdWludDMyX3QgbnVtX2hhcnRzLCBib29sIHNzd2kpCit7CisgICAgaW50
IGk7CisgICAgRGV2aWNlU3RhdGUgKmRldiA9IHFkZXZfbmV3KFRZUEVfVkVHQV9BQ0xJTlRfU1dJ
KTsKKworICAgIGFzc2VydChudW1faGFydHMgPD0gVkVHQV9BQ0xJTlRfTUFYX0hBUlRTKTsKKyAg
ICBhc3NlcnQoIShhZGRyICYgMHgzKSk7CisKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYs
ICJoYXJ0aWQtYmFzZSIsIGhhcnRpZF9iYXNlKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihk
ZXYsICJudW0taGFydHMiLCBudW1faGFydHMpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDMyKGRl
diwgInNzd2kiLCBzc3dpID8gdHJ1ZSA6IGZhbHNlKTsKKyAgICBzeXNidXNfcmVhbGl6ZV9hbmRf
dW5yZWYoU1lTX0JVU19ERVZJQ0UoZGV2KSwgJmVycm9yX2ZhdGFsKTsKKyAgICBzeXNidXNfbW1p
b19tYXAoU1lTX0JVU19ERVZJQ0UoZGV2KSwgMCwgYWRkcik7CisKKyAgICBmb3IgKGkgPSAwOyBp
IDwgbnVtX2hhcnRzOyBpKyspIHsKKyAgICAgICAgQ1BVU3RhdGUgKmNwdSA9IGNwdV9ieV9hcmNo
X2lkKGhhcnRpZF9iYXNlICsgaSk7CisgICAgICAgIFJJU0NWQ1BVICpydmNwdSA9IFJJU0NWX0NQ
VShjcHUpOworCisgICAgICAgIHFkZXZfY29ubmVjdF9ncGlvX291dChkZXYsIGksCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBxZGV2X2dldF9ncGlvX2luKERFVklDRShydmNwdSksCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNzd2kpID8gSVJRX1NfU09GVCA6IElS
UV9NX1NPRlQpKTsKKyAgICB9CisKKyAgICByZXR1cm4gZGV2OworfQorCitzdGF0aWMgdm9pZCB2
ZWdhX2FjbGludF9yZWdpc3Rlcl90eXBlcyh2b2lkKQoreworICAgIHR5cGVfcmVnaXN0ZXJfc3Rh
dGljKCZ2ZWdhX2FjbGludF9tdGltZXJfaW5mbyk7CisgICAgdHlwZV9yZWdpc3Rlcl9zdGF0aWMo
JnZlZ2FfYWNsaW50X3N3aV9pbmZvKTsKK30KKwordHlwZV9pbml0KHZlZ2FfYWNsaW50X3JlZ2lz
dGVyX3R5cGVzKQpkaWZmIC0tZ2l0IGEvaHcvaW50Yy92ZWdhX3BsaWMuYyBiL2h3L2ludGMvdmVn
YV9wbGljLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMC4uN2U0YzZiOWFj
NQotLS0gL2Rldi9udWxsCisrKyBiL2h3L2ludGMvdmVnYV9wbGljLmMKQEAgLTAsMCArMSw0OTYg
QEAKKy8qCisgKiBWRUdBIFBMSUMgKFBsYXRmb3JtIExldmVsIEludGVycnVwdCBDb250cm9sbGVy
KQorICovCisjaW5jbHVkZSAicWVtdS9vc2RlcC5oIgorI2luY2x1ZGUgInFhcGkvZXJyb3IuaCIK
KyNpbmNsdWRlICJxZW11L2xvZy5oIgorI2luY2x1ZGUgInFlbXUvbW9kdWxlLmgiCisjaW5jbHVk
ZSAicWVtdS9lcnJvci1yZXBvcnQuaCIKKyNpbmNsdWRlICJody9zeXNidXMuaCIKKyNpbmNsdWRl
ICJody9wY2kvbXNpLmgiCisjaW5jbHVkZSAiaHcvcWRldi1wcm9wZXJ0aWVzLmgiCisjaW5jbHVk
ZSAiaHcvaW50Yy92ZWdhX3BsaWMuaCIKKyNpbmNsdWRlICJ0YXJnZXQvcmlzY3YvY3B1LmgiCisj
aW5jbHVkZSAibWlncmF0aW9uL3Ztc3RhdGUuaCIKKyNpbmNsdWRlICJody9pcnEuaCIKKyNpbmNs
dWRlICJzeXN0ZW0va3ZtLmgiCisKK3N0YXRpYyBib29sIGFkZHJfYmV0d2Vlbih1aW50MzJfdCBh
ZGRyLCB1aW50MzJfdCBiYXNlLCB1aW50MzJfdCBudW0pCit7CisgICAgcmV0dXJuIGFkZHIgPj0g
YmFzZSAmJiBhZGRyIC0gYmFzZSA8IG51bTsKK30KKworc3RhdGljIFBMSUNNb2RlIGNoYXJfdG9f
bW9kZShjaGFyIGMpCit7CisgICAgc3dpdGNoIChjKSB7CisgICAgY2FzZSAnVSc6IHJldHVybiBQ
TElDTW9kZV9VOworICAgIGNhc2UgJ1MnOiByZXR1cm4gUExJQ01vZGVfUzsKKyAgICBjYXNlICdN
JzogcmV0dXJuIFBMSUNNb2RlX007CisgICAgZGVmYXVsdDoKKyAgICAgICAgZXJyb3JfcmVwb3J0
KCJwbGljOiBpbnZhbGlkIG1vZGUgJyVjJyIsIGMpOworICAgICAgICBleGl0KDEpOworICAgIH0K
K30KKworc3RhdGljIHVpbnQzMl90IGF0b21pY19zZXRfbWFza2VkKHVpbnQzMl90ICphLCB1aW50
MzJfdCBtYXNrLCB1aW50MzJfdCB2YWx1ZSkKK3sKKyAgICB1aW50MzJfdCBvbGQsIG5ldywgY21w
ID0gcWF0b21pY19yZWFkKGEpOworCisgICAgZG8geworICAgICAgICBvbGQgPSBjbXA7CisgICAg
ICAgIG5ldyA9IChvbGQgJiB+bWFzaykgfCAodmFsdWUgJiBtYXNrKTsKKyAgICAgICAgY21wID0g
cWF0b21pY19jbXB4Y2hnKGEsIG9sZCwgbmV3KTsKKyAgICB9IHdoaWxlIChvbGQgIT0gY21wKTsK
KworICAgIHJldHVybiBvbGQ7Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfcGxpY19zZXRfcGVuZGlu
ZyhWZWdhUExJQ1N0YXRlICpwbGljLCBpbnQgaXJxLCBib29sIGxldmVsKQoreworICAgIGF0b21p
Y19zZXRfbWFza2VkKCZwbGljLT5wZW5kaW5nW2lycSA+PiA1XSwgMSA8PCAoaXJxICYgMzEpLCAt
ISFsZXZlbCk7Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfcGxpY19zZXRfY2xhaW1lZChWZWdhUExJ
Q1N0YXRlICpwbGljLCBpbnQgaXJxLCBib29sIGxldmVsKQoreworICAgIGF0b21pY19zZXRfbWFz
a2VkKCZwbGljLT5jbGFpbWVkW2lycSA+PiA1XSwgMSA8PCAoaXJxICYgMzEpLCAtISFsZXZlbCk7
Cit9CisKK3N0YXRpYyB1aW50MzJfdCB2ZWdhX3BsaWNfY2xhaW1lZChWZWdhUExJQ1N0YXRlICpw
bGljLCB1aW50MzJfdCBhZGRyaWQpCit7CisgICAgdWludDMyX3QgbWF4X2lycSA9IDA7CisgICAg
dWludDMyX3QgbWF4X3ByaW8gPSBwbGljLT50YXJnZXRfcHJpb3JpdHlbYWRkcmlkXTsKKyAgICBp
bnQgaSwgajsKKyAgICBpbnQgbnVtX2lycV9pbl93b3JkID0gMzI7CisKKyAgICBmb3IgKGkgPSAw
OyBpIDwgcGxpYy0+Yml0ZmllbGRfd29yZHM7IGkrKykgeworICAgICAgICB1aW50MzJfdCBwZW5k
aW5nX2VuYWJsZWRfbm90X2NsYWltZWQgPQorICAgICAgICAgICAgICAgICAgICAgICAgKHBsaWMt
PnBlbmRpbmdbaV0gJiB+cGxpYy0+Y2xhaW1lZFtpXSkgJgorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHBsaWMtPmVuYWJsZVthZGRyaWQgKiBwbGljLT5iaXRmaWVsZF93b3JkcyArIGldOwor
CisgICAgICAgIGlmICghcGVuZGluZ19lbmFibGVkX25vdF9jbGFpbWVkKSB7CisgICAgICAgICAg
ICBjb250aW51ZTsKKyAgICAgICAgfQorCisgICAgICAgIGlmIChpID09IChwbGljLT5iaXRmaWVs
ZF93b3JkcyAtIDEpKSB7CisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICogSWYgcGxpYy0+
bnVtX3NvdXJjZXMgaXMgbm90IG11bHRpcGxlIG9mIDMyLCBudW0tb2YtaXJxIGluIGxhc3QKKyAg
ICAgICAgICAgICAqIHdvcmQgaXMgbm90IDMyLiBDb21wdXRlIHRoZSBudW0tb2YtaXJxIG9mIGxh
c3Qgd29yZCB0byBhdm9pZAorICAgICAgICAgICAgICogb3V0LW9mLWJvdW5kIGFjY2VzcyBvZiBz
b3VyY2VfcHJpb3JpdHkgYXJyYXkuCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIG51bV9p
cnFfaW5fd29yZCA9IHBsaWMtPm51bV9zb3VyY2VzIC0gKChwbGljLT5iaXRmaWVsZF93b3JkcyAt
IDEpIDw8IDUpOworICAgICAgICB9CisKKyAgICAgICAgZm9yIChqID0gMDsgaiA8IG51bV9pcnFf
aW5fd29yZDsgaisrKSB7CisgICAgICAgICAgICBpbnQgaXJxID0gKGkgPDwgNSkgKyBqOworICAg
ICAgICAgICAgdWludDMyX3QgcHJpbyA9IHBsaWMtPnNvdXJjZV9wcmlvcml0eVtpcnFdOworICAg
ICAgICAgICAgaW50IGVuYWJsZWQgPSBwZW5kaW5nX2VuYWJsZWRfbm90X2NsYWltZWQgJiAoMSA8
PCBqKTsKKworICAgICAgICAgICAgaWYgKGVuYWJsZWQgJiYgcHJpbyA+IG1heF9wcmlvKSB7Cisg
ICAgICAgICAgICAgICAgbWF4X2lycSA9IGlycTsKKyAgICAgICAgICAgICAgICBtYXhfcHJpbyA9
IHByaW87CisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9CisKKyAgICByZXR1cm4gbWF4
X2lycTsKK30KKworc3RhdGljIHZvaWQgdmVnYV9wbGljX3VwZGF0ZShWZWdhUExJQ1N0YXRlICpw
bGljKQoreworICAgIGludCBhZGRyaWQ7CisKKyAgICAvKiByYWlzZSBpcnEgb24gaGFydHMgd2hl
cmUgdGhpcyBpcnEgaXMgZW5hYmxlZCAqLworICAgIGZvciAoYWRkcmlkID0gMDsgYWRkcmlkIDwg
cGxpYy0+bnVtX2FkZHJzOyBhZGRyaWQrKykgeworICAgICAgICB1aW50MzJfdCBoYXJ0aWQgPSBw
bGljLT5hZGRyX2NvbmZpZ1thZGRyaWRdLmhhcnRpZDsKKyAgICAgICAgUExJQ01vZGUgbW9kZSA9
IHBsaWMtPmFkZHJfY29uZmlnW2FkZHJpZF0ubW9kZTsKKyAgICAgICAgYm9vbCBsZXZlbCA9ICEh
dmVnYV9wbGljX2NsYWltZWQocGxpYywgYWRkcmlkKTsKKworICAgICAgICBzd2l0Y2ggKG1vZGUp
IHsKKyAgICAgICAgY2FzZSBQTElDTW9kZV9NOgorICAgICAgICAgICAgcWVtdV9zZXRfaXJxKHBs
aWMtPm1fZXh0ZXJuYWxfaXJxc1toYXJ0aWQgLSBwbGljLT5oYXJ0aWRfYmFzZV0sIGxldmVsKTsK
KyAgICAgICAgICAgIGJyZWFrOworICAgICAgICBjYXNlIFBMSUNNb2RlX1M6CisgICAgICAgICAg
ICBxZW11X3NldF9pcnEocGxpYy0+c19leHRlcm5hbF9pcnFzW2hhcnRpZCAtIHBsaWMtPmhhcnRp
ZF9iYXNlXSwgbGV2ZWwpOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIGRlZmF1bHQ6Cisg
ICAgICAgICAgICBicmVhazsKKyAgICAgICAgfQorICAgIH0KK30KKworICAgIHVpbnQzMl90IHZl
Z2FfcHJpb3JpdHlfcmVncyA9IDB4MTA7ICAgIC8vMTYgSVBScyAocHJpb3JpdHkpCisgICAgdWlu
dDMyX3QgdmVnYV9wZW5kaW5nX3JlZ3MgPSAweDQ7ICAgICAgLy80IElQUnMgKHBlbmRpbmcpCisg
ICAgdWludDMyX3QgdmVnYV9lbmFibGVfcmVnX3NpemUgPSAweDEwMDsgLy80IElFUnMgKGVuYWJs
ZSkKKworc3RhdGljIHVpbnQ2NF90IHZlZ2FfcGxpY19yZWFkKHZvaWQgKm9wYXF1ZSwgaHdhZGRy
IGFkZHIsIHVuc2lnbmVkIHNpemUpCit7CisgICAgVmVnYVBMSUNTdGF0ZSAqcGxpYyA9IG9wYXF1
ZTsKKworICAgIGlmIChhZGRyX2JldHdlZW4oYWRkciwgcGxpYy0+cHJpb3JpdHlfYmFzZSwgdmVn
YV9wcmlvcml0eV9yZWdzIDw8IDIpKSB7ICAgICAgLy9CZXR3ZWVuICAweDAwIGFuZCAweDQwIChX
cml0ZSBvbmx5KQorICAgICAgICB1aW50MzJfdCBpcnEgPSAoYWRkciA+PiAyKSAqIDg7CisgICAg
ICAgIHVpbnQzMl90IHJlc3VsdCA9IDA7CisKKyAgICAgICAgZm9yKHVpbnQzMl90IGkgPSAwOyBp
IDwgODsgaSsrKQorICAgICAgICB7CisgICAgICAgICAgICBpZihpcnEgIT0gMCkKKyAgICAgICAg
ICAgIHsKKyAgICAgICAgICAgICAgICByZXN1bHQgfD0gKHBsaWMtPnNvdXJjZV9wcmlvcml0eVtp
cnFdICYmIDB4ZikgPDwgKGkgKiA0KTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICBpcnEgKys7
CisgICAgICAgIH0KKyAgICAgICAgcmV0dXJuIHJlc3VsdDsKKyAgICB9IGVsc2UgaWYgKGFkZHJf
YmV0d2VlbihhZGRyLCBwbGljLT5wZW5kaW5nX2Jhc2UsIHZlZ2FfcGVuZGluZ19yZWdzIDw8IDIp
KXsgIC8vQmV0d2VlbiAweDgwIGFuZCAweDkwIChSZWFkIG9ubHkpCisgICAgICAgIHVpbnQzMl90
IHdvcmQgPSAoYWRkciAtIHBsaWMtPnBlbmRpbmdfYmFzZSkgPj4gMjsKKworICAgICAgICByZXR1
cm4gcGxpYy0+cGVuZGluZ1t3b3JkXTsKKyAgICB9ZWxzZSBpZiAoYWRkcl9iZXR3ZWVuKGFkZHIs
IHBsaWMtPmVuYWJsZV9iYXNlLHZlZ2FfZW5hYmxlX3JlZ19zaXplKSkgeyAgICAgLy9CZXR3ZWVu
IDB4MTAwIGFuZCAweDIwMAorICAgICAgICB1aW50MzJfdCBhZGRyaWQgPSAoYWRkciAtIHBsaWMt
PmVuYWJsZV9iYXNlKSAvIHBsaWMtPmVuYWJsZV9zdHJpZGU7CisgICAgICAgIHVpbnQzMl90IHdv
cmRpZCA9IChhZGRyIC0gcGxpYy0+ZW5hYmxlX2Jhc2UgLSAoYWRkcmlkICogcGxpYy0+ZW5hYmxl
X3N0cmlkZSkpID4+IDI7CisKKyAgICAgICAgaWYgKHdvcmRpZCA8IHBsaWMtPmJpdGZpZWxkX3dv
cmRzKSB7CisgICAgICAgICAgICByZXR1cm4gcGxpYy0+ZW5hYmxlW2FkZHJpZCAqIHBsaWMtPmJp
dGZpZWxkX3dvcmRzICsgd29yZGlkXTsKKyAgICAgICAgfQorICAgIH0gZWxzZSBpZiAoYWRkcl9i
ZXR3ZWVuKGFkZHIsIHBsaWMtPmNvbnRleHRfYmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBwbGljLT5udW1fYWRkcnMgKiBwbGljLT5jb250ZXh0X3N0cmlkZSkpIHsKKyAgICAgICAg
dWludDMyX3QgYWRkcmlkID0gKGFkZHIgLSBwbGljLT5jb250ZXh0X2Jhc2UpIC8gcGxpYy0+Y29u
dGV4dF9zdHJpZGU7CisgICAgICAgIHVpbnQzMl90IGNvbnRleHRpZCA9IChhZGRyICYgKHBsaWMt
PmNvbnRleHRfc3RyaWRlIC0gMSkpOworCisgICAgICAgIGlmIChjb250ZXh0aWQgPT0gMCkgewor
ICAgICAgICAgICAgcmV0dXJuIHBsaWMtPnRhcmdldF9wcmlvcml0eVthZGRyaWRdOworICAgICAg
ICB9IGVsc2UgaWYgKGNvbnRleHRpZCA9PSA0KSB7CisgICAgICAgICAgICB1aW50MzJfdCBtYXhf
aXJxID0gdmVnYV9wbGljX2NsYWltZWQocGxpYywgYWRkcmlkKTsKKworICAgICAgICAgICAgaWYg
KG1heF9pcnEpIHsKKyAgICAgICAgICAgICAgICB2ZWdhX3BsaWNfc2V0X3BlbmRpbmcocGxpYywg
bWF4X2lycSwgZmFsc2UpOworICAgICAgICAgICAgICAgIHZlZ2FfcGxpY19zZXRfY2xhaW1lZChw
bGljLCBtYXhfaXJxLCB0cnVlKTsKKyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgdmVnYV9w
bGljX3VwZGF0ZShwbGljKTsKKyAgICAgICAgICAgIHJldHVybiBtYXhfaXJxOworICAgICAgICB9
CisgICAgfQorCisgICAgcWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCisgICAgICAgICAg
ICAgICAgICAiJXM6IEludmFsaWQgcmVnaXN0ZXIgcmVhZCAweCUiIEhXQUREUl9QUkl4ICJcbiIs
CisgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgYWRkcik7CisgICAgcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyB2b2lkIHZlZ2FfcGxpY193cml0ZSh2b2lkICpvcGFxdWUsIGh3YWRkciBhZGRyLCB1
aW50NjRfdCB2YWx1ZSwKKyAgICAgICAgdW5zaWduZWQgc2l6ZSkKK3sKKyAgICBWZWdhUExJQ1N0
YXRlICpwbGljID0gb3BhcXVlOworIAorICAgIGlmIChhZGRyX2JldHdlZW4oYWRkciwgcGxpYy0+
cHJpb3JpdHlfYmFzZSwgdmVnYV9wcmlvcml0eV9yZWdzIDw8IDIpKSB7ICAvL0JldHdlZW4gIDB4
MDAgYW5kIDB4NDAgKFdyaXRlIG9ubHkpCisgICAgICAgIAorICAgICAgICB1aW50MzJfdCBpcnEg
PSAoYWRkciA+PiAyKSAqIDg7CisgICAgICAgIGZvcih1aW50MzJfdCBpID0gMDsgaSA8IDg7IGkr
KykKKyAgICAgICAgeworICAgICAgICAgICAgaWYoaXJxICE9IDApeworICAgICAgICAgICAgICAg
IHBsaWMtPnNvdXJjZV9wcmlvcml0eVtpcnFdID0gKHZhbHVlID4+IChpICogNCkpICYmIDB4ZmY7
CisgICAgICAgICAgICAgICAgdmVnYV9wbGljX3VwZGF0ZShwbGljKTsKKyAgICAgICAgICAgIH0K
KyAgICAgICAgICAgIGlycSArKzsgCisgICAgICAgIH0KKyAgICB9IGVsc2UgaWYgKGFkZHJfYmV0
d2VlbihhZGRyLCBwbGljLT5wZW5kaW5nX2Jhc2UsIHZlZ2FfcGVuZGluZ19yZWdzIDw8IDIpKSB7
IC8vQmV0d2VlbiAweDgwIGFuZCAweDkwIChSZWFkIG9ubHkpCisgICAgICAgIHFlbXVfbG9nX21h
c2soTE9HX0dVRVNUX0VSUk9SLAorICAgICAgICAgICAgICAgICAgICAgICIlczogaW52YWxpZCBw
ZW5kaW5nIHdyaXRlOiAweCUiIEhXQUREUl9QUkl4ICIiLAorICAgICAgICAgICAgICAgICAgICAg
IF9fZnVuY19fLCBhZGRyKTsKKyAgICB9IGVsc2UgaWYgKGFkZHJfYmV0d2VlbihhZGRyLCBwbGlj
LT5lbmFibGVfYmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWdhX2VuYWJsZV9y
ZWdfc2l6ZSkpIHsgIC8vQmV0d2VlbiAweDEwMCBhbmQgMHgyMDAKKyAgICAgICAgdWludDMyX3Qg
YWRkcmlkID0gKGFkZHIgLSBwbGljLT5lbmFibGVfYmFzZSkgLyBwbGljLT5lbmFibGVfc3RyaWRl
OworICAgICAgICB1aW50MzJfdCB3b3JkaWQgPSAoYWRkciAtIHBsaWMtPmVuYWJsZV9iYXNlIC0g
KGFkZHJpZCAqIHBsaWMtPmVuYWJsZV9zdHJpZGUpKSA+PiAyOworCisgICAgICAgIGlmICh3b3Jk
aWQgPCBwbGljLT5iaXRmaWVsZF93b3JkcykgeworICAgICAgICAgICAgcGxpYy0+ZW5hYmxlW2Fk
ZHJpZCAqIHBsaWMtPmJpdGZpZWxkX3dvcmRzICsgd29yZGlkXSA9IHZhbHVlOworICAgICAgICB9
IGVsc2UgeworICAgICAgICAgICAgcWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICIlczogSW52YWxpZCBlbmFibGUgd3JpdGUgMHglIiBIV0FE
RFJfUFJJeCAiXG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywgYWRkcik7
CisgICAgICAgIH0KKyAgICB9IGVsc2UgaWYgKGFkZHJfYmV0d2VlbihhZGRyLCBwbGljLT5jb250
ZXh0X2Jhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxpYy0+bnVtX2FkZHJzICog
cGxpYy0+Y29udGV4dF9zdHJpZGUpKSB7CisgICAgICAgIHVpbnQzMl90IGFkZHJpZCA9IChhZGRy
IC0gcGxpYy0+Y29udGV4dF9iYXNlKSAvIHBsaWMtPmNvbnRleHRfc3RyaWRlOworICAgICAgICB1
aW50MzJfdCBjb250ZXh0aWQgPSAoYWRkciAmIChwbGljLT5jb250ZXh0X3N0cmlkZSAtIDEpKTsK
KworICAgICAgICBpZiAoY29udGV4dGlkID09IDApIHsKKyAgICAgICAgICAgIGlmICh2YWx1ZSA8
PSBwbGljLT5udW1fcHJpb3JpdGllcykgeworICAgICAgICAgICAgICAgIHBsaWMtPnRhcmdldF9w
cmlvcml0eVthZGRyaWRdID0gdmFsdWU7CisgICAgICAgICAgICAgICAgdmVnYV9wbGljX3VwZGF0
ZShwbGljKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0aWQgPT0g
NCkgeworICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IHBsaWMtPm51bV9zb3VyY2VzKSB7Cisg
ICAgICAgICAgICAgICAgICAgIHZlZ2FfcGxpY19zZXRfY2xhaW1lZChwbGljLCB2YWx1ZSwgZmFs
c2UpOworICAgICAgICAgICAgICAgICAgICB2ZWdhX3BsaWNfdXBkYXRlKHBsaWMpOworICAgICAg
ICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIHFlbXVfbG9nX21hc2so
TE9HX0dVRVNUX0VSUk9SLAorICAgICAgICAgICAgICAgICAgICAgICAgICAiJXM6IEludmFsaWQg
Y29udGV4dCB3cml0ZSAweCUiIEhXQUREUl9QUkl4ICJcbiIsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgIF9fZnVuY19fLCBhZGRyKTsKKyAgICAgICAgfQorICAgIH0gZWxzZSB7CisgICAgICAg
IHFlbXVfbG9nX21hc2soTE9HX0dVRVNUX0VSUk9SLAorICAgICAgICAgICAgICAgICAgICAgICIl
czogSW52YWxpZCByZWdpc3RlciB3cml0ZSAweCUiIEhXQUREUl9QUkl4ICJcbiIsCisgICAgICAg
ICAgICAgICAgICAgICAgX19mdW5jX18sIGFkZHIpOworICAgIH0KK30KKworc3RhdGljIGNvbnN0
IE1lbW9yeVJlZ2lvbk9wcyB2ZWdhX3BsaWNfb3BzID0geworICAgIC5yZWFkID0gdmVnYV9wbGlj
X3JlYWQsCisgICAgLndyaXRlID0gdmVnYV9wbGljX3dyaXRlLAorICAgIC5lbmRpYW5uZXNzID0g
REVWSUNFX0xJVFRMRV9FTkRJQU4sCisgICAgLnZhbGlkID0geworICAgICAgICAubWluX2FjY2Vz
c19zaXplID0gNCwKKyAgICAgICAgLm1heF9hY2Nlc3Nfc2l6ZSA9IDQKKyAgICB9Cit9OworCitz
dGF0aWMgdm9pZCB2ZWdhX3BsaWNfcmVzZXQoRGV2aWNlU3RhdGUgKmRldikKK3sKKyAgICBWZWdh
UExJQ1N0YXRlICpzID0gVkVHQV9QTElDKGRldik7CisgICAgaW50IGk7CisKKyAgICBtZW1zZXQo
cy0+c291cmNlX3ByaW9yaXR5LCAwLCBzaXplb2YodWludDMyX3QpICogcy0+bnVtX3NvdXJjZXMp
OworICAgIG1lbXNldChzLT50YXJnZXRfcHJpb3JpdHksIDAsIHNpemVvZih1aW50MzJfdCkgKiBz
LT5udW1fYWRkcnMpOworICAgIG1lbXNldChzLT5wZW5kaW5nLCAwLCBzaXplb2YodWludDMyX3Qp
ICogcy0+Yml0ZmllbGRfd29yZHMpOworICAgIG1lbXNldChzLT5jbGFpbWVkLCAwLCBzaXplb2Yo
dWludDMyX3QpICogcy0+Yml0ZmllbGRfd29yZHMpOworICAgIG1lbXNldChzLT5lbmFibGUsIDAs
IHNpemVvZih1aW50MzJfdCkgKiBzLT5udW1fZW5hYmxlcyk7CisKKyAgICBmb3IgKGkgPSAwOyBp
IDwgcy0+bnVtX2hhcnRzOyBpKyspIHsKKyAgICAgICAgcWVtdV9zZXRfaXJxKHMtPm1fZXh0ZXJu
YWxfaXJxc1tpXSwgMCk7CisgICAgICAgIHFlbXVfc2V0X2lycShzLT5zX2V4dGVybmFsX2lycXNb
aV0sIDApOworICAgIH0KK30KKworLyoKKyAqIHBhcnNlIFBMSUMgaGFydC9tb2RlIGFkZHJlc3Mg
b2Zmc2V0IGNvbmZpZworICoKKyAqICJNIiAgICAgICAgICAgICAgMSBoYXJ0IHdpdGggTSBtb2Rl
CisgKiAiTVMsTVMiICAgICAgICAgIDIgaGFydHMsIDAtMSB3aXRoIE0gYW5kIFMgbW9kZQorICog
Ik0sTVMsTVMsTVMsTVMiICA1IGhhcnRzLCAwIHdpdGggTSBtb2RlLCAxLTUgd2l0aCBNIGFuZCBT
IG1vZGUKKyAqLworc3RhdGljIHZvaWQgcGFyc2VfaGFydF9jb25maWcoVmVnYVBMSUNTdGF0ZSAq
cGxpYykKK3sKKyAgICBpbnQgYWRkcmlkLCBoYXJ0aWQsIG1vZGVzLCBtOworICAgIGNvbnN0IGNo
YXIgKnA7CisgICAgY2hhciBjOworCisgICAgLyogY291bnQgYW5kIHZhbGlkYXRlIGhhcnQvbW9k
ZSBjb21iaW5hdGlvbnMgKi8KKyAgICBhZGRyaWQgPSAwLCBoYXJ0aWQgPSAwLCBtb2RlcyA9IDA7
CisgICAgcCA9IHBsaWMtPmhhcnRfY29uZmlnOworICAgIHdoaWxlICgoYyA9ICpwKyspKSB7Cisg
ICAgICAgIGlmIChjID09ICcsJykgeworICAgICAgICAgICAgaWYgKG1vZGVzKSB7CisgICAgICAg
ICAgICAgICAgYWRkcmlkICs9IGN0cG9wOChtb2Rlcyk7CisgICAgICAgICAgICAgICAgaGFydGlk
Kys7CisgICAgICAgICAgICAgICAgbW9kZXMgPSAwOworICAgICAgICAgICAgfQorICAgICAgICB9
IGVsc2UgeworICAgICAgICAgICAgbSA9IDEgPDwgY2hhcl90b19tb2RlKGMpOworICAgICAgICAg
ICAgaWYgKG1vZGVzID09IChtb2RlcyB8IG0pKSB7CisgICAgICAgICAgICAgICAgZXJyb3JfcmVw
b3J0KCJwbGljOiBkdXBsaWNhdGUgbW9kZSAnJWMnIGluIGNvbmZpZzogJXMiLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBjLCBwbGljLT5oYXJ0X2NvbmZpZyk7CisgICAgICAgICAgICAg
ICAgZXhpdCgxKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIG1vZGVzIHw9IG07CisgICAg
ICAgIH0KKyAgICB9CisgICAgaWYgKG1vZGVzKSB7CisgICAgICAgIGFkZHJpZCArPSBjdHBvcDgo
bW9kZXMpOworICAgICAgICBoYXJ0aWQrKzsKKyAgICAgICAgbW9kZXMgPSAwOworICAgIH0KKwor
ICAgIHBsaWMtPm51bV9hZGRycyA9IGFkZHJpZDsKKyAgICBwbGljLT5udW1faGFydHMgPSBoYXJ0
aWQ7CisKKyAgICAvKiBzdG9yZSBoYXJ0L21vZGUgY29tYmluYXRpb25zICovCisgICAgcGxpYy0+
YWRkcl9jb25maWcgPSBnX25ldyhQTElDQWRkciwgcGxpYy0+bnVtX2FkZHJzKTsKKyAgICBhZGRy
aWQgPSAwLCBoYXJ0aWQgPSBwbGljLT5oYXJ0aWRfYmFzZTsKKyAgICBwID0gcGxpYy0+aGFydF9j
b25maWc7CisgICAgd2hpbGUgKChjID0gKnArKykpIHsKKyAgICAgICAgaWYgKGMgPT0gJywnKSB7
CisgICAgICAgICAgICBpZiAobW9kZXMpIHsKKyAgICAgICAgICAgICAgICBoYXJ0aWQrKzsKKyAg
ICAgICAgICAgICAgICBtb2RlcyA9IDA7CisgICAgICAgICAgICB9CisgICAgICAgIH0gZWxzZSB7
CisgICAgICAgICAgICBtID0gY2hhcl90b19tb2RlKGMpOworICAgICAgICAgICAgcGxpYy0+YWRk
cl9jb25maWdbYWRkcmlkXS5hZGRyaWQgPSBhZGRyaWQ7CisgICAgICAgICAgICBwbGljLT5hZGRy
X2NvbmZpZ1thZGRyaWRdLmhhcnRpZCA9IGhhcnRpZDsKKyAgICAgICAgICAgIHBsaWMtPmFkZHJf
Y29uZmlnW2FkZHJpZF0ubW9kZSA9IG07CisgICAgICAgICAgICBtb2RlcyB8PSAoMSA8PCBtKTsK
KyAgICAgICAgICAgIGFkZHJpZCsrOworICAgICAgICB9CisgICAgfQorfQorCitzdGF0aWMgdm9p
ZCB2ZWdhX3BsaWNfaXJxX3JlcXVlc3Qodm9pZCAqb3BhcXVlLCBpbnQgaXJxLCBpbnQgbGV2ZWwp
Cit7CisgICAgVmVnYVBMSUNTdGF0ZSAqcyA9IG9wYXF1ZTsKKworICAgIGlmIChsZXZlbCA+IDAp
IHsKKyAgICAgICAgdmVnYV9wbGljX3NldF9wZW5kaW5nKHMsIGlycSwgdHJ1ZSk7CisgICAgICAg
IHZlZ2FfcGxpY191cGRhdGUocyk7CisgICAgfQorfQorCitzdGF0aWMgdm9pZCB2ZWdhX3BsaWNf
cmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCit7CisgICAgVmVnYVBMSUNT
dGF0ZSAqcyA9IFZFR0FfUExJQyhkZXYpOworICAgIGludCBpOworCisgICAgbWVtb3J5X3JlZ2lv
bl9pbml0X2lvKCZzLT5tbWlvLCBPQkpFQ1QoZGV2KSwgJnZlZ2FfcGxpY19vcHMsIHMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgIFRZUEVfVkVHQV9QTElDLCBzLT5hcGVydHVyZV9zaXplKTsK
KyAgICBzeXNidXNfaW5pdF9tbWlvKFNZU19CVVNfREVWSUNFKGRldiksICZzLT5tbWlvKTsKKwor
ICAgIHBhcnNlX2hhcnRfY29uZmlnKHMpOworCisgICAgaWYgKCFzLT5udW1fc291cmNlcykgewor
ICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJwbGljOiBpbnZhbGlkIG51bWJlciBvZiBpbnRlcnJ1
cHQgc291cmNlcyIpOworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAgcy0+Yml0ZmllbGRf
d29yZHMgPSAocy0+bnVtX3NvdXJjZXMgKyAzMSkgPj4gNTsKKyAgICBzLT5udW1fZW5hYmxlcyA9
IHMtPmJpdGZpZWxkX3dvcmRzICogcy0+bnVtX2FkZHJzOworICAgIHMtPnNvdXJjZV9wcmlvcml0
eSA9IGdfbmV3MCh1aW50MzJfdCwgcy0+bnVtX3NvdXJjZXMpOworICAgIHMtPnRhcmdldF9wcmlv
cml0eSA9IGdfbmV3KHVpbnQzMl90LCBzLT5udW1fYWRkcnMpOworICAgIHMtPnBlbmRpbmcgPSBn
X25ldzAodWludDMyX3QsIHMtPmJpdGZpZWxkX3dvcmRzKTsKKyAgICBzLT5jbGFpbWVkID0gZ19u
ZXcwKHVpbnQzMl90LCBzLT5iaXRmaWVsZF93b3Jkcyk7CisgICAgcy0+ZW5hYmxlID0gZ19uZXcw
KHVpbnQzMl90LCBzLT5udW1fZW5hYmxlcyk7CisKKyAgICBxZGV2X2luaXRfZ3Bpb19pbihkZXYs
IHZlZ2FfcGxpY19pcnFfcmVxdWVzdCwgcy0+bnVtX3NvdXJjZXMpOworCisgICAgcy0+c19leHRl
cm5hbF9pcnFzID0gZ19tYWxsb2Moc2l6ZW9mKHFlbXVfaXJxKSAqIHMtPm51bV9oYXJ0cyk7Cisg
ICAgcWRldl9pbml0X2dwaW9fb3V0KGRldiwgcy0+c19leHRlcm5hbF9pcnFzLCBzLT5udW1faGFy
dHMpOworCisgICAgcy0+bV9leHRlcm5hbF9pcnFzID0gZ19tYWxsb2Moc2l6ZW9mKHFlbXVfaXJx
KSAqIHMtPm51bV9oYXJ0cyk7CisgICAgcWRldl9pbml0X2dwaW9fb3V0KGRldiwgcy0+bV9leHRl
cm5hbF9pcnFzLCBzLT5udW1faGFydHMpOworCisgICAgLyoKKyAgICAgKiBXZSBjYW4ndCBhbGxv
dyB0aGUgc3VwZXJ2aXNvciB0byBjb250cm9sIFNFSVAgYXMgdGhpcyB3b3VsZCBhbGxvdyB0aGUK
KyAgICAgKiBzdXBlcnZpc29yIHRvIGNsZWFyIGEgcGVuZGluZyBleHRlcm5hbCBpbnRlcnJ1cHQg
d2hpY2ggd2lsbCByZXN1bHQgaW4KKyAgICAgKiBsb3N0IGEgaW50ZXJydXB0IGluIHRoZSBjYXNl
IGEgUExJQyBpcyBhdHRhY2hlZC4gVGhlIFNFSVAgYml0IG11c3QgYmUKKyAgICAgKiBoYXJkd2Fy
ZSBjb250cm9sbGVkIHdoZW4gYSBQTElDIGlzIGF0dGFjaGVkLgorICAgICAqLworICAgIGZvciAo
aSA9IDA7IGkgPCBzLT5udW1faGFydHM7IGkrKykgeworICAgICAgICBSSVNDVkNQVSAqY3B1ID0g
UklTQ1ZfQ1BVKHFlbXVfZ2V0X2NwdShzLT5oYXJ0aWRfYmFzZSArIGkpKTsKKyAgICAgICAgaWYg
KHJpc2N2X2NwdV9jbGFpbV9pbnRlcnJ1cHRzKGNwdSwgTUlQX1NFSVApIDwgMCkgeworICAgICAg
ICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiU0VJUCBhbHJlYWR5IGNsYWltZWQiKTsKKyAgICAgICAg
ICAgIHJldHVybjsKKyAgICAgICAgfQorICAgIH0KKworICAgIG1zaV9ub25icm9rZW4gPSB0cnVl
OworfQorCitzdGF0aWMgY29uc3QgVk1TdGF0ZURlc2NyaXB0aW9uIHZtc3RhdGVfdmVnYV9wbGlj
ID0geworICAgIC5uYW1lID0gInJpc2N2X3ZlZ2FfcGxpYyIsCisgICAgLnZlcnNpb25faWQgPSAx
LAorICAgIC5taW5pbXVtX3ZlcnNpb25faWQgPSAxLAorICAgIC5maWVsZHMgPSAoY29uc3QgVk1T
dGF0ZUZpZWxkW10pIHsKKyAgICAgICAgICAgIFZNU1RBVEVfVkFSUkFZX1VJTlQzMihzb3VyY2Vf
cHJpb3JpdHksIFZlZ2FQTElDU3RhdGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgbnVtX3NvdXJjZXMsIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm1z
dGF0ZV9pbmZvX3VpbnQzMiwgdWludDMyX3QpLAorICAgICAgICAgICAgVk1TVEFURV9WQVJSQVlf
VUlOVDMyKHRhcmdldF9wcmlvcml0eSwgVmVnYVBMSUNTdGF0ZSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBudW1fYWRkcnMsIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdm1zdGF0ZV9pbmZvX3VpbnQzMiwgdWludDMyX3QpLAorICAgICAgICAgICAgVk1T
VEFURV9WQVJSQVlfVUlOVDMyKHBlbmRpbmcsIFZlZ2FQTElDU3RhdGUsIGJpdGZpZWxkX3dvcmRz
LCAwLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtc3RhdGVfaW5mb191aW50
MzIsIHVpbnQzMl90KSwKKyAgICAgICAgICAgIFZNU1RBVEVfVkFSUkFZX1VJTlQzMihjbGFpbWVk
LCBWZWdhUExJQ1N0YXRlLCBiaXRmaWVsZF93b3JkcywgMCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB2bXN0YXRlX2luZm9fdWludDMyLCB1aW50MzJfdCksCisgICAgICAgICAg
ICBWTVNUQVRFX1ZBUlJBWV9VSU5UMzIoZW5hYmxlLCBWZWdhUExJQ1N0YXRlLCBudW1fZW5hYmxl
cywgMCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bXN0YXRlX2luZm9fdWlu
dDMyLCB1aW50MzJfdCksCisgICAgICAgICAgICBWTVNUQVRFX0VORF9PRl9MSVNUKCkKKyAgICAg
ICAgfQorfTsKKworc3RhdGljIGNvbnN0IFByb3BlcnR5IHZlZ2FfcGxpY19wcm9wZXJ0aWVzW10g
PSB7CisgICAgREVGSU5FX1BST1BfU1RSSU5HKCJoYXJ0LWNvbmZpZyIsIFZlZ2FQTElDU3RhdGUs
IGhhcnRfY29uZmlnKSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoImhhcnRpZC1iYXNlIiwgVmVn
YVBMSUNTdGF0ZSwgaGFydGlkX2Jhc2UsIDApLAorICAgIC8qIG51bWJlciBvZiBpbnRlcnJ1cHQg
c291cmNlcyBpbmNsdWRpbmcgaW50ZXJydXB0IHNvdXJjZSAwICovCisgICAgREVGSU5FX1BST1Bf
VUlOVDMyKCJudW0tc291cmNlcyIsIFZlZ2FQTElDU3RhdGUsIG51bV9zb3VyY2VzLCAxKSwKKyAg
ICBERUZJTkVfUFJPUF9VSU5UMzIoIm51bS1wcmlvcml0aWVzIiwgVmVnYVBMSUNTdGF0ZSwgbnVt
X3ByaW9yaXRpZXMsIDApLAorICAgIC8qIGludGVycnVwdCBwcmlvcml0eSByZWdpc3RlciBiYXNl
IHN0YXJ0aW5nIGZyb20gc291cmNlIDAgKi8KKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoInByaW9y
aXR5LWJhc2UiLCBWZWdhUExJQ1N0YXRlLCBwcmlvcml0eV9iYXNlLCAwKSwKKyAgICBERUZJTkVf
UFJPUF9VSU5UMzIoInBlbmRpbmctYmFzZSIsIFZlZ2FQTElDU3RhdGUsIHBlbmRpbmdfYmFzZSwg
MCksCisgICAgREVGSU5FX1BST1BfVUlOVDMyKCJlbmFibGUtYmFzZSIsIFZlZ2FQTElDU3RhdGUs
IGVuYWJsZV9iYXNlLCAwKSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoImVuYWJsZS1zdHJpZGUi
LCBWZWdhUExJQ1N0YXRlLCBlbmFibGVfc3RyaWRlLCAwKSwKKyAgICBERUZJTkVfUFJPUF9VSU5U
MzIoImNvbnRleHQtYmFzZSIsIFZlZ2FQTElDU3RhdGUsIGNvbnRleHRfYmFzZSwgMCksCisgICAg
REVGSU5FX1BST1BfVUlOVDMyKCJjb250ZXh0LXN0cmlkZSIsIFZlZ2FQTElDU3RhdGUsIGNvbnRl
eHRfc3RyaWRlLCAwKSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoImFwZXJ0dXJlLXNpemUiLCBW
ZWdhUExJQ1N0YXRlLCBhcGVydHVyZV9zaXplLCAwKSwKK307CisKK3N0YXRpYyB2b2lkIHZlZ2Ff
cGxpY19jbGFzc19pbml0KE9iamVjdENsYXNzICprbGFzcywgY29uc3Qgdm9pZCAqZGF0YSkKK3sK
KyAgICBEZXZpY2VDbGFzcyAqZGMgPSBERVZJQ0VfQ0xBU1Moa2xhc3MpOworCisgICAgZGV2aWNl
X2NsYXNzX3NldF9sZWdhY3lfcmVzZXQoZGMsIHZlZ2FfcGxpY19yZXNldCk7CisgICAgZGV2aWNl
X2NsYXNzX3NldF9wcm9wcyhkYywgdmVnYV9wbGljX3Byb3BlcnRpZXMpOworICAgIGRjLT5yZWFs
aXplID0gdmVnYV9wbGljX3JlYWxpemU7CisgICAgZGMtPnZtc2QgPSAmdm1zdGF0ZV92ZWdhX3Bs
aWM7Cit9CisKK3N0YXRpYyBjb25zdCBUeXBlSW5mbyB2ZWdhX3BsaWNfaW5mbyA9IHsKKyAgICAu
bmFtZSAgICAgICAgICA9IFRZUEVfVkVHQV9QTElDLAorICAgIC5wYXJlbnQgICAgICAgID0gVFlQ
RV9TWVNfQlVTX0RFVklDRSwKKyAgICAuaW5zdGFuY2Vfc2l6ZSA9IHNpemVvZihWZWdhUExJQ1N0
YXRlKSwKKyAgICAuY2xhc3NfaW5pdCAgICA9IHZlZ2FfcGxpY19jbGFzc19pbml0LAorfTsKKwor
c3RhdGljIHZvaWQgdmVnYV9wbGljX3JlZ2lzdGVyX3R5cGVzKHZvaWQpCit7CisgICAgdHlwZV9y
ZWdpc3Rlcl9zdGF0aWMoJnZlZ2FfcGxpY19pbmZvKTsKK30KKwordHlwZV9pbml0KHZlZ2FfcGxp
Y19yZWdpc3Rlcl90eXBlcykKKworLyoKKyAqIENyZWF0ZSBQTElDIGRldmljZS4KKyAqLworRGV2
aWNlU3RhdGUgKnZlZ2FfcGxpY19jcmVhdGUoaHdhZGRyIGFkZHIsIGNoYXIgKmhhcnRfY29uZmln
LAorICAgIHVpbnQzMl90IG51bV9oYXJ0cywKKyAgICB1aW50MzJfdCBoYXJ0aWRfYmFzZSwgdWlu
dDMyX3QgbnVtX3NvdXJjZXMsCisgICAgdWludDMyX3QgbnVtX3ByaW9yaXRpZXMsIHVpbnQzMl90
IHByaW9yaXR5X2Jhc2UsCisgICAgdWludDMyX3QgcGVuZGluZ19iYXNlLCB1aW50MzJfdCBlbmFi
bGVfYmFzZSwKKyAgICB1aW50MzJfdCBlbmFibGVfc3RyaWRlLCB1aW50MzJfdCBjb250ZXh0X2Jh
c2UsCisgICAgdWludDMyX3QgY29udGV4dF9zdHJpZGUsIHVpbnQzMl90IGFwZXJ0dXJlX3NpemUp
Cit7CisgICAgRGV2aWNlU3RhdGUgKmRldiA9IHFkZXZfbmV3KFRZUEVfVkVHQV9QTElDKTsKKyAg
ICBpbnQgaTsKKyAgICBWZWdhUExJQ1N0YXRlICpwbGljOworCisgICAgYXNzZXJ0KGVuYWJsZV9z
dHJpZGUgPT0gKGVuYWJsZV9zdHJpZGUgJiAtZW5hYmxlX3N0cmlkZSkpOworICAgIGFzc2VydChj
b250ZXh0X3N0cmlkZSA9PSAoY29udGV4dF9zdHJpZGUgJiAtY29udGV4dF9zdHJpZGUpKTsKKyAg
ICBxZGV2X3Byb3Bfc2V0X3N0cmluZyhkZXYsICJoYXJ0LWNvbmZpZyIsIGhhcnRfY29uZmlnKTsK
KyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJoYXJ0aWQtYmFzZSIsIGhhcnRpZF9iYXNl
KTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJudW0tc291cmNlcyIsIG51bV9zb3Vy
Y2VzKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJudW0tcHJpb3JpdGllcyIsIG51
bV9wcmlvcml0aWVzKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJwcmlvcml0eS1i
YXNlIiwgcHJpb3JpdHlfYmFzZSk7CisgICAgcWRldl9wcm9wX3NldF91aW50MzIoZGV2LCAicGVu
ZGluZy1iYXNlIiwgcGVuZGluZ19iYXNlKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYs
ICJlbmFibGUtYmFzZSIsIGVuYWJsZV9iYXNlKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihk
ZXYsICJlbmFibGUtc3RyaWRlIiwgZW5hYmxlX3N0cmlkZSk7CisgICAgcWRldl9wcm9wX3NldF91
aW50MzIoZGV2LCAiY29udGV4dC1iYXNlIiwgY29udGV4dF9iYXNlKTsKKyAgICBxZGV2X3Byb3Bf
c2V0X3VpbnQzMihkZXYsICJjb250ZXh0LXN0cmlkZSIsIGNvbnRleHRfc3RyaWRlKTsKKyAgICBx
ZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJhcGVydHVyZS1zaXplIiwgYXBlcnR1cmVfc2l6ZSk7
CisgICAgc3lzYnVzX3JlYWxpemVfYW5kX3VucmVmKFNZU19CVVNfREVWSUNFKGRldiksICZlcnJv
cl9mYXRhbCk7CisgICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKGRldiksIDAsIGFk
ZHIpOworCisgICAgcGxpYyA9IFZFR0FfUExJQyhkZXYpOworCisgICAgZm9yIChpID0gMDsgaSA8
IHBsaWMtPm51bV9hZGRyczsgaSsrKSB7CisgICAgICAgIGludCBjcHVfbnVtID0gcGxpYy0+YWRk
cl9jb25maWdbaV0uaGFydGlkOworICAgICAgICBDUFVTdGF0ZSAqY3B1ID0gcWVtdV9nZXRfY3B1
KGNwdV9udW0pOworCisgICAgICAgIGlmIChwbGljLT5hZGRyX2NvbmZpZ1tpXS5tb2RlID09IFBM
SUNNb2RlX00pIHsKKyAgICAgICAgICAgIHFkZXZfY29ubmVjdF9ncGlvX291dChkZXYsIGNwdV9u
dW0gLSBoYXJ0aWRfYmFzZSArIG51bV9oYXJ0cywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBxZGV2X2dldF9ncGlvX2luKERFVklDRShjcHUpLCBJUlFfTV9FWFQpKTsKKyAgICAg
ICAgfQorICAgICAgICBpZiAocGxpYy0+YWRkcl9jb25maWdbaV0ubW9kZSA9PSBQTElDTW9kZV9T
KSB7CisgICAgICAgICAgICBxZGV2X2Nvbm5lY3RfZ3Bpb19vdXQoZGV2LCBjcHVfbnVtIC0gaGFy
dGlkX2Jhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcWRldl9nZXRfZ3Bp
b19pbihERVZJQ0UoY3B1KSwgSVJRX1NfRVhUKSk7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBy
ZXR1cm4gZGV2OworfQpcIE5vIG5ld2xpbmUgYXQgZW5kIG9mIGZpbGUKZGlmZiAtLWdpdCBhL2h3
L3Jpc2N2L0tjb25maWcgYi9ody9yaXNjdi9LY29uZmlnCmluZGV4IGZjOWMzNWJkOTguLjBkZWZl
MWI3ZDMgMTAwNjQ0Ci0tLSBhL2h3L3Jpc2N2L0tjb25maWcKKysrIGIvaHcvcmlzY3YvS2NvbmZp
ZwpAQCAtMTI4LDMgKzEyOCwzMSBAQCBjb25maWcgWElBTkdTSEFOX0tVTk1JTkdIVQogICAgIHNl
bGVjdCBSSVNDVl9BUExJQwogICAgIHNlbGVjdCBSSVNDVl9JTVNJQwogICAgIHNlbGVjdCBTRVJJ
QUxfTU0KKyAgICAKK2NvbmZpZyBWRUdBCisgICAgYm9vbAorICAgIGRlZmF1bHQgeQorICAgIGRl
cGVuZHMgb24gUklTQ1YzMiB8fCBSSVNDVjY0CisgICAgaW1wbHkgUENJX0RFVklDRVMKKyAgICBp
bXBseSBWSVJUSU9fVkdBCisgICAgaW1wbHkgVEVTVF9ERVZJQ0VTCisgICAgaW1wbHkgVFBNX1RJ
U19TWVNCVVMKKyAgICBzZWxlY3QgREVWSUNFX1RSRUUKKyAgICBzZWxlY3QgUklTQ1ZfTlVNQQor
ICAgIHNlbGVjdCBHT0xERklTSF9SVEMKKyAgICBzZWxlY3QgUENJCisgICAgc2VsZWN0IFBDSV9F
WFBSRVNTX0dFTkVSSUNfQlJJREdFCisgICAgc2VsZWN0IFBGTEFTSF9DRkkwMQorICAgIHNlbGVj
dCBTRVJJQUxfTU0KKyAgICBzZWxlY3QgVkVHQV9BQ0xJTlQgIAorICAgIHNlbGVjdCBSSVNDVl9B
UExJQworICAgIHNlbGVjdCBSSVNDVl9JT01NVQorICAgIHNlbGVjdCBSSVNDVl9JTVNJQworICAg
IHNlbGVjdCBWRUdBX1BMSUMgICAgCisgICAgc2VsZWN0IFNJRklWRV9URVNUCisgICAgc2VsZWN0
IFNNQklPUworICAgIHNlbGVjdCBWSVJUSU9fTU1JTworICAgIHNlbGVjdCBGV19DRkdfRE1BCisg
ICAgc2VsZWN0IFBMQVRGT1JNX0JVUworICAgIHNlbGVjdCBBQ1BJCisgICAgc2VsZWN0IEFDUElf
UENJCmRpZmYgLS1naXQgYS9ody9yaXNjdi9tZXNvbi5idWlsZCBiL2h3L3Jpc2N2L21lc29uLmJ1
aWxkCmluZGV4IDJhOGQ1YjEzNmMuLmZlNTA0ZTY4MTkgMTAwNjQ0Ci0tLSBhL2h3L3Jpc2N2L21l
c29uLmJ1aWxkCisrKyBiL2h3L3Jpc2N2L21lc29uLmJ1aWxkCkBAIC0xNCw1ICsxNCw2IEBAIHJp
c2N2X3NzLmFkZCh3aGVuOiAnQ09ORklHX1JJU0NWX0lPTU1VJywgaWZfdHJ1ZTogZmlsZXMoCiAJ
J3Jpc2N2LWlvbW11LmMnLCAncmlzY3YtaW9tbXUtcGNpLmMnLCAncmlzY3YtaW9tbXUtc3lzLmMn
LCAncmlzY3YtaW9tbXUtaHBtLmMnKSkKIHJpc2N2X3NzLmFkZCh3aGVuOiAnQ09ORklHX01JQ1JP
QkxBWkVfVicsIGlmX3RydWU6IGZpbGVzKCdtaWNyb2JsYXplLXYtZ2VuZXJpYy5jJykpCiByaXNj
dl9zcy5hZGQod2hlbjogJ0NPTkZJR19YSUFOR1NIQU5fS1VOTUlOR0hVJywgaWZfdHJ1ZTogZmls
ZXMoJ3hpYW5nc2hhbl9rbWguYycpKQorcmlzY3Zfc3MuYWRkKHdoZW46ICdDT05GSUdfVkVHQScs
IGlmX3RydWU6IGZpbGVzKCd2ZWdhLmMnKSkgIAogCiBod19hcmNoICs9IHsncmlzY3YnOiByaXNj
dl9zc30KZGlmZiAtLWdpdCBhL2h3L3Jpc2N2L3ZlZ2EuYyBiL2h3L3Jpc2N2L3ZlZ2EuYwpuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi5mN2U3OGYyNGRiCi0tLSAvZGV2L251
bGwKKysrIGIvaHcvcmlzY3YvdmVnYS5jCkBAIC0wLDAgKzEsMjA3NiBAQAorLyoKKyAqIFFFTVUg
UklTQy1WIFZpcnRJTyBCb2FyZAorICovCisKKyNpbmNsdWRlICJxZW11L29zZGVwLmgiCisjaW5j
bHVkZSAicWVtdS91bml0cy5oIgorI2luY2x1ZGUgInFlbXUvZXJyb3ItcmVwb3J0LmgiCisjaW5j
bHVkZSAicWVtdS9ndWVzdC1yYW5kb20uaCIKKyNpbmNsdWRlICJxYXBpL2Vycm9yLmgiCisjaW5j
bHVkZSAiaHcvYm9hcmRzLmgiCisjaW5jbHVkZSAiaHcvbG9hZGVyLmgiCisjaW5jbHVkZSAiaHcv
c3lzYnVzLmgiCisjaW5jbHVkZSAiaHcvcWRldi1wcm9wZXJ0aWVzLmgiCisjaW5jbHVkZSAiaHcv
Y2hhci9zZXJpYWwtbW0uaCIKKyNpbmNsdWRlICJ0YXJnZXQvcmlzY3YvY3B1LmgiCisjaW5jbHVk
ZSAiaHcvY29yZS9zeXNidXMtZmR0LmgiCisjaW5jbHVkZSAidGFyZ2V0L3Jpc2N2L3BtdS5oIgor
I2luY2x1ZGUgImh3L3Jpc2N2L3Jpc2N2X2hhcnQuaCIKKyNpbmNsdWRlICJody9yaXNjdi9pb21t
dS5oIgorI2luY2x1ZGUgImh3L3Jpc2N2L3Jpc2N2LWlvbW11LWJpdHMuaCIKKyNpbmNsdWRlICJo
dy9yaXNjdi92ZWdhLmgiICAgICAgICAgICAgICAgICAgCisjaW5jbHVkZSAiaHcvcmlzY3YvYm9v
dC5oIgorI2luY2x1ZGUgImh3L3Jpc2N2L251bWEuaCIKKyNpbmNsdWRlICJrdm0va3ZtX3Jpc2N2
LmgiCisjaW5jbHVkZSAiaHcvZmlybXdhcmUvc21iaW9zLmgiCisjaW5jbHVkZSAiaHcvaW50Yy92
ZWdhX2FjbGludC5oIgorI2luY2x1ZGUgImh3L2ludGMvcmlzY3ZfYXBsaWMuaCIKKyNpbmNsdWRl
ICJody9pbnRjL3ZlZ2FfcGxpYy5oIgorI2luY2x1ZGUgImh3L21pc2Mvc2lmaXZlX3Rlc3QuaCIK
KyNpbmNsdWRlICJody9wbGF0Zm9ybS1idXMuaCIKKyNpbmNsdWRlICJjaGFyZGV2L2NoYXIuaCIK
KyNpbmNsdWRlICJzeXN0ZW0vZGV2aWNlX3RyZWUuaCIKKyNpbmNsdWRlICJzeXN0ZW0vc3lzdGVt
LmgiCisjaW5jbHVkZSAic3lzdGVtL3RjZy5oIgorI2luY2x1ZGUgInN5c3RlbS9rdm0uaCIKKyNp
bmNsdWRlICJzeXN0ZW0vdHBtLmgiCisjaW5jbHVkZSAic3lzdGVtL3F0ZXN0LmgiCisjaW5jbHVk
ZSAiaHcvcGNpL3BjaS5oIgorI2luY2x1ZGUgImh3L3BjaS1ob3N0L2dwZXguaCIKKyNpbmNsdWRl
ICJody9kaXNwbGF5L3JhbWZiLmgiCisjaW5jbHVkZSAiaHcvYWNwaS9hbWwtYnVpbGQuaCIKKyNp
bmNsdWRlICJxYXBpL3FhcGktdmlzaXQtY29tbW9uLmgiCisjaW5jbHVkZSAiaHcvdmlydGlvL3Zp
cnRpby1pb21tdS5oIgorI2luY2x1ZGUgImh3L3VlZmkvdmFyLXNlcnZpY2UtYXBpLmgiCisjaW5j
bHVkZSAiaHcvbWlzYy91bmltcC5oIgorCitzdGF0aWMgdWludDY0X3QgdmVnYV9kcmFtX2Jhc2Vf
cHJvcGVydHk7CisKKy8qIEtWTSBBSUEgb25seSBzdXBwb3J0cyBBUExJQyBNU0kuIEFQTElDIFdp
cmVkIGlzIGFsd2F5cyBlbXVsYXRlZCBieSBRRU1VLiAqLworc3RhdGljIGJvb2wgdmVnYV91c2Vf
a3ZtX2FpYV9hcGxpY19pbXNpYyhSSVNDVlZlZ2FBSUFUeXBlIGFpYV90eXBlKQoreworICAgIGJv
b2wgbXNpbW9kZSA9IGFpYV90eXBlID09IFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUM7CisKKyAg
ICByZXR1cm4gcmlzY3ZfaXNfa3ZtX2FpYV9hcGxpY19pbXNpYyhtc2ltb2RlKTsKK30KKworc3Rh
dGljIGJvb2wgdmVnYV91c2VfZW11bGF0ZWRfYXBsaWMoUklTQ1ZWZWdhQUlBVHlwZSBhaWFfdHlw
ZSkKK3sKKyAgICBib29sIG1zaW1vZGUgPSBhaWFfdHlwZSA9PSBWRUdBX0FJQV9UWVBFX0FQTElD
X0lNU0lDOworCisgICAgcmV0dXJuIHJpc2N2X3VzZV9lbXVsYXRlZF9hcGxpYyhtc2ltb2RlKTsK
K30KKworc3RhdGljIGJvb2wgdmVnYV9hY2xpbnRfYWxsb3dlZCh2b2lkKQoreworICAgIHJldHVy
biB0Y2dfZW5hYmxlZCgpIHx8IHF0ZXN0X2VuYWJsZWQoKTsKK30KKworc3RhdGljICBNZW1NYXBF
bnRyeSB2ZWdhX21lbW1hcFtdID0geworICAgIFtWRUdBX0RFQlVHXSA9ICAgICAgICB7ICAgICAg
ICAweDAsICAgICAgICAgMHgxMDAgfSwKKyAgICBbVkVHQV9NUk9NXSA9ICAgICAgICAgeyAgICAg
MHgxMDAwLCAgICAgICAgMHhmMDAwIH0sCisgICAgW1ZFR0FfVEVTVF0gPSAgICAgICAgIHsgICAw
eDEwMDAwMCwgICAgICAgIDB4MTAwMCB9LAorICAgIFtWRUdBX1JUQ10gPSAgICAgICAgICB7ICAg
MHgxMDEwMDAsICAgICAgICAweDEwMDAgfSwKKyAgICBbVkVHQV9DTElOVF0gPSAgICAgICAgeyAg
MHgyMDAwMDAwLCAgICAgICAweDEwMDAwIH0sCisgICAgW1ZFR0FfQUNMSU5UX1NTV0ldID0gIHsg
IDB4MkYwMDAwMCwgICAgICAgIDB4NDAwMCB9LAorICAgIFtWRUdBX1BDSUVfUElPXSA9ICAgICB7
ICAweDMwMDAwMDAsICAgICAgIDB4MTAwMDAgfSwKKyAgICBbVkVHQV9JT01NVV9TWVNdID0gICAg
eyAgMHgzMDEwMDAwLCAgICAgICAgMHgxMDAwIH0sCisgICAgW1ZFR0FfUExBVEZPUk1fQlVTXSA9
IHsgIDB4NDAwMDAwMCwgICAgIDB4MjAwMDAwMCB9LAorICAgIFtWRUdBX1BMSUNfSURdID0gICAg
ICAgICB7ICAweGMwMDAwMDAsIFZFR0FfUExJQ19TSVpFKFZFR0FfQ1BVU19NQVggKiAyKSB9LAor
ICAgIFtWRUdBX0FQTElDX01dID0gICAgICB7ICAweGMwMDAwMDAsIEFQTElDX1NJWkUoVkVHQV9D
UFVTX01BWCkgfSwKKyAgICBbVkVHQV9BUExJQ19TXSA9ICAgICAgeyAgMHhkMDAwMDAwLCBBUExJ
Q19TSVpFKFZFR0FfQ1BVU19NQVgpIH0sCisgICAgW1ZFR0FfVUFSVDBdID0gICAgICAgIHsgMHgx
MDAwMDEwMCwgICAgICAgICAweDEwMCB9LAorICAgIFtWRUdBX1ZJUlRJT10gPSAgICAgICB7IDB4
MTAwMDEwMDAsICAgICAgICAweDEwMDAgfSwKKyAgICBbVkVHQV9GV19DRkddID0gICAgICAgeyAw
eDEwMTAwMDAwLCAgICAgICAgICAweDE4IH0sCisgICAgW1ZFR0FfRkxBU0hdID0gICAgICAgIHsg
MHgyMDAwMDAwMCwgICAgIDB4NDAwMDAwMCB9LAorICAgIFtWRUdBX0lNU0lDX01dID0gICAgICB7
IDB4MjQwMDAwMDAsIFZFR0FfSU1TSUNfTUFYX1NJWkUgfSwKKyAgICBbVkVHQV9JTVNJQ19TXSA9
ICAgICAgeyAweDI4MDAwMDAwLCBWRUdBX0lNU0lDX01BWF9TSVpFIH0sCisgICAgW1ZFR0FfUENJ
RV9FQ0FNXSA9ICAgIHsgMHgzMDAwMDAwMCwgICAgMHgxMDAwMDAwMCB9LAorICAgIFtWRUdBX1BD
SUVfTU1JT10gPSAgICB7IDB4NDAwMDAwMDAsICAgIDB4NDAwMDAwMDAgfSwKKyAgICBbVkVHQV9V
QVJUMV0gPSAgICAgICAgeyAweDEwMDAwMjAwLCAweDEwMCB9LAorICAgIFtWRUdBX1VBUlQyXSA9
ICAgICAgICB7IDB4MTAwMDAzMDAsIDB4MTAwIH0sCisgICAgW1ZFR0FfVUFSVDNdID0gICAgICAg
IHsgMHgxMDAwMDQwMCwgMHgxMDAgfSwKKyAgICBbVkVHQV9VQVJUNF0gPSAgICAgICAgeyAweDEw
MDAwNTAwLCAweDEwMCB9LAorICAgIFtWRUdBX1NQSTBdICA9ICAgICAgICB7IDB4MTAwMDA2MDAs
IDB4MTAwIH0sCisgICAgW1ZFR0FfU1BJMV0gID0gICAgICAgIHsgMHgxMDAwMDcwMCwgMHgxMDAg
fSwKKyAgICBbVkVHQV9JSUMwXSAgPSAgICAgICAgeyAweDEwMDAwODAwLCAweDEwMCB9LAorICAg
IFtWRUdBX0lJQzFdICA9ICAgICAgICB7IDB4MTAwMDA5MDAsIDB4MTAwIH0sCisgICAgW1ZFR0Ff
RFJBTV0gPSAgICAgICAgIHsgMHg0MDAwMDAwMDAsIDB4MCB9LAorfTsKKworLyogUENJZSBoaWdo
IG1taW8gaXMgZml4ZWQgZm9yIFJWMzIgKi8KKyNkZWZpbmUgVkVHQTMyX0hJR0hfUENJRV9NTUlP
X0JBU0UgIDB4MzAwMDAwMDAwVUxMCisjZGVmaW5lIFZFR0EzMl9ISUdIX1BDSUVfTU1JT19TSVpF
ICAoNCAqIEdpQikKKworLyogUENJZSBoaWdoIG1taW8gZm9yIFJWNjQsIHNpemUgaXMgZml4ZWQg
YnV0IGJhc2UgZGVwZW5kcyBvbiB0b3Agb2YgUkFNICovCisjZGVmaW5lIFZFR0E2NF9ISUdIX1BD
SUVfTU1JT19TSVpFICAoMTYgKiBHaUIpCisKK3N0YXRpYyBNZW1NYXBFbnRyeSB2ZWdhX2hpZ2hf
cGNpZV9tZW1tYXA7CisKKyNkZWZpbmUgVkVHQV9GTEFTSF9TRUNUT1JfU0laRSAoMjU2ICogS2lC
KQorCitzdGF0aWMgUEZsYXNoQ0ZJMDEgKnZlZ2FfZmxhc2hfY3JlYXRlMShSSVNDVlZlZ2FTdGF0
ZSAqcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIg
Km5hbWUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFy
ICphbGlhc19wcm9wX25hbWUpCit7CisgICAgLyoKKyAgICAgKiBDcmVhdGUgYSBzaW5nbGUgZmxh
c2ggZGV2aWNlLiAgV2UgdXNlIHRoZSBzYW1lIHBhcmFtZXRlcnMgYXMKKyAgICAgKiB0aGUgZmxh
c2ggZGV2aWNlcyBvbiB0aGUgQVJNIHZlZ2EgYm9hcmQuCisgICAgICovCisgICAgRGV2aWNlU3Rh
dGUgKmRldiA9IHFkZXZfbmV3KFRZUEVfUEZMQVNIX0NGSTAxKTsKKworICAgIHFkZXZfcHJvcF9z
ZXRfdWludDY0KGRldiwgInNlY3Rvci1sZW5ndGgiLCBWRUdBX0ZMQVNIX1NFQ1RPUl9TSVpFKTsK
KyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQ4KGRldiwgIndpZHRoIiwgNCk7CisgICAgcWRldl9wcm9w
X3NldF91aW50OChkZXYsICJkZXZpY2Utd2lkdGgiLCAyKTsKKyAgICBxZGV2X3Byb3Bfc2V0X2Jp
dChkZXYsICJiaWctZW5kaWFuIiwgZmFsc2UpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDE2KGRl
diwgImlkMCIsIDB4ODkpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDE2KGRldiwgImlkMSIsIDB4
MTgpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDE2KGRldiwgImlkMiIsIDB4MDApOworICAgIHFk
ZXZfcHJvcF9zZXRfdWludDE2KGRldiwgImlkMyIsIDB4MDApOworICAgIHFkZXZfcHJvcF9zZXRf
c3RyaW5nKGRldiwgIm5hbWUiLCBuYW1lKTsKKworICAgIG9iamVjdF9wcm9wZXJ0eV9hZGRfY2hp
bGQoT0JKRUNUKHMpLCBuYW1lLCBPQkpFQ1QoZGV2KSk7CisgICAgb2JqZWN0X3Byb3BlcnR5X2Fk
ZF9hbGlhcyhPQkpFQ1QocyksIGFsaWFzX3Byb3BfbmFtZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIE9CSkVDVChkZXYpLCAiZHJpdmUiKTsKKworICAgIHJldHVybiBQRkxBU0hfQ0ZJ
MDEoZGV2KTsKK30KKworc3RhdGljIHZvaWQgdmVnYV9mbGFzaF9jcmVhdGUoUklTQ1ZWZWdhU3Rh
dGUgKnMpCit7CisgICAgcy0+Zmxhc2hbMF0gPSB2ZWdhX2ZsYXNoX2NyZWF0ZTEocywgInZlZ2Eu
Zmxhc2gwIiwgInBmbGFzaDAiKTsKKyAgICBzLT5mbGFzaFsxXSA9IHZlZ2FfZmxhc2hfY3JlYXRl
MShzLCAidmVnYS5mbGFzaDEiLCAicGZsYXNoMSIpOworfQorCitzdGF0aWMgdm9pZCB2ZWdhX2Zs
YXNoX21hcDEoUEZsYXNoQ0ZJMDEgKmZsYXNoLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGh3YWRkciBiYXNlLCBod2FkZHIgc2l6ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBN
ZW1vcnlSZWdpb24gKnN5c21lbSkKK3sKKyAgICBEZXZpY2VTdGF0ZSAqZGV2ID0gREVWSUNFKGZs
YXNoKTsKKworICAgIGFzc2VydChRRU1VX0lTX0FMSUdORUQoc2l6ZSwgVkVHQV9GTEFTSF9TRUNU
T1JfU0laRSkpOworICAgIGFzc2VydChzaXplIC8gVkVHQV9GTEFTSF9TRUNUT1JfU0laRSA8PSBV
SU5UMzJfTUFYKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJudW0tYmxvY2tzIiwg
c2l6ZSAvIFZFR0FfRkxBU0hfU0VDVE9SX1NJWkUpOworICAgIHN5c2J1c19yZWFsaXplX2FuZF91
bnJlZihTWVNfQlVTX0RFVklDRShkZXYpLCAmZXJyb3JfZmF0YWwpOworCisgICAgbWVtb3J5X3Jl
Z2lvbl9hZGRfc3VicmVnaW9uKHN5c21lbSwgYmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3lzYnVzX21taW9fZ2V0X3JlZ2lvbihTWVNfQlVTX0RFVklDRShkZXYpLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDApKTsK
K30KKworc3RhdGljIHZvaWQgdmVnYV9mbGFzaF9tYXAoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICBNZW1vcnlSZWdpb24gKnN5c21lbSkKK3sKKyAgICBod2Fk
ZHIgZmxhc2hzaXplID0gcy0+bWVtbWFwW1ZFR0FfRkxBU0hdLnNpemUgLyAyOworICAgIGh3YWRk
ciBmbGFzaGJhc2UgPSBzLT5tZW1tYXBbVkVHQV9GTEFTSF0uYmFzZTsKKworICAgIHZlZ2FfZmxh
c2hfbWFwMShzLT5mbGFzaFswXSwgZmxhc2hiYXNlLCBmbGFzaHNpemUsCisgICAgICAgICAgICAg
ICAgICAgIHN5c21lbSk7CisgICAgdmVnYV9mbGFzaF9tYXAxKHMtPmZsYXNoWzFdLCBmbGFzaGJh
c2UgKyBmbGFzaHNpemUsIGZsYXNoc2l6ZSwKKyAgICAgICAgICAgICAgICAgICAgc3lzbWVtKTsK
K30KKworc3RhdGljIHZvaWQgY3JlYXRlX3BjaWVfaXJxX21hcChSSVNDVlZlZ2FTdGF0ZSAqcywg
dm9pZCAqZmR0LCBjaGFyICpub2RlbmFtZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdWludDMyX3QgaXJxY2hpcF9waGFuZGxlKQoreworICAgIGludCBwaW4sIGRldjsKKyAgICB1
aW50MzJfdCBpcnFfbWFwX3N0cmlkZSA9IDA7CisgICAgdWludDMyX3QgZnVsbF9pcnFfbWFwW1BD
SV9OVU1fUElOUyAqIFBDSV9OVU1fUElOUyAqCisgICAgICAgICAgICAgICAgICAgICAgICAgIEZE
VF9NQVhfSU5UX01BUF9XSURUSF0gPSB7fTsKKyAgICB1aW50MzJfdCAqaXJxX21hcCA9IGZ1bGxf
aXJxX21hcDsKKworICAgIC8qIFRoaXMgY29kZSBjcmVhdGVzIGEgc3RhbmRhcmQgc3dpenpsZSBv
ZiBpbnRlcnJ1cHRzIHN1Y2ggdGhhdAorICAgICAqIGVhY2ggZGV2aWNlJ3MgZmlyc3QgaW50ZXJy
dXB0IGlzIGJhc2VkIG9uIGl0J3MgUENJX1NMT1QgbnVtYmVyLgorICAgICAqIChTZWUgcGNpX3N3
aXp6bGVfbWFwX2lycV9mbigpKQorICAgICAqCisgICAgICogV2Ugb25seSBuZWVkIG9uZSBlbnRy
eSBwZXIgaW50ZXJydXB0IGluIHRoZSB0YWJsZSAobm90IG9uZSBwZXIKKyAgICAgKiBwb3NzaWJs
ZSBzbG90KSBzZWVpbmcgdGhlIGludGVycnVwdC1tYXAtbWFzayB3aWxsIGFsbG93IHRoZSB0YWJs
ZQorICAgICAqIHRvIHdyYXAgdG8gYW55IG51bWJlciBvZiBkZXZpY2VzLgorICAgICAqLworICAg
IGZvciAoZGV2ID0gMDsgZGV2IDwgUENJX05VTV9QSU5TOyBkZXYrKykgeworICAgICAgICBpbnQg
ZGV2Zm4gPSBkZXYgKiAweDg7CisKKyAgICAgICAgZm9yIChwaW4gPSAwOyBwaW4gPCBQQ0lfTlVN
X1BJTlM7IHBpbisrKSB7CisgICAgICAgICAgICBpbnQgaXJxX25yID0gUENJRV9JUlEgKyAoKHBp
biArIFBDSV9TTE9UKGRldmZuKSkgJSBQQ0lfTlVNX1BJTlMpOworICAgICAgICAgICAgaW50IGkg
PSAwOworCisgICAgICAgICAgICAvKiBGaWxsIFBDSSBhZGRyZXNzIGNlbGxzICovCisgICAgICAg
ICAgICBpcnFfbWFwW2ldID0gY3B1X3RvX2JlMzIoZGV2Zm4gPDwgOCk7CisgICAgICAgICAgICBp
ICs9IEZEVF9QQ0lfQUREUl9DRUxMUzsKKworICAgICAgICAgICAgLyogRmlsbCBQQ0kgSW50ZXJy
dXB0IGNlbGxzICovCisgICAgICAgICAgICBpcnFfbWFwW2ldID0gY3B1X3RvX2JlMzIocGluICsg
MSk7CisgICAgICAgICAgICBpICs9IEZEVF9QQ0lfSU5UX0NFTExTOworCisgICAgICAgICAgICAv
KiBGaWxsIGludGVycnVwdCBjb250cm9sbGVyIHBoYW5kbGUgYW5kIGNlbGxzICovCisgICAgICAg
ICAgICBpcnFfbWFwW2krK10gPSBjcHVfdG9fYmUzMihpcnFjaGlwX3BoYW5kbGUpOworICAgICAg
ICAgICAgaXJxX21hcFtpKytdID0gY3B1X3RvX2JlMzIoaXJxX25yKTsKKyAgICAgICAgICAgIGlm
IChzLT5haWFfdHlwZSAhPSBWRUdBX0FJQV9UWVBFX05PTkUpIHsKKyAgICAgICAgICAgICAgICBp
cnFfbWFwW2krK10gPSBjcHVfdG9fYmUzMigweDQpOworICAgICAgICAgICAgfQorCisgICAgICAg
ICAgICBpZiAoIWlycV9tYXBfc3RyaWRlKSB7CisgICAgICAgICAgICAgICAgaXJxX21hcF9zdHJp
ZGUgPSBpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgaXJxX21hcCArPSBpcnFfbWFwX3N0
cmlkZTsKKyAgICAgICAgfQorICAgIH0KKworICAgIHFlbXVfZmR0X3NldHByb3AoZmR0LCBub2Rl
bmFtZSwgImludGVycnVwdC1tYXAiLCBmdWxsX2lycV9tYXAsCisgICAgICAgICAgICAgICAgICAg
ICBQQ0lfTlVNX1BJTlMgKiBQQ0lfTlVNX1BJTlMgKgorICAgICAgICAgICAgICAgICAgICAgaXJx
X21hcF9zdHJpZGUgKiBzaXplb2YodWludDMyX3QpKTsKKworICAgIHFlbXVfZmR0X3NldHByb3Bf
Y2VsbHMoZmR0LCBub2RlbmFtZSwgImludGVycnVwdC1tYXAtbWFzayIsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAweDE4MDAsIDAsIDAsIDB4Nyk7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0
ZV9mZHRfc29ja2V0X2NwdXMoUklTQ1ZWZWdhU3RhdGUgKnMsIGludCBzb2NrZXQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgKmNsdXN0X25hbWUsIHVpbnQzMl90ICpw
aGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAqaW50
Y19waGFuZGxlcykKK3sKKyAgICBpbnQgY3B1OworICAgIHVpbnQzMl90IGNwdV9waGFuZGxlOwor
ICAgIE1hY2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHMpOworICAgIGJvb2wgaXNfMzJfYml0ID0g
cmlzY3ZfaXNfMzJiaXQoJnMtPnNvY1swXSk7CisKKyAgICBmb3IgKGNwdSA9IHMtPnNvY1tzb2Nr
ZXRdLm51bV9oYXJ0cyAtIDE7IGNwdSA+PSAwOyBjcHUtLSkgeworICAgICAgICBSSVNDVkNQVSAq
Y3B1X3B0ciA9ICZzLT5zb2Nbc29ja2V0XS5oYXJ0c1tjcHVdOworICAgICAgICBpbnQ4X3Qgc2F0
cF9tb2RlX21heCA9IGNwdV9wdHItPmNmZy5tYXhfc2F0cF9tb2RlOworICAgICAgICBnX2F1dG9m
cmVlIGNoYXIgKmNwdV9uYW1lID0gTlVMTDsKKyAgICAgICAgZ19hdXRvZnJlZSBjaGFyICpjb3Jl
X25hbWUgPSBOVUxMOworICAgICAgICBnX2F1dG9mcmVlIGNoYXIgKmludGNfbmFtZSA9IE5VTEw7
CisgICAgICAgIGdfYXV0b2ZyZWUgY2hhciAqc3ZfbmFtZSA9IE5VTEw7CisKKyAgICAgICAgY3B1
X3BoYW5kbGUgPSAoKnBoYW5kbGUpKys7CisKKyAgICAgICAgY3B1X25hbWUgPSBnX3N0cmR1cF9w
cmludGYoIi9jcHVzL2NwdUAlZCIsCisgICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5oYXJ0aWRf
YmFzZSArIGNwdSk7CisgICAgICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIGNwdV9u
YW1lKTsKKworICAgICAgICBpZiAoc2F0cF9tb2RlX21heCAhPSAtMSkgeworICAgICAgICAgICAg
c3ZfbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigicmlzY3YsJXMiLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzYXRwX21vZGVfc3RyKHNhdHBfbW9kZV9tYXgsIGlzXzMyX2Jp
dCkpOworICAgICAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgY3B1X25h
bWUsICJtbXUtdHlwZSIsIHN2X25hbWUpOworICAgICAgICB9CisKKyAgICAgICAgcmlzY3ZfaXNh
X3dyaXRlX2ZkdChjcHVfcHRyLCBtcy0+ZmR0LCBjcHVfbmFtZSk7CisKKyAgICAgICAgaWYgKGNw
dV9wdHItPmNmZy5leHRfemljYm9tKSB7CisgICAgICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2Nl
bGwobXMtPmZkdCwgY3B1X25hbWUsICJyaXNjdixjYm9tLWJsb2NrLXNpemUiLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNwdV9wdHItPmNmZy5jYm9tX2Jsb2Nrc2l6ZSk7Cisg
ICAgICAgIH0KKworICAgICAgICBpZiAoY3B1X3B0ci0+Y2ZnLmV4dF96aWNib3opIHsKKyAgICAg
ICAgICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBjcHVfbmFtZSwgInJpc2N2LGNi
b3otYmxvY2stc2l6ZSIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3B1X3B0
ci0+Y2ZnLmNib3pfYmxvY2tzaXplKTsKKyAgICAgICAgfQorCisgICAgICAgIGlmIChjcHVfcHRy
LT5jZmcuZXh0X3ppY2JvcCkgeworICAgICAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1z
LT5mZHQsIGNwdV9uYW1lLCAicmlzY3YsY2JvcC1ibG9jay1zaXplIiwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBjcHVfcHRyLT5jZmcuY2JvcF9ibG9ja3NpemUpOworICAgICAg
ICB9CisKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgY3B1X25hbWUs
ICJjb21wYXRpYmxlIiwgInJpc2N2Iik7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5n
KG1zLT5mZHQsIGNwdV9uYW1lLCAic3RhdHVzIiwgIm9rYXkiKTsKKyAgICAgICAgcWVtdV9mZHRf
c2V0cHJvcF9jZWxsKG1zLT5mZHQsIGNwdV9uYW1lLCAicmVnIiwKKyAgICAgICAgICAgIHMtPnNv
Y1tzb2NrZXRdLmhhcnRpZF9iYXNlICsgY3B1KTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9z
dHJpbmcobXMtPmZkdCwgY3B1X25hbWUsICJkZXZpY2VfdHlwZSIsICJjcHUiKTsKKyAgICAgICAg
cmlzY3Zfc29ja2V0X2ZkdF93cml0ZV9pZChtcywgY3B1X25hbWUsIHNvY2tldCk7CisgICAgICAg
IHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBjcHVfbmFtZSwgInBoYW5kbGUiLCBjcHVf
cGhhbmRsZSk7CisKKyAgICAgICAgaW50Y19waGFuZGxlc1tjcHVdID0gKCpwaGFuZGxlKSsrOwor
CisgICAgICAgIGludGNfbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiJXMvaW50ZXJydXB0LWNvbnRy
b2xsZXIiLCBjcHVfbmFtZSk7CisgICAgICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQs
IGludGNfbmFtZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBpbnRj
X25hbWUsICJwaGFuZGxlIiwKKyAgICAgICAgICAgIGludGNfcGhhbmRsZXNbY3B1XSk7CisgICAg
ICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIGludGNfbmFtZSwgImNvbXBhdGli
bGUiLAorICAgICAgICAgICAgInJpc2N2LGNwdS1pbnRjIik7CisgICAgICAgIHFlbXVfZmR0X3Nl
dHByb3AobXMtPmZkdCwgaW50Y19uYW1lLCAiaW50ZXJydXB0LWNvbnRyb2xsZXIiLCBOVUxMLCAw
KTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIGludGNfbmFtZSwgIiNp
bnRlcnJ1cHQtY2VsbHMiLCAxKTsKKworICAgICAgICBjb3JlX25hbWUgPSBnX3N0cmR1cF9wcmlu
dGYoIiVzL2NvcmUlZCIsIGNsdXN0X25hbWUsIGNwdSk7CisgICAgICAgIHFlbXVfZmR0X2FkZF9z
dWJub2RlKG1zLT5mZHQsIGNvcmVfbmFtZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3BfY2Vs
bChtcy0+ZmR0LCBjb3JlX25hbWUsICJjcHUiLCBjcHVfcGhhbmRsZSk7CisgICAgfQorfQorCitz
dGF0aWMgdm9pZCBjcmVhdGVfZmR0X3NvY2tldF9tZW1vcnkoUklTQ1ZWZWdhU3RhdGUgKnMsIGlu
dCBzb2NrZXQpCit7CisgICAgZ19hdXRvZnJlZSBjaGFyICptZW1fbmFtZSA9IE5VTEw7CisgICAg
aHdhZGRyIGFkZHI7CisgICAgdWludDY0X3Qgc2l6ZTsKKyAgICBNYWNoaW5lU3RhdGUgKm1zID0g
TUFDSElORShzKTsKKworICAgIGFkZHIgPSBzLT5tZW1tYXBbVkVHQV9EUkFNXS5iYXNlICsgcmlz
Y3Zfc29ja2V0X21lbV9vZmZzZXQobXMsIHNvY2tldCk7CisgICAgc2l6ZSA9IHJpc2N2X3NvY2tl
dF9tZW1fc2l6ZShtcywgc29ja2V0KTsKKyAgICBtZW1fbmFtZSA9IGdfc3RyZHVwX3ByaW50Zigi
L21lbW9yeUAlIkhXQUREUl9QUkl4LCBhZGRyKTsKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZSht
cy0+ZmR0LCBtZW1fbmFtZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxscyhtcy0+
ZmR0LCBtZW1fbmFtZSwgInJlZyIsIDIsIGFkZHIsIDIsIHNpemUpOworICAgIHFlbXVfZmR0X3Nl
dHByb3Bfc3RyaW5nKG1zLT5mZHQsIG1lbV9uYW1lLCAiZGV2aWNlX3R5cGUiLCAibWVtb3J5Iik7
CisgICAgcmlzY3Zfc29ja2V0X2ZkdF93cml0ZV9pZChtcywgbWVtX25hbWUsIHNvY2tldCk7Cit9
CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRfc29ja2V0X2NsaW50KFJJU0NWVmVnYVN0YXRlICpz
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNvY2tldCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICppbnRjX3BoYW5kbGVzKQor
eworICAgIGludCBjcHU7CisgICAgZ19hdXRvZnJlZSBjaGFyICpjbGludF9uYW1lID0gTlVMTDsK
KyAgICBnX2F1dG9mcmVlIHVpbnQzMl90ICpjbGludF9jZWxscyA9IE5VTEw7CisgICAgaHdhZGRy
IGNsaW50X2FkZHI7CisgICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7CisgICAgc3Rh
dGljIGNvbnN0IGNoYXIgKiBjb25zdCBjbGludF9jb21wYXRbMl0gPSB7CisgICAgICAgICJzaWZp
dmUsY2xpbnQwIiwgInJpc2N2LGNsaW50MCIKKyAgICB9OworCisgICAgY2xpbnRfY2VsbHMgPSBn
X25ldzAodWludDMyX3QsIHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0cyAqIDQpOworCisgICAgZm9y
IChjcHUgPSAwOyBjcHUgPCBzLT5zb2Nbc29ja2V0XS5udW1faGFydHM7IGNwdSsrKSB7CisgICAg
ICAgIGNsaW50X2NlbGxzW2NwdSAqIDQgKyAwXSA9IGNwdV90b19iZTMyKGludGNfcGhhbmRsZXNb
Y3B1XSk7CisgICAgICAgIGNsaW50X2NlbGxzW2NwdSAqIDQgKyAxXSA9IGNwdV90b19iZTMyKElS
UV9NX1NPRlQpOworICAgICAgICBjbGludF9jZWxsc1tjcHUgKiA0ICsgMl0gPSBjcHVfdG9fYmUz
MihpbnRjX3BoYW5kbGVzW2NwdV0pOworICAgICAgICBjbGludF9jZWxsc1tjcHUgKiA0ICsgM10g
PSBjcHVfdG9fYmUzMihJUlFfTV9USU1FUik7CisgICAgfQorCisgICAgY2xpbnRfYWRkciA9IHMt
Pm1lbW1hcFtWRUdBX0NMSU5UXS5iYXNlICsKKyAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZF
R0FfQ0xJTlRdLnNpemUgKiBzb2NrZXQ7CisgICAgY2xpbnRfbmFtZSA9IGdfc3RyZHVwX3ByaW50
ZigiL3NvYy9jbGludEAlIkhXQUREUl9QUkl4LCBjbGludF9hZGRyKTsKKyAgICBxZW11X2ZkdF9h
ZGRfc3Vibm9kZShtcy0+ZmR0LCBjbGludF9uYW1lKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX3N0
cmluZ19hcnJheShtcy0+ZmR0LCBjbGludF9uYW1lLCAiY29tcGF0aWJsZSIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgKGNoYXIgKiopJmNsaW50X2NvbXBhdCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBBUlJBWV9TSVpFKGNsaW50X2NvbXBhdCkpOworICAg
IHFlbXVfZmR0X3NldHByb3Bfc2l6ZWRfY2VsbHMobXMtPmZkdCwgY2xpbnRfbmFtZSwgInJlZyIs
CisgICAgICAgIDIsIGNsaW50X2FkZHIsIDIsIHMtPm1lbW1hcFtWRUdBX0NMSU5UXS5zaXplKTsK
KyAgICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIGNsaW50X25hbWUsICJpbnRlcnJ1cHRzLWV4
dGVuZGVkIiwKKyAgICAgICAgY2xpbnRfY2VsbHMsIHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0cyAq
IHNpemVvZih1aW50MzJfdCkgKiA0KTsKKyAgICByaXNjdl9zb2NrZXRfZmR0X3dyaXRlX2lkKG1z
LCBjbGludF9uYW1lLCBzb2NrZXQpOworfQorCitzdGF0aWMgdm9pZCBjcmVhdGVfZmR0X3NvY2tl
dF9hY2xpbnQoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaW50IHNvY2tldCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1aW50MzJfdCAqaW50Y19waGFuZGxlcykKK3sKKyAgICBpbnQgY3B1OworICAgIGNoYXIgKm5h
bWU7CisgICAgdW5zaWduZWQgbG9uZyBhZGRyLCBzaXplOworICAgIHVpbnQzMl90IGFjbGludF9j
ZWxsc19zaXplOworICAgIGdfYXV0b2ZyZWUgdWludDMyX3QgKmFjbGludF9tc3dpX2NlbGxzID0g
TlVMTDsKKyAgICBnX2F1dG9mcmVlIHVpbnQzMl90ICphY2xpbnRfc3N3aV9jZWxscyA9IE5VTEw7
CisgICAgZ19hdXRvZnJlZSB1aW50MzJfdCAqYWNsaW50X210aW1lcl9jZWxscyA9IE5VTEw7Cisg
ICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7CisKKyAgICBhY2xpbnRfbXN3aV9jZWxs
cyA9IGdfbmV3MCh1aW50MzJfdCwgcy0+c29jW3NvY2tldF0ubnVtX2hhcnRzICogMik7CisgICAg
YWNsaW50X210aW1lcl9jZWxscyA9IGdfbmV3MCh1aW50MzJfdCwgcy0+c29jW3NvY2tldF0ubnVt
X2hhcnRzICogMik7CisgICAgYWNsaW50X3Nzd2lfY2VsbHMgPSBnX25ldzAodWludDMyX3QsIHMt
PnNvY1tzb2NrZXRdLm51bV9oYXJ0cyAqIDIpOworCisgICAgZm9yIChjcHUgPSAwOyBjcHUgPCBz
LT5zb2Nbc29ja2V0XS5udW1faGFydHM7IGNwdSsrKSB7CisgICAgICAgIGFjbGludF9tc3dpX2Nl
bGxzW2NwdSAqIDIgKyAwXSA9IGNwdV90b19iZTMyKGludGNfcGhhbmRsZXNbY3B1XSk7CisgICAg
ICAgIGFjbGludF9tc3dpX2NlbGxzW2NwdSAqIDIgKyAxXSA9IGNwdV90b19iZTMyKElSUV9NX1NP
RlQpOworICAgICAgICBhY2xpbnRfbXRpbWVyX2NlbGxzW2NwdSAqIDIgKyAwXSA9IGNwdV90b19i
ZTMyKGludGNfcGhhbmRsZXNbY3B1XSk7CisgICAgICAgIGFjbGludF9tdGltZXJfY2VsbHNbY3B1
ICogMiArIDFdID0gY3B1X3RvX2JlMzIoSVJRX01fVElNRVIpOworICAgICAgICBhY2xpbnRfc3N3
aV9jZWxsc1tjcHUgKiAyICsgMF0gPSBjcHVfdG9fYmUzMihpbnRjX3BoYW5kbGVzW2NwdV0pOwor
ICAgICAgICBhY2xpbnRfc3N3aV9jZWxsc1tjcHUgKiAyICsgMV0gPSBjcHVfdG9fYmUzMihJUlFf
U19TT0ZUKTsKKyAgICB9CisgICAgYWNsaW50X2NlbGxzX3NpemUgPSBzLT5zb2Nbc29ja2V0XS5u
dW1faGFydHMgKiBzaXplb2YodWludDMyX3QpICogMjsKKworICAgIGlmIChzLT5haWFfdHlwZSAh
PSBWRUdBX0FJQV9UWVBFX0FQTElDX0lNU0lDKSB7CisgICAgICAgIGFkZHIgPSBzLT5tZW1tYXBb
VkVHQV9DTElOVF0uYmFzZSArCisgICAgICAgICAgICAgICAocy0+bWVtbWFwW1ZFR0FfQ0xJTlRd
LnNpemUgKiBzb2NrZXQpOworICAgICAgICBuYW1lID0gZ19zdHJkdXBfcHJpbnRmKCIvc29jL21z
d2lAJWx4IiwgYWRkcik7CisKKyAgICAgICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwg
bmFtZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIG5hbWUsICJj
b21wYXRpYmxlIiwKKyAgICAgICAgICAgICJyaXNjdixhY2xpbnQtbXN3aSIpOworICAgICAgICBx
ZW11X2ZkdF9zZXRwcm9wX3NpemVkX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJyZWciLAorICAgICAg
ICAgICAgMiwgYWRkciwgMiwgVkVHQV9BQ0xJTlRfU1dJX1NJWkUpOworICAgICAgICBxZW11X2Zk
dF9zZXRwcm9wKG1zLT5mZHQsIG5hbWUsICJpbnRlcnJ1cHRzLWV4dGVuZGVkIiwKKyAgICAgICAg
ICAgIGFjbGludF9tc3dpX2NlbGxzLCBhY2xpbnRfY2VsbHNfc2l6ZSk7CisgICAgICAgIHFlbXVf
ZmR0X3NldHByb3AobXMtPmZkdCwgbmFtZSwgImludGVycnVwdC1jb250cm9sbGVyIiwgTlVMTCwg
MCk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAiI2ludGVy
cnVwdC1jZWxscyIsIDApOworICAgICAgICByaXNjdl9zb2NrZXRfZmR0X3dyaXRlX2lkKG1zLCBu
YW1lLCBzb2NrZXQpOworICAgICAgICBnX2ZyZWUobmFtZSk7CisgICAgfQorCisgICAgaWYgKHMt
PmFpYV90eXBlID09IFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMpIHsKKyAgICAgICAgYWRkciA9
IHMtPm1lbW1hcFtWRUdBX0NMSU5UXS5iYXNlICsKKyAgICAgICAgICAgICAgIChWRUdBX0FDTElO
VF9ERUZBVUxUX01USU1FUl9TSVpFICogc29ja2V0KTsKKyAgICAgICAgc2l6ZSA9IFZFR0FfQUNM
SU5UX0RFRkFVTFRfTVRJTUVSX1NJWkU7CisgICAgfSBlbHNlIHsKKyAgICAgICAgYWRkciA9IHMt
Pm1lbW1hcFtWRUdBX0NMSU5UXS5iYXNlICsgVkVHQV9BQ0xJTlRfU1dJX1NJWkUgKworICAgICAg
ICAgICAgICAgKHMtPm1lbW1hcFtWRUdBX0NMSU5UXS5zaXplICogc29ja2V0KTsKKyAgICAgICAg
c2l6ZSA9IHMtPm1lbW1hcFtWRUdBX0NMSU5UXS5zaXplIC0gVkVHQV9BQ0xJTlRfU1dJX1NJWkU7
CisgICAgfQorICAgIG5hbWUgPSBnX3N0cmR1cF9wcmludGYoIi9zb2MvbXRpbWVyQCVseCIsIGFk
ZHIpOworICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIG5hbWUpOworICAgIHFlbXVf
ZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIG5hbWUsICJjb21wYXRpYmxlIiwKKyAgICAgICAg
InJpc2N2LGFjbGludC1tdGltZXIiKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX3NpemVkX2NlbGxz
KG1zLT5mZHQsIG5hbWUsICJyZWciLAorICAgICAgICAyLCBhZGRyICsgVkVHQV9BQ0xJTlRfREVG
QVVMVF9NVElNRSwKKyAgICAgICAgMiwgc2l6ZSAtIFZFR0FfQUNMSU5UX0RFRkFVTFRfTVRJTUUs
CisgICAgICAgIDIsIGFkZHIgKyBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FQ01QLAorICAgICAg
ICAyLCBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wKG1z
LT5mZHQsIG5hbWUsICJpbnRlcnJ1cHRzLWV4dGVuZGVkIiwKKyAgICAgICAgYWNsaW50X210aW1l
cl9jZWxscywgYWNsaW50X2NlbGxzX3NpemUpOworICAgIHJpc2N2X3NvY2tldF9mZHRfd3JpdGVf
aWQobXMsIG5hbWUsIHNvY2tldCk7CisgICAgZ19mcmVlKG5hbWUpOworCisgICAgaWYgKHMtPmFp
YV90eXBlICE9IFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMpIHsKKyAgICAgICAgYWRkciA9IHMt
Pm1lbW1hcFtWRUdBX0FDTElOVF9TU1dJXS5iYXNlICsKKyAgICAgICAgICAgICAgIChzLT5tZW1t
YXBbVkVHQV9BQ0xJTlRfU1NXSV0uc2l6ZSAqIHNvY2tldCk7CisKKyAgICAgICAgbmFtZSA9IGdf
c3RyZHVwX3ByaW50ZigiL3NvYy9zc3dpQCVseCIsIGFkZHIpOworICAgICAgICBxZW11X2ZkdF9h
ZGRfc3Vibm9kZShtcy0+ZmR0LCBuYW1lKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJp
bmcobXMtPmZkdCwgbmFtZSwgImNvbXBhdGlibGUiLAorICAgICAgICAgICAgInJpc2N2LGFjbGlu
dC1zc3dpIik7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3Bfc2l6ZWRfY2VsbHMobXMtPmZkdCwg
bmFtZSwgInJlZyIsCisgICAgICAgICAgICAyLCBhZGRyLCAyLCBzLT5tZW1tYXBbVkVHQV9BQ0xJ
TlRfU1NXSV0uc2l6ZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3AobXMtPmZkdCwgbmFtZSwg
ImludGVycnVwdHMtZXh0ZW5kZWQiLAorICAgICAgICAgICAgYWNsaW50X3Nzd2lfY2VsbHMsIGFj
bGludF9jZWxsc19zaXplKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcChtcy0+ZmR0LCBuYW1l
LCAiaW50ZXJydXB0LWNvbnRyb2xsZXIiLCBOVUxMLCAwKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0
cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICIjaW50ZXJydXB0LWNlbGxzIiwgMCk7CisgICAgICAg
IHJpc2N2X3NvY2tldF9mZHRfd3JpdGVfaWQobXMsIG5hbWUsIHNvY2tldCk7CisgICAgICAgIGdf
ZnJlZShuYW1lKTsKKyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRfc29ja2V0X3Bs
aWMoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGludCBzb2NrZXQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90
ICpwaGFuZGxlLCB1aW50MzJfdCAqaW50Y19waGFuZGxlcywKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWludDMyX3QgKnBsaWNfcGhhbmRsZXMpCit7CisgICAgaW50IGNwdTsK
KyAgICBnX2F1dG9mcmVlIGNoYXIgKnBsaWNfbmFtZSA9IE5VTEw7CisgICAgZ19hdXRvZnJlZSB1
aW50MzJfdCAqcGxpY19jZWxsczsKKyAgICB1bnNpZ25lZCBsb25nIHBsaWNfYWRkcjsKKyAgICBN
YWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsKKworICAgIHN0YXRpYyBjb25zdCBjaGFyICpj
b25zdCBwbGljX2NvbXBhdFsyXSA9IHsiY2RhYyxwbGljLTEuMC4wIiwgInJpc2N2LHBsaWMwIn07
CisKKyAgICBwbGljX3BoYW5kbGVzW3NvY2tldF0gPSAoKnBoYW5kbGUpKys7CisgICAgcGxpY19h
ZGRyID0gcy0+bWVtbWFwW1ZFR0FfUExJQ19JRF0uYmFzZSArCisgICAgICAgICAgICAgICAgKHMt
Pm1lbW1hcFtWRUdBX1BMSUNfSURdLnNpemUgKiBzb2NrZXQpOworICAgIHBsaWNfbmFtZSA9IGdf
c3RyZHVwX3ByaW50ZigiL3NvYy9wbGljQCVseCIsIHBsaWNfYWRkcik7CisgICAgcWVtdV9mZHRf
YWRkX3N1Ym5vZGUobXMtPmZkdCwgcGxpY19uYW1lKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2Nl
bGwobXMtPmZkdCwgcGxpY19uYW1lLAorICAgICAgICAiI2ludGVycnVwdC1jZWxscyIsIEZEVF9Q
TElDX0lOVF9DRUxMUyk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIHBsaWNf
bmFtZSwKKyAgICAgICAgIiNhZGRyZXNzLWNlbGxzIiwgRkRUX1BMSUNfQUREUl9DRUxMUyk7Cisg
ICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmdfYXJyYXkobXMtPmZkdCwgcGxpY19uYW1lLCAiY29t
cGF0aWJsZSIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNoYXIgKiopJnBs
aWNfY29tcGF0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFSUkFZX1NJWkUo
cGxpY19jb21wYXQpKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIHBsaWNfbmFtZSwg
ImludGVycnVwdC1jb250cm9sbGVyIiwgTlVMTCwgMCk7CisKKyAgICBpZiAoa3ZtX2VuYWJsZWQo
KSkgeworICAgICAgICBwbGljX2NlbGxzID0gZ19uZXcwKHVpbnQzMl90LCBzLT5zb2Nbc29ja2V0
XS5udW1faGFydHMgKiAyKTsKKworICAgICAgICBmb3IgKGNwdSA9IDA7IGNwdSA8IHMtPnNvY1tz
b2NrZXRdLm51bV9oYXJ0czsgY3B1KyspIHsKKyAgICAgICAgICAgIHBsaWNfY2VsbHNbY3B1ICog
MiArIDBdID0gY3B1X3RvX2JlMzIoaW50Y19waGFuZGxlc1tjcHVdKTsKKyAgICAgICAgICAgIHBs
aWNfY2VsbHNbY3B1ICogMiArIDFdID0gY3B1X3RvX2JlMzIoSVJRX1NfRVhUKTsKKyAgICAgICAg
fQorCisgICAgICAgIHFlbXVfZmR0X3NldHByb3AobXMtPmZkdCwgcGxpY19uYW1lLCAiaW50ZXJy
dXB0cy1leHRlbmRlZCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgcGxpY19jZWxscywKKyAg
ICAgICAgICAgICAgICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5udW1faGFydHMgKiBzaXplb2Yo
dWludDMyX3QpICogMik7CisgICB9IGVsc2UgeworICAgICAgICBwbGljX2NlbGxzID0gZ19uZXcw
KHVpbnQzMl90LCBzLT5zb2Nbc29ja2V0XS5udW1faGFydHMgKiA0KTsKKworICAgICAgICBmb3Ig
KGNwdSA9IDA7IGNwdSA8IHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0czsgY3B1KyspIHsKKyAgICAg
ICAgICAgIHBsaWNfY2VsbHNbY3B1ICogNCArIDBdID0gY3B1X3RvX2JlMzIoaW50Y19waGFuZGxl
c1tjcHVdKTsKKyAgICAgICAgICAgIHBsaWNfY2VsbHNbY3B1ICogNCArIDFdID0gY3B1X3RvX2Jl
MzIoSVJRX01fRVhUKTsKKyAgICAgICAgICAgIHBsaWNfY2VsbHNbY3B1ICogNCArIDJdID0gY3B1
X3RvX2JlMzIoaW50Y19waGFuZGxlc1tjcHVdKTsKKyAgICAgICAgICAgIHBsaWNfY2VsbHNbY3B1
ICogNCArIDNdID0gY3B1X3RvX2JlMzIoSVJRX1NfRVhUKTsKKyAgICAgICAgfQorCisgICAgICAg
IHFlbXVfZmR0X3NldHByb3AobXMtPmZkdCwgcGxpY19uYW1lLCAiaW50ZXJydXB0cy1leHRlbmRl
ZCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgcGxpY19jZWxscywKKyAgICAgICAgICAgICAg
ICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5udW1faGFydHMgKiBzaXplb2YodWludDMyX3QpICog
NCk7CisgICAgfQorCisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxscyhtcy0+ZmR0LCBw
bGljX25hbWUsICJyZWciLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMiwgcGxp
Y19hZGRyLCAyLCBzLT5tZW1tYXBbVkVHQV9QTElDX0lEXS5zaXplKTsKKyAgICBxZW11X2ZkdF9z
ZXRwcm9wX2NlbGwobXMtPmZkdCwgcGxpY19uYW1lLCAicmlzY3YsbmRldiIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgIFZFR0FfSVJRQ0hJUF9OVU1fU09VUkNFUyAtIDEpOworICAgIHJpc2N2
X3NvY2tldF9mZHRfd3JpdGVfaWQobXMsIHBsaWNfbmFtZSwgc29ja2V0KTsKKyAgICBxZW11X2Zk
dF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgcGxpY19uYW1lLCAicGhhbmRsZSIsCisgICAgICAgIHBs
aWNfcGhhbmRsZXNbc29ja2V0XSk7CisKKyAgICBpZiAoIXNvY2tldCkgeworICAgICAgICBwbGF0
Zm9ybV9idXNfYWRkX2FsbF9mZHRfbm9kZXMobXMtPmZkdCwgcGxpY19uYW1lLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfUExBVEZPUk1fQlVT
XS5iYXNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+bWVtbWFw
W1ZFR0FfUExBVEZPUk1fQlVTXS5zaXplLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgVklSVF9QTEFURk9STV9CVVNfSVJRKTsKKyAgICB9Cit9CisKK3VpbnQzMl90IGlt
c2ljX251bV9iaXRzX3ZlZ2EodWludDMyX3QgY291bnQpCit7CisgICAgdWludDMyX3QgcmV0ID0g
MDsKKworICAgIHdoaWxlIChCSVQocmV0KSA8IGNvdW50KSB7CisgICAgICAgIHJldCsrOworICAg
IH0KKworICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRfb25lX2lt
c2ljKFJJU0NWVmVnYVN0YXRlICpzLCBod2FkZHIgYmFzZV9hZGRyLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmludGNfcGhhbmRsZXMsIHVpbnQzMl90IG1zaV9w
aGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBtX21vZGUsIHVp
bnQzMl90IGltc2ljX2d1ZXN0X2JpdHMpCit7CisgICAgaW50IGNwdSwgc29ja2V0OworICAgIGdf
YXV0b2ZyZWUgY2hhciAqaW1zaWNfbmFtZSA9IE5VTEw7CisgICAgTWFjaGluZVN0YXRlICptcyA9
IE1BQ0hJTkUocyk7CisgICAgaW50IHNvY2tldF9jb3VudCA9IHJpc2N2X3NvY2tldF9jb3VudCht
cyk7CisgICAgdWludDMyX3QgaW1zaWNfbWF4X2hhcnRfcGVyX3NvY2tldCwgaW1zaWNfYWRkciwg
aW1zaWNfc2l6ZTsKKyAgICBnX2F1dG9mcmVlIHVpbnQzMl90ICppbXNpY19jZWxscyA9IE5VTEw7
CisgICAgZ19hdXRvZnJlZSB1aW50MzJfdCAqaW1zaWNfcmVncyA9IE5VTEw7CisgICAgc3RhdGlj
IGNvbnN0IGNoYXIgKiBjb25zdCBpbXNpY19jb21wYXRbMl0gPSB7CisgICAgICAgICJxZW11LGlt
c2ljcyIsICJyaXNjdixpbXNpY3MiCisgICAgfTsKKworICAgIGltc2ljX2NlbGxzID0gZ19uZXcw
KHVpbnQzMl90LCBtcy0+c21wLmNwdXMgKiAyKTsKKyAgICBpbXNpY19yZWdzID0gZ19uZXcwKHVp
bnQzMl90LCBzb2NrZXRfY291bnQgKiA0KTsKKworICAgIGZvciAoY3B1ID0gMDsgY3B1IDwgbXMt
PnNtcC5jcHVzOyBjcHUrKykgeworICAgICAgICBpbXNpY19jZWxsc1tjcHUgKiAyICsgMF0gPSBj
cHVfdG9fYmUzMihpbnRjX3BoYW5kbGVzW2NwdV0pOworICAgICAgICBpbXNpY19jZWxsc1tjcHUg
KiAyICsgMV0gPSBjcHVfdG9fYmUzMihtX21vZGUgPyBJUlFfTV9FWFQgOiBJUlFfU19FWFQpOwor
ICAgIH0KKworICAgIGltc2ljX21heF9oYXJ0X3Blcl9zb2NrZXQgPSAwOworICAgIGZvciAoc29j
a2V0ID0gMDsgc29ja2V0IDwgc29ja2V0X2NvdW50OyBzb2NrZXQrKykgeworICAgICAgICBpbXNp
Y19hZGRyID0gYmFzZV9hZGRyICsgc29ja2V0ICogVkVHQV9JTVNJQ19HUk9VUF9NQVhfU0laRTsK
KyAgICAgICAgaW1zaWNfc2l6ZSA9IElNU0lDX0hBUlRfU0laRShpbXNpY19ndWVzdF9iaXRzKSAq
CisgICAgICAgICAgICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5udW1faGFydHM7CisgICAgICAg
IGltc2ljX3JlZ3Nbc29ja2V0ICogNCArIDBdID0gMDsKKyAgICAgICAgaW1zaWNfcmVnc1tzb2Nr
ZXQgKiA0ICsgMV0gPSBjcHVfdG9fYmUzMihpbXNpY19hZGRyKTsKKyAgICAgICAgaW1zaWNfcmVn
c1tzb2NrZXQgKiA0ICsgMl0gPSAwOworICAgICAgICBpbXNpY19yZWdzW3NvY2tldCAqIDQgKyAz
XSA9IGNwdV90b19iZTMyKGltc2ljX3NpemUpOworICAgICAgICBpZiAoaW1zaWNfbWF4X2hhcnRf
cGVyX3NvY2tldCA8IHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0cykgeworICAgICAgICAgICAgaW1z
aWNfbWF4X2hhcnRfcGVyX3NvY2tldCA9IHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0czsKKyAgICAg
ICAgfQorICAgIH0KKworICAgIGltc2ljX25hbWUgPSBnX3N0cmR1cF9wcmludGYoIi9zb2MvaW50
ZXJydXB0LWNvbnRyb2xsZXJAJWx4IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICh1bnNpZ25lZCBsb25nKWJhc2VfYWRkcik7CisgICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMt
PmZkdCwgaW1zaWNfbmFtZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmdfYXJyYXkobXMt
PmZkdCwgaW1zaWNfbmFtZSwgImNvbXBhdGlibGUiLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIChjaGFyICoqKSZpbXNpY19jb21wYXQsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgQVJSQVlfU0laRShpbXNpY19jb21wYXQpKTsKKworICAgIHFlbXVfZmR0X3Nl
dHByb3BfY2VsbChtcy0+ZmR0LCBpbXNpY19uYW1lLCAiI2ludGVycnVwdC1jZWxscyIsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgIEZEVF9JTVNJQ19JTlRfQ0VMTFMpOworICAgIHFlbXVfZmR0
X3NldHByb3AobXMtPmZkdCwgaW1zaWNfbmFtZSwgImludGVycnVwdC1jb250cm9sbGVyIiwgTlVM
TCwgMCk7CisgICAgcWVtdV9mZHRfc2V0cHJvcChtcy0+ZmR0LCBpbXNpY19uYW1lLCAibXNpLWNv
bnRyb2xsZXIiLCBOVUxMLCAwKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIGltc2lj
X25hbWUsICJpbnRlcnJ1cHRzLWV4dGVuZGVkIiwKKyAgICAgICAgICAgICAgICAgICAgIGltc2lj
X2NlbGxzLCBtcy0+c21wLmNwdXMgKiBzaXplb2YodWludDMyX3QpICogMik7CisgICAgcWVtdV9m
ZHRfc2V0cHJvcChtcy0+ZmR0LCBpbXNpY19uYW1lLCAicmVnIiwgaW1zaWNfcmVncywKKyAgICAg
ICAgICAgICAgICAgICAgIHNvY2tldF9jb3VudCAqIHNpemVvZih1aW50MzJfdCkgKiA0KTsKKyAg
ICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgaW1zaWNfbmFtZSwgInJpc2N2LG51bS1p
ZHMiLAorICAgICAgICAgICAgICAgICAgICAgVkVHQV9JUlFDSElQX05VTV9NU0lTKTsKKworICAg
IGlmIChpbXNpY19ndWVzdF9iaXRzKSB7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbCht
cy0+ZmR0LCBpbXNpY19uYW1lLCAicmlzY3YsZ3Vlc3QtaW5kZXgtYml0cyIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpbXNpY19ndWVzdF9iaXRzKTsKKyAgICB9CisKKyAgICBpZiAo
c29ja2V0X2NvdW50ID4gMSkgeworICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZk
dCwgaW1zaWNfbmFtZSwgInJpc2N2LGhhcnQtaW5kZXgtYml0cyIsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBpbXNpY19udW1fYml0c192ZWdhKGltc2ljX21heF9oYXJ0X3Blcl9zb2Nr
ZXQpKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIGltc2ljX25hbWUs
ICJyaXNjdixncm91cC1pbmRleC1iaXRzIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGltc2ljX251bV9iaXRzX3ZlZ2Eoc29ja2V0X2NvdW50KSk7CisgICAgICAgIHFlbXVfZmR0X3Nl
dHByb3BfY2VsbChtcy0+ZmR0LCBpbXNpY19uYW1lLCAicmlzY3YsZ3JvdXAtaW5kZXgtc2hpZnQi
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSU1TSUNfTU1JT19HUk9VUF9NSU5fU0hJ
RlQpOworICAgIH0KKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgaW1zaWNfbmFt
ZSwgInBoYW5kbGUiLCBtc2lfcGhhbmRsZSk7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRf
aW1zaWMoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQzMl90ICpwaGFuZGxlLCB1aW50MzJfdCAqaW50Y19waGFuZGxlcywKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWludDMyX3QgKm1zaV9tX3BoYW5kbGUsIHVpbnQzMl90ICptc2lfc19w
aGFuZGxlKQoreworICAgICptc2lfbV9waGFuZGxlID0gKCpwaGFuZGxlKSsrOworICAgICptc2lf
c19waGFuZGxlID0gKCpwaGFuZGxlKSsrOworCisgICAgaWYgKCFrdm1fZW5hYmxlZCgpKSB7Cisg
ICAgICAgIC8qIE0tbGV2ZWwgSU1TSUMgbm9kZSAqLworICAgICAgICBjcmVhdGVfZmR0X29uZV9p
bXNpYyhzLCBzLT5tZW1tYXBbVkVHQV9JTVNJQ19NXS5iYXNlLCBpbnRjX3BoYW5kbGVzLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAqbXNpX21fcGhhbmRsZSwgdHJ1ZSwgMCk7CisgICAg
fQorCisgICAgLyogUy1sZXZlbCBJTVNJQyBub2RlICovCisgICAgY3JlYXRlX2ZkdF9vbmVfaW1z
aWMocywgcy0+bWVtbWFwW1ZFR0FfSU1TSUNfU10uYmFzZSwgaW50Y19waGFuZGxlcywKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAqbXNpX3NfcGhhbmRsZSwgZmFsc2UsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgaW1zaWNfbnVtX2JpdHNfdmVnYShzLT5haWFfZ3Vlc3RzICsgMSkpOworCit9
CisKKy8qIENhbGxlciBtdXN0IGZyZWUgc3RyaW5nIGFmdGVyIHVzZSAqLworc3RhdGljIGNoYXIg
KmZkdF9nZXRfYXBsaWNfbm9kZW5hbWUodW5zaWduZWQgbG9uZyBhcGxpY19hZGRyKQoreworICAg
IHJldHVybiBnX3N0cmR1cF9wcmludGYoIi9zb2MvaW50ZXJydXB0LWNvbnRyb2xsZXJAJWx4Iiwg
YXBsaWNfYWRkcik7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRfb25lX2FwbGljKFJJU0NW
VmVnYVN0YXRlICpzLCBpbnQgc29ja2V0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdW5zaWduZWQgbG9uZyBhcGxpY19hZGRyLCB1aW50MzJfdCBhcGxpY19zaXplLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgbXNpX3BoYW5kbGUsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAqaW50Y19waGFuZGxlcywKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGFwbGljX3BoYW5kbGUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBhcGxpY19jaGlsZF9waGFuZGxl
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBtX21vZGUsIGludCBudW1f
aGFydHMpCit7CisgICAgaW50IGNwdTsKKyAgICBnX2F1dG9mcmVlIGNoYXIgKmFwbGljX25hbWUg
PSBmZHRfZ2V0X2FwbGljX25vZGVuYW1lKGFwbGljX2FkZHIpOworICAgIGdfYXV0b2ZyZWUgdWlu
dDMyX3QgKmFwbGljX2NlbGxzID0gZ19uZXcwKHVpbnQzMl90LCBudW1faGFydHMgKiAyKTsKKyAg
ICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsKKyAgICBzdGF0aWMgY29uc3QgY2hhciAq
IGNvbnN0IGFwbGljX2NvbXBhdFsyXSA9IHsKKyAgICAgICAgInFlbXUsYXBsaWMiLCAicmlzY3Ys
YXBsaWMiCisgICAgfTsKKworICAgIGZvciAoY3B1ID0gMDsgY3B1IDwgbnVtX2hhcnRzOyBjcHUr
KykgeworICAgICAgICBhcGxpY19jZWxsc1tjcHUgKiAyICsgMF0gPSBjcHVfdG9fYmUzMihpbnRj
X3BoYW5kbGVzW2NwdV0pOworICAgICAgICBhcGxpY19jZWxsc1tjcHUgKiAyICsgMV0gPSBjcHVf
dG9fYmUzMihtX21vZGUgPyBJUlFfTV9FWFQgOiBJUlFfU19FWFQpOworICAgIH0KKworICAgIHFl
bXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIGFwbGljX25hbWUpOworICAgIHFlbXVfZmR0X3Nl
dHByb3Bfc3RyaW5nX2FycmF5KG1zLT5mZHQsIGFwbGljX25hbWUsICJjb21wYXRpYmxlIiwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2hhciAqKikmYXBsaWNfY29tcGF0LAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFSUkFZX1NJWkUoYXBsaWNfY29tcGF0
KSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIGFwbGljX25hbWUsICIjYWRk
cmVzcy1jZWxscyIsCisgICAgICAgICAgICAgICAgICAgICAgICAgIEZEVF9BUExJQ19BRERSX0NF
TExTKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgYXBsaWNfbmFtZSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgIiNpbnRlcnJ1cHQtY2VsbHMiLCBGRFRfQVBMSUNfSU5U
X0NFTExTKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIGFwbGljX25hbWUsICJpbnRl
cnJ1cHQtY29udHJvbGxlciIsIE5VTEwsIDApOworCisgICAgaWYgKHMtPmFpYV90eXBlID09IFZF
R0FfQUlBX1RZUEVfQVBMSUMpIHsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcChtcy0+ZmR0LCBh
cGxpY19uYW1lLCAiaW50ZXJydXB0cy1leHRlbmRlZCIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgYXBsaWNfY2VsbHMsIG51bV9oYXJ0cyAqIHNpemVvZih1aW50MzJfdCkgKiAyKTsKKyAgICB9
IGVsc2UgeworICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgYXBsaWNfbmFt
ZSwgIm1zaS1wYXJlbnQiLCBtc2lfcGhhbmRsZSk7CisgICAgfQorCisgICAgcWVtdV9mZHRfc2V0
cHJvcF9zaXplZF9jZWxscyhtcy0+ZmR0LCBhcGxpY19uYW1lLCAicmVnIiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIDIsIGFwbGljX2FkZHIsIDIsIGFwbGljX3NpemUpOworICAg
IHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBhcGxpY19uYW1lLCAicmlzY3YsbnVtLXNv
dXJjZXMiLAorICAgICAgICAgICAgICAgICAgICAgICAgICBWRUdBX0lSUUNISVBfTlVNX1NPVVJD
RVMpOworCisgICAgaWYgKGFwbGljX2NoaWxkX3BoYW5kbGUpIHsKKyAgICAgICAgcWVtdV9mZHRf
c2V0cHJvcF9jZWxsKG1zLT5mZHQsIGFwbGljX25hbWUsICJyaXNjdixjaGlsZHJlbiIsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBhcGxpY19jaGlsZF9waGFuZGxlKTsKKyAgICAgICAg
cWVtdV9mZHRfc2V0cHJvcF9jZWxscyhtcy0+ZmR0LCBhcGxpY19uYW1lLCAicmlzY3YsZGVsZWdh
dGlvbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBsaWNfY2hpbGRfcGhhbmRs
ZSwgMHgxLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZFR0FfSVJRQ0hJUF9OVU1f
U09VUkNFUyk7CisgICAgICAgIC8qCisgICAgICAgICAqIERFUFJFQ0FURURfOS4xOiBDb21wYXQg
cHJvcGVydHkga2VwdCB0ZW1wb3JhcmlseQorICAgICAgICAgKiB0byBhbGxvdyBvbGQgZmlybXdh
cmVzIHRvIHdvcmsgd2l0aCBBSUEuIERvICpub3QqCisgICAgICAgICAqIHVzZSAncmlzY3YsZGVs
ZWdhdGUnIGluIG5ldyBjb2RlOiB1c2UKKyAgICAgICAgICogJ3Jpc2N2LGRlbGVnYXRpb24nIGlu
c3RlYWQuCisgICAgICAgICAqLworICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGxzKG1zLT5m
ZHQsIGFwbGljX25hbWUsICJyaXNjdixkZWxlZ2F0ZSIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgYXBsaWNfY2hpbGRfcGhhbmRsZSwgMHgxLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFZFR0FfSVJRQ0hJUF9OVU1fU09VUkNFUyk7CisgICAgfQorCisgICAgcmlzY3Zf
c29ja2V0X2ZkdF93cml0ZV9pZChtcywgYXBsaWNfbmFtZSwgc29ja2V0KTsKKyAgICBxZW11X2Zk
dF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgYXBsaWNfbmFtZSwgInBoYW5kbGUiLCBhcGxpY19waGFu
ZGxlKTsKK30KKworc3RhdGljIHZvaWQgY3JlYXRlX2ZkdF9zb2NrZXRfYXBsaWMoUklTQ1ZWZWdh
U3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgc29ja2V0
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgbXNpX21fcGhh
bmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IG1zaV9z
X3BoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAq
cGhhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpp
bnRjX3BoYW5kbGVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMy
X3QgKmFwbGljX3BoYW5kbGVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
aW50IG51bV9oYXJ0cykKK3sKKyAgICB1bnNpZ25lZCBsb25nIGFwbGljX2FkZHI7CisgICAgTWFj
aGluZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7CisgICAgdWludDMyX3QgYXBsaWNfbV9waGFuZGxl
LCBhcGxpY19zX3BoYW5kbGU7CisKKyAgICBhcGxpY19tX3BoYW5kbGUgPSAoKnBoYW5kbGUpKys7
CisgICAgYXBsaWNfc19waGFuZGxlID0gKCpwaGFuZGxlKSsrOworCisgICAgaWYgKCFrdm1fZW5h
YmxlZCgpKSB7CisgICAgICAgIC8qIE0tbGV2ZWwgQVBMSUMgbm9kZSAqLworICAgICAgICBhcGxp
Y19hZGRyID0gcy0+bWVtbWFwW1ZFR0FfQVBMSUNfTV0uYmFzZSArCisgICAgICAgICAgICAgICAg
ICAgICAocy0+bWVtbWFwW1ZFR0FfQVBMSUNfTV0uc2l6ZSAqIHNvY2tldCk7CisgICAgICAgIGNy
ZWF0ZV9mZHRfb25lX2FwbGljKHMsIHNvY2tldCwgYXBsaWNfYWRkciwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfQVBMSUNfTV0uc2l6ZSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbXNpX21fcGhhbmRsZSwgaW50Y19waGFuZGxlcywKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgYXBsaWNfbV9waGFuZGxlLCBhcGxpY19zX3BoYW5kbGUsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsIG51bV9oYXJ0cyk7CisgICAgfQorCisg
ICAgLyogUy1sZXZlbCBBUExJQyBub2RlICovCisgICAgYXBsaWNfYWRkciA9IHMtPm1lbW1hcFtW
RUdBX0FQTElDX1NdLmJhc2UgKworICAgICAgICAgICAgICAgICAocy0+bWVtbWFwW1ZFR0FfQVBM
SUNfU10uc2l6ZSAqIHNvY2tldCk7CisgICAgY3JlYXRlX2ZkdF9vbmVfYXBsaWMocywgc29ja2V0
LCBhcGxpY19hZGRyLCBzLT5tZW1tYXBbVkVHQV9BUExJQ19TXS5zaXplLAorICAgICAgICAgICAg
ICAgICAgICAgICAgIG1zaV9zX3BoYW5kbGUsIGludGNfcGhhbmRsZXMsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgYXBsaWNfc19waGFuZGxlLCAwLAorICAgICAgICAgICAgICAgICAgICAgICAg
IGZhbHNlLCBudW1faGFydHMpOworCisgICAgaWYgKCFzb2NrZXQpIHsKKyAgICAgICAgZ19hdXRv
ZnJlZSBjaGFyICphcGxpY19uYW1lID0gZmR0X2dldF9hcGxpY19ub2RlbmFtZShhcGxpY19hZGRy
KTsKKyAgICAgICAgcGxhdGZvcm1fYnVzX2FkZF9hbGxfZmR0X25vZGVzKG1zLT5mZHQsIGFwbGlj
X25hbWUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzLT5tZW1tYXBb
VkVHQV9QTEFURk9STV9CVVNdLmJhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzLT5tZW1tYXBbVkVHQV9QTEFURk9STV9CVVNdLnNpemUsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBWSVJUX1BMQVRGT1JNX0JVU19JUlEpOworICAgIH0K
KworICAgIGFwbGljX3BoYW5kbGVzW3NvY2tldF0gPSBhcGxpY19zX3BoYW5kbGU7Cit9CisKK3N0
YXRpYyB2b2lkIGNyZWF0ZV9mZHRfcG11KFJJU0NWVmVnYVN0YXRlICpzKQoreworICAgIGdfYXV0
b2ZyZWUgY2hhciAqcG11X25hbWUgPSBnX3N0cmR1cF9wcmludGYoIi9wbXUiKTsKKyAgICBNYWNo
aW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsKKyAgICBSSVNDVkNQVSBoYXJ0ID0gcy0+c29jWzBd
LmhhcnRzWzBdOworCisgICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwgcG11X25hbWUp
OworICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIHBtdV9uYW1lLCAiY29tcGF0
aWJsZSIsICJyaXNjdixwbXUiKTsKKyAgICByaXNjdl9wbXVfZ2VuZXJhdGVfZmR0X25vZGUobXMt
PmZkdCwgaGFydC5wbXVfYXZhaWxfY3RycywgcG11X25hbWUpOworfQorCitzdGF0aWMgdm9pZCBj
cmVhdGVfZmR0X3NvY2tldHMoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWludDMyX3QgKnBoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdWludDMyX3QgKmlycV9tbWlvX3BoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDMyX3QgKmlycV9wY2llX3BoYW5kbGUsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWludDMyX3QgKmlycV92aXJ0aW9fcGhhbmRsZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1aW50MzJfdCAqbXNpX3BjaWVfcGhhbmRsZSkKK3sKKyAgICBpbnQg
c29ja2V0LCBwaGFuZGxlX3BvczsKKyAgICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsK
KyAgICB1aW50MzJfdCBtc2lfbV9waGFuZGxlID0gMCwgbXNpX3NfcGhhbmRsZSA9IDA7CisgICAg
dWludDMyX3QgeHBsaWNfcGhhbmRsZXNbTUFYX05PREVTXTsKKyAgICBnX2F1dG9mcmVlIHVpbnQz
Ml90ICppbnRjX3BoYW5kbGVzID0gTlVMTDsKKyAgICBpbnQgc29ja2V0X2NvdW50ID0gcmlzY3Zf
c29ja2V0X2NvdW50KG1zKTsKKworICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsICIv
Y3B1cyIpOworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCAiL2NwdXMiLCAidGlt
ZWJhc2UtZnJlcXVlbmN5IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAga3ZtX2VuYWJsZWQo
KSA/CisgICAgICAgICAgICAgICAgICAgICAgICAgIGt2bV9yaXNjdl9nZXRfdGltZWJhc2VfZnJl
cXVlbmN5KCZzLT5zb2MtPmhhcnRzWzBdKSA6CisgICAgICAgICAgICAgICAgICAgICAgICAgIFZF
R0FfQUNMSU5UX0RFRkFVTFRfVElNRUJBU0VfRlJFUSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9j
ZWxsKG1zLT5mZHQsICIvY3B1cyIsICIjc2l6ZS1jZWxscyIsIDB4MCk7CisgICAgcWVtdV9mZHRf
c2V0cHJvcF9jZWxsKG1zLT5mZHQsICIvY3B1cyIsICIjYWRkcmVzcy1jZWxscyIsIDB4MSk7Cisg
ICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwgIi9jcHVzL2NwdS1tYXAiKTsKKworICAg
IGludGNfcGhhbmRsZXMgPSBnX25ldzAodWludDMyX3QsIG1zLT5zbXAuY3B1cyk7CisKKyAgICBw
aGFuZGxlX3BvcyA9IG1zLT5zbXAuY3B1czsKKyAgICBmb3IgKHNvY2tldCA9IChzb2NrZXRfY291
bnQgLSAxKTsgc29ja2V0ID49IDA7IHNvY2tldC0tKSB7CisgICAgICAgIGdfYXV0b2ZyZWUgY2hh
ciAqY2x1c3RfbmFtZSA9IE5VTEw7CisgICAgICAgIHBoYW5kbGVfcG9zIC09IHMtPnNvY1tzb2Nr
ZXRdLm51bV9oYXJ0czsKKworICAgICAgICBjbHVzdF9uYW1lID0gZ19zdHJkdXBfcHJpbnRmKCIv
Y3B1cy9jcHUtbWFwL2NsdXN0ZXIlZCIsIHNvY2tldCk7CisgICAgICAgIHFlbXVfZmR0X2FkZF9z
dWJub2RlKG1zLT5mZHQsIGNsdXN0X25hbWUpOworCisgICAgICAgIGNyZWF0ZV9mZHRfc29ja2V0
X2NwdXMocywgc29ja2V0LCBjbHVzdF9uYW1lLCBwaGFuZGxlLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZpbnRjX3BoYW5kbGVzW3BoYW5kbGVfcG9zXSk7CisKKyAgICAgICAgY3Jl
YXRlX2ZkdF9zb2NrZXRfbWVtb3J5KHMsIHNvY2tldCk7CisKKyAgICAgICAgaWYgKHZlZ2FfYWNs
aW50X2FsbG93ZWQoKSAmJiBzLT5oYXZlX2FjbGludCkgeworICAgICAgICAgICAgY3JlYXRlX2Zk
dF9zb2NrZXRfYWNsaW50KHMsIHNvY2tldCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAmaW50Y19waGFuZGxlc1twaGFuZGxlX3Bvc10pOworICAgICAgICB9IGVsc2UgaWYg
KHRjZ19lbmFibGVkKCkpIHsKKyAgICAgICAgICAgIGNyZWF0ZV9mZHRfc29ja2V0X2NsaW50KHMs
IHNvY2tldCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZpbnRjX3BoYW5k
bGVzW3BoYW5kbGVfcG9zXSk7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAocy0+YWlhX3R5
cGUgPT0gVkVHQV9BSUFfVFlQRV9BUExJQ19JTVNJQykgeworICAgICAgICBjcmVhdGVfZmR0X2lt
c2ljKHMsIHBoYW5kbGUsIGludGNfcGhhbmRsZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAg
Jm1zaV9tX3BoYW5kbGUsICZtc2lfc19waGFuZGxlKTsKKyAgICAgICAgKm1zaV9wY2llX3BoYW5k
bGUgPSBtc2lfc19waGFuZGxlOworICAgIH0KKworICAgIC8qCisgICAgICogV2l0aCBLVk0gQUlB
IGFwbGljLWltc2ljLCB1c2luZyBhbiBpcnFjaGlwIHdpdGhvdXQgc3BsaXQKKyAgICAgKiBtb2Rl
LCB3ZSdsbCB1c2Ugb25seSBvbmUgQVBMSUMgaW5zdGFuY2UuCisgICAgICovCisgICAgaWYgKCF2
ZWdhX3VzZV9lbXVsYXRlZF9hcGxpYyhzLT5haWFfdHlwZSkpIHsKKyAgICAgICAgY3JlYXRlX2Zk
dF9zb2NrZXRfYXBsaWMocywgMCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNp
X21fcGhhbmRsZSwgbXNpX3NfcGhhbmRsZSwgcGhhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgJmludGNfcGhhbmRsZXNbMF0sIHhwbGljX3BoYW5kbGVzLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBtcy0+c21wLmNwdXMpOworCisgICAgICAgICppcnFfbW1p
b19waGFuZGxlID0geHBsaWNfcGhhbmRsZXNbMF07CisgICAgICAgICppcnFfdmlydGlvX3BoYW5k
bGUgPSB4cGxpY19waGFuZGxlc1swXTsKKyAgICAgICAgKmlycV9wY2llX3BoYW5kbGUgPSB4cGxp
Y19waGFuZGxlc1swXTsKKyAgICB9IGVsc2UgeworICAgICAgICBwaGFuZGxlX3BvcyA9IG1zLT5z
bXAuY3B1czsKKyAgICAgICAgZm9yIChzb2NrZXQgPSAoc29ja2V0X2NvdW50IC0gMSk7IHNvY2tl
dCA+PSAwOyBzb2NrZXQtLSkgeworICAgICAgICAgICAgcGhhbmRsZV9wb3MgLT0gcy0+c29jW3Nv
Y2tldF0ubnVtX2hhcnRzOworCisgICAgICAgICAgICBpZiAocy0+YWlhX3R5cGUgPT0gVkVHQV9B
SUFfVFlQRV9OT05FKSB7CisgICAgICAgICAgICAgICAgY3JlYXRlX2ZkdF9zb2NrZXRfcGxpYyhz
LCBzb2NrZXQsIHBoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmaW50Y19waGFuZGxlc1twaGFuZGxlX3Bvc10sCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB4cGxpY19waGFuZGxlcyk7CisgICAgICAgICAgICB9IGVsc2UgeworICAg
ICAgICAgICAgICAgIGNyZWF0ZV9mZHRfc29ja2V0X2FwbGljKHMsIHNvY2tldCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2lfbV9waGFuZGxlLCBtc2lfc19waGFu
ZGxlLCBwaGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZp
bnRjX3BoYW5kbGVzW3BoYW5kbGVfcG9zXSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB4cGxpY19waGFuZGxlcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5udW1faGFydHMpOworICAgICAgICAgICAgfQorICAg
ICAgICB9CisKKyAgICAgICAgZm9yIChzb2NrZXQgPSAwOyBzb2NrZXQgPCBzb2NrZXRfY291bnQ7
IHNvY2tldCsrKSB7CisgICAgICAgICAgICBpZiAoc29ja2V0ID09IDApIHsKKyAgICAgICAgICAg
ICAgICAqaXJxX21taW9fcGhhbmRsZSA9IHhwbGljX3BoYW5kbGVzW3NvY2tldF07CisgICAgICAg
ICAgICAgICAgKmlycV92aXJ0aW9fcGhhbmRsZSA9IHhwbGljX3BoYW5kbGVzW3NvY2tldF07Cisg
ICAgICAgICAgICAgICAgKmlycV9wY2llX3BoYW5kbGUgPSB4cGxpY19waGFuZGxlc1tzb2NrZXRd
OworICAgICAgICAgICAgfQorICAgICAgICAgICAgaWYgKHNvY2tldCA9PSAxKSB7CisgICAgICAg
ICAgICAgICAgKmlycV92aXJ0aW9fcGhhbmRsZSA9IHhwbGljX3BoYW5kbGVzW3NvY2tldF07Cisg
ICAgICAgICAgICAgICAgKmlycV9wY2llX3BoYW5kbGUgPSB4cGxpY19waGFuZGxlc1tzb2NrZXRd
OworICAgICAgICAgICAgfQorICAgICAgICAgICAgaWYgKHNvY2tldCA9PSAyKSB7CisgICAgICAg
ICAgICAgICAgKmlycV9wY2llX3BoYW5kbGUgPSB4cGxpY19waGFuZGxlc1tzb2NrZXRdOworICAg
ICAgICAgICAgfQorICAgICAgICB9CisgICAgfQorCisgICAgcmlzY3Zfc29ja2V0X2ZkdF93cml0
ZV9kaXN0YW5jZV9tYXRyaXgobXMpOworfQorCitzdGF0aWMgdm9pZCBjcmVhdGVfZmR0X3ZpcnRp
byhSSVNDVlZlZ2FTdGF0ZSAqcywgdWludDMyX3QgaXJxX3ZpcnRpb19waGFuZGxlKQoreworICAg
IGludCBpOworICAgIE1hY2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHMpOworICAgIGh3YWRkciB2
aXJ0aW9fYmFzZSA9IHMtPm1lbW1hcFtWRUdBX1ZJUlRJT10uYmFzZTsKKworICAgIGZvciAoaSA9
IDA7IGkgPCBWSVJUSU9fQ09VTlQ7IGkrKykgeworICAgICAgICBnX2F1dG9mcmVlIGNoYXIgKm5h
bWUgPSBOVUxMOworICAgICAgICB1aW50NjRfdCBzaXplID0gcy0+bWVtbWFwW1ZFR0FfVklSVElP
XS5zaXplOworICAgICAgICBod2FkZHIgYWRkciA9IHZpcnRpb19iYXNlICsgaSAqIHNpemU7CisK
KyAgICAgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy92aXJ0aW9fbW1pb0AlIkhXQURE
Ul9QUkl4LCBhZGRyKTsKKworICAgICAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCBu
YW1lKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgbmFtZSwgImNv
bXBhdGlibGUiLCAidmlydGlvLG1taW8iKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXpl
ZF9jZWxscyhtcy0+ZmR0LCBuYW1lLCAicmVnIiwgMiwgYWRkciwgMiwgc2l6ZSk7CisgICAgICAg
IHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAiaW50ZXJydXB0LXBhcmVudCIs
CisgICAgICAgICAgICBpcnFfdmlydGlvX3BoYW5kbGUpOworICAgICAgICBpZiAocy0+YWlhX3R5
cGUgPT0gVkVHQV9BSUFfVFlQRV9OT05FKSB7CisgICAgICAgICAgICBxZW11X2ZkdF9zZXRwcm9w
X2NlbGwobXMtPmZkdCwgbmFtZSwgImludGVycnVwdHMiLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFZJUlRJT19JUlEgKyBpKTsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAg
ICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbHMobXMtPmZkdCwgbmFtZSwgImludGVycnVwdHMiLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWSVJUSU9fSVJRICsgaSwgMHg0KTsK
KyAgICAgICAgfQorICAgIH0KK30KKworc3RhdGljIHZvaWQgY3JlYXRlX2ZkdF9wY2llKFJJU0NW
VmVnYVN0YXRlICpzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGlycV9w
Y2llX3BoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgbXNpX3Bj
aWVfcGhhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBpb21tdV9z
eXNfcGhhbmRsZSkKK3sKKyAgICBnX2F1dG9mcmVlIGNoYXIgKm5hbWUgPSBOVUxMOworICAgIE1h
Y2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHMpOworCisgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50
ZigiL3NvYy9wY2lAJSJIV0FERFJfUFJJeCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIHMt
Pm1lbW1hcFtWRUdBX1BDSUVfRUNBTV0uYmFzZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxs
KG1zLT5mZHQsIG5hbWUsICIjYWRkcmVzcy1jZWxscyIsCisgICAgICAgIEZEVF9QQ0lfQUREUl9D
RUxMUyk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICIjaW50ZXJy
dXB0LWNlbGxzIiwKKyAgICAgICAgRkRUX1BDSV9JTlRfQ0VMTFMpOworICAgIHFlbXVfZmR0X3Nl
dHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAiI3NpemUtY2VsbHMiLCAweDIpOworICAgIHFlbXVf
ZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIG5hbWUsICJjb21wYXRpYmxlIiwKKyAgICAgICAg
InBjaS1ob3N0LWVjYW0tZ2VuZXJpYyIpOworICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1z
LT5mZHQsIG5hbWUsICJkZXZpY2VfdHlwZSIsICJwY2kiKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9w
X2NlbGwobXMtPmZkdCwgbmFtZSwgImxpbnV4LHBjaS1kb21haW4iLCAwKTsKKyAgICBxZW11X2Zk
dF9zZXRwcm9wX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJidXMtcmFuZ2UiLCAwLAorICAgICAgICBz
LT5tZW1tYXBbVkVHQV9QQ0lFX0VDQU1dLnNpemUgLyBQQ0lFX01NQ0ZHX1NJWkVfTUlOIC0gMSk7
CisgICAgcWVtdV9mZHRfc2V0cHJvcChtcy0+ZmR0LCBuYW1lLCAiZG1hLWNvaGVyZW50IiwgTlVM
TCwgMCk7CisgICAgaWYgKHMtPmFpYV90eXBlID09IFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMp
IHsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICJtc2ktcGFy
ZW50IiwgbXNpX3BjaWVfcGhhbmRsZSk7CisgICAgfQorICAgIHFlbXVfZmR0X3NldHByb3Bfc2l6
ZWRfY2VsbHMobXMtPmZkdCwgbmFtZSwgInJlZyIsIDIsCisgICAgICAgIHMtPm1lbW1hcFtWRUdB
X1BDSUVfRUNBTV0uYmFzZSwgMiwgcy0+bWVtbWFwW1ZFR0FfUENJRV9FQ0FNXS5zaXplKTsKKyAg
ICBxZW11X2ZkdF9zZXRwcm9wX3NpemVkX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJyYW5nZXMiLAor
ICAgICAgICAxLCBGRFRfUENJX1JBTkdFX0lPUE9SVCwgMiwgMCwKKyAgICAgICAgMiwgcy0+bWVt
bWFwW1ZFR0FfUENJRV9QSU9dLmJhc2UsIDIsIHMtPm1lbW1hcFtWRUdBX1BDSUVfUElPXS5zaXpl
LAorICAgICAgICAxLCBGRFRfUENJX1JBTkdFX01NSU8sCisgICAgICAgIDIsIHMtPm1lbW1hcFtW
RUdBX1BDSUVfTU1JT10uYmFzZSwKKyAgICAgICAgMiwgcy0+bWVtbWFwW1ZFR0FfUENJRV9NTUlP
XS5iYXNlLCAyLCBzLT5tZW1tYXBbVkVHQV9QQ0lFX01NSU9dLnNpemUsCisgICAgICAgIDEsIEZE
VF9QQ0lfUkFOR0VfTU1JT182NEJJVCwKKyAgICAgICAgMiwgdmVnYV9oaWdoX3BjaWVfbWVtbWFw
LmJhc2UsCisgICAgICAgIDIsIHZlZ2FfaGlnaF9wY2llX21lbW1hcC5iYXNlLCAyLCB2ZWdhX2hp
Z2hfcGNpZV9tZW1tYXAuc2l6ZSk7CisKKyAgICBpZiAodmVnYV9pc19pb21tdV9zeXNfZW5hYmxl
ZChzKSkgeworICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJp
b21tdS1tYXAiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIGlvbW11X3N5c19w
aGFuZGxlLCAwLCAwLCAwLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvbW11X3N5
c19waGFuZGxlLCAwLCAweGZmZmYpOworICAgIH0KKworICAgIGNyZWF0ZV9wY2llX2lycV9tYXAo
cywgbXMtPmZkdCwgbmFtZSwgaXJxX3BjaWVfcGhhbmRsZSk7Cit9CisKK3N0YXRpYyB2b2lkIGNy
ZWF0ZV9mZHRfcmVzZXQoUklTQ1ZWZWdhU3RhdGUgKnMsIHVpbnQzMl90ICpwaGFuZGxlKQorewor
ICAgIGNoYXIgKm5hbWU7CisgICAgdWludDMyX3QgdGVzdF9waGFuZGxlOworICAgIE1hY2hpbmVT
dGF0ZSAqbXMgPSBNQUNISU5FKHMpOworCisgICAgdGVzdF9waGFuZGxlID0gKCpwaGFuZGxlKSsr
OworICAgIG5hbWUgPSBnX3N0cmR1cF9wcmludGYoIi9zb2MvdGVzdEAlIkhXQUREUl9QUkl4LAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfVEVTVF0uYmFzZSk7Cisg
ICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwgbmFtZSk7CisgICAgeworICAgICAgICBz
dGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IGNvbXBhdFszXSA9IHsKKyAgICAgICAgICAgICJzaWZp
dmUsdGVzdDEiLCAic2lmaXZlLHRlc3QwIiwgInN5c2NvbiIKKyAgICAgICAgfTsKKyAgICAgICAg
cWVtdV9mZHRfc2V0cHJvcF9zdHJpbmdfYXJyYXkobXMtPmZkdCwgbmFtZSwgImNvbXBhdGlibGUi
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2hhciAqKikmY29tcGF0
LCBBUlJBWV9TSVpFKGNvbXBhdCkpOworICAgIH0KKyAgICBxZW11X2ZkdF9zZXRwcm9wX3NpemVk
X2NlbGxzKG1zLT5mZHQsIG5hbWUsICJyZWciLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgMiwgcy0+bWVtbWFwW1ZFR0FfVEVTVF0uYmFzZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIDIsIHMtPm1lbW1hcFtWRUdBX1RFU1RdLnNpemUpOworICAgIHFlbXVfZmR0
X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAicGhhbmRsZSIsIHRlc3RfcGhhbmRsZSk7Cisg
ICAgdGVzdF9waGFuZGxlID0gcWVtdV9mZHRfZ2V0X3BoYW5kbGUobXMtPmZkdCwgbmFtZSk7Cisg
ICAgZ19mcmVlKG5hbWUpOworCisgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiL3JlYm9vdCIp
OworICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIG5hbWUpOworICAgIHFlbXVfZmR0
X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIG5hbWUsICJjb21wYXRpYmxlIiwgInN5c2Nvbi1yZWJv
b3QiKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgInJlZ21hcCIs
IHRlc3RfcGhhbmRsZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUs
ICJvZmZzZXQiLCAweDApOworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1l
LCAidmFsdWUiLCBGSU5JU0hFUl9SRVNFVCk7CisgICAgZ19mcmVlKG5hbWUpOworCisgICAgbmFt
ZSA9IGdfc3RyZHVwX3ByaW50ZigiL3Bvd2Vyb2ZmIik7CisgICAgcWVtdV9mZHRfYWRkX3N1Ym5v
ZGUobXMtPmZkdCwgbmFtZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwg
bmFtZSwgImNvbXBhdGlibGUiLCAic3lzY29uLXBvd2Vyb2ZmIik7CisgICAgcWVtdV9mZHRfc2V0
cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICJyZWdtYXAiLCB0ZXN0X3BoYW5kbGUpOworICAgIHFl
bXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAib2Zmc2V0IiwgMHgwKTsKKyAgICBx
ZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgInZhbHVlIiwgRklOSVNIRVJfUEFT
Uyk7CisgICAgZ19mcmVlKG5hbWUpOworfQorCitzdGF0aWMgdm9pZCBjcmVhdGVfZmR0X3VhcnQo
UklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
aXJxX21taW9fcGhhbmRsZSkKK3sKKyAgICBnX2F1dG9mcmVlIGNoYXIgKm5hbWUgPSBOVUxMOwor
ICAgIE1hY2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHMpOworCisgICAgbmFtZSA9IGdfc3RyZHVw
X3ByaW50ZigiL3NvYy9zZXJpYWxAJSJIV0FERFJfUFJJeCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHMtPm1lbW1hcFtWRUdBX1VBUlQwXS5iYXNlKTsKKyAgICBxZW11X2ZkdF9hZGRfc3Vi
bm9kZShtcy0+ZmR0LCBuYW1lKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX3N0cmluZyhtcy0+ZmR0
LCBuYW1lLCAiY29tcGF0aWJsZSIsICJuczE2NTUwYSIpOworICAgIHFlbXVfZmR0X3NldHByb3Bf
c2l6ZWRfY2VsbHMobXMtPmZkdCwgbmFtZSwgInJlZyIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAyLCBzLT5tZW1tYXBbVkVHQV9VQVJUMF0uYmFzZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIDIsIHMtPm1lbW1hcFtWRUdBX1VBUlQwXS5zaXplKTsKKyAgICBx
ZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgImNsb2NrLWZyZXF1ZW5jeSIsIDM2
ODY0MDApOworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAiaW50ZXJy
dXB0LXBhcmVudCIsIGlycV9tbWlvX3BoYW5kbGUpOworICAgIGlmIChzLT5haWFfdHlwZSA9PSBW
RUdBX0FJQV9UWVBFX05PTkUpIHsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5m
ZHQsIG5hbWUsICJpbnRlcnJ1cHRzIiwgVUFSVDBfSVJRKTsKKyAgICB9IGVsc2UgeworICAgICAg
ICBxZW11X2ZkdF9zZXRwcm9wX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJpbnRlcnJ1cHRzIiwgVUFS
VDBfSVJRLCAweDQpOworICAgIH0KKworICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5m
ZHQsICIvY2hvc2VuIiwgInN0ZG91dC1wYXRoIiwgbmFtZSk7CisgICAgcWVtdV9mZHRfc2V0cHJv
cF9zdHJpbmcobXMtPmZkdCwgIi9hbGlhc2VzIiwgInNlcmlhbDAiLCBuYW1lKTsKK30KKworc3Rh
dGljIHZvaWQgY3JlYXRlX2ZkdF9ydGMoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICB1aW50MzJfdCBpcnFfbW1pb19waGFuZGxlKQoreworICAgIGdfYXV0b2Zy
ZWUgY2hhciAqbmFtZSA9IE5VTEw7CisgICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7
CisKKyAgICBuYW1lID0gZ19zdHJkdXBfcHJpbnRmKCIvc29jL3J0Y0AlIkhXQUREUl9QUkl4LAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfUlRDXS5iYXNlKTsKKyAg
ICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCBuYW1lKTsKKyAgICBxZW11X2ZkdF9zZXRw
cm9wX3N0cmluZyhtcy0+ZmR0LCBuYW1lLCAiY29tcGF0aWJsZSIsCisgICAgICAgICJnb29nbGUs
Z29sZGZpc2gtcnRjIik7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxscyhtcy0+ZmR0
LCBuYW1lLCAicmVnIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIsIHMtPm1l
bW1hcFtWRUdBX1JUQ10uYmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIs
IHMtPm1lbW1hcFtWRUdBX1JUQ10uc2l6ZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1z
LT5mZHQsIG5hbWUsICJpbnRlcnJ1cHQtcGFyZW50IiwKKyAgICAgICAgaXJxX21taW9fcGhhbmRs
ZSk7CisgICAgaWYgKHMtPmFpYV90eXBlID09IFZFR0FfQUlBX1RZUEVfTk9ORSkgeworICAgICAg
ICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgImludGVycnVwdHMiLCBSVENf
SVJRKTsKKyAgICB9IGVsc2UgeworICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGxzKG1zLT5m
ZHQsIG5hbWUsICJpbnRlcnJ1cHRzIiwgUlRDX0lSUSwgMHg0KTsKKyAgICB9Cit9CisKK3N0YXRp
YyB2b2lkIGNyZWF0ZV9mZHRfZmxhc2goUklTQ1ZWZWdhU3RhdGUgKnMpCit7CisgICAgTWFjaGlu
ZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7CisgICAgaHdhZGRyIGZsYXNoc2l6ZSA9IHMtPm1lbW1h
cFtWRUdBX0ZMQVNIXS5zaXplIC8gMjsKKyAgICBod2FkZHIgZmxhc2hiYXNlID0gcy0+bWVtbWFw
W1ZFR0FfRkxBU0hdLmJhc2U7CisgICAgZ19hdXRvZnJlZSBjaGFyICpuYW1lID0gZ19zdHJkdXBf
cHJpbnRmKCIvZmxhc2hAJSIgUFJJeDY0LCBmbGFzaGJhc2UpOworCisgICAgcWVtdV9mZHRfYWRk
X3N1Ym5vZGUobXMtPmZkdCwgbmFtZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMt
PmZkdCwgbmFtZSwgImNvbXBhdGlibGUiLCAiY2ZpLWZsYXNoIik7CisgICAgcWVtdV9mZHRfc2V0
cHJvcF9zaXplZF9jZWxscyhtcy0+ZmR0LCBuYW1lLCAicmVnIiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIDIsIGZsYXNoYmFzZSwgMiwgZmxhc2hzaXplLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgMiwgZmxhc2hiYXNlICsgZmxhc2hzaXplLCAyLCBmbGFzaHNp
emUpOworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAiYmFuay13aWR0
aCIsIDQpOworfQorCitzdGF0aWMgdm9pZCBjcmVhdGVfZmR0X2Z3X2NmZyhSSVNDVlZlZ2FTdGF0
ZSAqcykKK3sKKyAgICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsKKyAgICBod2FkZHIg
YmFzZSA9IHMtPm1lbW1hcFtWRUdBX0ZXX0NGR10uYmFzZTsKKyAgICBod2FkZHIgc2l6ZSA9IHMt
Pm1lbW1hcFtWRUdBX0ZXX0NGR10uc2l6ZTsKKyAgICBnX2F1dG9mcmVlIGNoYXIgKm5vZGVuYW1l
ID0gZ19zdHJkdXBfcHJpbnRmKCIvZnctY2ZnQCUiIFBSSXg2NCwgYmFzZSk7CisKKyAgICBxZW11
X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCBub2RlbmFtZSk7CisgICAgcWVtdV9mZHRfc2V0cHJv
cF9zdHJpbmcobXMtPmZkdCwgbm9kZW5hbWUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ImNvbXBhdGlibGUiLCAicWVtdSxmdy1jZmctbW1pbyIpOworICAgIHFlbXVfZmR0X3NldHByb3Bf
c2l6ZWRfY2VsbHMobXMtPmZkdCwgbm9kZW5hbWUsICJyZWciLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgMiwgYmFzZSwgMiwgc2l6ZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcCht
cy0+ZmR0LCBub2RlbmFtZSwgImRtYS1jb2hlcmVudCIsIE5VTEwsIDApOworfQorCitzdGF0aWMg
dm9pZCBjcmVhdGVfZmR0X3ZpcnRpb19pb21tdShSSVNDVlZlZ2FTdGF0ZSAqcywgdWludDE2X3Qg
YmRmKQoreworICAgIGNvbnN0IGNoYXIgY29tcGF0W10gPSAidmlydGlvLHBjaS1pb21tdVwwcGNp
MWFmNCwxMDU3IjsKKyAgICB2b2lkICpmZHQgPSBNQUNISU5FKHMpLT5mZHQ7CisgICAgdWludDMy
X3QgaW9tbXVfcGhhbmRsZTsKKyAgICBnX2F1dG9mcmVlIGNoYXIgKmlvbW11X25vZGUgPSBOVUxM
OworICAgIGdfYXV0b2ZyZWUgY2hhciAqcGNpX25vZGUgPSBOVUxMOworCisgICAgcGNpX25vZGUg
PSBnX3N0cmR1cF9wcmludGYoIi9zb2MvcGNpQCUiSFdBRERSX1BSSXgsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfUENJRV9FQ0FNXS5iYXNlKTsKKyAgICBp
b21tdV9ub2RlID0gZ19zdHJkdXBfcHJpbnRmKCIlcy92aXJ0aW9faW9tbXVAJXgsJXgiLCBwY2lf
bm9kZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9TTE9UKGJkZiksIFBD
SV9GVU5DKGJkZikpOworICAgIGlvbW11X3BoYW5kbGUgPSBxZW11X2ZkdF9hbGxvY19waGFuZGxl
KGZkdCk7CisKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShmZHQsIGlvbW11X25vZGUpOworCisg
ICAgcWVtdV9mZHRfc2V0cHJvcChmZHQsIGlvbW11X25vZGUsICJjb21wYXRpYmxlIiwgY29tcGF0
LCBzaXplb2YoY29tcGF0KSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxscyhmZHQs
IGlvbW11X25vZGUsICJyZWciLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSwg
YmRmIDw8IDgsIDEsIDAsIDEsIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAx
LCAwLCAxLCAwKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwoZmR0LCBpb21tdV9ub2RlLCAi
I2lvbW11LWNlbGxzIiwgMSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKGZkdCwgaW9tbXVf
bm9kZSwgInBoYW5kbGUiLCBpb21tdV9waGFuZGxlKTsKKworICAgIHFlbXVfZmR0X3NldHByb3Bf
Y2VsbHMoZmR0LCBwY2lfbm9kZSwgImlvbW11LW1hcCIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAwLCBpb21tdV9waGFuZGxlLCAwLCBiZGYsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICBiZGYgKyAxLCBpb21tdV9waGFuZGxlLCBiZGYgKyAxLCAweGZmZmYgLSBiZGYpOworfQorCitz
dGF0aWMgdm9pZCBjcmVhdGVfZmR0X2lvbW11X3N5cyhSSVNDVlZlZ2FTdGF0ZSAqcywgdWludDMy
X3QgaXJxX2NoaXAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBt
c2lfcGhhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90ICpp
b21tdV9zeXNfcGhhbmRsZSkKK3sKKyAgICBjb25zdCBjaGFyIGNvbXBbXSA9ICJyaXNjdixpb21t
dSI7CisgICAgdm9pZCAqZmR0ID0gTUFDSElORShzKS0+ZmR0OworICAgIHVpbnQzMl90IGlvbW11
X3BoYW5kbGU7CisgICAgZ19hdXRvZnJlZSBjaGFyICppb21tdV9ub2RlID0gTlVMTDsKKyAgICBo
d2FkZHIgYWRkciA9IHMtPm1lbW1hcFtWRUdBX0lPTU1VX1NZU10uYmFzZTsKKyAgICBod2FkZHIg
c2l6ZSA9IHMtPm1lbW1hcFtWRUdBX0lPTU1VX1NZU10uc2l6ZTsKKyAgICB1aW50MzJfdCBpb21t
dV9pcnFfbWFwW1JJU0NWX0lPTU1VX0lOVFJfQ09VTlRdID0geworICAgICAgICBJT01NVV9TWVNf
SVJRICsgUklTQ1ZfSU9NTVVfSU5UUl9DUSwKKyAgICAgICAgSU9NTVVfU1lTX0lSUSArIFJJU0NW
X0lPTU1VX0lOVFJfRlEsCisgICAgICAgIElPTU1VX1NZU19JUlEgKyBSSVNDVl9JT01NVV9JTlRS
X1BNLAorICAgICAgICBJT01NVV9TWVNfSVJRICsgUklTQ1ZfSU9NTVVfSU5UUl9QUSwKKyAgICB9
OworCisgICAgaW9tbXVfbm9kZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy9pb21tdUAleCIsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHVuc2lnbmVkIGludCkgcy0+bWVtbWFwW1ZF
R0FfSU9NTVVfU1lTXS5iYXNlKTsKKyAgICBpb21tdV9waGFuZGxlID0gcWVtdV9mZHRfYWxsb2Nf
cGhhbmRsZShmZHQpOworICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKGZkdCwgaW9tbXVfbm9kZSk7
CisKKyAgICBxZW11X2ZkdF9zZXRwcm9wKGZkdCwgaW9tbXVfbm9kZSwgImNvbXBhdGlibGUiLCBj
b21wLCBzaXplb2YoY29tcCkpOworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChmZHQsIGlvbW11
X25vZGUsICIjaW9tbXUtY2VsbHMiLCAxKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwoZmR0
LCBpb21tdV9ub2RlLCAicGhhbmRsZSIsIGlvbW11X3BoYW5kbGUpOworCisgICAgcWVtdV9mZHRf
c2V0cHJvcF9zaXplZF9jZWxscyhmZHQsIGlvbW11X25vZGUsICJyZWciLCAyLCBhZGRyLCAyLCBz
aXplKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwoZmR0LCBpb21tdV9ub2RlLCAiaW50ZXJy
dXB0LXBhcmVudCIsIGlycV9jaGlwKTsKKworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbHMoZmR0
LCBpb21tdV9ub2RlLCAiaW50ZXJydXB0cyIsCisgICAgICAgIGlvbW11X2lycV9tYXBbMF0sIEZE
VF9JUlFfVFlQRV9FREdFX0xPVywKKyAgICAgICAgaW9tbXVfaXJxX21hcFsxXSwgRkRUX0lSUV9U
WVBFX0VER0VfTE9XLAorICAgICAgICBpb21tdV9pcnFfbWFwWzJdLCBGRFRfSVJRX1RZUEVfRURH
RV9MT1csCisgICAgICAgIGlvbW11X2lycV9tYXBbM10sIEZEVF9JUlFfVFlQRV9FREdFX0xPVyk7
CisKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwoZmR0LCBpb21tdV9ub2RlLCAibXNpLXBhcmVu
dCIsIG1zaV9waGFuZGxlKTsKKworICAgICppb21tdV9zeXNfcGhhbmRsZSA9IGlvbW11X3BoYW5k
bGU7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRfaW9tbXUoUklTQ1ZWZWdhU3RhdGUgKnMs
IHVpbnQxNl90IGJkZikKK3sKKyAgICBjb25zdCBjaGFyIGNvbXBbXSA9ICJyaXNjdixwY2ktaW9t
bXUiOworICAgIHZvaWQgKmZkdCA9IE1BQ0hJTkUocyktPmZkdDsKKyAgICB1aW50MzJfdCBpb21t
dV9waGFuZGxlOworICAgIGdfYXV0b2ZyZWUgY2hhciAqaW9tbXVfbm9kZSA9IE5VTEw7CisgICAg
Z19hdXRvZnJlZSBjaGFyICpwY2lfbm9kZSA9IE5VTEw7CisKKyAgICBwY2lfbm9kZSA9IGdfc3Ry
ZHVwX3ByaW50ZigiL3NvYy9wY2lAJSJIV0FERFJfUFJJeCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBzLT5tZW1tYXBbVkVHQV9QQ0lFX0VDQU1dLmJhc2UpOworICAgIGlvbW11X25v
ZGUgPSBnX3N0cmR1cF9wcmludGYoIiVzL2lvbW11QCV4IiwgcGNpX25vZGUsIGJkZik7CisgICAg
aW9tbXVfcGhhbmRsZSA9IHFlbXVfZmR0X2FsbG9jX3BoYW5kbGUoZmR0KTsKKyAgICBxZW11X2Zk
dF9hZGRfc3Vibm9kZShmZHQsIGlvbW11X25vZGUpOworCisgICAgcWVtdV9mZHRfc2V0cHJvcChm
ZHQsIGlvbW11X25vZGUsICJjb21wYXRpYmxlIiwgY29tcCwgc2l6ZW9mKGNvbXApKTsKKyAgICBx
ZW11X2ZkdF9zZXRwcm9wX2NlbGwoZmR0LCBpb21tdV9ub2RlLCAiI2lvbW11LWNlbGxzIiwgMSk7
CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKGZkdCwgaW9tbXVfbm9kZSwgInBoYW5kbGUiLCBp
b21tdV9waGFuZGxlKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGxzKGZkdCwgaW9tbXVfbm9k
ZSwgInJlZyIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBiZGYgPDwgOCwgMCwgMCwgMCwg
MCk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxscyhmZHQsIHBjaV9ub2RlLCAiaW9tbXUtbWFw
IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIGlvbW11X3BoYW5kbGUsIDAsIGJkZiwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgIGJkZiArIDEsIGlvbW11X3BoYW5kbGUsIGJkZiAr
IDEsIDB4ZmZmZiAtIGJkZik7CisgICAgcy0+cGNpX2lvbW11X2JkZiA9IGJkZjsKK30KKworc3Rh
dGljIHZvaWQgZmluYWxpemVfZmR0KFJJU0NWVmVnYVN0YXRlICpzKQoreworICAgIHVpbnQzMl90
IHBoYW5kbGUgPSAxLCBpcnFfbW1pb19waGFuZGxlID0gMSwgbXNpX3BjaWVfcGhhbmRsZSA9IDE7
CisgICAgdWludDMyX3QgaXJxX3BjaWVfcGhhbmRsZSA9IDEsIGlycV92aXJ0aW9fcGhhbmRsZSA9
IDE7CisgICAgdWludDMyX3QgaW9tbXVfc3lzX3BoYW5kbGUgPSAxOworCisgICAgY3JlYXRlX2Zk
dF9zb2NrZXRzKHMsICZwaGFuZGxlLCAmaXJxX21taW9fcGhhbmRsZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgJmlycV9wY2llX3BoYW5kbGUsICZpcnFfdmlydGlvX3BoYW5kbGUsCisgICAgICAg
ICAgICAgICAgICAgICAgICZtc2lfcGNpZV9waGFuZGxlKTsKKworICAgIGNyZWF0ZV9mZHRfdmly
dGlvKHMsIGlycV92aXJ0aW9fcGhhbmRsZSk7CisKKyAgICBpZiAodmVnYV9pc19pb21tdV9zeXNf
ZW5hYmxlZChzKSkgeworICAgICAgICBjcmVhdGVfZmR0X2lvbW11X3N5cyhzLCBpcnFfbW1pb19w
aGFuZGxlLCBtc2lfcGNpZV9waGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAm
aW9tbXVfc3lzX3BoYW5kbGUpOworICAgIH0KKyAgICBjcmVhdGVfZmR0X3BjaWUocywgaXJxX3Bj
aWVfcGhhbmRsZSwgbXNpX3BjaWVfcGhhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgaW9tbXVf
c3lzX3BoYW5kbGUpOworCisgICAgY3JlYXRlX2ZkdF9yZXNldChzLCAmcGhhbmRsZSk7CisKKyAg
ICBjcmVhdGVfZmR0X3VhcnQocywgaXJxX21taW9fcGhhbmRsZSk7CisKKyAgICBjcmVhdGVfZmR0
X3J0YyhzLCBpcnFfbW1pb19waGFuZGxlKTsKK30KKworc3RhdGljIHZvaWQgY3JlYXRlX2ZkdChS
SVNDVlZlZ2FTdGF0ZSAqcykKK3sKKyAgICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsK
KyAgICB1aW50OF90IHJuZ19zZWVkWzMyXTsKKyAgICBnX2F1dG9mcmVlIGNoYXIgKm5hbWUgPSBO
VUxMOworCisgICAgbXMtPmZkdCA9IGNyZWF0ZV9kZXZpY2VfdHJlZSgmcy0+ZmR0X3NpemUpOwor
ICAgIGlmICghbXMtPmZkdCkgeworICAgICAgICBlcnJvcl9yZXBvcnQoImNyZWF0ZV9kZXZpY2Vf
dHJlZSgpIGZhaWxlZCIpOworICAgICAgICBleGl0KDEpOworICAgIH0KKworICAgIHFlbXVfZmR0
X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsICIvIiwgIm1vZGVsIiwgInJpc2N2LXZpcnRpbyxxZW11
Iik7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgIi8iLCAiY29tcGF0aWJs
ZSIsICJyaXNjdi12aXJ0aW8iKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwg
Ii8iLCAiI3NpemUtY2VsbHMiLCAweDIpOworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+
ZmR0LCAiLyIsICIjYWRkcmVzcy1jZWxscyIsIDB4Mik7CisKKyAgICBxZW11X2ZkdF9hZGRfc3Vi
bm9kZShtcy0+ZmR0LCAiL3NvYyIpOworICAgIHFlbXVfZmR0X3NldHByb3AobXMtPmZkdCwgIi9z
b2MiLCAicmFuZ2VzIiwgTlVMTCwgMCk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMt
PmZkdCwgIi9zb2MiLCAiY29tcGF0aWJsZSIsICJzaW1wbGUtYnVzIik7CisgICAgcWVtdV9mZHRf
c2V0cHJvcF9jZWxsKG1zLT5mZHQsICIvc29jIiwgIiNzaXplLWNlbGxzIiwgMHgyKTsKKyAgICBx
ZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgIi9zb2MiLCAiI2FkZHJlc3MtY2VsbHMiLCAw
eDIpOworCisgICAgLyoKKyAgICAgKiBUaGUgIi9zb2MvcGNpQC4uLiIgbm9kZSBpcyBuZWVkZWQg
Zm9yIFBDSUUgaG90cGx1Z3MKKyAgICAgKiB0aGF0IG1pZ2h0IGhhcHBlbiBiZWZvcmUgZmluYWxp
emVfZmR0KCkuCisgICAgICovCisgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy9wY2lA
JSJIV0FERFJfUFJJeCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1lbW1hcFtWRUdB
X1BDSUVfRUNBTV0uYmFzZSk7CisgICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwgbmFt
ZSk7CisKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCAiL2Nob3NlbiIpOworCisg
ICAgLyogUGFzcyBzZWVkIHRvIFJORyAqLworICAgIHFlbXVfZ3Vlc3RfZ2V0cmFuZG9tX25vZmFp
bChybmdfc2VlZCwgc2l6ZW9mKHJuZ19zZWVkKSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcChtcy0+
ZmR0LCAiL2Nob3NlbiIsICJybmctc2VlZCIsCisgICAgICAgICAgICAgICAgICAgICBybmdfc2Vl
ZCwgc2l6ZW9mKHJuZ19zZWVkKSk7CisKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0
LCAiL2FsaWFzZXMiKTsKKworICAgIGNyZWF0ZV9mZHRfZmxhc2gocyk7CisgICAgY3JlYXRlX2Zk
dF9md19jZmcocyk7CisgICAgY3JlYXRlX2ZkdF9wbXUocyk7Cit9CisKK3N0YXRpYyBpbmxpbmUg
RGV2aWNlU3RhdGUgKmdwZXhfcGNpZV9pbml0KE1lbW9yeVJlZ2lvbiAqc3lzX21lbSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERldmljZVN0YXRlICppcnFjaGlw
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUklTQ1ZWZWdhU3Rh
dGUgKnMpCit7CisgICAgRGV2aWNlU3RhdGUgKmRldjsKKyAgICBNZW1vcnlSZWdpb24gKmVjYW1f
YWxpYXMsICplY2FtX3JlZzsKKyAgICBNZW1vcnlSZWdpb24gKm1taW9fYWxpYXMsICpoaWdoX21t
aW9fYWxpYXMsICptbWlvX3JlZzsKKyAgICBod2FkZHIgZWNhbV9iYXNlID0gcy0+bWVtbWFwW1ZF
R0FfUENJRV9FQ0FNXS5iYXNlOworICAgIGh3YWRkciBlY2FtX3NpemUgPSBzLT5tZW1tYXBbVkVH
QV9QQ0lFX0VDQU1dLnNpemU7CisgICAgaHdhZGRyIG1taW9fYmFzZSA9IHMtPm1lbW1hcFtWRUdB
X1BDSUVfTU1JT10uYmFzZTsKKyAgICBod2FkZHIgbW1pb19zaXplID0gcy0+bWVtbWFwW1ZFR0Ff
UENJRV9NTUlPXS5zaXplOworICAgIGh3YWRkciBoaWdoX21taW9fYmFzZSA9IHZlZ2FfaGlnaF9w
Y2llX21lbW1hcC5iYXNlOworICAgIGh3YWRkciBoaWdoX21taW9fc2l6ZSA9IHZlZ2FfaGlnaF9w
Y2llX21lbW1hcC5zaXplOworICAgIGh3YWRkciBwaW9fYmFzZSA9IHMtPm1lbW1hcFtWRUdBX1BD
SUVfUElPXS5iYXNlOworICAgIGh3YWRkciBwaW9fc2l6ZSA9IHMtPm1lbW1hcFtWRUdBX1BDSUVf
UElPXS5zaXplOworICAgIHFlbXVfaXJxIGlycTsKKyAgICBpbnQgaTsKKworICAgIGRldiA9IHFk
ZXZfbmV3KFRZUEVfR1BFWF9IT1NUKTsKKworICAgIC8qIFNldCBHUEVYIG9iamVjdCBwcm9wZXJ0
aWVzIGZvciB0aGUgVkVHQSBtYWNoaW5lICovCisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50
KE9CSkVDVChkZXYpLCBQQ0lfSE9TVF9FQ0FNX0JBU0UsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZWNhbV9iYXNlLCBOVUxMKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChPQkpF
Q1QoZGV2KSwgUENJX0hPU1RfRUNBTV9TSVpFLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGVjYW1fc2l6ZSwgTlVMTCk7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KE9CSkVDVChk
ZXYpLCBQQ0lfSE9TVF9CRUxPV180R19NTUlPX0JBU0UsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIG1taW9fYmFzZSwgTlVMTCk7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JK
RUNUKGRldiksIFBDSV9IT1NUX0JFTE9XXzRHX01NSU9fU0laRSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBtbWlvX3NpemUsIE5VTEwpOworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfdWlu
dChPQkpFQ1QoZGV2KSwgUENJX0hPU1RfQUJPVkVfNEdfTU1JT19CQVNFLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBoaWdoX21taW9fYmFzZSwgTlVMTCk7CisgICAgb2JqZWN0X3Byb3Bl
cnR5X3NldF9pbnQoT0JKRUNUKGRldiksIFBDSV9IT1NUX0FCT1ZFXzRHX01NSU9fU0laRSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBoaWdoX21taW9fc2l6ZSwgTlVMTCk7CisgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF91aW50KE9CSkVDVChkZXYpLCBQQ0lfSE9TVF9QSU9fQkFTRSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBwaW9fYmFzZSwgTlVMTCk7CisgICAgb2JqZWN0X3By
b3BlcnR5X3NldF9pbnQoT0JKRUNUKGRldiksIFBDSV9IT1NUX1BJT19TSVpFLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHBpb19zaXplLCBOVUxMKTsKKworICAgIHN5c2J1c19yZWFsaXpl
X2FuZF91bnJlZihTWVNfQlVTX0RFVklDRShkZXYpLCAmZXJyb3JfZmF0YWwpOworCisgICAgZWNh
bV9hbGlhcyA9IGdfbmV3MChNZW1vcnlSZWdpb24sIDEpOworICAgIGVjYW1fcmVnID0gc3lzYnVz
X21taW9fZ2V0X3JlZ2lvbihTWVNfQlVTX0RFVklDRShkZXYpLCAwKTsKKyAgICBtZW1vcnlfcmVn
aW9uX2luaXRfYWxpYXMoZWNhbV9hbGlhcywgT0JKRUNUKGRldiksICJwY2llLWVjYW0iLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBlY2FtX3JlZywgMCwgZWNhbV9zaXplKTsKKyAgICBt
ZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdpb24oZ2V0X3N5c3RlbV9tZW1vcnkoKSwgZWNhbV9iYXNl
LCBlY2FtX2FsaWFzKTsKKworICAgIG1taW9fYWxpYXMgPSBnX25ldzAoTWVtb3J5UmVnaW9uLCAx
KTsKKyAgICBtbWlvX3JlZyA9IHN5c2J1c19tbWlvX2dldF9yZWdpb24oU1lTX0JVU19ERVZJQ0Uo
ZGV2KSwgMSk7CisgICAgbWVtb3J5X3JlZ2lvbl9pbml0X2FsaWFzKG1taW9fYWxpYXMsIE9CSkVD
VChkZXYpLCAicGNpZS1tbWlvIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW1pb19y
ZWcsIG1taW9fYmFzZSwgbW1pb19zaXplKTsKKyAgICBtZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdp
b24oZ2V0X3N5c3RlbV9tZW1vcnkoKSwgbW1pb19iYXNlLCBtbWlvX2FsaWFzKTsKKworICAgIC8q
IE1hcCBoaWdoIE1NSU8gc3BhY2UgKi8KKyAgICBoaWdoX21taW9fYWxpYXMgPSBnX25ldzAoTWVt
b3J5UmVnaW9uLCAxKTsKKyAgICBtZW1vcnlfcmVnaW9uX2luaXRfYWxpYXMoaGlnaF9tbWlvX2Fs
aWFzLCBPQkpFQ1QoZGV2KSwgInBjaWUtbW1pby1oaWdoIiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbW1pb19yZWcsIGhpZ2hfbW1pb19iYXNlLCBoaWdoX21taW9fc2l6ZSk7CisgICAg
bWVtb3J5X3JlZ2lvbl9hZGRfc3VicmVnaW9uKGdldF9zeXN0ZW1fbWVtb3J5KCksIGhpZ2hfbW1p
b19iYXNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWdoX21taW9fYWxpYXMp
OworCisgICAgc3lzYnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKGRldiksIDIsIHBpb19iYXNl
KTsKKworICAgIGZvciAoaSA9IDA7IGkgPCBQQ0lfTlVNX1BJTlM7IGkrKykgeworICAgICAgICBp
cnEgPSBxZGV2X2dldF9ncGlvX2luKGlycWNoaXAsIFBDSUVfSVJRICsgaSk7CisKKyAgICAgICAg
c3lzYnVzX2Nvbm5lY3RfaXJxKFNZU19CVVNfREVWSUNFKGRldiksIGksIGlycSk7CisgICAgICAg
IGdwZXhfc2V0X2lycV9udW0oR1BFWF9IT1NUKGRldiksIGksIFBDSUVfSVJRICsgaSk7CisgICAg
fQorCisgICAgR1BFWF9IT1NUKGRldiktPmdwZXhfY2ZnLmJ1cyA9IFBDSV9IT1NUX0JSSURHRShk
ZXYpLT5idXM7CisgICAgcmV0dXJuIGRldjsKK30KKworc3RhdGljIEZXQ2ZnU3RhdGUgKmNyZWF0
ZV9md19jZmcoY29uc3QgTWFjaGluZVN0YXRlICptcywgaHdhZGRyIGJhc2UpCit7CisgICAgRldD
ZmdTdGF0ZSAqZndfY2ZnOworCisgICAgZndfY2ZnID0gZndfY2ZnX2luaXRfbWVtX3dpZGUoYmFz
ZSArIDgsIGJhc2UsIDgsIGJhc2UgKyAxNiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAmYWRkcmVzc19zcGFjZV9tZW1vcnkpOworICAgIGZ3X2NmZ19hZGRfaTE2KGZ3X2NmZywg
RldfQ0ZHX05CX0NQVVMsICh1aW50MTZfdCltcy0+c21wLmNwdXMpOworCisgICAgcmV0dXJuIGZ3
X2NmZzsKK30KKworc3RhdGljIERldmljZVN0YXRlICp2ZWdhX2NyZWF0ZV9wbGljKGNvbnN0IE1l
bU1hcEVudHJ5ICptZW1tYXAsIGludCBzb2NrZXQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgaW50IGJhc2VfaGFydGlkLCBpbnQgaGFydF9jb3VudCkKK3sKKyAgICBnX2F1
dG9mcmVlIGNoYXIgKnBsaWNfaGFydF9jb25maWcgPSBOVUxMOworCisgICAgLyogUGVyLXNvY2tl
dCBQTElDIGhhcnQgdG9wb2xvZ3kgY29uZmlndXJhdGlvbiBzdHJpbmcgKi8KKyAgICBwbGljX2hh
cnRfY29uZmlnID0gcmlzY3ZfcGxpY19oYXJ0X2NvbmZpZ19zdHJpbmcoaGFydF9jb3VudCk7CisK
KyAgICAvKiBQZXItc29ja2V0IFBMSUMgKi8KKyAgICByZXR1cm4gdmVnYV9wbGljX2NyZWF0ZSgK
KyAgICAgICAgICAgICBtZW1tYXBbVkVHQV9QTElDX0lEXS5iYXNlICsgc29ja2V0ICogbWVtbWFw
W1ZFR0FfUExJQ19JRF0uc2l6ZSwgICAgIC8vQ2hhbmdlZCBmb3IgQ0RBQworICAgICAgICAgICAg
IHBsaWNfaGFydF9jb25maWcsIGhhcnRfY291bnQsIGJhc2VfaGFydGlkLAorICAgICAgICAgICAg
IFZFR0FfSVJRQ0hJUF9OVU1fU09VUkNFUywKKyAgICAgICAgICAgICAoKDFVIDw8IFZFR0FfSVJR
Q0hJUF9OVU1fUFJJT19CSVRTKSAtIDEpLAorICAgICAgICAgICAgIFZFR0FfUExJQ19QUklPUklU
WV9CQVNFLCBWRUdBX1BMSUNfUEVORElOR19CQVNFLAorICAgICAgICAgICAgIFZFR0FfUExJQ19F
TkFCTEVfQkFTRSwgVkVHQV9QTElDX0VOQUJMRV9TVFJJREUsCisgICAgICAgICAgICAgVkVHQV9Q
TElDX0NPTlRFWFRfQkFTRSwKKyAgICAgICAgICAgICBWRUdBX1BMSUNfQ09OVEVYVF9TVFJJREUs
CisgICAgICAgICAgICAgbWVtbWFwW1ZFR0FfUExJQ19JRF0uc2l6ZSk7Cit9CisKK3N0YXRpYyBE
ZXZpY2VTdGF0ZSAqdmVnYV9jcmVhdGVfYWlhKFJJU0NWVmVnYUFJQVR5cGUgYWlhX3R5cGUsIGlu
dCBhaWFfZ3Vlc3RzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qg
TWVtTWFwRW50cnkgKm1lbW1hcCwgaW50IHNvY2tldCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGludCBiYXNlX2hhcnRpZCwgaW50IGhhcnRfY291bnQpCit7CisgICAgaW50
IGk7CisgICAgaHdhZGRyIGFkZHIgPSAwOworICAgIHVpbnQzMl90IGd1ZXN0X2JpdHM7CisgICAg
RGV2aWNlU3RhdGUgKmFwbGljX3MgPSBOVUxMOworICAgIERldmljZVN0YXRlICphcGxpY19tID0g
TlVMTDsKKyAgICBib29sIG1zaW1vZGUgPSBhaWFfdHlwZSA9PSBWRUdBX0FJQV9UWVBFX0FQTElD
X0lNU0lDOworCisgICAgaWYgKG1zaW1vZGUpIHsKKyAgICAgICAgaWYgKCFrdm1fZW5hYmxlZCgp
KSB7CisgICAgICAgICAgICAvKiBQZXItc29ja2V0IE0tbGV2ZWwgSU1TSUNzICovCisgICAgICAg
ICAgICBhZGRyID0gbWVtbWFwW1ZFR0FfSU1TSUNfTV0uYmFzZSArCisgICAgICAgICAgICAgICAg
ICAgc29ja2V0ICogVkVHQV9JTVNJQ19HUk9VUF9NQVhfU0laRTsKKyAgICAgICAgICAgIGZvciAo
aSA9IDA7IGkgPCBoYXJ0X2NvdW50OyBpKyspIHsKKyAgICAgICAgICAgICAgICByaXNjdl9pbXNp
Y19jcmVhdGUoYWRkciArIGkgKiBJTVNJQ19IQVJUX1NJWkUoMCksCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGJhc2VfaGFydGlkICsgaSwgdHJ1ZSwgMSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9JUlFDSElQX05VTV9NU0lTKTsKKyAgICAgICAg
ICAgIH0KKyAgICAgICAgfQorCisgICAgICAgIC8qIFBlci1zb2NrZXQgUy1sZXZlbCBJTVNJQ3Mg
Ki8KKyAgICAgICAgZ3Vlc3RfYml0cyA9IGltc2ljX251bV9iaXRzX3ZlZ2EoYWlhX2d1ZXN0cyAr
IDEpOworICAgICAgICBhZGRyID0gbWVtbWFwW1ZFR0FfSU1TSUNfU10uYmFzZSArIHNvY2tldCAq
IFZFR0FfSU1TSUNfR1JPVVBfTUFYX1NJWkU7CisgICAgICAgIGZvciAoaSA9IDA7IGkgPCBoYXJ0
X2NvdW50OyBpKyspIHsKKyAgICAgICAgICAgIHJpc2N2X2ltc2ljX2NyZWF0ZShhZGRyICsgaSAq
IElNU0lDX0hBUlRfU0laRShndWVzdF9iaXRzKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBiYXNlX2hhcnRpZCArIGksIGZhbHNlLCAxICsgYWlhX2d1ZXN0cywKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBWRUdBX0lSUUNISVBfTlVNX01TSVMpOworICAgICAgICB9Cisg
ICAgfQorCisgICAgaWYgKCFrdm1fZW5hYmxlZCgpKSB7CisgICAgICAgIC8qIFBlci1zb2NrZXQg
TS1sZXZlbCBBUExJQyAqLworICAgICAgICBhcGxpY19tID0gcmlzY3ZfYXBsaWNfY3JlYXRlKG1l
bW1hcFtWRUdBX0FQTElDX01dLmJhc2UgKworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHNvY2tldCAqIG1lbW1hcFtWRUdBX0FQTElDX01dLnNpemUsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgbWVtbWFwW1ZFR0FfQVBMSUNfTV0uc2l6ZSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobXNpbW9kZSkgPyAwIDogYmFzZV9oYXJ0
aWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1zaW1vZGUpID8gMCA6
IGhhcnRfY291bnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9J
UlFDSElQX05VTV9TT1VSQ0VTLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFZFR0FfSVJRQ0hJUF9OVU1fUFJJT19CSVRTLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIG1zaW1vZGUsIHRydWUsIE5VTEwpOworICAgIH0KKworICAgIC8qIFBlci1zb2Nr
ZXQgUy1sZXZlbCBBUExJQyAqLworICAgIGFwbGljX3MgPSByaXNjdl9hcGxpY19jcmVhdGUobWVt
bWFwW1ZFR0FfQVBMSUNfU10uYmFzZSArCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzb2NrZXQgKiBtZW1tYXBbVkVHQV9BUExJQ19TXS5zaXplLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbWVtbWFwW1ZFR0FfQVBMSUNfU10uc2l6ZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIChtc2ltb2RlKSA/IDAgOiBiYXNlX2hhcnRpZCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIChtc2ltb2RlKSA/IDAgOiBoYXJ0X2NvdW50LAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9JUlFDSElQX05VTV9TT1VSQ0VTLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9JUlFDSElQX05VTV9QUklPX0JJ
VFMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2ltb2RlLCBmYWxzZSwgYXBs
aWNfbSk7CisKKyAgICBpZiAoa3ZtX2VuYWJsZWQoKSAmJiBtc2ltb2RlKSB7CisgICAgICAgIHJp
c2N2X2FwbGljX3NldF9rdm1fbXNpY2ZnYWRkcihSSVNDVl9BUExJQyhhcGxpY19zKSwgYWRkcik7
CisgICAgfQorCisgICAgcmV0dXJuIGt2bV9lbmFibGVkKCkgPyBhcGxpY19zIDogYXBsaWNfbTsK
K30KKworc3RhdGljIHZvaWQgY3JlYXRlX3BsYXRmb3JtX2J1cyhSSVNDVlZlZ2FTdGF0ZSAqcywg
RGV2aWNlU3RhdGUgKmlycWNoaXApCit7CisgICAgRGV2aWNlU3RhdGUgKmRldjsKKyAgICBTeXNC
dXNEZXZpY2UgKnN5c2J1czsKKyAgICBpbnQgaTsKKyAgICBNZW1vcnlSZWdpb24gKnN5c21lbSA9
IGdldF9zeXN0ZW1fbWVtb3J5KCk7CisKKyAgICBkZXYgPSBxZGV2X25ldyhUWVBFX1BMQVRGT1JN
X0JVU19ERVZJQ0UpOworICAgIGRldi0+aWQgPSBnX3N0cmR1cChUWVBFX1BMQVRGT1JNX0JVU19E
RVZJQ0UpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDMyKGRldiwgIm51bV9pcnFzIiwgVkVHQV9Q
TEFURk9STV9CVVNfTlVNX0lSUVMpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDMyKGRldiwgIm1t
aW9fc2l6ZSIsIHMtPm1lbW1hcFtWRUdBX1BMQVRGT1JNX0JVU10uc2l6ZSk7CisgICAgc3lzYnVz
X3JlYWxpemVfYW5kX3VucmVmKFNZU19CVVNfREVWSUNFKGRldiksICZlcnJvcl9mYXRhbCk7Cisg
ICAgcy0+cGxhdGZvcm1fYnVzX2RldiA9IGRldjsKKworICAgIHN5c2J1cyA9IFNZU19CVVNfREVW
SUNFKGRldik7CisgICAgZm9yIChpID0gMDsgaSA8IFZFR0FfUExBVEZPUk1fQlVTX05VTV9JUlFT
OyBpKyspIHsKKyAgICAgICAgaW50IGlycSA9IFZJUlRfUExBVEZPUk1fQlVTX0lSUSArIGk7Cisg
ICAgICAgIHN5c2J1c19jb25uZWN0X2lycShzeXNidXMsIGksIHFkZXZfZ2V0X2dwaW9faW4oaXJx
Y2hpcCwgaXJxKSk7CisgICAgfQorCisgICAgbWVtb3J5X3JlZ2lvbl9hZGRfc3VicmVnaW9uKHN5
c21lbSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfUExB
VEZPUk1fQlVTXS5iYXNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeXNidXNf
bW1pb19nZXRfcmVnaW9uKHN5c2J1cywgMCkpOworfQorCitzdGF0aWMgdm9pZCB2ZWdhX2J1aWxk
X3NtYmlvcyhSSVNDVlZlZ2FTdGF0ZSAqcykKK3sKKyAgICBNYWNoaW5lQ2xhc3MgKm1jID0gTUFD
SElORV9HRVRfQ0xBU1Mocyk7CisgICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7Cisg
ICAgdWludDhfdCAqc21iaW9zX3RhYmxlcywgKnNtYmlvc19hbmNob3I7CisgICAgc2l6ZV90IHNt
Ymlvc190YWJsZXNfbGVuLCBzbWJpb3NfYW5jaG9yX2xlbjsKKyAgICBzdHJ1Y3Qgc21iaW9zX3Bo
eXNfbWVtX2FyZWEgbWVtX2FycmF5OworICAgIGNvbnN0IGNoYXIgKnByb2R1Y3QgPSAiUUVNVSBW
aXJ0dWFsIE1hY2hpbmUiOworCisgICAgaWYgKGt2bV9lbmFibGVkKCkpIHsKKyAgICAgICAgcHJv
ZHVjdCA9ICJLVk0gVmlydHVhbCBNYWNoaW5lIjsKKyAgICB9CisKKyAgICBzbWJpb3Nfc2V0X2Rl
ZmF1bHRzKCJRRU1VIiwgcHJvZHVjdCwgbWMtPm5hbWUpOworCisgICAgaWYgKHJpc2N2X2lzXzMy
Yml0KCZzLT5zb2NbMF0pKSB7CisgICAgICAgIHNtYmlvc19zZXRfZGVmYXVsdF9wcm9jZXNzb3Jf
ZmFtaWx5KDB4MjAwKTsKKyAgICB9IGVsc2UgeworICAgICAgICBzbWJpb3Nfc2V0X2RlZmF1bHRf
cHJvY2Vzc29yX2ZhbWlseSgweDIwMSk7CisgICAgfQorCisgICAgLyogYnVpbGQgdGhlIGFycmF5
IG9mIHBoeXNpY2FsIG1lbSBhcmVhIGZyb20gYmFzZV9tZW1tYXAgKi8KKyAgICBtZW1fYXJyYXku
YWRkcmVzcyA9IHMtPm1lbW1hcFtWRUdBX0RSQU1dLmJhc2U7CisgICAgbWVtX2FycmF5Lmxlbmd0
aCA9IG1zLT5yYW1fc2l6ZTsKKworICAgIHNtYmlvc19nZXRfdGFibGVzKG1zLCBTTUJJT1NfRU5U
UllfUE9JTlRfVFlQRV82NCwKKyAgICAgICAgICAgICAgICAgICAgICAmbWVtX2FycmF5LCAxLAor
ICAgICAgICAgICAgICAgICAgICAgICZzbWJpb3NfdGFibGVzLCAmc21iaW9zX3RhYmxlc19sZW4s
CisgICAgICAgICAgICAgICAgICAgICAgJnNtYmlvc19hbmNob3IsICZzbWJpb3NfYW5jaG9yX2xl
biwKKyAgICAgICAgICAgICAgICAgICAgICAmZXJyb3JfZmF0YWwpOworCisgICAgaWYgKHNtYmlv
c19hbmNob3IpIHsKKyAgICAgICAgZndfY2ZnX2FkZF9maWxlKHMtPmZ3X2NmZywgImV0Yy9zbWJp
b3Mvc21iaW9zLXRhYmxlcyIsCisgICAgICAgICAgICAgICAgICAgICAgICBzbWJpb3NfdGFibGVz
LCBzbWJpb3NfdGFibGVzX2xlbik7CisgICAgICAgIGZ3X2NmZ19hZGRfZmlsZShzLT5md19jZmcs
ICJldGMvc21iaW9zL3NtYmlvcy1hbmNob3IiLAorICAgICAgICAgICAgICAgICAgICAgICAgc21i
aW9zX2FuY2hvciwgc21iaW9zX2FuY2hvcl9sZW4pOworICAgIH0KK30KKworc3RhdGljIHZvaWQg
dmVnYV9tYWNoaW5lX2RvbmUoTm90aWZpZXIgKm5vdGlmaWVyLCB2b2lkICpkYXRhKQoreworICAg
IFJJU0NWVmVnYVN0YXRlICpzID0gY29udGFpbmVyX29mKG5vdGlmaWVyLCBSSVNDVlZlZ2FTdGF0
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWNoaW5lX2RvbmUpOwor
ICAgIE1hY2hpbmVTdGF0ZSAqbWFjaGluZSA9IE1BQ0hJTkUocyk7CisgICAgaHdhZGRyIHN0YXJ0
X2FkZHIgPSBzLT5tZW1tYXBbVkVHQV9EUkFNXS5iYXNlOworICAgIHRhcmdldF91bG9uZyBmaXJt
d2FyZV9lbmRfYWRkciwga2VybmVsX3N0YXJ0X2FkZHI7CisgICAgY29uc3QgY2hhciAqZmlybXdh
cmVfbmFtZSA9IHJpc2N2X2RlZmF1bHRfZmlybXdhcmVfbmFtZSgmcy0+c29jWzBdKTsKKyAgICB1
aW50NjRfdCBmZHRfbG9hZF9hZGRyOworICAgIHVpbnQ2NF90IGtlcm5lbF9lbnRyeSA9IDA7Cisg
ICAgQmxvY2tCYWNrZW5kICpwZmxhc2hfYmxrMDsKKyAgICBSSVNDVkJvb3RJbmZvIGJvb3RfaW5m
bzsKKworICAgIC8qCisgICAgICogQW4gdXNlciBwcm92aWRlZCBkdGIgbXVzdCBpbmNsdWRlIGV2
ZXJ5dGhpbmcsIGluY2x1ZGluZworICAgICAqIGR5bmFtaWMgc3lzYnVzIGRldmljZXMuIE91ciBG
RFQgbmVlZHMgdG8gYmUgZmluYWxpemVkLgorICAgICAqLworICAgIGlmIChtYWNoaW5lLT5kdGIg
PT0gTlVMTCkgeworICAgICAgICBmaW5hbGl6ZV9mZHQocyk7CisgICAgfQorCisgICAgLyoKKyAg
ICAgKiBPbmx5IGRpcmVjdCBib290IGtlcm5lbCBpcyBjdXJyZW50bHkgc3VwcG9ydGVkIGZvciBL
Vk0gVk0sCisgICAgICogc28gdGhlICItYmlvcyIgcGFyYW1ldGVyIGlzIG5vdCBzdXBwb3J0ZWQg
d2hlbiBLVk0gaXMgZW5hYmxlZC4KKyAgICAgKi8KKyAgICBpZiAoa3ZtX2VuYWJsZWQoKSkgewor
ICAgICAgICBpZiAobWFjaGluZS0+ZmlybXdhcmUpIHsKKyAgICAgICAgICAgIGlmIChzdHJjbXAo
bWFjaGluZS0+ZmlybXdhcmUsICJub25lIikpIHsKKyAgICAgICAgICAgICAgICBlcnJvcl9yZXBv
cnQoIk1hY2hpbmUgbW9kZSBmaXJtd2FyZSBpcyBub3Qgc3VwcG9ydGVkIGluICIKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgImNvbWJpbmF0aW9uIHdpdGggS1ZNLiIpOworICAgICAgICAg
ICAgICAgIGV4aXQoMSk7CisgICAgICAgICAgICB9CisgICAgICAgIH0gZWxzZSB7CisgICAgICAg
ICAgICBtYWNoaW5lLT5maXJtd2FyZSA9IGdfc3RyZHVwKCJub25lIik7CisgICAgICAgIH0KKyAg
ICB9CisKKyAgICBmaXJtd2FyZV9lbmRfYWRkciA9IHJpc2N2X2ZpbmRfYW5kX2xvYWRfZmlybXdh
cmUobWFjaGluZSwgZmlybXdhcmVfbmFtZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJnN0YXJ0X2FkZHIsIE5VTEwpOworCisgICAgcGZsYXNo
X2JsazAgPSBwZmxhc2hfY2ZpMDFfZ2V0X2JsayhzLT5mbGFzaFswXSk7CisgICAgaWYgKHBmbGFz
aF9ibGswKSB7CisgICAgICAgIGlmIChtYWNoaW5lLT5maXJtd2FyZSAmJiAhc3RyY21wKG1hY2hp
bmUtPmZpcm13YXJlLCAibm9uZSIpICYmCisgICAgICAgICAgICAha3ZtX2VuYWJsZWQoKSkgewor
ICAgICAgICAgICAgLyoKKyAgICAgICAgICAgICAqIFBmbGFzaCB3YXMgc3VwcGxpZWQgYnV0IGJp
b3MgaXMgbm9uZSBhbmQgbm90IEtWTSBndWVzdCwKKyAgICAgICAgICAgICAqIGxldCdzIG92ZXJ3
cml0ZSB0aGUgYWRkcmVzcyB3ZSBqdW1wIHRvIGFmdGVyIHJlc2V0IHRvCisgICAgICAgICAgICAg
KiB0aGUgYmFzZSBvZiB0aGUgZmxhc2guCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIHN0
YXJ0X2FkZHIgPSBzLT5tZW1tYXBbVkVHQV9GTEFTSF0uYmFzZTsKKyAgICAgICAgfSBlbHNlIHsK
KyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAgKiBQZmxhc2ggd2FzIHN1cHBsaWVkIGJ1dCBl
aXRoZXIgS1ZNIGd1ZXN0IG9yIGJpb3MgaXMgbm90IG5vbmUuCisgICAgICAgICAgICAgKiBJbiB0
aGlzIGNhc2UsIGJhc2Ugb2YgdGhlIGZsYXNoIHdvdWxkIGNvbnRhaW4gUy1tb2RlIHBheWxvYWQu
CisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIHJpc2N2X3NldHVwX2Zpcm13YXJlX2Jvb3Qo
bWFjaGluZSk7CisgICAgICAgICAgICBrZXJuZWxfZW50cnkgPSBzLT5tZW1tYXBbVkVHQV9GTEFT
SF0uYmFzZTsKKyAgICAgICAgfQorICAgIH0KKworICAgIHJpc2N2X2Jvb3RfaW5mb19pbml0KCZi
b290X2luZm8sICZzLT5zb2NbMF0pOworCisgICAgaWYgKG1hY2hpbmUtPmtlcm5lbF9maWxlbmFt
ZSAmJiAha2VybmVsX2VudHJ5KSB7CisgICAgICAgIGtlcm5lbF9zdGFydF9hZGRyID0gcmlzY3Zf
Y2FsY19rZXJuZWxfc3RhcnRfYWRkcigmYm9vdF9pbmZvLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlybXdhcmVfZW5kX2FkZHIpOwor
ICAgICAgICByaXNjdl9sb2FkX2tlcm5lbChtYWNoaW5lLCAmYm9vdF9pbmZvLCBrZXJuZWxfc3Rh
cnRfYWRkciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwgTlVMTCk7CisgICAgICAg
IGtlcm5lbF9lbnRyeSA9IGJvb3RfaW5mby5pbWFnZV9sb3dfYWRkcjsKKyAgICB9CisKKyAgICBm
ZHRfbG9hZF9hZGRyID0gcmlzY3ZfY29tcHV0ZV9mZHRfYWRkcihzLT5tZW1tYXBbVkVHQV9EUkFN
XS5iYXNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1l
bW1hcFtWRUdBX0RSQU1dLnNpemUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbWFjaGluZSwgJmJvb3RfaW5mbyk7CisgICAgcmlzY3ZfbG9hZF9mZHQoZmR0X2xv
YWRfYWRkciwgbWFjaGluZS0+ZmR0KTsKKworICAgIC8qIGxvYWQgdGhlIHJlc2V0IHZlY3RvciAq
LworICAgIHJpc2N2X3NldHVwX3JvbV9yZXNldF92ZWMobWFjaGluZSwgJnMtPnNvY1swXSwgc3Rh
cnRfYWRkciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1lbW1hcFtWRUdBX01S
T01dLmJhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzLT5tZW1tYXBbVkVHQV9N
Uk9NXS5zaXplLCBrZXJuZWxfZW50cnksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBm
ZHRfbG9hZF9hZGRyKTsKKworICAgIC8qCisgICAgICogT25seSBkaXJlY3QgYm9vdCBrZXJuZWwg
aXMgY3VycmVudGx5IHN1cHBvcnRlZCBmb3IgS1ZNIFZNLAorICAgICAqIFNvIGhlcmUgc2V0dXAg
a2VybmVsIHN0YXJ0IGFkZHJlc3MgYW5kIGZkdCBhZGRyZXNzLgorICAgICAqIFRPRE86U3VwcG9y
dCBmaXJtd2FyZSBsb2FkaW5nIGFuZCBpbnRlZ3JhdGUgdG8gVENHIHN0YXJ0CisgICAgICovCisg
ICAgaWYgKGt2bV9lbmFibGVkKCkpIHsKKyAgICAgICAgcmlzY3Zfc2V0dXBfZGlyZWN0X2tlcm5l
bChrZXJuZWxfZW50cnksIGZkdF9sb2FkX2FkZHIpOworICAgIH0KKworICAgIHZlZ2FfYnVpbGRf
c21iaW9zKHMpOworCisgICAgaWYgKHZlZ2FfaXNfYWNwaV9lbmFibGVkKHMpKSB7CisgICAgICAg
IHZpcnRfYWNwaV9zZXR1cChzKTsKKyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfbWFjaGlu
ZV9pbml0KE1hY2hpbmVTdGF0ZSAqbWFjaGluZSkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9
IFJJU0NWX1ZFR0FfTUFDSElORShtYWNoaW5lKTsKKyAgICBNZW1vcnlSZWdpb24gKnN5c3RlbV9t
ZW1vcnkgPSBnZXRfc3lzdGVtX21lbW9yeSgpOworICAgIE1lbW9yeVJlZ2lvbiAqbWFza19yb20g
PSBnX25ldyhNZW1vcnlSZWdpb24sIDEpOworICAgIERldmljZVN0YXRlICptbWlvX2lycWNoaXAs
ICp2aXJ0aW9faXJxY2hpcCwgKnBjaWVfaXJxY2hpcDsKKyAgICBpbnQgaSwgYmFzZV9oYXJ0aWQs
IGhhcnRfY291bnQ7CisgICAgaW50IHNvY2tldF9jb3VudCA9IHJpc2N2X3NvY2tldF9jb3VudCht
YWNoaW5lKTsKKworICAgIHMtPm1lbW1hcCA9IHZlZ2FfbWVtbWFwOworCisgICAgLyogQ2hlY2sg
c29ja2V0IGNvdW50IGxpbWl0ICovCisgICAgaWYgKFZFR0FfU09DS0VUU19NQVggPCBzb2NrZXRf
Y291bnQpIHsKKyAgICAgICAgZXJyb3JfcmVwb3J0KCJudW1iZXIgb2Ygc29ja2V0cy9ub2RlcyBz
aG91bGQgYmUgbGVzcyB0aGFuICVkIiwKKyAgICAgICAgICAgIFZFR0FfU09DS0VUU19NQVgpOwor
ICAgICAgICBleGl0KDEpOworICAgIH0KKworICAgIGlmICghdmVnYV9hY2xpbnRfYWxsb3dlZCgp
ICYmIHMtPmhhdmVfYWNsaW50KSB7CisgICAgICAgIGVycm9yX3JlcG9ydCgiJ2FjbGludCcgaXMg
b25seSBhdmFpbGFibGUgd2l0aCBUQ0cgYWNjZWxlcmF0aW9uIik7CisgICAgICAgIGV4aXQoMSk7
CisgICAgfQorCisgICAgLyogSW5pdGlhbGl6ZSBzb2NrZXRzICovCisgICAgbW1pb19pcnFjaGlw
ID0gdmlydGlvX2lycWNoaXAgPSBwY2llX2lycWNoaXAgPSBOVUxMOworICAgIC8vcHJpbnRmKCJz
b2NrZXRfY291bnQtPiVkXG4iLHNvY2tldF9jb3VudCk7CisgICAgZm9yIChpID0gMDsgaSA8IHNv
Y2tldF9jb3VudDsgaSsrKSB7CisgICAgICAgIGdfYXV0b2ZyZWUgY2hhciAqc29jX25hbWUgPSBn
X3N0cmR1cF9wcmludGYoInNvYyVkIiwgaSk7CisKKyAgICAgICAgaWYgKCFyaXNjdl9zb2NrZXRf
Y2hlY2tfaGFydGlkcyhtYWNoaW5lLCBpKSkgeworICAgICAgICAgICAgZXJyb3JfcmVwb3J0KCJk
aXNjb250aW51b3VzIGhhcnRpZHMgaW4gc29ja2V0JWQiLCBpKTsKKyAgICAgICAgICAgIGV4aXQo
MSk7CisgICAgICAgIH0KKworICAgICAgICBiYXNlX2hhcnRpZCA9IHJpc2N2X3NvY2tldF9maXJz
dF9oYXJ0aWQobWFjaGluZSwgaSk7CisgICAgICAgIGlmIChiYXNlX2hhcnRpZCA8IDApIHsKKyAg
ICAgICAgICAgIGVycm9yX3JlcG9ydCgiY2FuJ3QgZmluZCBoYXJ0aWQgYmFzZSBmb3Igc29ja2V0
JWQiLCBpKTsKKyAgICAgICAgICAgIGV4aXQoMSk7CisgICAgICAgIH0KKworICAgICAgICBoYXJ0
X2NvdW50ID0gcmlzY3Zfc29ja2V0X2hhcnRfY291bnQobWFjaGluZSwgaSk7CisgICAgICAgIGlm
IChoYXJ0X2NvdW50IDwgMCkgeworICAgICAgICAgICAgZXJyb3JfcmVwb3J0KCJjYW4ndCBmaW5k
IGhhcnQgY291bnQgZm9yIHNvY2tldCVkIiwgaSk7CisgICAgICAgICAgICBleGl0KDEpOworICAg
ICAgICB9CisKKyAgICAgICAgb2JqZWN0X2luaXRpYWxpemVfY2hpbGQoT0JKRUNUKG1hY2hpbmUp
LCBzb2NfbmFtZSwgJnMtPnNvY1tpXSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
VFlQRV9SSVNDVl9IQVJUX0FSUkFZKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9zdHIo
T0JKRUNUKCZzLT5zb2NbaV0pLCAiY3B1LXR5cGUiLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBtYWNoaW5lLT5jcHVfdHlwZSwgJmVycm9yX2Fib3J0KTsKKyAgICAgICAgb2JqZWN0
X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5zb2NbaV0pLCAiaGFydGlkLWJhc2UiLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2hhcnRpZCwgJmVycm9yX2Fib3J0KTsK
KyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5zb2NbaV0pLCAibnVt
LWhhcnRzIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFydF9jb3VudCwgJmVy
cm9yX2Fib3J0KTsKKyAgICAgICAgc3lzYnVzX3JlYWxpemUoU1lTX0JVU19ERVZJQ0UoJnMtPnNv
Y1tpXSksICZlcnJvcl9mYXRhbCk7CisKKyAgICAgICAgaWYgKHZlZ2FfYWNsaW50X2FsbG93ZWQo
KSAmJiBzLT5oYXZlX2FjbGludCkgeworICAgICAgICAgICAgaWYgKHMtPmFpYV90eXBlID09IFZF
R0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMpIHsKKyAgICAgICAgICAgICAgICAvKiBQZXItc29ja2V0
IEFDTElOVCBNVElNRVIgKi8KKyAgICAgICAgICAgICAgICB2ZWdhX2FjbGludF9tdGltZXJfY3Jl
YXRlKHMtPm1lbW1hcFtWRUdBX0NMSU5UXS5iYXNlICsKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBpICogVkVHQV9BQ0xJTlRfREVGQVVMVF9NVElNRVJfU0laRSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgIFZFR0FfQUNMSU5UX0RFRkFVTFRfTVRJTUVSX1NJWkUsCisgICAgICAgICAgICAg
ICAgICAgICAgICBiYXNlX2hhcnRpZCwgaGFydF9jb3VudCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgIFZFR0FfQUNMSU5UX0RFRkFVTFRfTVRJTUVDTVAsCisgICAgICAgICAgICAgICAgICAgICAg
ICBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FLAorICAgICAgICAgICAgICAgICAgICAgICAgVkVH
QV9BQ0xJTlRfREVGQVVMVF9USU1FQkFTRV9GUkVRLCB0cnVlKTsKKyAgICAgICAgICAgIH0gZWxz
ZSB7CisgICAgICAgICAgICAgICAgLyogUGVyLXNvY2tldCBBQ0xJTlQgTVNXSSwgTVRJTUVSLCBh
bmQgU1NXSSAqLworICAgICAgICAgICAgICAgIHZlZ2FfYWNsaW50X3N3aV9jcmVhdGUocy0+bWVt
bWFwW1ZFR0FfQ0xJTlRdLmJhc2UgKyAKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICog
cy0+bWVtbWFwW1ZFR0FfQ0xJTlRdLnNpemUsCisgICAgICAgICAgICAgICAgICAgICAgICBiYXNl
X2hhcnRpZCwgaGFydF9jb3VudCwgZmFsc2UpOworICAgICAgICAgICAgICAgIHZlZ2FfYWNsaW50
X210aW1lcl9jcmVhdGUocy0+bWVtbWFwW1ZFR0FfQ0xJTlRdLmJhc2UgKworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGkgKiBzLT5tZW1tYXBbVkVHQV9DTElOVF0uc2l6ZSArCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgVkVHQV9BQ0xJTlRfU1dJX1NJWkUsCisgICAgICAgICAgICAg
ICAgICAgICAgICBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FUl9TSVpFLAorICAgICAgICAgICAg
ICAgICAgICAgICAgYmFzZV9oYXJ0aWQsIGhhcnRfY291bnQsCisgICAgICAgICAgICAgICAgICAg
ICAgICBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FQ01QLAorICAgICAgICAgICAgICAgICAgICAg
ICAgVkVHQV9BQ0xJTlRfREVGQVVMVF9NVElNRSwKKyAgICAgICAgICAgICAgICAgICAgICAgIFZF
R0FfQUNMSU5UX0RFRkFVTFRfVElNRUJBU0VfRlJFUSwgdHJ1ZSk7CisKKyAgICAgICAgICAgICAg
ICB2ZWdhX2FjbGludF9zd2lfY3JlYXRlKHMtPm1lbW1hcFtWRUdBX0FDTElOVF9TU1dJXS5iYXNl
ICsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICogcy0+bWVtbWFwW1ZFR0FfQUNMSU5U
X1NTV0ldLnNpemUsCisgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2hhcnRpZCwgaGFydF9j
b3VudCwgdHJ1ZSk7CisgICAgICAgICAgICB9CisgICAgICAgIH0gZWxzZSBpZiAodGNnX2VuYWJs
ZWQoKSkgeyAgICAgICAvL0NoYW5nZWQgZm9yIENEQUMKKyAgICAgICAgICAgIC8qIFBlci1zb2Nr
ZXQgU2lGaXZlIENMSU5UICovCisgICAgICAgICAgICB2ZWdhX2FjbGludF9zd2lfY3JlYXRlKHMt
Pm1lbW1hcFtWRUdBX0NMSU5UXS5iYXNlICsgIGkgKiBzLT5tZW1tYXBbVkVHQV9DTElOVF0uc2l6
ZQorICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAweDQwMCwKKyAgICAgICAgICAgICAgICAg
ICAgICAgIGJhc2VfaGFydGlkLCBoYXJ0X2NvdW50LCBmYWxzZSk7IAorICAgICAgICAgICAgIHZl
Z2FfYWNsaW50X210aW1lcl9jcmVhdGUocy0+bWVtbWFwW1ZFR0FfQ0xJTlRdLmJhc2UgKyAgIGkg
KiBzLT5tZW1tYXBbVkVHQV9DTElOVF0uc2l6ZQorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICsgVkVHQV9BQ0xJTlRfU1dJX1NJWkUsCisgICAgICAgICAgICAgICAgICAgICAgICBWRUdBX0FD
TElOVF9ERUZBVUxUX01USU1FUl9TSVpFLAorICAgICAgICAgICAgICAgICAgICAgICAgYmFzZV9o
YXJ0aWQsIGhhcnRfY291bnQsCisgICAgICAgICAgICAgICAgICAgICAgICBWRUdBX0FDTElOVF9E
RUZBVUxUX01USU1FQ01QLAorICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9BQ0xJTlRfREVG
QVVMVF9NVElNRSwKKyAgICAgICAgICAgICAgICAgICAgICAgIFZFR0FfQUNMSU5UX0RFRkFVTFRf
VElNRUJBU0VfRlJFUSwgdHJ1ZSk7CisgICAgICAgIH0KKworICAgICAgICAvKiBQZXItc29ja2V0
IGludGVycnVwdCBjb250cm9sbGVyICovCisgICAgICAgIGlmIChzLT5haWFfdHlwZSA9PSBWRUdB
X0FJQV9UWVBFX05PTkUpIHsKKyAgICAgICAgICAgIHMtPmlycWNoaXBbaV0gPSB2ZWdhX2NyZWF0
ZV9wbGljKHMtPm1lbW1hcCwgaSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGJhc2VfaGFydGlkLCBoYXJ0X2NvdW50KTsKKyAgICAgICAgfSBlbHNlIHsKKyAg
ICAgICAgICAgIHMtPmlycWNoaXBbaV0gPSB2ZWdhX2NyZWF0ZV9haWEocy0+YWlhX3R5cGUsIHMt
PmFpYV9ndWVzdHMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHMtPm1lbW1hcCwgaSwgYmFzZV9oYXJ0aWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGhhcnRfY291bnQpOworICAgICAgICB9CisKKyAgICAgICAgLyogVHJ5
IHRvIHVzZSBkaWZmZXJlbnQgSVJRQ0hJUCBpbnN0YW5jZSBiYXNlZCBkZXZpY2UgdHlwZSAqLwor
ICAgICAgICBpZiAoaSA9PSAwKSB7CisgICAgICAgICAgICBtbWlvX2lycWNoaXAgPSBzLT5pcnFj
aGlwW2ldOworICAgICAgICAgICAgdmlydGlvX2lycWNoaXAgPSBzLT5pcnFjaGlwW2ldOworICAg
ICAgICAgICAgcGNpZV9pcnFjaGlwID0gcy0+aXJxY2hpcFtpXTsKKyAgICAgICAgfQorICAgICAg
ICBpZiAoaSA9PSAxKSB7CisgICAgICAgICAgICB2aXJ0aW9faXJxY2hpcCA9IHMtPmlycWNoaXBb
aV07CisgICAgICAgICAgICBwY2llX2lycWNoaXAgPSBzLT5pcnFjaGlwW2ldOworICAgICAgICB9
CisgICAgICAgIGlmIChpID09IDIpIHsKKyAgICAgICAgICAgIHBjaWVfaXJxY2hpcCA9IHMtPmly
cWNoaXBbaV07CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAoa3ZtX2VuYWJsZWQoKSAmJiB2
ZWdhX3VzZV9rdm1fYWlhX2FwbGljX2ltc2ljKHMtPmFpYV90eXBlKSkgeworICAgICAgICBrdm1f
cmlzY3ZfYWlhX2NyZWF0ZShtYWNoaW5lLCBJTVNJQ19NTUlPX0dST1VQX01JTl9TSElGVCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9JUlFDSElQX05VTV9TT1VSQ0VTLCBWRUdB
X0lSUUNISVBfTlVNX01TSVMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1lbW1h
cFtWRUdBX0FQTElDX1NdLmJhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1l
bW1hcFtWRUdBX0lNU0lDX1NdLmJhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMt
PmFpYV9ndWVzdHMpOworICAgIH0KKworICAgIGlmIChyaXNjdl9pc18zMmJpdCgmcy0+c29jWzBd
KSkgeworI2lmIEhPU1RfTE9OR19CSVRTID09IDY0CisgICAgICAgIC8qIGxpbWl0IFJBTSBzaXpl
IGluIGEgMzItYml0IHN5c3RlbSAqLworICAgICAgICBpZiAobWFjaGluZS0+cmFtX3NpemUgPiAx
MCAqIEdpQikgeworICAgICAgICAgICAgbWFjaGluZS0+cmFtX3NpemUgPSAxMCAqIEdpQjsKKyAg
ICAgICAgICAgIGVycm9yX3JlcG9ydCgiTGltaXRpbmcgUkFNIHNpemUgdG8gMTAgR2lCIik7Cisg
ICAgICAgIH0KKyNlbmRpZgorICAgICAgICB2ZWdhX2hpZ2hfcGNpZV9tZW1tYXAuYmFzZSA9IFZF
R0EzMl9ISUdIX1BDSUVfTU1JT19CQVNFOworICAgICAgICB2ZWdhX2hpZ2hfcGNpZV9tZW1tYXAu
c2l6ZSA9IFZFR0EzMl9ISUdIX1BDSUVfTU1JT19TSVpFOworICAgIH0gZWxzZSB7CisgICAgICAg
IHZlZ2FfaGlnaF9wY2llX21lbW1hcC5zaXplID0gVkVHQTY0X0hJR0hfUENJRV9NTUlPX1NJWkU7
CisgICAgICAgIHZlZ2FfaGlnaF9wY2llX21lbW1hcC5iYXNlID0gcy0+bWVtbWFwW1ZFR0FfRFJB
TV0uYmFzZSArCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFjaGluZS0+
cmFtX3NpemU7CisgICAgICAgIHZlZ2FfaGlnaF9wY2llX21lbW1hcC5iYXNlID0KKyAgICAgICAg
ICAgIFJPVU5EX1VQKHZlZ2FfaGlnaF9wY2llX21lbW1hcC5iYXNlLCB2ZWdhX2hpZ2hfcGNpZV9t
ZW1tYXAuc2l6ZSk7CisgICAgfQorCisgICAgLypDTEEgY29uZmlndXJhdGlvbiBvZiBkcmFtKi8K
KyAgICBzLT5kcmFtX2Jhc2UgPSB2ZWdhX2RyYW1fYmFzZV9wcm9wZXJ0eTsKKyAgICBwcmludGYo
IkRFQlVHOiBwYXJzZWQgZHJhbV9iYXNlID0gMHglbHhcbiIsICh1bnNpZ25lZCBsb25nKXMtPmRy
YW1fYmFzZSk7CisKKyAgICBpZiAoIXMtPmRyYW1fYmFzZSkKKyAgICB7CisgICAgICAgIGVycm9y
X3JlcG9ydCgiUGxlYXNlIHNwZWNpZnkgLU0gdmVnYSxkcmFtLWJhc2U9PGFkZHI+Iik7CisgICAg
ICAgIGV4aXQoMSk7CisgICAgfQorICAgIGVsc2UKKyAgICB7CisgICAgICAgIHZlZ2FfbWVtbWFw
W1ZFR0FfRFJBTV0uYmFzZSA9IHMtPmRyYW1fYmFzZTsKKyAgICB9CisKKyAgICBtZW1vcnlfcmVn
aW9uX2FkZF9zdWJyZWdpb24oc3lzdGVtX21lbW9yeSwgcy0+bWVtbWFwW1ZFR0FfRFJBTV0uYmFz
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFjaGluZS0+cmFtKTsKKworICAg
IHByaW50ZigiVkVHQTogRFJBTSBpbml0aWFsaXplZCBhdCBiYXNlIDB4JWx4IHdpdGggc2l6ZSAw
eCVseFxuIiwKKyAgICAgICAgICAgKHVuc2lnbmVkIGxvbmcpcy0+ZHJhbV9iYXNlLCAodW5zaWdu
ZWQgbG9uZyltYWNoaW5lLT5yYW1fc2l6ZSk7CisKKyAgICAvKiBib290IHJvbSAqLworICAgIG1l
bW9yeV9yZWdpb25faW5pdF9yb20obWFza19yb20sIE5VTEwsICJyaXNjdl92ZWdhX2JvYXJkLm1y
b20iLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfTVJPTV0uc2l6
ZSwgJmVycm9yX2ZhdGFsKTsKKyAgICBtZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdpb24oc3lzdGVt
X21lbW9yeSwgcy0+bWVtbWFwW1ZFR0FfTVJPTV0uYmFzZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbWFza19yb20pOworCisgICAgLyoKKyAgICAgKiBJbml0IGZ3X2NmZy4gTXVz
dCBiZSBkb25lIGJlZm9yZSByaXNjdl9sb2FkX2ZkdCwgb3RoZXJ3aXNlIHRoZQorICAgICAqIGRl
dmljZSB0cmVlIGNhbm5vdCBiZSBhbHRlcmVkIGFuZCB3ZSBnZXQgRkRUX0VSUl9OT1NQQUNFLgor
ICAgICAqLworICAgIHMtPmZ3X2NmZyA9IGNyZWF0ZV9md19jZmcobWFjaGluZSwgcy0+bWVtbWFw
W1ZFR0FfRldfQ0ZHXS5iYXNlKTsKKyAgICByb21fc2V0X2Z3KHMtPmZ3X2NmZyk7CisKKyAgICAv
KiBTaUZpdmUgVGVzdCBNTUlPIGRldmljZSAqLworICAgIHNpZml2ZV90ZXN0X2NyZWF0ZShzLT5t
ZW1tYXBbVkVHQV9URVNUXS5iYXNlKTsKKworICAgIC8qIFZpcnRJTyBNTUlPIGRldmljZXMgKi8K
KyAgICBmb3IgKGkgPSAwOyBpIDwgVklSVElPX0NPVU5UOyBpKyspIHsKKyAgICAgICAgc3lzYnVz
X2NyZWF0ZV9zaW1wbGUoInZpcnRpby1tbWlvIiwKKyAgICAgICAgICAgIHMtPm1lbW1hcFtWRUdB
X1ZJUlRJT10uYmFzZSArIGkgKiBzLT5tZW1tYXBbVkVHQV9WSVJUSU9dLnNpemUsCisgICAgICAg
ICAgICBxZGV2X2dldF9ncGlvX2luKHZpcnRpb19pcnFjaGlwLCBWSVJUSU9fSVJRICsgaSkpOwor
ICAgIH0KKworICAgIGdwZXhfcGNpZV9pbml0KHN5c3RlbV9tZW1vcnksIHBjaWVfaXJxY2hpcCwg
cyk7CisKKyAgICBjcmVhdGVfcGxhdGZvcm1fYnVzKHMsIG1taW9faXJxY2hpcCk7CisKKyAgICAv
KkZvciByZWcgc2hpZnQgaW4gVUFSVCAoMCBvciAyKSovCisgICAgYm9vbCBpc19iYXJlbWV0YWwg
PSBzLT5iYXJlbWV0YWxfbW9kZTsKKyAgICBzZXJpYWxfbW1faW5pdChzeXN0ZW1fbWVtb3J5LCBz
LT5tZW1tYXBbVkVHQV9VQVJUMF0uYmFzZSwKKyAgICAgICAgaXNfYmFyZW1ldGFsID8gMiA6IDAs
CisgICAgICAgIHFkZXZfZ2V0X2dwaW9faW4obW1pb19pcnFjaGlwLCBVQVJUMF9JUlEpLAorICAg
ICAgICAzOTkxOTMsCisgICAgICAgIHNlcmlhbF9oZCgwKSwKKyAgICAgICAgREVWSUNFX0xJVFRM
RV9FTkRJQU4pOworCisgICAgc3lzYnVzX2NyZWF0ZV9zaW1wbGUoImdvbGRmaXNoX3J0YyIsIHMt
Pm1lbW1hcFtWRUdBX1JUQ10uYmFzZSwKKyAgICAgICAgcWRldl9nZXRfZ3Bpb19pbihtbWlvX2ly
cWNoaXAsIFJUQ19JUlEpKTsKKworICAgIGZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHMtPmZs
YXNoKTsgaSsrKSB7CisgICAgICAgIC8qIE1hcCBsZWdhY3kgLWRyaXZlIGlmPXBmbGFzaCB0byBt
YWNoaW5lIHByb3BlcnRpZXMgKi8KKyAgICAgICAgcGZsYXNoX2NmaTAxX2xlZ2FjeV9kcml2ZShz
LT5mbGFzaFtpXSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZV9nZXQo
SUZfUEZMQVNILCAwLCBpKSk7CisgICAgfQorICAgIHZlZ2FfZmxhc2hfbWFwKHMsIHN5c3RlbV9t
ZW1vcnkpOworCisgICAgLyogbG9hZC9jcmVhdGUgZGV2aWNlIHRyZWUgKi8KKyAgICBpZiAobWFj
aGluZS0+ZHRiKSB7CisgICAgICAgIG1hY2hpbmUtPmZkdCA9IGxvYWRfZGV2aWNlX3RyZWUobWFj
aGluZS0+ZHRiLCAmcy0+ZmR0X3NpemUpOworICAgICAgICBpZiAoIW1hY2hpbmUtPmZkdCkgewor
ICAgICAgICAgICAgZXJyb3JfcmVwb3J0KCJsb2FkX2RldmljZV90cmVlKCkgZmFpbGVkIik7Cisg
ICAgICAgICAgICBleGl0KDEpOworICAgICAgICB9CisgICAgfSBlbHNlIHsKKyAgICAgICAgY3Jl
YXRlX2ZkdChzKTsKKyAgICB9CisKKyAgICBpZiAodmVnYV9pc19pb21tdV9zeXNfZW5hYmxlZChz
KSkgeworICAgICAgICBEZXZpY2VTdGF0ZSAqaW9tbXVfc3lzID0gcWRldl9uZXcoVFlQRV9SSVND
Vl9JT01NVV9TWVMpOworCisgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfdWludChPQkpFQ1Qo
aW9tbXVfc3lzKSwgImFkZHIiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+
bWVtbWFwW1ZFR0FfSU9NTVVfU1lTXS5iYXNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJmVycm9yX2ZhdGFsKTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KE9C
SkVDVChpb21tdV9zeXMpLCAiYmFzZS1pcnEiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgSU9NTVVfU1lTX0lSUSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZl
cnJvcl9mYXRhbCk7CisgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfbGluayhPQkpFQ1QoaW9t
bXVfc3lzKSwgImlycWNoaXAiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT0JK
RUNUKG1taW9faXJxY2hpcCksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZXJy
b3JfZmF0YWwpOworCisgICAgICAgIHN5c2J1c19yZWFsaXplX2FuZF91bnJlZihTWVNfQlVTX0RF
VklDRShpb21tdV9zeXMpLCAmZXJyb3JfZmF0YWwpOworICAgIH0KKworICAgIHMtPm1hY2hpbmVf
ZG9uZS5ub3RpZnkgPSB2ZWdhX21hY2hpbmVfZG9uZTsKKyAgICBxZW11X2FkZF9tYWNoaW5lX2lu
aXRfZG9uZV9ub3RpZmllcigmcy0+bWFjaGluZV9kb25lKTsKKworICAgIC8qVUFSVDEgLSBVQVJU
NCovCisgICAgY3JlYXRlX3VuaW1wbGVtZW50ZWRfZGV2aWNlKCJ2ZWdhLnVhcnQxIiwKKyAgICAg
ICAgIHMtPm1lbW1hcFtWRUdBX1VBUlQxXS5iYXNlLAorICAgICAgICAgcy0+bWVtbWFwW1ZFR0Ff
VUFSVDFdLnNpemUpOworICAgIGNyZWF0ZV91bmltcGxlbWVudGVkX2RldmljZSgidmVnYS51YXJ0
MiIsCisgICAgICAgICBzLT5tZW1tYXBbVkVHQV9VQVJUMl0uYmFzZSwKKyAgICAgICAgIHMtPm1l
bW1hcFtWRUdBX1VBUlQyXS5zaXplKTsKKyAgICBjcmVhdGVfdW5pbXBsZW1lbnRlZF9kZXZpY2Uo
InZlZ2EudWFydDMiLAorICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfVUFSVDNdLmJhc2UsCisgICAg
ICAgICBzLT5tZW1tYXBbVkVHQV9VQVJUM10uc2l6ZSk7CisgICAgY3JlYXRlX3VuaW1wbGVtZW50
ZWRfZGV2aWNlKCJ2ZWdhLnVhcnQ0IiwKKyAgICAgICAgIHMtPm1lbW1hcFtWRUdBX1VBUlQ0XS5i
YXNlLAorICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfVUFSVDRdLnNpemUpOworCisgICAgLyogU1BJ
IE1NSU8qLworICAgIGNyZWF0ZV91bmltcGxlbWVudGVkX2RldmljZSgidmVnYS5zcGkwIiwKKyAg
ICAgICAgIHMtPm1lbW1hcFtWRUdBX1NQSTBdLmJhc2UsCisgICAgICAgICBzLT5tZW1tYXBbVkVH
QV9TUEkwXS5zaXplKTsKKyAgICBjcmVhdGVfdW5pbXBsZW1lbnRlZF9kZXZpY2UoInZlZ2Euc3Bp
MSIsCisgICAgICAgICBzLT5tZW1tYXBbVkVHQV9TUEkxXS5iYXNlLAorICAgICAgICAgcy0+bWVt
bWFwW1ZFR0FfU1BJMV0uc2l6ZSk7CisKKyAgICAvKiBJMkMgTU1JTyovCisgICAgY3JlYXRlX3Vu
aW1wbGVtZW50ZWRfZGV2aWNlKCJ2ZWdhLmkyYzAiLAorICAgICAgICAgcy0+bWVtbWFwW1ZFR0Ff
SUlDMF0uYmFzZSwKKyAgICAgICAgIHMtPm1lbW1hcFtWRUdBX0lJQzBdLnNpemUpOworICAgIGNy
ZWF0ZV91bmltcGxlbWVudGVkX2RldmljZSgidmVnYS5pMmMxIiwKKyAgICAgICAgIHMtPm1lbW1h
cFtWRUdBX0lJQzFdLmJhc2UsCisgICAgICAgICBzLT5tZW1tYXBbVkVHQV9JSUMxXS5zaXplKTsK
KyAgICAKK30KKworc3RhdGljIHZvaWQgdmVnYV9tYWNoaW5lX2luc3RhbmNlX2luaXQoT2JqZWN0
ICpvYmopCit7CisgICAgUklTQ1ZWZWdhU3RhdGUgKnMgPSBSSVNDVl9WRUdBX01BQ0hJTkUob2Jq
KTsKKworICAgIHZlZ2FfZmxhc2hfY3JlYXRlKHMpOworCisgICAgcy0+b2VtX2lkID0gZ19zdHJu
ZHVwKEFDUElfQlVJTERfQVBQTkFNRTYsIDYpOworICAgIHMtPm9lbV90YWJsZV9pZCA9IGdfc3Ry
bmR1cChBQ1BJX0JVSUxEX0FQUE5BTUU4LCA4KTsKKyAgICBzLT5hY3BpID0gT05fT0ZGX0FVVE9f
QVVUTzsKKyAgICBzLT5pb21tdV9zeXMgPSBPTl9PRkZfQVVUT19BVVRPOworfQorCitzdGF0aWMg
Y2hhciAqdmVnYV9nZXRfYWlhX2d1ZXN0cyhPYmplY3QgKm9iaiwgRXJyb3IgKiplcnJwKQorewor
ICAgIFJJU0NWVmVnYVN0YXRlICpzID0gUklTQ1ZfVkVHQV9NQUNISU5FKG9iaik7CisKKyAgICBy
ZXR1cm4gZ19zdHJkdXBfcHJpbnRmKCIlZCIsIHMtPmFpYV9ndWVzdHMpOworfQorCitzdGF0aWMg
dm9pZCB2ZWdhX3NldF9haWFfZ3Vlc3RzKE9iamVjdCAqb2JqLCBjb25zdCBjaGFyICp2YWwsIEVy
cm9yICoqZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElO
RShvYmopOworCisgICAgcy0+YWlhX2d1ZXN0cyA9IGF0b2kodmFsKTsKKyAgICBpZiAocy0+YWlh
X2d1ZXN0cyA8IDAgfHwgcy0+YWlhX2d1ZXN0cyA+IFZFR0FfSVJRQ0hJUF9NQVhfR1VFU1RTKSB7
CisgICAgICAgIGVycm9yX3NldGcoZXJycCwgIkludmFsaWQgbnVtYmVyIG9mIEFJQSBJTVNJQyBn
dWVzdHMiKTsKKyAgICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoZXJycCwgIlZhbGlkIHZhbHVlcyBi
ZSBiZXR3ZWVuIDAgYW5kICVkLlxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9J
UlFDSElQX01BWF9HVUVTVFMpOworICAgIH0KK30KKworc3RhdGljIGNoYXIgKnZlZ2FfZ2V0X2Fp
YShPYmplY3QgKm9iaiwgRXJyb3IgKiplcnJwKQoreworICAgIFJJU0NWVmVnYVN0YXRlICpzID0g
UklTQ1ZfVkVHQV9NQUNISU5FKG9iaik7CisgICAgY29uc3QgY2hhciAqdmFsOworCisgICAgc3dp
dGNoIChzLT5haWFfdHlwZSkgeworICAgIGNhc2UgVkVHQV9BSUFfVFlQRV9BUExJQzoKKyAgICAg
ICAgdmFsID0gImFwbGljIjsKKyAgICAgICAgYnJlYWs7CisgICAgY2FzZSBWRUdBX0FJQV9UWVBF
X0FQTElDX0lNU0lDOgorICAgICAgICB2YWwgPSAiYXBsaWMtaW1zaWMiOworICAgICAgICBicmVh
azsKKyAgICBkZWZhdWx0OgorICAgICAgICB2YWwgPSAibm9uZSI7CisgICAgICAgIGJyZWFrOwor
ICAgIH07CisKKyAgICByZXR1cm4gZ19zdHJkdXAodmFsKTsKK30KKworc3RhdGljIHZvaWQgdmVn
YV9zZXRfYWlhKE9iamVjdCAqb2JqLCBjb25zdCBjaGFyICp2YWwsIEVycm9yICoqZXJycCkKK3sK
KyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElORShvYmopOworCisgICAg
aWYgKCFzdHJjbXAodmFsLCAibm9uZSIpKSB7CisgICAgICAgIHMtPmFpYV90eXBlID0gVkVHQV9B
SUFfVFlQRV9OT05FOworICAgIH0gZWxzZSBpZiAoIXN0cmNtcCh2YWwsICJhcGxpYyIpKSB7Cisg
ICAgICAgIHMtPmFpYV90eXBlID0gVkVHQV9BSUFfVFlQRV9BUExJQzsKKyAgICB9IGVsc2UgaWYg
KCFzdHJjbXAodmFsLCAiYXBsaWMtaW1zaWMiKSkgeworICAgICAgICBzLT5haWFfdHlwZSA9IFZF
R0FfQUlBX1RZUEVfQVBMSUNfSU1TSUM7CisgICAgfSBlbHNlIHsKKyAgICAgICAgZXJyb3Jfc2V0
ZyhlcnJwLCAiSW52YWxpZCBBSUEgaW50ZXJydXB0IGNvbnRyb2xsZXIgdHlwZSIpOworICAgICAg
ICBlcnJvcl9hcHBlbmRfaGludChlcnJwLCAiVmFsaWQgdmFsdWVzIGFyZSBub25lLCBhcGxpYywg
YW5kICIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgImFwbGljLWltc2ljLlxuIik7CisgICAg
fQorfQorCitzdGF0aWMgYm9vbCB2ZWdhX2dldF9hY2xpbnQoT2JqZWN0ICpvYmosIEVycm9yICoq
ZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElORShvYmop
OworCisgICAgcmV0dXJuIHMtPmhhdmVfYWNsaW50OworfQorCitzdGF0aWMgdm9pZCB2ZWdhX3Nl
dF9hY2xpbnQoT2JqZWN0ICpvYmosIGJvb2wgdmFsdWUsIEVycm9yICoqZXJycCkKK3sKKyAgICBS
SVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElORShvYmopOworCisgICAgcy0+aGF2
ZV9hY2xpbnQgPSB2YWx1ZTsKK30KKworYm9vbCB2ZWdhX2lzX2lvbW11X3N5c19lbmFibGVkKFJJ
U0NWVmVnYVN0YXRlICpzKQoreworICAgIHJldHVybiBzLT5pb21tdV9zeXMgPT0gT05fT0ZGX0FV
VE9fT047Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfZ2V0X2lvbW11X3N5cyhPYmplY3QgKm9iaiwg
VmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAq
cyA9IFJJU0NWX1ZFR0FfTUFDSElORShvYmopOworICAgIE9uT2ZmQXV0byBpb21tdV9zeXMgPSBz
LT5pb21tdV9zeXM7CisKKyAgICB2aXNpdF90eXBlX09uT2ZmQXV0byh2LCBuYW1lLCAmaW9tbXVf
c3lzLCBlcnJwKTsKK30KKworc3RhdGljIHZvaWQgdmVnYV9zZXRfaW9tbXVfc3lzKE9iamVjdCAq
b2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQoreworICAgIFJJU0NWVmVnYVN0
YXRlICpzID0gUklTQ1ZfVkVHQV9NQUNISU5FKG9iaik7CisKKyAgICB2aXNpdF90eXBlX09uT2Zm
QXV0byh2LCBuYW1lLCAmcy0+aW9tbXVfc3lzLCBlcnJwKTsKK30KKworYm9vbCB2ZWdhX2lzX2Fj
cGlfZW5hYmxlZChSSVNDVlZlZ2FTdGF0ZSAqcykKK3sKKyAgICByZXR1cm4gcy0+YWNwaSAhPSBP
Tl9PRkZfQVVUT19PRkY7Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfZ2V0X2FjcGkoT2JqZWN0ICpv
YmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQoreworICAgIFJJU0NWVmVnYVN0YXRlICpz
ID0gUklTQ1ZfVkVHQV9NQUNISU5FKG9iaik7CisgICAgT25PZmZBdXRvIGFjcGkgPSBzLT5hY3Bp
OworCisgICAgdmlzaXRfdHlwZV9Pbk9mZkF1dG8odiwgbmFtZSwgJmFjcGksIGVycnApOworfQor
CitzdGF0aWMgdm9pZCB2ZWdhX3NldF9hY3BpKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25z
dCBjaGFyICpuYW1lLAorICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpvcGFxdWUsIEVy
cm9yICoqZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElO
RShvYmopOworCisgICAgdmlzaXRfdHlwZV9Pbk9mZkF1dG8odiwgbmFtZSwgJnMtPmFjcGksIGVy
cnApOworfQorCitzdGF0aWMgSG90cGx1Z0hhbmRsZXIgKnZlZ2FfbWFjaGluZV9nZXRfaG90cGx1
Z19oYW5kbGVyKE1hY2hpbmVTdGF0ZSAqbWFjaGluZSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGV2aWNlU3RhdGUgKmRldikKK3sKKyAg
ICBNYWNoaW5lQ2xhc3MgKm1jID0gTUFDSElORV9HRVRfQ0xBU1MobWFjaGluZSk7CisgICAgUklT
Q1ZWZWdhU3RhdGUgKnMgPSBSSVNDVl9WRUdBX01BQ0hJTkUobWFjaGluZSk7CisKKyAgICBpZiAo
ZGV2aWNlX2lzX2R5bmFtaWNfc3lzYnVzKG1jLCBkZXYpIHx8CisgICAgICAgIG9iamVjdF9keW5h
bWljX2Nhc3QoT0JKRUNUKGRldiksIFRZUEVfVklSVElPX0lPTU1VX1BDSSkgfHwKKyAgICAgICAg
b2JqZWN0X2R5bmFtaWNfY2FzdChPQkpFQ1QoZGV2KSwgVFlQRV9SSVNDVl9JT01NVV9QQ0kpKSB7
CisgICAgICAgIHMtPmlvbW11X3N5cyA9IE9OX09GRl9BVVRPX09GRjsKKyAgICAgICAgcmV0dXJu
IEhPVFBMVUdfSEFORExFUihtYWNoaW5lKTsKKyAgICB9CisKKyAgICByZXR1cm4gTlVMTDsKK30K
Kworc3RhdGljIHZvaWQgdmVnYV9tYWNoaW5lX2RldmljZV9wbHVnX2NiKEhvdHBsdWdIYW5kbGVy
ICpob3RwbHVnX2RldiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBE
ZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCit7CisgICAgUklTQ1ZWZWdhU3RhdGUgKnMg
PSBSSVNDVl9WRUdBX01BQ0hJTkUoaG90cGx1Z19kZXYpOworCisgICAgaWYgKHMtPnBsYXRmb3Jt
X2J1c19kZXYpIHsKKyAgICAgICAgTWFjaGluZUNsYXNzICptYyA9IE1BQ0hJTkVfR0VUX0NMQVNT
KHMpOworCisgICAgICAgIGlmIChkZXZpY2VfaXNfZHluYW1pY19zeXNidXMobWMsIGRldikpIHsK
KyAgICAgICAgICAgIHBsYXRmb3JtX2J1c19saW5rX2RldmljZShQTEFURk9STV9CVVNfREVWSUNF
KHMtPnBsYXRmb3JtX2J1c19kZXYpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFNZU19CVVNfREVWSUNFKGRldikpOworICAgICAgICB9CisgICAgfQorCisgICAgaWYgKG9i
amVjdF9keW5hbWljX2Nhc3QoT0JKRUNUKGRldiksIFRZUEVfVklSVElPX0lPTU1VX1BDSSkpIHsK
KyAgICAgICAgY3JlYXRlX2ZkdF92aXJ0aW9faW9tbXUocywgcGNpX2dldF9iZGYoUENJX0RFVklD
RShkZXYpKSk7CisgICAgfQorCisgICAgaWYgKG9iamVjdF9keW5hbWljX2Nhc3QoT0JKRUNUKGRl
diksIFRZUEVfUklTQ1ZfSU9NTVVfUENJKSkgeworICAgICAgICBjcmVhdGVfZmR0X2lvbW11KHMs
IHBjaV9nZXRfYmRmKFBDSV9ERVZJQ0UoZGV2KSkpOworICAgICAgICBzLT5pb21tdV9zeXMgPSBP
Tl9PRkZfQVVUT19PRkY7CisgICAgfQorfQorCitzdGF0aWMgYm9vbCB2ZWdhX2dldF9iYXJlbWV0
YWwoT2JqZWN0ICpvYmosIEVycm9yICoqZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9
IChSSVNDVlZlZ2FTdGF0ZSAqKW9iajsKKyAgICByZXR1cm4gcy0+YmFyZW1ldGFsX21vZGU7Cit9
CisKK3N0YXRpYyB2b2lkIHZlZ2Ffc2V0X2JhcmVtZXRhbChPYmplY3QgKm9iaiwgYm9vbCB2YWx1
ZSwgRXJyb3IgKiplcnJwKQoreworICAgIFJJU0NWVmVnYVN0YXRlICpzID0gKFJJU0NWVmVnYVN0
YXRlICopb2JqOworICAgIHMtPmJhcmVtZXRhbF9tb2RlID0gdmFsdWU7Cit9CisKKworc3RhdGlj
IHZvaWQgdmVnYV9tYWNoaW5lX2NsYXNzX2luaXQoT2JqZWN0Q2xhc3MgKm9jLCBjb25zdCB2b2lk
ICpkYXRhKQoreworICAgIE1hY2hpbmVDbGFzcyAqbWMgPSBNQUNISU5FX0NMQVNTKG9jKTsKKyAg
ICBIb3RwbHVnSGFuZGxlckNsYXNzICpoYyA9IEhPVFBMVUdfSEFORExFUl9DTEFTUyhvYyk7CisK
KyAgICBtYy0+ZGVzYyA9ICJSSVNDLVYgVmVnYSBib2FyZCI7CisgICAgbWMtPmluaXQgPSB2ZWdh
X21hY2hpbmVfaW5pdDsKKyAgICBtYy0+bWF4X2NwdXMgPSBWRUdBX0NQVVNfTUFYOworICAgIG1j
LT5kZWZhdWx0X2NwdV90eXBlID0gVFlQRV9SSVNDVl9DUFVfQkFTRTsKKyAgICBtYy0+YmxvY2tf
ZGVmYXVsdF90eXBlID0gSUZfVklSVElPOworICAgIG1jLT5ub19jZHJvbSA9IDE7CisgICAgbWMt
PnBjaV9hbGxvd18wX2FkZHJlc3MgPSB0cnVlOworICAgIG1jLT5wb3NzaWJsZV9jcHVfYXJjaF9p
ZHMgPSByaXNjdl9udW1hX3Bvc3NpYmxlX2NwdV9hcmNoX2lkczsKKyAgICBtYy0+Y3B1X2luZGV4
X3RvX2luc3RhbmNlX3Byb3BzID0gcmlzY3ZfbnVtYV9jcHVfaW5kZXhfdG9fcHJvcHM7CisgICAg
bWMtPmdldF9kZWZhdWx0X2NwdV9ub2RlX2lkID0gcmlzY3ZfbnVtYV9nZXRfZGVmYXVsdF9jcHVf
bm9kZV9pZDsKKyAgICBtYy0+bnVtYV9tZW1fc3VwcG9ydGVkID0gdHJ1ZTsKKyAgICAvKiBwbGF0
Zm9ybSBpbnN0ZWFkIG9mIGFyY2hpdGVjdHVyYWwgY2hvaWNlICovCisgICAgbWMtPmNwdV9jbHVz
dGVyX2hhc19udW1hX2JvdW5kYXJ5ID0gdHJ1ZTsKKyAgICBtYy0+ZGVmYXVsdF9yYW1faWQgPSAi
cmlzY3ZfdmVnYV9ib2FyZC5yYW0iOworICAgIGFzc2VydCghbWMtPmdldF9ob3RwbHVnX2hhbmRs
ZXIpOworICAgIG1jLT5nZXRfaG90cGx1Z19oYW5kbGVyID0gdmVnYV9tYWNoaW5lX2dldF9ob3Rw
bHVnX2hhbmRsZXI7CisKKyAgICBoYy0+cGx1ZyA9IHZlZ2FfbWFjaGluZV9kZXZpY2VfcGx1Z19j
YjsKKworICAgIG1hY2hpbmVfY2xhc3NfYWxsb3dfZHluYW1pY19zeXNidXNfZGV2KG1jLCBUWVBF
X1JBTUZCX0RFVklDRSk7CisgICAgbWFjaGluZV9jbGFzc19hbGxvd19keW5hbWljX3N5c2J1c19k
ZXYobWMsIFRZUEVfVUVGSV9WQVJTX1NZU0JVUyk7CisjaWZkZWYgQ09ORklHX1RQTQorICAgIG1h
Y2hpbmVfY2xhc3NfYWxsb3dfZHluYW1pY19zeXNidXNfZGV2KG1jLCBUWVBFX1RQTV9USVNfU1lT
QlVTKTsKKyNlbmRpZgorCisgICAgb2JqZWN0X2NsYXNzX3Byb3BlcnR5X2FkZF9ib29sKG9jLCAi
YWNsaW50IiwgdmVnYV9nZXRfYWNsaW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB2ZWdhX3NldF9hY2xpbnQpOworICAgIG9iamVjdF9jbGFzc19wcm9wZXJ0eV9zZXRfZGVz
Y3JpcHRpb24ob2MsICJhY2xpbnQiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIihUQ0cgb25seSkgU2V0IG9uL29mZiB0byAiCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAiZW5hYmxlL2Rpc2FibGUgZW11bGF0aW5nICIKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBQ0xJTlQgZGV2aWNlcyIpOwor
CisgICAgb2JqZWN0X2NsYXNzX3Byb3BlcnR5X2FkZF9zdHIob2MsICJhaWEiLCB2ZWdhX2dldF9h
aWEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVnYV9zZXRfYWlhKTsKKyAg
ICBvYmplY3RfY2xhc3NfcHJvcGVydHlfc2V0X2Rlc2NyaXB0aW9uKG9jLCAiYWlhIiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTZXQgdHlwZSBvZiBBSUEgaW50
ZXJydXB0ICIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjb250
cm9sbGVyLiBWYWxpZCB2YWx1ZXMgYXJlICIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICJub25lLCBhcGxpYywgYW5kIGFwbGljLWltc2ljLiIpOworCisgICAgb2Jq
ZWN0X2NsYXNzX3Byb3BlcnR5X2FkZF9zdHIob2MsICJhaWEtZ3Vlc3RzIiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2ZWdhX2dldF9haWFfZ3Vlc3RzLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHZlZ2Ffc2V0X2FpYV9ndWVzdHMpOworICAgIHsKKyAgICAg
ICAgZ19hdXRvZnJlZSBjaGFyICpzdHIgPQorICAgICAgICAgICAgZ19zdHJkdXBfcHJpbnRmKCJT
ZXQgbnVtYmVyIG9mIGd1ZXN0IE1NSU8gcGFnZXMgZm9yIEFJQSBJTVNJQy4gIgorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICJWYWxpZCB2YWx1ZSBzaG91bGQgYmUgYmV0d2VlbiAwIGFuZCAl
ZC4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZFR0FfSVJRQ0hJUF9NQVhfR1VFU1RT
KTsKKyAgICAgICAgb2JqZWN0X2NsYXNzX3Byb3BlcnR5X3NldF9kZXNjcmlwdGlvbihvYywgImFp
YS1ndWVzdHMiLCBzdHIpOworICAgIH0KKworICAgIG9iamVjdF9jbGFzc19wcm9wZXJ0eV9hZGQo
b2MsICJhY3BpIiwgIk9uT2ZmQXV0byIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2
ZWdhX2dldF9hY3BpLCB2ZWdhX3NldF9hY3BpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgTlVMTCwgTlVMTCk7CisgICAgb2JqZWN0X2NsYXNzX3Byb3BlcnR5X3NldF9kZXNjcmlwdGlv
bihvYywgImFjcGkiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IkVuYWJsZSBBQ1BJIik7CisKKyAgICBvYmplY3RfY2xhc3NfcHJvcGVydHlfYWRkKG9jLCAiaW9t
bXUtc3lzIiwgIk9uT2ZmQXV0byIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWdh
X2dldF9pb21tdV9zeXMsIHZlZ2Ffc2V0X2lvbW11X3N5cywKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIE5VTEwsIE5VTEwpOworICAgIG9iamVjdF9jbGFzc19wcm9wZXJ0eV9zZXRfZGVz
Y3JpcHRpb24ob2MsICJpb21tdS1zeXMiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIkVuYWJsZSBJT01NVSBwbGF0Zm9ybSBkZXZpY2UiKTsKKyAgICAKKyAgICAv
KkFkZCBDTEEgYXJndW1lbnQgZm9yIGJhcmVtZXRhbCovCisgICAgb2JqZWN0X2NsYXNzX3Byb3Bl
cnR5X2FkZF9ib29sKG9jLCAiYmFyZW1ldGFsLW1vZGUiLAorICAgIHZlZ2FfZ2V0X2JhcmVtZXRh
bCwgdmVnYV9zZXRfYmFyZW1ldGFsKTsKKworICAgIC8qIEFkZCBDTEEgZm9yIERSQU0gYmFzZSBh
ZGRyZXNzICovCisKKyAgICAvKiBwZXItaW5zdGFuY2UgRFJBTSBiYXNlIGFkZHJlc3MgKi8KKyAg
ICBvYmplY3RfY2xhc3NfcHJvcGVydHlfYWRkX3VpbnQ2NF9wdHIob2MsICJkcmFtLWJhc2UiLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmdmVnYV9kcmFtX2Jhc2Vf
cHJvcGVydHksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9CSl9Q
Uk9QX0ZMQUdfV1JJVEUpOworICAgIG9iamVjdF9jbGFzc19wcm9wZXJ0eV9zZXRfZGVzY3JpcHRp
b24ob2MsICJkcmFtLWJhc2UiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIkJhc2UgYWRkcmVzcyBvZiBEUkFNIChmcm9tIENMQSkiKTsKK30KKworc3RhdGljIGNv
bnN0IFR5cGVJbmZvIHZlZ2FfbWFjaGluZV90eXBlaW5mbyA9IHsKKyAgICAubmFtZSAgICAgICA9
IE1BQ0hJTkVfVFlQRV9OQU1FKCJ2ZWdhIiksCisgICAgLnBhcmVudCAgICAgPSBUWVBFX01BQ0hJ
TkUsCisgICAgLmNsYXNzX2luaXQgPSB2ZWdhX21hY2hpbmVfY2xhc3NfaW5pdCwKKyAgICAuaW5z
dGFuY2VfaW5pdCA9IHZlZ2FfbWFjaGluZV9pbnN0YW5jZV9pbml0LAorICAgIC5pbnN0YW5jZV9z
aXplID0gc2l6ZW9mKFJJU0NWVmVnYVN0YXRlKSwKKyAgICAuaW50ZXJmYWNlcyA9IChjb25zdCBJ
bnRlcmZhY2VJbmZvW10pIHsKKyAgICAgICAgIHsgVFlQRV9IT1RQTFVHX0hBTkRMRVIgfSwKKyAg
ICAgICAgIHsgfQorICAgIH0sCit9OworCitzdGF0aWMgdm9pZCB2ZWdhX21hY2hpbmVfaW5pdF9y
ZWdpc3Rlcl90eXBlcyh2b2lkKQoreworICAgIHR5cGVfcmVnaXN0ZXJfc3RhdGljKCZ2ZWdhX21h
Y2hpbmVfdHlwZWluZm8pOworfQorCit0eXBlX2luaXQodmVnYV9tYWNoaW5lX2luaXRfcmVnaXN0
ZXJfdHlwZXMpCmRpZmYgLS1naXQgYS9pbmNsdWRlL2h3L2ludGMvdmVnYV9hY2xpbnQuaCBiL2lu
Y2x1ZGUvaHcvaW50Yy92ZWdhX2FjbGludC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAw
MDAwMDAwMDAuLjk0NzU3M2YzZTEKLS0tIC9kZXYvbnVsbAorKysgYi9pbmNsdWRlL2h3L2ludGMv
dmVnYV9hY2xpbnQuaApAQCAtMCwwICsxLDY3IEBACisvKgorICogUklTQy1WIEFDTElOVCAoQWR2
YW5jZWQgQ29yZSBMb2NhbCBJbnRlcnJ1cHRvcikgaW50ZXJmYWNlCisgKi8KKworI2lmbmRlZiBI
V19WRUdBX0FDTElOVF9ICisjZGVmaW5lIEhXX1ZFR0FfQUNMSU5UX0gKKworI2luY2x1ZGUgImh3
L3N5c2J1cy5oIgorCisjZGVmaW5lIFRZUEVfVkVHQV9BQ0xJTlRfTVRJTUVSICJ2ZWdhLmFjbGlu
dC5tdGltZXIiCisKKyNkZWZpbmUgVkVHQV9BQ0xJTlRfTVRJTUVSKG9iaikgXAorICAgIE9CSkVD
VF9DSEVDSyhWRUdBQWNsaW50TVRpbWVyU3RhdGUsIChvYmopLCBUWVBFX1ZFR0FfQUNMSU5UX01U
SU1FUikKKwordHlwZWRlZiBzdHJ1Y3QgVkVHQUFjbGludE1UaW1lclN0YXRlIHsKKyAgICAvKjwg
cHJpdmF0ZSA+Ki8KKyAgICBTeXNCdXNEZXZpY2UgcGFyZW50X29iajsKKyAgICB1aW50NjRfdCB0
aW1lX2RlbHRhOworICAgIHVpbnQ2NF90ICp0aW1lY21wOworICAgIFFFTVVUaW1lciAqKnRpbWVy
czsKKworICAgIC8qPCBwdWJsaWMgPiovCisgICAgTWVtb3J5UmVnaW9uIG1taW87CisgICAgdWlu
dDMyX3QgaGFydGlkX2Jhc2U7CisgICAgdWludDMyX3QgbnVtX2hhcnRzOworICAgIHVpbnQzMl90
IHRpbWVjbXBfYmFzZTsKKyAgICB1aW50MzJfdCB0aW1lX2Jhc2U7CisgICAgdWludDMyX3QgYXBl
cnR1cmVfc2l6ZTsKKyAgICB1aW50MzJfdCB0aW1lYmFzZV9mcmVxOworICAgIHFlbXVfaXJxICp0
aW1lcl9pcnFzOworfSBWRUdBQWNsaW50TVRpbWVyU3RhdGU7CisKK0RldmljZVN0YXRlICp2ZWdh
X2FjbGludF9tdGltZXJfY3JlYXRlKGh3YWRkciBhZGRyLCBod2FkZHIgc2l6ZSwKKyAgICB1aW50
MzJfdCBoYXJ0aWRfYmFzZSwgdWludDMyX3QgbnVtX2hhcnRzLAorICAgIHVpbnQzMl90IHRpbWVj
bXBfYmFzZSwgdWludDMyX3QgdGltZV9iYXNlLCB1aW50MzJfdCB0aW1lYmFzZV9mcmVxLAorICAg
IGJvb2wgcHJvdmlkZV9yZHRpbWUpOworCisjZGVmaW5lIFRZUEVfVkVHQV9BQ0xJTlRfU1dJICJ2
ZWdhLmFjbGludC5zd2kiCisKKyNkZWZpbmUgVkVHQV9BQ0xJTlRfU1dJKG9iaikgXAorICAgIE9C
SkVDVF9DSEVDSyhWRUdBQWNsaW50U3dpU3RhdGUsIChvYmopLCBUWVBFX1ZFR0FfQUNMSU5UX1NX
SSkKKwordHlwZWRlZiBzdHJ1Y3QgVkVHQUFjbGludFN3aVN0YXRlIHsKKyAgICAvKjwgcHJpdmF0
ZSA+Ki8KKyAgICBTeXNCdXNEZXZpY2UgcGFyZW50X29iajsKKworICAgIC8qPCBwdWJsaWMgPiov
CisgICAgTWVtb3J5UmVnaW9uIG1taW87CisgICAgdWludDMyX3QgaGFydGlkX2Jhc2U7CisgICAg
dWludDMyX3QgbnVtX2hhcnRzOworICAgIHVpbnQzMl90IHNzd2k7CisgICAgcWVtdV9pcnEgKnNv
ZnRfaXJxczsKK30gVkVHQUFjbGludFN3aVN0YXRlOworCitEZXZpY2VTdGF0ZSAqdmVnYV9hY2xp
bnRfc3dpX2NyZWF0ZShod2FkZHIgYWRkciwgdWludDMyX3QgaGFydGlkX2Jhc2UsCisgICAgdWlu
dDMyX3QgbnVtX2hhcnRzLCBib29sIHNzd2kpOworCitlbnVtIHsKKyAgICBWRUdBX0FDTElOVF9E
RUZBVUxUX01USU1FQ01QICAgICAgPSAweDAsCisgICAgVkVHQV9BQ0xJTlRfREVGQVVMVF9NVElN
RSAgICAgICAgID0gMHgxMDAsCisgICAgVkVHQV9BQ0xJTlRfREVGQVVMVF9NVElNRVJfU0laRSAg
ID0gMHg4MDAwLAorICAgIFZFR0FfQUNMSU5UX0RFRkFVTFRfVElNRUJBU0VfRlJFUSA9IDEwMDAw
MDAwLAorICAgIFZFR0FfQUNMSU5UX01BWF9IQVJUUyAgICAgICAgICAgICA9IDQwOTUsCisgICAg
VkVHQV9BQ0xJTlRfU1dJX1NJWkUgICAgICAgICAgICAgID0gMHg0ODAKK307CisKKyNlbmRpZgpk
aWZmIC0tZ2l0IGEvaW5jbHVkZS9ody9pbnRjL3ZlZ2FfcGxpYy5oIGIvaW5jbHVkZS9ody9pbnRj
L3ZlZ2FfcGxpYy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAuLmIwM2I5
ZDBjMzQKLS0tIC9kZXYvbnVsbAorKysgYi9pbmNsdWRlL2h3L2ludGMvdmVnYV9wbGljLmgKQEAg
LTAsMCArMSw3MCBAQAorLyoKKyogIFZFR0EgUExJQyAoUGxhdGZvcm0gTGV2ZWwgSW50ZXJydXB0
IENvbnRyb2xsZXIpIGludGVyZmFjZQorKi8KKyNpZm5kZWYgSFdfVkVHQV9QTElDX0gKKyNkZWZp
bmUgSFdfVkVHQV9QTElDX0gKKworI2luY2x1ZGUgImh3L3N5c2J1cy5oIgorI2luY2x1ZGUgInFv
bS9vYmplY3QuaCIKKworI2RlZmluZSBUWVBFX1ZFR0FfUExJQyAicmlzY3YudmVnYS5wbGljIgor
Cit0eXBlZGVmIHN0cnVjdCBWZWdhUExJQ1N0YXRlIFZlZ2FQTElDU3RhdGU7CitERUNMQVJFX0lO
U1RBTkNFX0NIRUNLRVIoVmVnYVBMSUNTdGF0ZSwgVkVHQV9QTElDLAorICAgICAgICAgICAgICAg
ICAgICAgICAgIFRZUEVfVkVHQV9QTElDKQorCit0eXBlZGVmIGVudW0gUExJQ01vZGUgeworICAg
IFBMSUNNb2RlX1UsCisgICAgUExJQ01vZGVfUywKKyAgICBQTElDTW9kZV9NCit9IFBMSUNNb2Rl
OworCit0eXBlZGVmIHN0cnVjdCBQTElDQWRkciB7CisgICAgdWludDMyX3QgYWRkcmlkOworICAg
IHVpbnQzMl90IGhhcnRpZDsKKyAgICBQTElDTW9kZSBtb2RlOworfSBQTElDQWRkcjsKKworc3Ry
dWN0IFZlZ2FQTElDU3RhdGUgeworICAgIC8qPCBwcml2YXRlID4qLworICAgIFN5c0J1c0Rldmlj
ZSBwYXJlbnRfb2JqOworCisgICAgLyo8IHB1YmxpYyA+Ki8KKyAgICBNZW1vcnlSZWdpb24gbW1p
bzsKKyAgICB1aW50MzJfdCBudW1fYWRkcnM7CisgICAgdWludDMyX3QgbnVtX2hhcnRzOworICAg
IHVpbnQzMl90IGJpdGZpZWxkX3dvcmRzOworICAgIHVpbnQzMl90IG51bV9lbmFibGVzOworICAg
IFBMSUNBZGRyICphZGRyX2NvbmZpZzsKKyAgICB1aW50MzJfdCAqc291cmNlX3ByaW9yaXR5Owor
ICAgIHVpbnQzMl90ICp0YXJnZXRfcHJpb3JpdHk7CisgICAgdWludDMyX3QgKnBlbmRpbmc7Cisg
ICAgdWludDMyX3QgKmNsYWltZWQ7CisgICAgdWludDMyX3QgKmVuYWJsZTsKKworICAgIC8qIGNv
bmZpZyAqLworICAgIGNoYXIgKmhhcnRfY29uZmlnOworICAgIHVpbnQzMl90IGhhcnRpZF9iYXNl
OworICAgIHVpbnQzMl90IG51bV9zb3VyY2VzOworICAgIHVpbnQzMl90IG51bV9wcmlvcml0aWVz
OworICAgIHVpbnQzMl90IHByaW9yaXR5X2Jhc2U7CisgICAgdWludDMyX3QgcGVuZGluZ19iYXNl
OworICAgIHVpbnQzMl90IGVuYWJsZV9iYXNlOworICAgIHVpbnQzMl90IGVuYWJsZV9zdHJpZGU7
CisgICAgdWludDMyX3QgY29udGV4dF9iYXNlOworICAgIHVpbnQzMl90IGNvbnRleHRfc3RyaWRl
OworICAgIHVpbnQzMl90IGFwZXJ0dXJlX3NpemU7CisKKyAgICBxZW11X2lycSAqbV9leHRlcm5h
bF9pcnFzOworICAgIHFlbXVfaXJxICpzX2V4dGVybmFsX2lycXM7Cit9OworCitEZXZpY2VTdGF0
ZSAqdmVnYV9wbGljX2NyZWF0ZShod2FkZHIgYWRkciwgY2hhciAqaGFydF9jb25maWcsCisgICAg
dWludDMyX3QgbnVtX2hhcnRzLAorICAgIHVpbnQzMl90IGhhcnRpZF9iYXNlLCB1aW50MzJfdCBu
dW1fc291cmNlcywKKyAgICB1aW50MzJfdCBudW1fcHJpb3JpdGllcywgdWludDMyX3QgcHJpb3Jp
dHlfYmFzZSwKKyAgICB1aW50MzJfdCBwZW5kaW5nX2Jhc2UsIHVpbnQzMl90IGVuYWJsZV9iYXNl
LAorICAgIHVpbnQzMl90IGVuYWJsZV9zdHJpZGUsIHVpbnQzMl90IGNvbnRleHRfYmFzZSwKKyAg
ICB1aW50MzJfdCBjb250ZXh0X3N0cmlkZSwgdWludDMyX3QgYXBlcnR1cmVfc2l6ZSk7CisKKyNl
bmRpZgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9ody9yaXNjdi92ZWdhLmggYi9pbmNsdWRlL2h3L3Jp
c2N2L3ZlZ2EuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi4yZThmOTRk
YWE2Ci0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS9ody9yaXNjdi92ZWdhLmgKQEAgLTAsMCAr
MSwxNjYgQEAKKy8qCisgKiBRRU1VIFJJU0MtViBWZWdhIElPIG1hY2hpbmUgaW50ZXJmYWNlCisg
Ki8KKworI2lmbmRlZiBIV19SSVNDVl9WRUdBX0gKKyNkZWZpbmUgSFdfUklTQ1ZfVkVHQV9ICisK
KyNpbmNsdWRlICJody9ib2FyZHMuaCIKKyNpbmNsdWRlICJody9yaXNjdi9yaXNjdl9oYXJ0Lmgi
CisjaW5jbHVkZSAiaHcvc3lzYnVzLmgiCisjaW5jbHVkZSAiaHcvYmxvY2svZmxhc2guaCIKKyNp
bmNsdWRlICJody9pbnRjL3Jpc2N2X2ltc2ljLmgiCisKKyNkZWZpbmUgVkVHQV9DUFVTX01BWF9C
SVRTICAgICAgICAgICAgIDkKKyNkZWZpbmUgVkVHQV9DUFVTX01BWCAgICAgICAgICAgICAgICAg
ICgxIDw8IFZFR0FfQ1BVU19NQVhfQklUUykKKyNkZWZpbmUgVkVHQV9TT0NLRVRTX01BWF9CSVRT
ICAgICAgICAgIDIKKyNkZWZpbmUgVkVHQV9TT0NLRVRTX01BWCAgICAgICAgICAgICAgICgxIDw8
IFZFR0FfU09DS0VUU19NQVhfQklUUykKKworI2RlZmluZSBUWVBFX1JJU0NWX1ZFR0FfTUFDSElO
RSBNQUNISU5FX1RZUEVfTkFNRSgidmVnYSIpCit0eXBlZGVmIHN0cnVjdCBSSVNDVlZlZ2FTdGF0
ZSBSSVNDVlZlZ2FTdGF0ZTsKK0RFQ0xBUkVfSU5TVEFOQ0VfQ0hFQ0tFUihSSVNDVlZlZ2FTdGF0
ZSwgUklTQ1ZfVkVHQV9NQUNISU5FLAorICAgICAgICAgICAgICAgICAgICAgICAgIFRZUEVfUklT
Q1ZfVkVHQV9NQUNISU5FKQorCit0eXBlZGVmIGVudW0gUklTQ1ZWZWdhQUlBVHlwZSB7CisgICAg
VkVHQV9BSUFfVFlQRV9OT05FID0gMCwKKyAgICBWRUdBX0FJQV9UWVBFX0FQTElDLAorICAgIFZF
R0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMsCit9IFJJU0NWVmVnYUFJQVR5cGU7CisKK3N0cnVjdCBS
SVNDVlZlZ2FTdGF0ZSB7CisgICAgLyo8IHByaXZhdGUgPiovCisgICAgTWFjaGluZVN0YXRlIHBh
cmVudDsKKworICAgIC8qPCBwdWJsaWMgPiovCisgICAgTm90aWZpZXIgbWFjaGluZV9kb25lOwor
ICAgIERldmljZVN0YXRlICpwbGF0Zm9ybV9idXNfZGV2OworICAgIFJJU0NWSGFydEFycmF5U3Rh
dGUgc29jW1ZFR0FfU09DS0VUU19NQVhdOworICAgIERldmljZVN0YXRlICppcnFjaGlwW1ZFR0Ff
U09DS0VUU19NQVhdOworICAgIFBGbGFzaENGSTAxICpmbGFzaFsyXTsKKyAgICBGV0NmZ1N0YXRl
ICpmd19jZmc7CisKKyAgICBpbnQgZmR0X3NpemU7CisgICAgYm9vbCBoYXZlX2FjbGludDsKKyAg
ICBSSVNDVlZlZ2FBSUFUeXBlIGFpYV90eXBlOworICAgIGludCBhaWFfZ3Vlc3RzOworICAgIGNo
YXIgKm9lbV9pZDsKKyAgICBjaGFyICpvZW1fdGFibGVfaWQ7CisgICAgT25PZmZBdXRvIGFjcGk7
CisgICAgY29uc3QgTWVtTWFwRW50cnkgKm1lbW1hcDsKKyAgICBzdHJ1Y3QgR1BFWEhvc3QgKmdw
ZXhfaG9zdDsKKyAgICBPbk9mZkF1dG8gaW9tbXVfc3lzOworICAgIHVpbnQxNl90IHBjaV9pb21t
dV9iZGY7CisKKyAgICAvKkFsbG93IENMQSBjb25maWd1cmF0aW9uKi8KKyAgICBib29sIGJhcmVt
ZXRhbF9tb2RlOyAvKlRvIGVuYWJsZSByZWdpc3RlciBzaGlmdCBpbiBVQVJUKi8KKyAgICB1aW50
NjRfdCBkcmFtX2Jhc2U7ICAgLyogQ3VzdG9tIGNvbmZpZ3VyYWJsZSBEUkFNIGJhc2UgKi8KK307
CisKK2VudW0geworICAgIFZFR0FfREVCVUcsCisgICAgVkVHQV9NUk9NLAorICAgIFZFR0FfVEVT
VCwKKyAgICBWRUdBX1JUQywKKyAgICBWRUdBX0NMSU5ULAorICAgIFZFR0FfQUNMSU5UX1NTV0ks
CisgICAgVkVHQV9QTElDX0lELAorICAgIFZFR0FfQVBMSUNfTSwKKyAgICBWRUdBX0FQTElDX1Ms
CisgICAgVkVHQV9VQVJUMCwKKyAgICBWRUdBX1ZJUlRJTywKKyAgICBWRUdBX0ZXX0NGRywKKyAg
ICBWRUdBX0lNU0lDX00sCisgICAgVkVHQV9JTVNJQ19TLAorICAgIFZFR0FfRkxBU0gsCisgICAg
VkVHQV9EUkFNLAorICAgIFZFR0FfUENJRV9NTUlPLAorICAgIFZFR0FfVUFSVDEsCisgICAgVkVH
QV9VQVJUMiwKKyAgICBWRUdBX1VBUlQzLAorICAgIFZFR0FfVUFSVDQsCisgICAgVkVHQV9TUEkw
LAorICAgIFZFR0FfU1BJMSwKKyAgICBWRUdBX0lJQzAsCisgICAgVkVHQV9JSUMxLAorICAgIFZF
R0FfUENJRV9QSU8sCisgICAgVkVHQV9QTEFURk9STV9CVVMsCisgICAgVkVHQV9QQ0lFX0VDQU0s
CisgICAgVkVHQV9JT01NVV9TWVMsCit9OworCitlbnVtIHsKKyAgICBVQVJUMF9JUlEgPSAxMCwK
KyAgICBVQVJUMV9JUlEgPSAxMCwKKyAgICBVQVJUMl9JUlEgPSAxMCwKKyAgICBVQVJUM19JUlEg
PSAxMCwKKyAgICBVQVJUNF9JUlEgPSAxMCwKKyAgICBSVENfSVJRID0gMTEsCisgICAgVklSVElP
X0lSUSA9IDEsIC8qIDEgdG8gOCAqLworICAgIFZJUlRJT19DT1VOVCA9IDgsCisgICAgUENJRV9J
UlEgPSAweDIwLCAvKiAzMiB0byAzNSAqLworICAgIElPTU1VX1NZU19JUlEgPSAweDI0LCAvKiAz
Ni0zOSAqLworICAgIFZJUlRfUExBVEZPUk1fQlVTX0lSUSA9IDY0LCAvKiA2NCB0byA5NSAqLwor
fTsKKworI2RlZmluZSBWRUdBX1BMQVRGT1JNX0JVU19OVU1fSVJRUyAzMgorCisjZGVmaW5lIFZF
R0FfSVJRQ0hJUF9OVU1fTVNJUyAyNTUKKyNkZWZpbmUgVkVHQV9JUlFDSElQX05VTV9TT1VSQ0VT
IDk2CisjZGVmaW5lIFZFR0FfSVJRQ0hJUF9OVU1fUFJJT19CSVRTIDQgICAvLyBDaGFuZ2VkIGZv
ciBDREFDCisjZGVmaW5lIFZFR0FfSVJRQ0hJUF9NQVhfR1VFU1RTX0JJVFMgMworI2RlZmluZSBW
RUdBX0lSUUNISVBfTUFYX0dVRVNUUyAoKDFVIDw8IFZFR0FfSVJRQ0hJUF9NQVhfR1VFU1RTX0JJ
VFMpIC0gMVUpCisKKyNkZWZpbmUgVkVHQV9QTElDX1BSSU9SSVRZX0JBU0UgMHgwMAorI2RlZmlu
ZSBWRUdBX1BMSUNfUEVORElOR19CQVNFIDB4ODAKKyNkZWZpbmUgVkVHQV9QTElDX0VOQUJMRV9C
QVNFIDB4MTIwCisjZGVmaW5lIFZFR0FfUExJQ19FTkFCTEVfU1RSSURFIDB4NDAKKyNkZWZpbmUg
VkVHQV9QTElDX0NPTlRFWFRfQkFTRSAweDMxMAorI2RlZmluZSBWRUdBX1BMSUNfQ09OVEVYVF9T
VFJJREUgMHgxMAorCisKKyNkZWZpbmUgVkVHQV9QTElDX1NJWkUoX19udW1fY29udGV4dCkgXAor
ICAgIChWRUdBX1BMSUNfQ09OVEVYVF9CQVNFICsgKF9fbnVtX2NvbnRleHQpICogVkVHQV9QTElD
X0NPTlRFWFRfU1RSSURFKQorCisjZGVmaW5lIEZEVF9QQ0lfQUREUl9DRUxMUyAgICAzCisjZGVm
aW5lIEZEVF9QQ0lfSU5UX0NFTExTICAgICAxCisjZGVmaW5lIEZEVF9QTElDX0FERFJfQ0VMTFMg
ICAwCisjZGVmaW5lIEZEVF9QTElDX0lOVF9DRUxMUyAgICAxCisjZGVmaW5lIEZEVF9BUExJQ19J
TlRfQ0VMTFMgICAyCisjZGVmaW5lIEZEVF9BUExJQ19BRERSX0NFTExTICAwCisjZGVmaW5lIEZE
VF9JTVNJQ19JTlRfQ0VMTFMgICAwCisjZGVmaW5lIEZEVF9NQVhfSU5UX0NFTExTICAgICAyCisj
ZGVmaW5lIEZEVF9NQVhfSU5UX01BUF9XSURUSCAoRkRUX1BDSV9BRERSX0NFTExTICsgRkRUX1BD
SV9JTlRfQ0VMTFMgKyBcCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxICsgRkRU
X01BWF9JTlRfQ0VMTFMpCisjZGVmaW5lIEZEVF9QTElDX0lOVF9NQVBfV0lEVEggIChGRFRfUENJ
X0FERFJfQ0VMTFMgKyBGRFRfUENJX0lOVF9DRUxMUyArIFwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIDEgKyBGRFRfUExJQ19JTlRfQ0VMTFMpCisjZGVmaW5lIEZEVF9BUExJQ19J
TlRfTUFQX1dJRFRIIChGRFRfUENJX0FERFJfQ0VMTFMgKyBGRFRfUENJX0lOVF9DRUxMUyArIFwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgKyBGRFRfQVBMSUNfSU5UX0NFTExT
KQorCitib29sIHZlZ2FfaXNfYWNwaV9lbmFibGVkKFJJU0NWVmVnYVN0YXRlICpzKTsKK2Jvb2wg
dmVnYV9pc19pb21tdV9zeXNfZW5hYmxlZChSSVNDVlZlZ2FTdGF0ZSAqcyk7Cit2b2lkIHZpcnRf
YWNwaV9zZXR1cChSSVNDVlZlZ2FTdGF0ZSAqdm1zKTsKK3VpbnQzMl90IGltc2ljX251bV9iaXRz
X3ZlZ2EodWludDMyX3QgY291bnQpOworCisvKgorICogVGhlIHZlZ2EgbWFjaGluZSBwaHlzaWNh
bCBhZGRyZXNzIHNwYWNlIHVzZWQgYnkgc29tZSBvZiB0aGUgZGV2aWNlcworICogbmFtZWx5IEFD
TElOVCwgUExJQywgQVBMSUMsIGFuZCBJTVNJQyBkZXBlbmQgb24gbnVtYmVyIG9mIFNvY2tldHMs
CisgKiBudW1iZXIgb2YgQ1BVcywgYW5kIG51bWJlciBvZiBJTVNJQyBndWVzdCBmaWxlcy4KKyAq
CisgKiBWYXJpb3VzIGxpbWl0cyBkZWZpbmVkIGJ5IFZFR0FfU09DS0VUU19NQVhfQklUUywgVkVH
QV9DUFVTX01BWF9CSVRTLAorICogYW5kIFZFR0FfSVJRQ0hJUF9NQVhfR1VFU1RTX0JJVFMgYXJl
IHR1bmVkIGZvciBtYXhpbXVtIHV0aWxpemF0aW9uCisgKiBvZiB2ZWdhIG1hY2hpbmUgcGh5c2lj
YWwgYWRkcmVzcyBzcGFjZS4KKyAqLworCisjZGVmaW5lIFZFR0FfSU1TSUNfR1JPVVBfTUFYX1NJ
WkUgICAgICAoMVUgPDwgSU1TSUNfTU1JT19HUk9VUF9NSU5fU0hJRlQpCisjaWYgVkVHQV9JTVNJ
Q19HUk9VUF9NQVhfU0laRSA8IFwKKyAgICBJTVNJQ19HUk9VUF9TSVpFKFZFR0FfQ1BVU19NQVhf
QklUUywgVkVHQV9JUlFDSElQX01BWF9HVUVTVFNfQklUUykKKyNlcnJvciAiQ2FuJ3QgYWNjb21t
b2RhdGUgc2luZ2xlIElNU0lDIGdyb3VwIGluIGFkZHJlc3Mgc3BhY2UiCisjZW5kaWYKKworI2Rl
ZmluZSBWRUdBX0lNU0lDX01BWF9TSVpFICAgICAgICAgICAgKFZFR0FfU09DS0VUU19NQVggKiBc
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9JTVNJQ19HUk9V
UF9NQVhfU0laRSkKKyNpZiAweDQwMDAwMDAgPCBWRUdBX0lNU0lDX01BWF9TSVpFCisjZXJyb3Ig
IkNhbid0IGFjY29tbW9kYXRlIGFsbCBJTVNJQyBncm91cHMgaW4gYWRkcmVzcyBzcGFjZSIKKyNl
bmRpZgorCisjZW5kaWYKLS0gCjIuNDMuMAoK
--0000000000002aa26f0642483da3--

