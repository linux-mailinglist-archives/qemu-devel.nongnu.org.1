Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 8530775216C
	for <lists+qemu-devel@lfdr.de>; Thu, 13 Jul 2023 14:43:53 +0200 (CEST)
Received: from localhost ([::1] helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces@nongnu.org>)
	id 1qJvef-0004WG-E4; Thu, 13 Jul 2023 08:42:45 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10])
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <maz@kernel.org>) id 1qJvec-0004W4-NU
 for qemu-devel@nongnu.org; Thu, 13 Jul 2023 08:42:42 -0400
Received: from dfw.source.kernel.org ([139.178.84.217])
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <maz@kernel.org>) id 1qJveM-0007vk-JE
 for qemu-devel@nongnu.org; Thu, 13 Jul 2023 08:42:40 -0400
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature RSA-PSS (2048 bits))
 (No client certificate requested)
 by dfw.source.kernel.org (Postfix) with ESMTPS id 5C9DD6108A;
 Thu, 13 Jul 2023 12:42:22 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id ADDD8C433C8;
 Thu, 13 Jul 2023 12:42:21 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1689252141;
 bh=odxW8f+rh484Mr9UsgzP2u4vFb2E1ABK9CswTNOq7mc=;
 h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
 b=dMwmw4O+zUu792nCbi+OxlevFQpPdgqQ/6zLEysHzcZTBWf97bigLwo0E0UMg24s0
 yzCt41kLb5aMcY/8wtqiq0bRNcsoihIM7F+MQXJiGsY3DcCAz87t/L9pPMkZqxZ23B
 rAeOx5tjJztXRyYFe3P2eJLfefifDQ7WATXuSBQdDiR2PGWthwLV0lgzeaVXDBYFqI
 r0POVYEDfR/18Z8g3LzTIzG3kuMpz8CVVBqgyyQ2uaIFbqqX4lglMms7CvzU1Mxt+1
 has0WBjApo7PlBLAQeGke1icbqezIJHhw/4B7o1eoh0mADbqxPWehHkaoPlwij2KZ2
 lHt4cYY+3Ygmg==
Received: from sofa.misterjones.org ([185.219.108.64]
 helo=goblin-girl.misterjones.org)
 by disco-boy.misterjones.org with esmtpsa (TLS1.3) tls
 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (Exim 4.95)
 (envelope-from <maz@kernel.org>) id 1qJveF-00CnQ9-9R;
 Thu, 13 Jul 2023 13:42:19 +0100
Date: Thu, 13 Jul 2023 13:42:18 +0100
Message-ID: <86v8eougnp.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Kunkun Jiang <jiangkunkun@huawei.com>
Cc: Steven Sistare <steven.sistare@oracle.com>,<qemu-devel@nongnu.org>,
 Paolo Bonzini <pbonzini@redhat.com>,	Stefan Hajnoczi <stefanha@redhat.com>,
 =?UTF-8?B?TWFyYy1BbmRyw6k=?= Lureau <marcandre.lureau@redhat.com>,	Alex
 =?UTF-8?B?QmVubsOpZQ==?= <alex.bennee@linaro.org>,	"Dr. David Alan Gilbert"
 <dgilbert@redhat.com>,	"Michael S. Tsirkin" <mst@redhat.com>,	Marcel
 Apfelbaum <marcel.apfelbaum@gmail.com>,	Alex Williamson
 <alex.williamson@redhat.com>,	"Daniel P. Berrange" <berrange@redhat.com>,
 Juan Quintela <quintela@redhat.com>,	Markus Armbruster <armbru@redhat.com>,
 Eric Blake <eblake@redhat.com>,	Jason Zeng <jason.zeng@linux.intel.com>,
 Zheng Chuan <zhengchuan@huawei.com>,	Mark Kanda <mark.kanda@oracle.com>,
 Guoyi Tu <tugy@chinatelecom.cn>,	Peter Maydell <peter.maydell@linaro.org>,
 Philippe =?UTF-8?B?TWF0aGlldS1EYXVkw6k=?=
 <philippe.mathieu.daude@gmail.com>,	Igor Mammedov <imammedo@redhat.com>,
 David Hildenbrand <david@redhat.com>,	John Snow <jsnow@redhat.com>,	Peng
 Liang <tcx4c70@gmail.com>,	"wanghaibin.wang@huawei.com"
 <wanghaibin.wang@huawei.com>,	Zenghui Yu <yuzenghui@huawei.com>,	Eric Auger
 <eric.auger@redhat.com>
Subject: Re: [PATCH V9 32/46] vfio-pci: cpr part 2 (msi)
In-Reply-To: <3f84f075-c9ac-c238-21b7-be8bcd6cdccc@huawei.com>
References: <1658851843-236870-1-git-send-email-steven.sistare@oracle.com>
 <1658851843-236870-33-git-send-email-steven.sistare@oracle.com>
 <8f79e5cb-aa6b-8bff-d0ec-f62fc929f669@huawei.com>
 <eafc9251-4b5c-d905-4e92-e6b02f3c2c56@oracle.com>
 <3f84f075-c9ac-c238-21b7-be8bcd6cdccc@huawei.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/28.2
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: jiangkunkun@huawei.com, steven.sistare@oracle.com,
 qemu-devel@nongnu.org, pbonzini@redhat.com, stefanha@redhat.com,
 marcandre.lureau@redhat.com, alex.bennee@linaro.org, dgilbert@redhat.com,
 mst@redhat.com, marcel.apfelbaum@gmail.com, alex.williamson@redhat.com,
 berrange@redhat.com, quintela@redhat.com, armbru@redhat.com, eblake@redhat.com,
 jason.zeng@linux.intel.com, zhengchuan@huawei.com, mark.kanda@oracle.com,
 tugy@chinatelecom.cn, peter.maydell@linaro.org,
 philippe.mathieu.daude@gmail.com, imammedo@redhat.com, david@redhat.com,
 jsnow@redhat.com, tcx4c70@gmail.com, wanghaibin.wang@huawei.com,
 yuzenghui@huawei.com, eric.auger@redhat.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org);
 SAEximRunCond expanded to false
Received-SPF: pass client-ip=139.178.84.217; envelope-from=maz@kernel.org;
 helo=dfw.source.kernel.org
X-Spam_score_int: -20
X-Spam_score: -2.1
X-Spam_bar: --
X-Spam_report: (-2.1 / 5.0 requ) BAYES_00=-1.9, DKIMWL_WL_HIGH=-0.001,
 DKIM_SIGNED=0.1, DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 SPF_HELO_NONE=0.001, SPF_PASS=-0.001,
 T_SCC_BODY_TEXT_LINE=-0.01 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org

On Thu, 13 Jul 2023 13:35:57 +0100,
Kunkun Jiang <jiangkunkun@huawei.com> wrote:
> 
> For ARM, it will first send a DISCARD command to ITS and then
> establish the interrupt reporting channel for GICv3. The DISCARD
> will remove the pending interrupt. Interrupts that come before
> channel re-establishment are silently discarded.  Do you guys have
> any good ideas?

I'm missing the context, but if you're worried about interrupts that
are lost between the DISCARD and the MAPTI commands, the only way to
solve the problem is to inject a spurious interrupt after the MAPTI
has taken place.

If it hurts, don't do that.

	M.

-- 
Without deviation from the norm, progress is not possible.

