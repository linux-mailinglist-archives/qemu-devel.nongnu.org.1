Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 313E3708930
	for <lists+qemu-devel@lfdr.de>; Thu, 18 May 2023 22:11:41 +0200 (CEST)
Received: from localhost ([::1] helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces@nongnu.org>)
	id 1pzjru-0000bl-R4; Thu, 18 May 2023 16:04:58 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10])
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <tsimpson@qualcomm.com>)
 id 1pzjri-0000DL-8n
 for qemu-devel@nongnu.org; Thu, 18 May 2023 16:04:48 -0400
Received: from mx0b-0031df01.pphosted.com ([205.220.180.131])
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <tsimpson@qualcomm.com>)
 id 1pzjrS-00058P-Uh
 for qemu-devel@nongnu.org; Thu, 18 May 2023 16:04:44 -0400
Received: from pps.filterd (m0279873.ppops.net [127.0.0.1])
 by mx0a-0031df01.pphosted.com (8.17.1.19/8.17.1.19) with ESMTP id
 34IFnFkc013274; Thu, 18 May 2023 20:04:19 GMT
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=quicinc.com;
 h=from : to : cc :
 subject : date : message-id : in-reply-to : references : mime-version :
 content-type : content-type : content-transfer-encoding; s=qcppdkim1;
 bh=2GF6pJCvorg02iRo5ULtdoiq3CwjQXhEBnBUq+kVWkM=;
 b=lKVqdUmlYpvLGcHubx5Q83ad+nKKxBhuOqoMSyaHJzabMcZMxG5r75Jj3QWaXByvXWna
 l8mUyHdlUXiDT8PY8T6wFji+s8ns9GMsFNMHEP4FRgNEjxnr10kYrHzrGkG4WEroiOSO
 m1nyNNm2tX+cZ75whL6sGzJxEJhE7qfsxbGLa7S7fiJtB8WMtpzzmYyVMMGIuJEifQHK
 xFYjPfGAWCGFEHsmGZxXIo5Oa+UUIVWFs1BMhhVt8QVgug+u1rq4n6JvcU8zWdz83rt+
 C66QQcsGuDHlo4beAapxDeVZ69AcGCUENmSJYCOv7WgmVOH3bLMjHG/Imr7SC055w3a1 JQ== 
Received: from nalasppmta05.qualcomm.com (Global_NAT1.qualcomm.com
 [129.46.96.20])
 by mx0a-0031df01.pphosted.com (PPS) with ESMTPS id 3qn8d2jex0-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT);
 Thu, 18 May 2023 20:04:19 +0000
Received: from pps.filterd (NALASPPMTA05.qualcomm.com [127.0.0.1])
 by NALASPPMTA05.qualcomm.com (8.17.1.5/8.17.1.5) with ESMTP id 34IK4HuG012813; 
 Thu, 18 May 2023 20:04:17 GMT
Received: from pps.reinject (localhost [127.0.0.1])
 by NALASPPMTA05.qualcomm.com (PPS) with ESMTPS id 3qj3mmta0j-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT);
 Thu, 18 May 2023 20:04:17 +0000
Received: from NALASPPMTA05.qualcomm.com (NALASPPMTA05.qualcomm.com
 [127.0.0.1])
 by pps.reinject (8.17.1.5/8.17.1.5) with ESMTP id 34IK1dhv008789;
 Thu, 18 May 2023 20:04:17 GMT
Received: from hu-devc-sd-u20-a-1.qualcomm.com (hu-tsimpson-lv.qualcomm.com
 [10.47.204.221])
 by NALASPPMTA05.qualcomm.com (PPS) with ESMTPS id 34IK4FK5012593
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT);
 Thu, 18 May 2023 20:04:17 +0000
Received: by hu-devc-sd-u20-a-1.qualcomm.com (Postfix, from userid 47164)
 id B90356E8; Thu, 18 May 2023 13:04:13 -0700 (PDT)
From: Taylor Simpson <tsimpson@quicinc.com>
To: qemu-devel@nongnu.org
Cc: tsimpson@quicinc.com, richard.henderson@linaro.org, philmd@linaro.org,
 peter.maydell@linaro.org, bcain@quicinc.com, quic_mathbern@quicinc.com,
 stefanha@redhat.com, ale@rev.ng, anjo@rev.ng, quic_mliebel@quicinc.com,
 =?UTF-8?q?Alex=20Benn=C3=A9e?= <alex.bennee@linaro.org>
Subject: [PULL v2 39/44] gdbstub: only send stop-reply packets when allowed to
Date: Thu, 18 May 2023 13:04:06 -0700
Message-Id: <20230518200411.271148-40-tsimpson@quicinc.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20230518200411.271148-1-tsimpson@quicinc.com>
References: <20230518200411.271148-1-tsimpson@quicinc.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
X-QCInternal: smtphost
X-QCInternal: smtphost
X-Proofpoint-Virus-Version: vendor=nai engine=6200 definitions=5800
 signatures=585085
X-Proofpoint-Virus-Version: vendor=nai engine=6200 definitions=5800
 signatures=585085
X-Proofpoint-ORIG-GUID: _tyCK4FA1NJpq9Zo00ZzBnJjGqJgKe5Y
X-Proofpoint-GUID: _tyCK4FA1NJpq9Zo00ZzBnJjGqJgKe5Y
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.254,Aquarius:18.0.957,Hydra:6.0.573,FMLib:17.11.170.22
 definitions=2023-05-18_15,2023-05-17_02,2023-02-09_01
X-Proofpoint-Spam-Details: rule=outbound_notspam policy=outbound score=0
 impostorscore=0 adultscore=0
 malwarescore=0 mlxlogscore=877 bulkscore=0 phishscore=0 spamscore=0
 suspectscore=0 clxscore=1015 mlxscore=0 priorityscore=1501
 lowpriorityscore=0 classifier=spam adjust=0 reason=mlx scancount=1
 engine=8.12.0-2304280000 definitions=main-2305180165
Received-SPF: pass client-ip=205.220.180.131;
 envelope-from=tsimpson@qualcomm.com; helo=mx0b-0031df01.pphosted.com
X-Spam_score_int: -17
X-Spam_score: -1.8
X-Spam_bar: -
X-Spam_report: (-1.8 / 5.0 requ) BAYES_00=-1.9, DKIM_SIGNED=0.1,
 DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, HEADER_FROM_DIFFERENT_DOMAINS=0.25,
 SPF_HELO_NONE=0.001, SPF_PASS=-0.001,
 T_SCC_BODY_TEXT_LINE=-0.01 autolearn=no autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org

RnJvbTogTWF0aGV1cyBUYXZhcmVzIEJlcm5hcmRpbm8gPHF1aWNfbWF0aGJlcm5AcXVpY2luYy5j
b20+CgpHREIncyByZW1vdGUgc2VyaWFsIHByb3RvY29sIGFsbG93cyBzdG9wLXJlcGx5IG1lc3Nh
Z2VzIHRvIGJlIHNlbnQgYnkKdGhlIHN0dWIgZWl0aGVyIGFzIGEgbm90aWZpY2F0aW9uIHBhY2tl
dCBvciBhcyBhIHJlcGx5IHRvIGEgR0RCIGNvbW1hbmQKKHByb3ZpZGVkIHRoYXQgdGhlIGNtZCBh
Y2NlcHRzIHN1Y2ggYSByZXNwb25zZSkuIFFFTVUgY3VycmVudGx5IGRvZXMgbm90CmltcGxlbWVu
dCBub3RpZmljYXRpb24gcGFja2V0cywgc28gaXQgc2hvdWxkIG9ubHkgc2VuZCBzdG9wLXJlcGxp
ZXMKc3luY2hyb25vdXNseSBhbmQgd2hlbiByZXF1ZXN0ZWQuIE5ldmVydGhlbGVzcywgaXQgc3Rp
bGwgaXNzdWVzCnVuc29saWNpdGVkIHN0b3AgbWVzc2FnZXMgdGhyb3VnaCBnZGJfdm1fc3RhdGVf
Y2hhbmdlKCkuCgpBbHRob3VnaCB0aGlzIGJlaGF2aW9yIGRvZXNuJ3Qgc2VlbSB0byBjYXVzZSBw
cm9ibGVtcyB3aXRoIEdEQiBpdHNlbGYKKHRoZSBtZXNzYWdlcyBhcmUganVzdCBpZ25vcmVkKSwg
aXQgY2FuIGltcGFjdCBvdGhlciBkZWJ1Z2dlcnMgdGhhdAppbXBsZW1lbnQgdGhlIEdEQiByZW1v
dGUgc2VyaWFsIHByb3RvY29sLCBsaWtlIGhleGFnb24tbGxkYi4gTGV0J3MKY2hhbmdlIHRoZSBn
ZGJzdHViIHRvIHNlbmQgc3RvcCBtZXNzYWdlcyBvbmx5IGFzIGEgcmVzcG9uc2UgdG8gYQpwcmV2
aW91cyBHREIgY29tbWFuZCB0aGF0IGFjY2VwdHMgc3VjaCBhIHJlcGx5LgoKU2lnbmVkLW9mZi1i
eTogTWF0aGV1cyBUYXZhcmVzIEJlcm5hcmRpbm8gPHF1aWNfbWF0aGJlcm5AcXVpY2luYy5jb20+
CkFja2VkLWJ5OiBBbGV4IEJlbm7DqWUgPGFsZXguYmVubmVlQGxpbmFyby5vcmc+ClNpZ25lZC1v
ZmYtYnk6IFRheWxvciBTaW1wc29uIDx0c2ltcHNvbkBxdWljaW5jLmNvbT4KTWVzc2FnZS1JZDog
PGE0OWMwODk3ZmMyMmE2YTc4MjdjOGRmYzMyYWVmMmUxZDkzM2VjNmIuMTY4MzIxNDM3NS5naXQu
cXVpY19tYXRoYmVybkBxdWljaW5jLmNvbT4KLS0tCiBnZGJzdHViL2ludGVybmFscy5oIHwgIDUg
KysrKysKIGdkYnN0dWIvZ2Ric3R1Yi5jICAgfCAzNyArKysrKysrKysrKysrKysrKysrKysrKysr
KysrLS0tLS0tLS0tCiBnZGJzdHViL3NvZnRtbXUuYyAgIHwgMTMgKysrKysrKysrKystLQogZ2Ri
c3R1Yi91c2VyLmMgICAgICB8IDI0ICsrKysrKysrKysrKysrKystLS0tLS0tLQogNCBmaWxlcyBj
aGFuZ2VkLCA2MCBpbnNlcnRpb25zKCspLCAxOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9n
ZGJzdHViL2ludGVybmFscy5oIGIvZ2Ric3R1Yi9pbnRlcm5hbHMuaAppbmRleCA5NGRkZmY0NDk1
Li4zM2QyMWQ2NDg4IDEwMDY0NAotLS0gYS9nZGJzdHViL2ludGVybmFscy5oCisrKyBiL2dkYnN0
dWIvaW50ZXJuYWxzLmgKQEAgLTY1LDYgKzY1LDExIEBAIHR5cGVkZWYgc3RydWN0IEdEQlN0YXRl
IHsKICAgICBHQnl0ZUFycmF5ICptZW1fYnVmOwogICAgIGludCBzc3RlcF9mbGFnczsKICAgICBp
bnQgc3VwcG9ydGVkX3NzdGVwX2ZsYWdzOworICAgIC8qCisgICAgICogV2hldGhlciB3ZSBhcmUg
YWxsb3dlZCB0byBzZW5kIGEgc3RvcCByZXBseSBwYWNrZXQgYXQgdGhpcyBtb21lbnQuCisgICAg
ICogTXVzdCBiZSBzZXQgb2ZmIGFmdGVyIHNlbmRpbmcgdGhlIHN0b3AgcmVwbHkgaXRzZWxmLgor
ICAgICAqLworICAgIGJvb2wgYWxsb3dfc3RvcF9yZXBseTsKIH0gR0RCU3RhdGU7CiAKIC8qIGxp
dmVzIGluIG1haW4gZ2Ric3R1Yi5jICovCmRpZmYgLS1naXQgYS9nZGJzdHViL2dkYnN0dWIuYyBi
L2dkYnN0dWIvZ2Ric3R1Yi5jCmluZGV4IDA3NjBkNzg2ODUuLmJlMTg1NjhkMGEgMTAwNjQ0Ci0t
LSBhL2dkYnN0dWIvZ2Ric3R1Yi5jCisrKyBiL2dkYnN0dWIvZ2Ric3R1Yi5jCkBAIC03NzcsNiAr
Nzc3LDEwIEBAIHR5cGVkZWYgdm9pZCAoKkdkYkNtZEhhbmRsZXIpKEdBcnJheSAqcGFyYW1zLCB2
b2lkICp1c2VyX2N0eCk7CiAvKgogICogY21kX3N0YXJ0c3dpdGggLT4gY21kIGlzIGNvbXBhcmVk
IHVzaW5nIHN0YXJ0c3dpdGgKICAqCisgKiBhbGxvd19zdG9wX3JlcGx5IC0+IHRydWUgaWZmIHRo
ZSBnZGJzdHViIGNhbiByZXNwb25kIHRvIHRoaXMgY29tbWFuZCB3aXRoIGEKKyAqICAgInN0b3Ag
cmVwbHkiIHBhY2tldC4gVGhlIGxpc3Qgb2YgY29tbWFuZHMgdGhhdCBhY2NlcHQgc3VjaCByZXNw
b25zZSBpcworICogICBkZWZpbmVkIGF0IHRoZSBHREIgUmVtb3RlIFNlcmlhbCBQcm90b2NvbCBk
b2N1bWVudGF0aW9uLiBzZWU6CisgKiAgIGh0dHBzOi8vc291cmNld2FyZS5vcmcvZ2RiL29ubGlu
ZWRvY3MvZ2RiL1N0b3AtUmVwbHktUGFja2V0cy5odG1sI1N0b3AtUmVwbHktUGFja2V0cy4KICAq
CiAgKiBzY2hlbWEgZGVmaW5pdGlvbnM6CiAgKiBFYWNoIHNjaGVtYSBwYXJhbWV0ZXIgZW50cnkg
Y29uc2lzdHMgb2YgMiBjaGFycywKQEAgLTgwMiw2ICs4MDYsNyBAQCB0eXBlZGVmIHN0cnVjdCBH
ZGJDbWRQYXJzZUVudHJ5IHsKICAgICBjb25zdCBjaGFyICpjbWQ7CiAgICAgYm9vbCBjbWRfc3Rh
cnRzd2l0aDsKICAgICBjb25zdCBjaGFyICpzY2hlbWE7CisgICAgYm9vbCBhbGxvd19zdG9wX3Jl
cGx5OwogfSBHZGJDbWRQYXJzZUVudHJ5OwogCiBzdGF0aWMgaW5saW5lIGludCBzdGFydHN3aXRo
KGNvbnN0IGNoYXIgKnN0cmluZywgY29uc3QgY2hhciAqcGF0dGVybikKQEAgLTgzNSw2ICs4NDAs
NyBAQCBzdGF0aWMgaW50IHByb2Nlc3Nfc3RyaW5nX2NtZCh2b2lkICp1c2VyX2N0eCwgY29uc3Qg
Y2hhciAqZGF0YSwKICAgICAgICAgICAgIH0KICAgICAgICAgfQogCisgICAgICAgIGdkYnNlcnZl
cl9zdGF0ZS5hbGxvd19zdG9wX3JlcGx5ID0gY21kLT5hbGxvd19zdG9wX3JlcGx5OwogICAgICAg
ICBjbWQtPmhhbmRsZXIocGFyYW1zLCB1c2VyX2N0eCk7CiAgICAgICAgIHJldHVybiAwOwogICAg
IH0KQEAgLTEyODMsMTEgKzEyODksMTQgQEAgc3RhdGljIHZvaWQgaGFuZGxlX3ZfYXR0YWNoKEdB
cnJheSAqcGFyYW1zLCB2b2lkICp1c2VyX2N0eCkKICAgICBnZGJzZXJ2ZXJfc3RhdGUuZ19jcHUg
PSBjcHU7CiAgICAgZ2Ric2VydmVyX3N0YXRlLmNfY3B1ID0gY3B1OwogCi0gICAgZ19zdHJpbmdf
cHJpbnRmKGdkYnNlcnZlcl9zdGF0ZS5zdHJfYnVmLCAiVCUwMnh0aHJlYWQ6IiwgR0RCX1NJR05B
TF9UUkFQKTsKLSAgICBnZGJfYXBwZW5kX3RocmVhZF9pZChjcHUsIGdkYnNlcnZlcl9zdGF0ZS5z
dHJfYnVmKTsKLSAgICBnX3N0cmluZ19hcHBlbmRfYyhnZGJzZXJ2ZXJfc3RhdGUuc3RyX2J1Ziwg
JzsnKTsKKyAgICBpZiAoZ2Ric2VydmVyX3N0YXRlLmFsbG93X3N0b3BfcmVwbHkpIHsKKyAgICAg
ICAgZ19zdHJpbmdfcHJpbnRmKGdkYnNlcnZlcl9zdGF0ZS5zdHJfYnVmLCAiVCUwMnh0aHJlYWQ6
IiwgR0RCX1NJR05BTF9UUkFQKTsKKyAgICAgICAgZ2RiX2FwcGVuZF90aHJlYWRfaWQoY3B1LCBn
ZGJzZXJ2ZXJfc3RhdGUuc3RyX2J1Zik7CisgICAgICAgIGdfc3RyaW5nX2FwcGVuZF9jKGdkYnNl
cnZlcl9zdGF0ZS5zdHJfYnVmLCAnOycpOworICAgICAgICBnZGJzZXJ2ZXJfc3RhdGUuYWxsb3df
c3RvcF9yZXBseSA9IGZhbHNlOwogY2xlYW51cDoKLSAgICBnZGJfcHV0X3N0cmJ1ZigpOworICAg
ICAgICBnZGJfcHV0X3N0cmJ1ZigpOworICAgIH0KIH0KIAogc3RhdGljIHZvaWQgaGFuZGxlX3Zf
a2lsbChHQXJyYXkgKnBhcmFtcywgdm9pZCAqdXNlcl9jdHgpCkBAIC0xMzEwLDEyICsxMzE5LDE0
IEBAIHN0YXRpYyBjb25zdCBHZGJDbWRQYXJzZUVudHJ5IGdkYl92X2NvbW1hbmRzX3RhYmxlW10g
PSB7CiAgICAgICAgIC5oYW5kbGVyID0gaGFuZGxlX3ZfY29udCwKICAgICAgICAgLmNtZCA9ICJD
b250IiwKICAgICAgICAgLmNtZF9zdGFydHN3aXRoID0gMSwKKyAgICAgICAgLmFsbG93X3N0b3Bf
cmVwbHkgPSB0cnVlLAogICAgICAgICAuc2NoZW1hID0gInMwIgogICAgIH0sCiAgICAgewogICAg
ICAgICAuaGFuZGxlciA9IGhhbmRsZV92X2F0dGFjaCwKICAgICAgICAgLmNtZCA9ICJBdHRhY2g7
IiwKICAgICAgICAgLmNtZF9zdGFydHN3aXRoID0gMSwKKyAgICAgICAgLmFsbG93X3N0b3BfcmVw
bHkgPSB0cnVlLAogICAgICAgICAuc2NoZW1hID0gImwwIgogICAgIH0sCiAgICAgewpAQCAtMTY5
OCwxMCArMTcwOSwxMyBAQCBzdGF0aWMgdm9pZCBoYW5kbGVfZ2VuX3NldChHQXJyYXkgKnBhcmFt
cywgdm9pZCAqdXNlcl9jdHgpCiAKIHN0YXRpYyB2b2lkIGhhbmRsZV90YXJnZXRfaGFsdChHQXJy
YXkgKnBhcmFtcywgdm9pZCAqdXNlcl9jdHgpCiB7Ci0gICAgZ19zdHJpbmdfcHJpbnRmKGdkYnNl
cnZlcl9zdGF0ZS5zdHJfYnVmLCAiVCUwMnh0aHJlYWQ6IiwgR0RCX1NJR05BTF9UUkFQKTsKLSAg
ICBnZGJfYXBwZW5kX3RocmVhZF9pZChnZGJzZXJ2ZXJfc3RhdGUuY19jcHUsIGdkYnNlcnZlcl9z
dGF0ZS5zdHJfYnVmKTsKLSAgICBnX3N0cmluZ19hcHBlbmRfYyhnZGJzZXJ2ZXJfc3RhdGUuc3Ry
X2J1ZiwgJzsnKTsKLSAgICBnZGJfcHV0X3N0cmJ1ZigpOworICAgIGlmIChnZGJzZXJ2ZXJfc3Rh
dGUuYWxsb3dfc3RvcF9yZXBseSkgeworICAgICAgICBnX3N0cmluZ19wcmludGYoZ2Ric2VydmVy
X3N0YXRlLnN0cl9idWYsICJUJTAyeHRocmVhZDoiLCBHREJfU0lHTkFMX1RSQVApOworICAgICAg
ICBnZGJfYXBwZW5kX3RocmVhZF9pZChnZGJzZXJ2ZXJfc3RhdGUuY19jcHUsIGdkYnNlcnZlcl9z
dGF0ZS5zdHJfYnVmKTsKKyAgICAgICAgZ19zdHJpbmdfYXBwZW5kX2MoZ2Ric2VydmVyX3N0YXRl
LnN0cl9idWYsICc7Jyk7CisgICAgICAgIGdkYl9wdXRfc3RyYnVmKCk7CisgICAgICAgIGdkYnNl
cnZlcl9zdGF0ZS5hbGxvd19zdG9wX3JlcGx5ID0gZmFsc2U7CisgICAgfQogICAgIC8qCiAgICAg
ICogUmVtb3ZlIGFsbCB0aGUgYnJlYWtwb2ludHMgd2hlbiB0aGlzIHF1ZXJ5IGlzIGlzc3VlZCwK
ICAgICAgKiBiZWNhdXNlIGdkYiBpcyBkb2luZyBhbiBpbml0aWFsIGNvbm5lY3QgYW5kIHRoZSBz
dGF0ZQpAQCAtMTcyNSw3ICsxNzM5LDggQEAgc3RhdGljIGludCBnZGJfaGFuZGxlX3BhY2tldChj
b25zdCBjaGFyICpsaW5lX2J1ZikKICAgICAgICAgICAgIHN0YXRpYyBjb25zdCBHZGJDbWRQYXJz
ZUVudHJ5IHRhcmdldF9oYWx0ZWRfY21kX2Rlc2MgPSB7CiAgICAgICAgICAgICAgICAgLmhhbmRs
ZXIgPSBoYW5kbGVfdGFyZ2V0X2hhbHQsCiAgICAgICAgICAgICAgICAgLmNtZCA9ICI/IiwKLSAg
ICAgICAgICAgICAgICAuY21kX3N0YXJ0c3dpdGggPSAxCisgICAgICAgICAgICAgICAgLmNtZF9z
dGFydHN3aXRoID0gMSwKKyAgICAgICAgICAgICAgICAuYWxsb3dfc3RvcF9yZXBseSA9IHRydWUs
CiAgICAgICAgICAgICB9OwogICAgICAgICAgICAgY21kX3BhcnNlciA9ICZ0YXJnZXRfaGFsdGVk
X2NtZF9kZXNjOwogICAgICAgICB9CkBAIC0xNzM2LDYgKzE3NTEsNyBAQCBzdGF0aWMgaW50IGdk
Yl9oYW5kbGVfcGFja2V0KGNvbnN0IGNoYXIgKmxpbmVfYnVmKQogICAgICAgICAgICAgICAgIC5o
YW5kbGVyID0gaGFuZGxlX2NvbnRpbnVlLAogICAgICAgICAgICAgICAgIC5jbWQgPSAiYyIsCiAg
ICAgICAgICAgICAgICAgLmNtZF9zdGFydHN3aXRoID0gMSwKKyAgICAgICAgICAgICAgICAuYWxs
b3dfc3RvcF9yZXBseSA9IHRydWUsCiAgICAgICAgICAgICAgICAgLnNjaGVtYSA9ICJMMCIKICAg
ICAgICAgICAgIH07CiAgICAgICAgICAgICBjbWRfcGFyc2VyID0gJmNvbnRpbnVlX2NtZF9kZXNj
OwpAQCAtMTc0Nyw2ICsxNzYzLDcgQEAgc3RhdGljIGludCBnZGJfaGFuZGxlX3BhY2tldChjb25z
dCBjaGFyICpsaW5lX2J1ZikKICAgICAgICAgICAgICAgICAuaGFuZGxlciA9IGhhbmRsZV9jb250
X3dpdGhfc2lnLAogICAgICAgICAgICAgICAgIC5jbWQgPSAiQyIsCiAgICAgICAgICAgICAgICAg
LmNtZF9zdGFydHN3aXRoID0gMSwKKyAgICAgICAgICAgICAgICAuYWxsb3dfc3RvcF9yZXBseSA9
IHRydWUsCiAgICAgICAgICAgICAgICAgLnNjaGVtYSA9ICJsMCIKICAgICAgICAgICAgIH07CiAg
ICAgICAgICAgICBjbWRfcGFyc2VyID0gJmNvbnRfd2l0aF9zaWdfY21kX2Rlc2M7CkBAIC0xNzg1
LDYgKzE4MDIsNyBAQCBzdGF0aWMgaW50IGdkYl9oYW5kbGVfcGFja2V0KGNvbnN0IGNoYXIgKmxp
bmVfYnVmKQogICAgICAgICAgICAgICAgIC5oYW5kbGVyID0gaGFuZGxlX3N0ZXAsCiAgICAgICAg
ICAgICAgICAgLmNtZCA9ICJzIiwKICAgICAgICAgICAgICAgICAuY21kX3N0YXJ0c3dpdGggPSAx
LAorICAgICAgICAgICAgICAgIC5hbGxvd19zdG9wX3JlcGx5ID0gdHJ1ZSwKICAgICAgICAgICAg
ICAgICAuc2NoZW1hID0gIkwwIgogICAgICAgICAgICAgfTsKICAgICAgICAgICAgIGNtZF9wYXJz
ZXIgPSAmc3RlcF9jbWRfZGVzYzsKQEAgLTE5NzYsNiArMTk5NCw3IEBAIHZvaWQgZ2RiX3JlYWRf
Ynl0ZSh1aW50OF90IGNoKQogewogICAgIHVpbnQ4X3QgcmVwbHk7CiAKKyAgICBnZGJzZXJ2ZXJf
c3RhdGUuYWxsb3dfc3RvcF9yZXBseSA9IGZhbHNlOwogI2lmbmRlZiBDT05GSUdfVVNFUl9PTkxZ
CiAgICAgaWYgKGdkYnNlcnZlcl9zdGF0ZS5sYXN0X3BhY2tldC0+bGVuKSB7CiAgICAgICAgIC8q
IFdhaXRpbmcgZm9yIGEgcmVzcG9uc2UgdG8gdGhlIGxhc3QgcGFja2V0LiAgSWYgd2Ugc2VlIHRo
ZSBzdGFydApkaWZmIC0tZ2l0IGEvZ2Ric3R1Yi9zb2Z0bW11LmMgYi9nZGJzdHViL3NvZnRtbXUu
YwppbmRleCAyMmVjZDA5ZDA0Li45OWQ5OTRlNmJmIDEwMDY0NAotLS0gYS9nZGJzdHViL3NvZnRt
bXUuYworKysgYi9nZGJzdHViL3NvZnRtbXUuYwpAQCAtNDMsNiArNDMsNyBAQCBzdGF0aWMgdm9p
ZCByZXNldF9nZGJzZXJ2ZXJfc3RhdGUodm9pZCkKICAgICBnX2ZyZWUoZ2Ric2VydmVyX3N0YXRl
LnByb2Nlc3Nlcyk7CiAgICAgZ2Ric2VydmVyX3N0YXRlLnByb2Nlc3NlcyA9IE5VTEw7CiAgICAg
Z2Ric2VydmVyX3N0YXRlLnByb2Nlc3NfbnVtID0gMDsKKyAgICBnZGJzZXJ2ZXJfc3RhdGUuYWxs
b3dfc3RvcF9yZXBseSA9IGZhbHNlOwogfQogCiAvKgpAQCAtMTM5LDYgKzE0MCwxMCBAQCBzdGF0
aWMgdm9pZCBnZGJfdm1fc3RhdGVfY2hhbmdlKHZvaWQgKm9wYXF1ZSwgYm9vbCBydW5uaW5nLCBS
dW5TdGF0ZSBzdGF0ZSkKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAorICAgIGlmICghZ2Ric2Vy
dmVyX3N0YXRlLmFsbG93X3N0b3BfcmVwbHkpIHsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKwog
ICAgIGdkYl9hcHBlbmRfdGhyZWFkX2lkKGNwdSwgdGlkKTsKIAogICAgIHN3aXRjaCAoc3RhdGUp
IHsKQEAgLTIwNSw2ICsyMTAsNyBAQCBzdGF0aWMgdm9pZCBnZGJfdm1fc3RhdGVfY2hhbmdlKHZv
aWQgKm9wYXF1ZSwgYm9vbCBydW5uaW5nLCBSdW5TdGF0ZSBzdGF0ZSkKIAogc2VuZF9wYWNrZXQ6
CiAgICAgZ2RiX3B1dF9wYWNrZXQoYnVmLT5zdHIpOworICAgIGdkYnNlcnZlcl9zdGF0ZS5hbGxv
d19zdG9wX3JlcGx5ID0gZmFsc2U7CiAKICAgICAvKiBkaXNhYmxlIHNpbmdsZSBzdGVwIGlmIGl0
IHdhcyBlbmFibGVkICovCiAgICAgY3B1X3NpbmdsZV9zdGVwKGNwdSwgMCk7CkBAIC00MjIsOCAr
NDI4LDExIEBAIHZvaWQgZ2RiX2V4aXQoaW50IGNvZGUpCiAKICAgICB0cmFjZV9nZGJzdHViX29w
X2V4aXRpbmcoKHVpbnQ4X3QpY29kZSk7CiAKLSAgICBzbnByaW50ZihidWYsIHNpemVvZihidWYp
LCAiVyUwMngiLCAodWludDhfdCljb2RlKTsKLSAgICBnZGJfcHV0X3BhY2tldChidWYpOworICAg
IGlmIChnZGJzZXJ2ZXJfc3RhdGUuYWxsb3dfc3RvcF9yZXBseSkgeworICAgICAgICBzbnByaW50
ZihidWYsIHNpemVvZihidWYpLCAiVyUwMngiLCAodWludDhfdCljb2RlKTsKKyAgICAgICAgZ2Ri
X3B1dF9wYWNrZXQoYnVmKTsKKyAgICAgICAgZ2Ric2VydmVyX3N0YXRlLmFsbG93X3N0b3BfcmVw
bHkgPSBmYWxzZTsKKyAgICB9CiAKICAgICBxZW11X2Nocl9mZV9kZWluaXQoJmdkYnNlcnZlcl9z
eXN0ZW1fc3RhdGUuY2hyLCB0cnVlKTsKIH0KZGlmZiAtLWdpdCBhL2dkYnN0dWIvdXNlci5jIGIv
Z2Ric3R1Yi91c2VyLmMKaW5kZXggODA0ODhiNmJiOS4uNWIzNzViZTFkOSAxMDA2NDQKLS0tIGEv
Z2Ric3R1Yi91c2VyLmMKKysrIGIvZ2Ric3R1Yi91c2VyLmMKQEAgLTEwOCw4ICsxMDgsMTEgQEAg
dm9pZCBnZGJfZXhpdChpbnQgY29kZSkKIAogICAgIHRyYWNlX2dkYnN0dWJfb3BfZXhpdGluZygo
dWludDhfdCljb2RlKTsKIAotICAgIHNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICJXJTAyeCIs
ICh1aW50OF90KWNvZGUpOwotICAgIGdkYl9wdXRfcGFja2V0KGJ1Zik7CisgICAgaWYgKGdkYnNl
cnZlcl9zdGF0ZS5hbGxvd19zdG9wX3JlcGx5KSB7CisgICAgICAgIHNucHJpbnRmKGJ1Ziwgc2l6
ZW9mKGJ1ZiksICJXJTAyeCIsICh1aW50OF90KWNvZGUpOworICAgICAgICBnZGJfcHV0X3BhY2tl
dChidWYpOworICAgICAgICBnZGJzZXJ2ZXJfc3RhdGUuYWxsb3dfc3RvcF9yZXBseSA9IGZhbHNl
OworICAgIH0KIH0KIAogaW50IGdkYl9oYW5kbGVzaWcoQ1BVU3RhdGUgKmNwdSwgaW50IHNpZykK
QEAgLTEyNywxMSArMTMwLDE0IEBAIGludCBnZGJfaGFuZGxlc2lnKENQVVN0YXRlICpjcHUsIGlu
dCBzaWcpCiAKICAgICBpZiAoc2lnICE9IDApIHsKICAgICAgICAgZ2RiX3NldF9zdG9wX2NwdShj
cHUpOwotICAgICAgICBnX3N0cmluZ19wcmludGYoZ2Ric2VydmVyX3N0YXRlLnN0cl9idWYsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAiVCUwMnh0aHJlYWQ6IiwgZ2RiX3RhcmdldF9zaWduYWxf
dG9fZ2RiKHNpZykpOwotICAgICAgICBnZGJfYXBwZW5kX3RocmVhZF9pZChjcHUsIGdkYnNlcnZl
cl9zdGF0ZS5zdHJfYnVmKTsKLSAgICAgICAgZ19zdHJpbmdfYXBwZW5kX2MoZ2Ric2VydmVyX3N0
YXRlLnN0cl9idWYsICc7Jyk7Ci0gICAgICAgIGdkYl9wdXRfc3RyYnVmKCk7CisgICAgICAgIGlm
IChnZGJzZXJ2ZXJfc3RhdGUuYWxsb3dfc3RvcF9yZXBseSkgeworICAgICAgICAgICAgZ19zdHJp
bmdfcHJpbnRmKGdkYnNlcnZlcl9zdGF0ZS5zdHJfYnVmLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICJUJTAyeHRocmVhZDoiLCBnZGJfdGFyZ2V0X3NpZ25hbF90b19nZGIoc2lnKSk7Cisg
ICAgICAgICAgICBnZGJfYXBwZW5kX3RocmVhZF9pZChjcHUsIGdkYnNlcnZlcl9zdGF0ZS5zdHJf
YnVmKTsKKyAgICAgICAgICAgIGdfc3RyaW5nX2FwcGVuZF9jKGdkYnNlcnZlcl9zdGF0ZS5zdHJf
YnVmLCAnOycpOworICAgICAgICAgICAgZ2RiX3B1dF9zdHJidWYoKTsKKyAgICAgICAgICAgIGdk
YnNlcnZlcl9zdGF0ZS5hbGxvd19zdG9wX3JlcGx5ID0gZmFsc2U7CisgICAgICAgIH0KICAgICB9
CiAgICAgLyoKICAgICAgKiBnZGJfcHV0X3BhY2tldCgpIG1pZ2h0IGhhdmUgZGV0ZWN0ZWQgdGhh
dCB0aGUgcGVlciB0ZXJtaW5hdGVkIHRoZQpAQCAtMTc0LDEyICsxODAsMTQgQEAgdm9pZCBnZGJf
c2lnbmFsbGVkKENQVUFyY2hTdGF0ZSAqZW52LCBpbnQgc2lnKQogewogICAgIGNoYXIgYnVmWzRd
OwogCi0gICAgaWYgKCFnZGJzZXJ2ZXJfc3RhdGUuaW5pdCB8fCBnZGJzZXJ2ZXJfdXNlcl9zdGF0
ZS5mZCA8IDApIHsKKyAgICBpZiAoIWdkYnNlcnZlcl9zdGF0ZS5pbml0IHx8IGdkYnNlcnZlcl91
c2VyX3N0YXRlLmZkIDwgMCB8fAorICAgICAgICAhZ2Ric2VydmVyX3N0YXRlLmFsbG93X3N0b3Bf
cmVwbHkpIHsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIHNucHJpbnRmKGJ1Ziwgc2l6
ZW9mKGJ1ZiksICJYJTAyeCIsIGdkYl90YXJnZXRfc2lnbmFsX3RvX2dkYihzaWcpKTsKICAgICBn
ZGJfcHV0X3BhY2tldChidWYpOworICAgIGdkYnNlcnZlcl9zdGF0ZS5hbGxvd19zdG9wX3JlcGx5
ID0gZmFsc2U7CiB9CiAKIHN0YXRpYyB2b2lkIGdkYl9hY2NlcHRfaW5pdChpbnQgZmQpCi0tIAoy
LjI1LjEKCg==

