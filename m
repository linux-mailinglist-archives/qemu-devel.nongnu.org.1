Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 0A9CCC1A71D
	for <lists+qemu-devel@lfdr.de>; Wed, 29 Oct 2025 13:59:12 +0100 (CET)
Received: from localhost ([::1] helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces@nongnu.org>)
	id 1vE5kk-0006ja-2m; Wed, 29 Oct 2025 08:58:17 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10])
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <karthika.b@cdac.in>)
 id 1vE1uV-0000SK-7F; Wed, 29 Oct 2025 04:52:03 -0400
Received: from mailsender.cdac.in ([196.1.113.117]
 helo=mailsender-core1.pune.cdac.in)
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <karthika.b@cdac.in>)
 id 1vE1uM-0001gN-9k; Wed, 29 Oct 2025 04:52:02 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=cdac.in; s=default;
 t=1761727888; bh=q7Fb/PFoeC02J6HE/hDaza53oGgikjCJ6xlU1apXDME=;
 h=Date:From:To:Cc:Subject:From;
 b=PXCGnq+1qy1x5tTmUlZCJmlmMNVdlEjaOxyZ23uPSUtP7lC6e2xfUOBzoO2XMmO2y
 EiIpoMo+yV0NMJCoWb6BZDxkl0V7WrV4XSwU3nKgVFWrWa31ldakl8ocx670fgTYUK
 9uKYEV0Ky7qH4zQp8fx5gVFNyXMi5fNukvbBYthA=
Received: from mscr-int2.pune.cdac.in (mscr-int2.pune.cdac.in [10.208.193.12])
 by mailsender.cdac.in (8.15.2/8.15.2/Debian-22ubuntu3) with ESMTP id
 59T8pSWZ2629658; Wed, 29 Oct 2025 14:21:28 +0530
Received: from mailgw-cip.pune.cdac.in (mscr-haproxy.pune.cdac.in
 [10.208.193.46])
 by mscr-int2.pune.cdac.in (Postfix) with ESMTP id 093601000720E;
 Wed, 29 Oct 2025 14:21:17 +0530 (IST)
Received: from webmail2 (unknown [10.208.193.8])
 by mailgw-cip.pune.cdac.in (Postfix) with ESMTPS id 020AD14E0412;
 Wed, 29 Oct 2025 14:21:17 +0530 (IST)
Date: Wed, 29 Oct 2025 14:20:09 +0530 (IST)
From: Karthika B <karthika.b@cdac.in>
To: "qemu-devel@nongnu.org" <qemu-devel@nongnu.org>
Cc: "qemu-riscv@nongnu.org" <qemu-riscv@nongnu.org>,
 "sreenadh@cdac.in" <sreenadh@cdac.in>, "raokk@cdac.in" <raokk@cdac.in>
Message-ID: <385625713.441366.1761727810206@webmail2.cdac.in>
Subject: [PATCH] RISC-V: Add Vega machine support for upstream QEMU
MIME-Version: 1.0
Content-Type: multipart/mixed; 
 boundary="----=_Part_441364_1251780791.1761727810203"
X-Priority: 3
Importance: Normal
X-Mailer: Open-Xchange Mailer v7.10.4-Rev30
X-Originating-Client: open-xchange-appsuite
X-CDAC-PUNE-MailScanner-Information: Please contact the ISP for more
 information
X-CDAC-PUNE-MailScanner-ID: 093601000720E.A5154
X-CDAC-PUNE-MailScanner: Found to be clean
X-CDAC-PUNE-MailScanner-SpamCheck: not spam, SpamAssassin (not cached,
 score=-0.199, required 6, autolearn=disabled, ALL_TRUSTED -1.00,
 BAYES_50 0.80, HTML_MESSAGE 0.00)
X-CDAC-PUNE-MailScanner-From: karthika.b@cdac.in
Received-SPF: pass client-ip=196.1.113.117; envelope-from=karthika.b@cdac.in;
 helo=mailsender-core1.pune.cdac.in
X-Spam_score_int: -4
X-Spam_score: -0.5
X-Spam_bar: /
X-Spam_report: (-0.5 / 5.0 requ) BAYES_00=-1.9, DKIM_SIGNED=0.1,
 DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 HTML_IMAGE_ONLY_24=1.618, HTML_MESSAGE=0.001,
 RCVD_IN_VALIDITY_CERTIFIED_BLOCKED=0.001, RCVD_IN_VALIDITY_RPBL_BLOCKED=0.001,
 SPF_HELO_NONE=0.001, SPF_PASS=-0.001 autolearn=no autolearn_force=no
X-Spam_action: no action
X-Mailman-Approved-At: Wed, 29 Oct 2025 08:57:47 -0400
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org

------=_Part_441364_1251780791.1761727810203
Content-Type: multipart/alternative; 
	boundary="----=_Part_441365_923824781.1761727810203"

------=_Part_441365_923824781.1761727810203
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit

Dear QEMU Maintainers,

This patch adds support for the Vega RISC-V machine model, developed as part
of the Vega multicore platform at C-DAC, Thiruvananthapuram.

The Vega machine includes:
- Multi-core CPU configuration
- PLIC and ACLINT interrupt controllers
- DRAM and MMIO memory mapping
- UART and Timer initialization

The Vega platform functionality was verified on the 64-bit QEMU build by:
- Successfully booting a Linux image using the Berkeley Boot Loader (BBL)
- Running bare-metal example programs from the Vega SDK

Signed-off-by: Karthika B <karthika.b@cdac.in>

---

For reference:
This patch submission is being sent to the official QEMU mailing list
(qemu-devel@nongnu.org, qemu-riscv@nongnu.org) as part of our effort to
upstream the Vega RISC-V machine model developed under the Microprocessor Development Programme.

Best regards,  
Karthika B 
Project Engineer, HDG
C-DAC, Thiruvananthapuram
------------------------------------------------------------------------------------------------------------
[ C-DAC is on Social-Media too. Kindly follow us at:
Facebook: https://www.facebook.com/CDACINDIA & Twitter: @cdacindia ]

This e-mail is for the sole use of the intended recipient(s) and may
contain confidential and privileged information. If you are not the
intended recipient, please contact the sender by reply e-mail and destroy
all copies and the original message. Any unauthorized review, use,
disclosure, dissemination, forwarding, printing or copying of this email
is strictly prohibited and appropriate legal action will be taken.
------------------------------------------------------------------------------------------------------------


------=_Part_441365_923824781.1761727810203
MIME-Version: 1.0
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: 7bit

<!doctype html>
<html>
 <head> 
  <meta charset="UTF-8"> 
 </head>
 <body>
  <div class="default-style">
   Dear QEMU Maintainers,
   <br>
   <br>This patch adds support for the Vega RISC-V machine model, developed as part
   <br>of the Vega multicore platform at C-DAC, Thiruvananthapuram.
   <br>
   <br>The Vega machine includes:
   <br>&nbsp;- Multi-core CPU configuration
   <br>&nbsp;- PLIC and ACLINT interrupt controllers
   <br>&nbsp;- DRAM and MMIO memory mapping
   <br>&nbsp;- UART and Timer initialization
   <br>
   <br>The Vega platform functionality was verified on the 64-bit QEMU build by:
   <br>- Successfully booting a Linux image using the Berkeley Boot Loader (BBL)
   <br>- Running bare-metal example programs from the Vega SDK
   <br>
   <br>Signed-off-by: Karthika B &lt;karthika.b@cdac.in&gt;
   <br>
   <br>---
   <br>
   <br>For reference:
   <br>This patch submission is being sent to the official QEMU mailing list
   <br>(qemu-devel@nongnu.org, qemu-riscv@nongnu.org) as part of our effort to
   <br>upstream the Vega RISC-V machine model developed under the Microprocessor Development Programme.
   <br>
   <br>Best regards, &nbsp;
   <br>Karthika B&nbsp;
   <br>Project Engineer, HDG
   <br>C-DAC, Thiruvananthapuram
  </div>
 <br />
<!-- <img src="cid:signature.jpeg">-->
<img src="https://pramani.cdac.in/signature.jpg">
<br />
<br />------------------------------------------------------------------------------------------------------------
<br />[ C-DAC is on Social-Media too. Kindly follow us at:
<br />Facebook: https://www.facebook.com/CDACINDIA & Twitter: @cdacindia ]
<br />
<br />This e-mail is for the sole use of the intended recipient(s) and may
<br />contain confidential and privileged information. If you are not the
<br />intended recipient, please contact the sender by reply e-mail and destroy
<br />all copies and the original message. Any unauthorized review, use,
<br />disclosure, dissemination, forwarding, printing or copying of this email
<br />is strictly prohibited and appropriate legal action will be taken.
<br />------------------------------------------------------------------------------------------------------------

</body>
</html>

------=_Part_441365_923824781.1761727810203--

------=_Part_441364_1251780791.1761727810203
Content-Type: text/x-patch; charset=ISO-8859-1;
 name=0001-riscv-Add-Vega-board-support.patch
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename=0001-riscv-Add-Vega-board-support.patch
X-Part-Id: 246dd5d34a094eddb7bc3502922232dc

RnJvbSBjODIxOGE3ZmM3MjdiMzBmNDU1MTZmZmUyYmFlZWE4MTlhOWQ1ZGYz
IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBLYXJ0aGlrYSBCIDxr
YXJ0aGlrYS5iQGNkYWMuaW4+CkRhdGU6IFRodSwgMjMgT2N0IDIwMjUgMTU6
MDc6NTcgKzA1MzAKU3ViamVjdDogW1BBVENIXSByaXNjdjogQWRkIFZlZ2Eg
Ym9hcmQgc3VwcG9ydAoKVGhpcyBwYXRjaCBhZGRzIHN1cHBvcnQgZm9yIHRo
ZSBWZWdhIFJJU0MtViBtYWNoaW5lIG1vZGVsLgoKVGhlIFZlZ2EgbWFjaGlu
ZSBpbmNsdWRlczoKIC0gTXVsdGktY29yZSBDUFUgY29uZmlndXJhdGlvbgog
LSBQTElDIGFuZCBBQ0xJTlQgaW50ZXJydXB0IGNvbnRyb2xsZXJzCiAtIERS
QU0gYW5kIE1NSU8gbWVtb3J5IG1hcHBpbmcKIC0gVUFSVCBhbmQgdGltZXIg
aW5pdGlhbGl6YXRpb24KClRoZSBWZWdhIHBsYXRmb3JtIHdhcyB2ZXJpZmll
ZCB0byBib290IFZlZ2EgU0RLIGltYWdlcwpzdWNjZXNzZnVsbHkgb24gYm90
aCAzMi1iaXQgYW5kIDY0LWJpdCBRRU1VIGJ1aWxkcy4KClNpZ25lZC1vZmYt
Ynk6IEthcnRoaWthIEIgPGthcnRoaWthLmJAY2RhYy5pbj4KLS0tCiBSRUFE
TUUubWQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICA1
NSArCiBjb25maWdzL2RldmljZXMvcmlzY3Y2NC1zb2Z0bW11L2RlZmF1bHQu
bWFrIHwgICAgMSArCiBody9pbnRjL0tjb25maWcgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHwgICAgNyArCiBody9pbnRjL21lc29uLmJ1aWxkICAg
ICAgICAgICAgICAgICAgICAgICAgIHwgICAgMiArCiBody9pbnRjL3ZlZ2Ff
YWNsaW50LmMgICAgICAgICAgICAgICAgICAgICAgIHwgIDU1MSArKysrKwog
aHcvaW50Yy92ZWdhX3BsaWMuYyAgICAgICAgICAgICAgICAgICAgICAgICB8
ICA0OTYgKysrKysKIGh3L3Jpc2N2L0tjb25maWcgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgfCAgIDI4ICsKIGh3L3Jpc2N2L21lc29uLmJ1aWxkICAg
ICAgICAgICAgICAgICAgICAgICAgfCAgICAxICsKIGh3L3Jpc2N2L3ZlZ2Eu
YyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAyMDc2ICsrKysrKysr
KysrKysrKysrKysKIGluY2x1ZGUvaHcvaW50Yy92ZWdhX2FjbGludC5oICAg
ICAgICAgICAgICAgfCAgIDY3ICsKIGluY2x1ZGUvaHcvaW50Yy92ZWdhX3Bs
aWMuaCAgICAgICAgICAgICAgICAgfCAgIDcwICsKIGluY2x1ZGUvaHcvcmlz
Y3YvdmVnYS5oICAgICAgICAgICAgICAgICAgICAgfCAgMTY2ICsrCiAxMiBm
aWxlcyBjaGFuZ2VkLCAzNTIwIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2Rl
IDEwMDY0NCBSRUFETUUubWQKIGNyZWF0ZSBtb2RlIDEwMDY0NCBody9pbnRj
L3ZlZ2FfYWNsaW50LmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBody9pbnRjL3Zl
Z2FfcGxpYy5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgaHcvcmlzY3YvdmVnYS5j
CiBjcmVhdGUgbW9kZSAxMDA2NDQgaW5jbHVkZS9ody9pbnRjL3ZlZ2FfYWNs
aW50LmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNsdWRlL2h3L2ludGMvdmVn
YV9wbGljLmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNsdWRlL2h3L3Jpc2N2
L3ZlZ2EuaAoKZGlmZiAtLWdpdCBhL1JFQURNRS5tZCBiL1JFQURNRS5tZApu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi5lZTlmYjM3
MDdiCi0tLSAvZGV2L251bGwKKysrIGIvUkVBRE1FLm1kCkBAIC0wLDAgKzEs
NTUgQEAKKyMgUUVNVSBmb3IgVmVnYSBNYWNoaW5lCis9PT09PT09PT09PT09
PT09PT09PT09PT09CisKK1RoaXMgaXMgYSBjdXN0b20gUUVNVSBmb3JrIGZv
ciBzaW11bGF0aW5nIHRoZSBSSVNDLVYgVmVnYSBtdWx0aWNvcmUgcGxhdGZv
cm0uCisKKyMjIEZlYXR1cmVzCis9PT09PT09PT09PT0KKy0gQ3VzdG9tIGB2
ZWdhYCBtYWNoaW5lIHdpdGggbXVsdGktaGFydCBzdXBwb3J0CistIFN1cHBv
cnQgZm9yIGJhcmUtbWV0YWwgYW5kIExpbnV4IGtlcm5lbCBib290CistIEN1
c3RvbSBBQ0xJTlQgYW5kIFBMSUMgaW50ZWdyYXRpb24KKy0gYC1NIHZlZ2Es
YmFyZW1ldGFsPW9uYCBydW50aW1lIG9wdGlvbiBmb3Igc2VsZWN0aW5nIFVB
UlQgSVJRCistICBkcmFtLWJhc2U9MHgwIHJ1bnRpbWUgb3B0aW9uIGZvciBk
cmFtIGJhc2UgYWRkcmVzcworCisjIyBVc2FnZQorPT09PT09PT0KKworI0J1
aWxkIFFFTVUgZm9yIDY0LWJpdCBzeXN0ZW0KKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tCisuL2NvbmZpZ3VyZSAtLXRhcmdldC1saXN0PXJpc2N2
NjQtc29mdG1tdQorbWFrZQorCisjRk9SIEJBUkUgTUVUQUwgUFJPR1JBTSBA
RFJBTV9CQVNFIDBYODAwMDAwMDAKKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tCisuL2J1aWxkL3FlbXUtc3lzdGVtLXJp
c2N2NjQgLU0gdmVnYSxkcmFtLWJhc2U9MHg4MDAwMDAwMCxiYXJlbWV0YWwt
bW9kZT1vbiAtc21wIDEgLW0gMkcgLWtlcm5lbCBzcGlrZWRiZ184YyAtYmlv
cyBub25lIC1kaXNwbGF5IG5vbmUgLXNlcmlhbCBzdGRpbworCisjRk9SIEJB
UkUgTUVUQUwgUFJPR1JBTSBARFJBTV9CQVNFIDBYNDAwMDAwMDAwCistLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKy4v
YnVpbGQvcWVtdS1zeXN0ZW0tcmlzY3Y2NCAtTSB2ZWdhLGRyYW0tYmFzZT0w
eDQwMDAwMDAwMCxiYXJlbWV0YWwtbW9kZT1vbiAtc21wIDEgLW0gMkcgLWtl
cm5lbCBzcGlrZWRiZ180MGMgLWJpb3Mgbm9uZSAtZGlzcGxheSBub25lIC1z
ZXJpYWwgc3RkaW8KKworI0ZPUiBCT09USU5HIExJTlVYKGJibCkgQERSQU1f
QkFTRSAwWDgwMDAwMDAwCistLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLQorLi9idWlsZC9xZW11LXN5c3RlbS1yaXNjdjY0
IC1NIHZlZ2EsZHJhbS1iYXNlPTB4ODAwMDAwMDAgIC1zbXAgNCAtbSAyRyAg
ICAgLWRpc3BsYXkgbm9uZSAtc2VyaWFsIHN0ZGlvICAgICAtYmlvcyBub25l
IC1rZXJuZWwgYmJsXzhjICAgICAtaW5pdHJkIHJvb3Rmcy5jcGlvICAgICAt
YXBwZW5kICJyb290PS9kZXYvcmFtIiAtY3B1IHJ2YTIzczY0CisKKyNGT1Ig
Qk9PVElORyBMSU5VWChiYmwpIEBEUkFNX0JBU0UgMFg0MDAwMDAwMDAKKy0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQor
Li9idWlsZC9xZW11LXN5c3RlbS1yaXNjdjY0IC1NIHZlZ2EsZHJhbS1iYXNl
PTB4NDAwMDAwMDAwICAtc21wIDQgLW0gMkcgICAgIC1kaXNwbGF5IG5vbmUg
LXNlcmlhbCBzdGRpbyAgICAgLWJpb3Mgbm9uZSAta2VybmVsIGJibF80MGMg
ICAgIC1pbml0cmQgcm9vdGZzLmNwaW8gICAgIC1hcHBlbmQgInJvb3Q9L2Rl
di9yYW0iIC1jcHUgcnZhMjNzNjQKKworIyNGT1IgQk9PVElORyBVLUJPT1Qg
KDIwMjUuMDcpIEBEUkFNX0JBU0UgMFg4MDAwMDAwMAorLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorLi9i
dWlsZF82NC9xZW11LXN5c3RlbS1yaXNjdjY0IC1NIHZlZ2EsYmFyZW1ldGFs
LW1vZGU9b24sZHJhbS1iYXNlPTB4ODAwMDAwMDAgLXNtcCAxIC1tIDJHIC1r
ZXJuZWwgZndfcGF5bG9hZC5lbGYgLWJpb3Mgbm9uZSAtZGlzcGxheSBub25l
IC1zZXJpYWwgc3RkaW8gLWNwdSBydmEyM3M2NAorCisKKyNCdWlsZCBRRU1V
IGZvciAzMi1iaXQgc3lzdGVtCistLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tCisuL2NvbmZpZ3VyZSAtLXRhcmdldC1saXN0PXJpc2N2MzItc29mdG1t
dQorbWFrZQorCisjRk9SIEJBUkUgTUVUQUwgUFJPR1JBTSBARFJBTV9CQVNF
IDB4MjAwMDAwIChGT1IgQVJJRVMpCistLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKy4vYnVpbGQvcWVt
dS1zeXN0ZW0tcmlzY3YzMiAtTSB2ZWdhLGRyYW0tYmFzZT0weDIwMDAwMCxi
YXJlbWV0YWwtbW9kZT1vbiAtc21wIDEgLW0gMkcgLWtlcm5lbCBoZWxsby5l
bGYgLWJpb3Mgbm9uZSAtZGlzcGxheSBub25lIC1zZXJpYWwgc3RkaW8KKwor
IyNEZWJ1ZyBpbiBRZW11IHdpdGggR0RCIHN1cHBvcnQKKz09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09CitSZWZlciB0aGUgdXNlciBndWlkZSBp
biB0aGUgZm9sZGVyIGRlYnVnX2d1aWRlLyAoTk9UIFVQREFURUQpCisKZGlm
ZiAtLWdpdCBhL2NvbmZpZ3MvZGV2aWNlcy9yaXNjdjY0LXNvZnRtbXUvZGVm
YXVsdC5tYWsgYi9jb25maWdzL2RldmljZXMvcmlzY3Y2NC1zb2Z0bW11L2Rl
ZmF1bHQubWFrCmluZGV4IGU0ODViYmQxYTMuLjk3MjA1ZDNiM2YgMTAwNjQ0
Ci0tLSBhL2NvbmZpZ3MvZGV2aWNlcy9yaXNjdjY0LXNvZnRtbXUvZGVmYXVs
dC5tYWsKKysrIGIvY29uZmlncy9kZXZpY2VzL3Jpc2N2NjQtc29mdG1tdS9k
ZWZhdWx0Lm1hawpAQCAtMTIsMyArMTIsNCBAQAogIyBDT05GSUdfTUlDUk9D
SElQX1BGU09DPW4KICMgQ09ORklHX1NIQUtUSV9DPW4KICMgQ09ORklHX1hJ
QU5HU0hBTl9LVU5NSU5HSFU9bgorIyBDT05GSUdfVkVHQT1uCmRpZmYgLS1n
aXQgYS9ody9pbnRjL0tjb25maWcgYi9ody9pbnRjL0tjb25maWcKaW5kZXgg
NzU0NzUyOGYyYy4uZGMyMDJjMjFhZCAxMDA2NDQKLS0tIGEvaHcvaW50Yy9L
Y29uZmlnCisrKyBiL2h3L2ludGMvS2NvbmZpZwpAQCAtMTA5LDMgKzEwOSwx
MCBAQCBjb25maWcgTE9PTkdBUkNIX1BDSF9NU0kKIAogY29uZmlnIExPT05H
QVJDSF9FWFRJT0kKICAgICBib29sCisKK2NvbmZpZyBWRUdBX0FDTElOVCAg
ICAgIAorICAgIGJvb2wKKworY29uZmlnIFZFR0FfUExJQyAgICAgICAgCisg
ICAgYm9vbAorICAgIHNlbGVjdCBNU0lfTk9OQlJPS0VOCmRpZmYgLS1naXQg
YS9ody9pbnRjL21lc29uLmJ1aWxkIGIvaHcvaW50Yy9tZXNvbi5idWlsZApp
bmRleCAzMTM3NTIxYTRhLi5kMDcyYmQyOGZiIDEwMDY0NAotLS0gYS9ody9p
bnRjL21lc29uLmJ1aWxkCisrKyBiL2h3L2ludGMvbWVzb24uYnVpbGQKQEAg
LTYxLDYgKzYxLDggQEAgc3BlY2lmaWNfc3MuYWRkKHdoZW46ICdDT05GSUdf
UklTQ1ZfQVBMSUMnLCBpZl90cnVlOiBmaWxlcygncmlzY3ZfYXBsaWMuYycp
KQogc3BlY2lmaWNfc3MuYWRkKHdoZW46ICdDT05GSUdfUklTQ1ZfSU1TSUMn
LCBpZl90cnVlOiBmaWxlcygncmlzY3ZfaW1zaWMuYycpKQogc3BlY2lmaWNf
c3MuYWRkKHdoZW46ICdDT05GSUdfU0lGSVZFX1BMSUMnLCBpZl90cnVlOiBm
aWxlcygnc2lmaXZlX3BsaWMuYycpKQogc3BlY2lmaWNfc3MuYWRkKHdoZW46
ICdDT05GSUdfWElDUycsIGlmX3RydWU6IGZpbGVzKCd4aWNzLmMnLCAneGl2
ZTIuYycpKQorc3BlY2lmaWNfc3MuYWRkKHdoZW46ICdDT05GSUdfVkVHQV9B
Q0xJTlQnLCBpZl90cnVlOiBmaWxlcygndmVnYV9hY2xpbnQuYycpKSAgCitz
cGVjaWZpY19zcy5hZGQod2hlbjogJ0NPTkZJR19WRUdBX1BMSUMnLCBpZl90
cnVlOiBmaWxlcygndmVnYV9wbGljLmMnKSkgICAgICAKIHNwZWNpZmljX3Nz
LmFkZCh3aGVuOiBbJ0NPTkZJR19LVk0nLCAnQ09ORklHX1hJQ1MnXSwKIAkJ
aWZfdHJ1ZTogZmlsZXMoJ3hpY3Nfa3ZtLmMnKSkKIHNwZWNpZmljX3NzLmFk
ZCh3aGVuOiAnQ09ORklHX1BTRVJJRVMnLCBpZl90cnVlOiBmaWxlcygneGlj
c19zcGFwci5jJywgJ3NwYXByX3hpdmUuYycpKQpkaWZmIC0tZ2l0IGEvaHcv
aW50Yy92ZWdhX2FjbGludC5jIGIvaHcvaW50Yy92ZWdhX2FjbGludC5jCm5l
dyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAuLjlmZTc2ZDZk
NTAKLS0tIC9kZXYvbnVsbAorKysgYi9ody9pbnRjL3ZlZ2FfYWNsaW50LmMK
QEAgLTAsMCArMSw1NTEgQEAKKy8qCisgKiBWRUdBIEFDTElOVCAoQWR2YW5j
ZWQgQ29yZSBMb2NhbCBJbnRlcnJ1cHRvcikKKyovCisjaW5jbHVkZSAicWVt
dS9vc2RlcC5oIgorI2luY2x1ZGUgInFhcGkvZXJyb3IuaCIKKyNpbmNsdWRl
ICJxZW11L2Vycm9yLXJlcG9ydC5oIgorI2luY2x1ZGUgInFlbXUvbG9nLmgi
CisjaW5jbHVkZSAicWVtdS9tb2R1bGUuaCIKKyNpbmNsdWRlICJody9zeXNi
dXMuaCIKKyNpbmNsdWRlICJ0YXJnZXQvcmlzY3YvY3B1LmgiCisjaW5jbHVk
ZSAidGFyZ2V0L3Jpc2N2L3RpbWVfaGVscGVyLmgiCisjaW5jbHVkZSAiaHcv
cWRldi1wcm9wZXJ0aWVzLmgiCisjaW5jbHVkZSAiaHcvaW50Yy92ZWdhX2Fj
bGludC5oIgorI2luY2x1ZGUgInFlbXUvdGltZXIuaCIKKyNpbmNsdWRlICJo
dy9pcnEuaCIKKyNpbmNsdWRlICJtaWdyYXRpb24vdm1zdGF0ZS5oIgorCit0
eXBlZGVmIHN0cnVjdCB2ZWdhX2FjbGludF9tdGltZXJfY2FsbGJhY2sgewor
ICAgIFZFR0FBY2xpbnRNVGltZXJTdGF0ZSAqczsKKyAgICBpbnQgbnVtOwor
fSB2ZWdhX2FjbGludF9tdGltZXJfY2FsbGJhY2s7CisKK3N0YXRpYyB1aW50
NjRfdCBjcHVfdmVnYV9yZWFkX3J0Y19yYXcodWludDMyX3QgdGltZWJhc2Vf
ZnJlcSkKK3sKKyAgICByZXR1cm4gbXVsZGl2NjQocWVtdV9jbG9ja19nZXRf
bnMoUUVNVV9DTE9DS19WSVJUVUFMKSwKKyAgICAgICAgdGltZWJhc2VfZnJl
cSwgTkFOT1NFQ09ORFNfUEVSX1NFQ09ORCk7Cit9CisKK3N0YXRpYyB1aW50
NjRfdCBjcHVfdmVnYV9yZWFkX3J0Yyh2b2lkICpvcGFxdWUpCit7CisgICAg
VkVHQUFjbGludE1UaW1lclN0YXRlICptdGltZXIgPSBvcGFxdWU7CisgICAg
cmV0dXJuIGNwdV92ZWdhX3JlYWRfcnRjX3JhdyhtdGltZXItPnRpbWViYXNl
X2ZyZXEpICsgbXRpbWVyLT50aW1lX2RlbHRhOworfQorCisvKgorICogQ2Fs
bGVkIHdoZW4gdGltZWNtcCBpcyB3cml0dGVuIHRvIHVwZGF0ZSB0aGUgUUVN
VSB0aW1lciBvciBpbW1lZGlhdGVseQorICogdHJpZ2dlciB0aW1lciBpbnRl
cnJ1cHQgaWYgbXRpbWVjbXAgPD0gY3VycmVudCB0aW1lciB2YWx1ZS4KKyAq
Lworc3RhdGljIHZvaWQgdmVnYV9hY2xpbnRfbXRpbWVyX3dyaXRlX3RpbWVj
bXAoVkVHQUFjbGludE1UaW1lclN0YXRlICptdGltZXIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUklTQ1ZDUFUg
KmNwdSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpbnQgaGFydGlkLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IHZhbHVlKQoreworICAg
IHVpbnQzMl90IHRpbWViYXNlX2ZyZXEgPSBtdGltZXItPnRpbWViYXNlX2Zy
ZXE7CisgICAgdWludDY0X3QgbmV4dDsKKyAgICB1aW50NjRfdCBkaWZmOwor
CisgICAgdWludDY0X3QgcnRjID0gY3B1X3ZlZ2FfcmVhZF9ydGMobXRpbWVy
KTsKKworICAgIC8qIENvbXB1dGUgdGhlIHJlbGF0aXZlIGhhcnRpZCB3LnIu
dCB0aGUgc29ja2V0ICovCisgICAgaGFydGlkID0gaGFydGlkIC0gbXRpbWVy
LT5oYXJ0aWRfYmFzZTsKKworICAgIG10aW1lci0+dGltZWNtcFtoYXJ0aWRd
ID0gdmFsdWU7CisgICAgaWYgKG10aW1lci0+dGltZWNtcFtoYXJ0aWRdIDw9
IHJ0YykgeworICAgICAgICAvKgorICAgICAgICAgKiBJZiB3ZSdyZSBzZXR0
aW5nIGFuIE1USU1FQ01QIHZhbHVlIGluIHRoZSAicGFzdCIsCisgICAgICAg
ICAqIGltbWVkaWF0ZWx5IHJhaXNlIHRoZSB0aW1lciBpbnRlcnJ1cHQKKyAg
ICAgICAgICovCisgICAgICAgIHFlbXVfaXJxX3JhaXNlKG10aW1lci0+dGlt
ZXJfaXJxc1toYXJ0aWRdKTsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKwor
ICAgIC8qIG90aGVyd2lzZSwgc2V0IHVwIHRoZSBmdXR1cmUgdGltZXIgaW50
ZXJydXB0ICovCisgICAgcWVtdV9pcnFfbG93ZXIobXRpbWVyLT50aW1lcl9p
cnFzW2hhcnRpZF0pOworICAgIGRpZmYgPSBtdGltZXItPnRpbWVjbXBbaGFy
dGlkXSAtIHJ0YzsKKyAgICAvKiBiYWNrIHRvIG5zIChub3RlIGFyZ3Mgc3dp
dGNoZWQgaW4gbXVsZGl2NjQpICovCisgICAgdWludDY0X3QgbnNfZGlmZiA9
IG11bGRpdjY0KGRpZmYsIE5BTk9TRUNPTkRTX1BFUl9TRUNPTkQsIHRpbWVi
YXNlX2ZyZXEpOworCisgICAgLyoKKyAgICAgKiBjaGVjayBpZiBuc19kaWZm
IG92ZXJmbG93ZWQgYW5kIGNoZWNrIGlmIHRoZSBhZGRpdGlvbiB3b3VsZCBw
b3RlbnRpYWxseQorICAgICAqIG92ZXJmbG93CisgICAgICovCisgICAgaWYg
KChOQU5PU0VDT05EU19QRVJfU0VDT05EID4gdGltZWJhc2VfZnJlcSAmJiBu
c19kaWZmIDwgZGlmZikgfHwKKyAgICAgICAgbnNfZGlmZiA+IElOVDY0X01B
WCkgeworICAgICAgICBuZXh0ID0gSU5UNjRfTUFYOworICAgIH0gZWxzZSB7
CisgICAgICAgIC8qCisgICAgICAgICAqIGFzIGl0IGlzIHZlcnkgdW5saWtl
bHkgcWVtdV9jbG9ja19nZXRfbnMgd2lsbCByZXR1cm4gYSB2YWx1ZQorICAg
ICAgICAgKiBncmVhdGVyIHRoYW4gSU5UNjRfTUFYLCBubyBhZGRpdGlvbmFs
IGNoZWNrIGlzIG5lZWRlZCBmb3IgYW4KKyAgICAgICAgICogdW5zaWduZWQg
aW50ZWdlciBvdmVyZmxvdy4KKyAgICAgICAgICovCisgICAgICAgIG5leHQg
PSBxZW11X2Nsb2NrX2dldF9ucyhRRU1VX0NMT0NLX1ZJUlRVQUwpICsgbnNf
ZGlmZjsKKyAgICAgICAgLyoKKyAgICAgICAgICogaWYgbnNfZGlmZiBpcyBJ
TlQ2NF9NQVggbmV4dCBtYXkgc3RpbGwgYmUgb3V0c2lkZSB0aGUgcmFuZ2UK
KyAgICAgICAgICogb2YgYSBzaWduZWQgaW50ZWdlci4KKyAgICAgICAgICov
CisgICAgICAgIG5leHQgPSBNSU4obmV4dCwgSU5UNjRfTUFYKTsKKyAgICB9
CisKKyAgICB0aW1lcl9tb2QobXRpbWVyLT50aW1lcnNbaGFydGlkXSwgbmV4
dCk7Cit9CisKKy8qCisgKiBDYWxsYmFjayB1c2VkIHdoZW4gdGhlIHRpbWVy
IHNldCB1c2luZyB0aW1lcl9tb2QgZXhwaXJlcy4KKyAqIFNob3VsZCByYWlz
ZSB0aGUgdGltZXIgaW50ZXJydXB0IGxpbmUKKyAqLworc3RhdGljIHZvaWQg
dmVnYV9hY2xpbnRfbXRpbWVyX2NiKHZvaWQgKm9wYXF1ZSkKK3sKKyAgICB2
ZWdhX2FjbGludF9tdGltZXJfY2FsbGJhY2sgKnN0YXRlID0gb3BhcXVlOwor
CisgICAgcWVtdV9pcnFfcmFpc2Uoc3RhdGUtPnMtPnRpbWVyX2lycXNbc3Rh
dGUtPm51bV0pOworfQorCisvKiBDUFUgcmVhZCBNVElNRVIgcmVnaXN0ZXIg
Ki8KK3N0YXRpYyB1aW50NjRfdCB2ZWdhX2FjbGludF9tdGltZXJfcmVhZCh2
b2lkICpvcGFxdWUsIGh3YWRkciBhZGRyLAorICAgIHVuc2lnbmVkIHNpemUp
Cit7CisgICAgVkVHQUFjbGludE1UaW1lclN0YXRlICptdGltZXIgPSBvcGFx
dWU7CisKKyAgICBpZiAoYWRkciA+PSBtdGltZXItPnRpbWVjbXBfYmFzZSAm
JgorICAgICAgICBhZGRyIDwgKG10aW1lci0+dGltZWNtcF9iYXNlICsgKG10
aW1lci0+bnVtX2hhcnRzIDw8IDMpKSkgeworICAgICAgICBzaXplX3QgaGFy
dGlkID0gbXRpbWVyLT5oYXJ0aWRfYmFzZSArCisgICAgICAgICAgICAgICAg
ICAgICAgICAoKGFkZHIgLSBtdGltZXItPnRpbWVjbXBfYmFzZSkgPj4gMyk7
CisgICAgICAgIENQVVN0YXRlICpjcHUgPSBjcHVfYnlfYXJjaF9pZChoYXJ0
aWQpOworICAgICAgICBDUFVSSVNDVlN0YXRlICplbnYgPSBjcHUgPyBjcHVf
ZW52KGNwdSkgOiBOVUxMOworICAgICAgICBpZiAoIWVudikgeworICAgICAg
ICAgICAgcWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICJhY2xpbnQtbXRpbWVyOiBpbnZhbGlkIGhh
cnRpZDogJXp1IiwgaGFydGlkKTsKKyAgICAgICAgfSBlbHNlIGlmICgoYWRk
ciAmIDB4NykgPT0gMCkgeworICAgICAgICAgICAgLyogdGltZWNtcF9sbyBm
b3IgUlYzMi9SVjY0IG9yIHRpbWVjbXAgZm9yIFJWNjQgKi8KKyAgICAgICAg
ICAgIHVpbnQ2NF90IHRpbWVjbXAgPSBtdGltZXItPnRpbWVjbXBbaGFydGlk
XTsKKyAgICAgICAgICAgIHJldHVybiAoc2l6ZSA9PSA0KSA/ICh0aW1lY21w
ICYgMHhGRkZGRkZGRikgOiB0aW1lY21wOworICAgICAgICB9IGVsc2UgaWYg
KChhZGRyICYgMHg3KSA9PSA0KSB7CisgICAgICAgICAgICAvKiB0aW1lY21w
X2hpICovCisgICAgICAgICAgICB1aW50NjRfdCB0aW1lY21wID0gbXRpbWVy
LT50aW1lY21wW2hhcnRpZF07CisgICAgICAgICAgICByZXR1cm4gKHRpbWVj
bXAgPj4gMzIpICYgMHhGRkZGRkZGRjsKKyAgICAgICAgfSBlbHNlIHsKKyAg
ICAgICAgICAgIHFlbXVfbG9nX21hc2soTE9HX1VOSU1QLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAiYWNsaW50LW10aW1lcjogaW52YWxpZCByZWFk
OiAlMDh4IiwgKHVpbnQzMl90KWFkZHIpOworICAgICAgICAgICAgcmV0dXJu
IDA7CisgICAgICAgIH0KKyAgICB9IGVsc2UgaWYgKGFkZHIgPT0gbXRpbWVy
LT50aW1lX2Jhc2UpIHsKKyAgICAgICAgLyogdGltZV9sbyBmb3IgUlYzMi9S
VjY0IG9yIHRpbWVjbXAgZm9yIFJWNjQgKi8KKyAgICAgICAgdWludDY0X3Qg
cnRjID0gY3B1X3ZlZ2FfcmVhZF9ydGMobXRpbWVyKTsKKyAgICAgICAgcmV0
dXJuIChzaXplID09IDQpID8gKHJ0YyAmIDB4RkZGRkZGRkYpIDogcnRjOwor
ICAgIH0gZWxzZSBpZiAoYWRkciA9PSBtdGltZXItPnRpbWVfYmFzZSArIDQp
IHsKKyAgICAgICAgLyogdGltZV9oaSAqLworICAgICAgICByZXR1cm4gKGNw
dV92ZWdhX3JlYWRfcnRjKG10aW1lcikgPj4gMzIpICYgMHhGRkZGRkZGRjsK
KyAgICB9CisKKyAgICBxZW11X2xvZ19tYXNrKExPR19VTklNUCwKKyAgICAg
ICAgICAgICAgICAgICJhY2xpbnQtbXRpbWVyOiBpbnZhbGlkIHJlYWQ6ICUw
OHgiLCAodWludDMyX3QpYWRkcik7CisgICAgcmV0dXJuIDA7Cit9CisKKy8q
IENQVSB3cml0ZSBNVElNRVIgcmVnaXN0ZXIgKi8KK3N0YXRpYyB2b2lkIHZl
Z2FfYWNsaW50X210aW1lcl93cml0ZSh2b2lkICpvcGFxdWUsIGh3YWRkciBh
ZGRyLAorICAgIHVpbnQ2NF90IHZhbHVlLCB1bnNpZ25lZCBzaXplKQorewor
ICAgIFZFR0FBY2xpbnRNVGltZXJTdGF0ZSAqbXRpbWVyID0gb3BhcXVlOwor
ICAgIGludCBpOworCisgICAgaWYgKGFkZHIgPj0gbXRpbWVyLT50aW1lY21w
X2Jhc2UgJiYKKyAgICAgICAgYWRkciA8IChtdGltZXItPnRpbWVjbXBfYmFz
ZSArIChtdGltZXItPm51bV9oYXJ0cyA8PCA1KSkpIHsKKyAgICAgICAgc2l6
ZV90IGhhcnRpZCA9IG10aW1lci0+aGFydGlkX2Jhc2UgKworICAgICAgICAg
ICAgICAgICAgICAgICAgKChhZGRyIC0gbXRpbWVyLT50aW1lY21wX2Jhc2Up
ID4+IDUpOworCisgICAgICAgIENQVVN0YXRlICpjcHUgPSBjcHVfYnlfYXJj
aF9pZChoYXJ0aWQpOworICAgICAgICBDUFVSSVNDVlN0YXRlICplbnYgPSBj
cHUgPyBjcHVfZW52KGNwdSkgOiBOVUxMOworICAgICAgICBpZiAoIWVudikg
eworICAgICAgICAgICAgcWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1Is
CisgICAgICAgICAgICAgICAgICAgICAgICAgICJhY2xpbnQtbXRpbWVyOiBp
bnZhbGlkIGhhcnRpZDogJXp1IiwgaGFydGlkKTsKKyAgICAgICAgfSBlbHNl
IGlmICgoYWRkciAmIDB4NykgPT0gMCkgeworICAgICAgICAgICAgaWYgKHNp
emUgPT0gNCkgeworICAgICAgICAgICAgICAgIC8qIHRpbWVjbXBfbG8gZm9y
IFJWMzIvUlY2NCAqLworICAgICAgICAgICAgICAgIHVpbnQ2NF90IHRpbWVj
bXBfaGkgPSBtdGltZXItPnRpbWVjbXBbaGFydGlkXSA+PiAzMjsKKyAgICAg
ICAgICAgICAgICB2ZWdhX2FjbGludF9tdGltZXJfd3JpdGVfdGltZWNtcCht
dGltZXIsIFJJU0NWX0NQVShjcHUpLCBoYXJ0aWQsCisgICAgICAgICAgICAg
ICAgICAgIHRpbWVjbXBfaGkgPDwgMzIgfCAodmFsdWUgJiAweEZGRkZGRkZG
KSk7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIC8q
IHRpbWVjbXAgZm9yIFJWNjQgKi8KKyAgICAgICAgICAgICAgICB2ZWdhX2Fj
bGludF9tdGltZXJfd3JpdGVfdGltZWNtcChtdGltZXIsIFJJU0NWX0NQVShj
cHUpLCBoYXJ0aWQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHZhbHVlKTsKKyAgICAgICAgICAgIH0KKyAg
ICAgICAgfSBlbHNlIGlmICgoYWRkciAmIDB4NykgPT0gNCkgeworICAgICAg
ICAgICAgaWYgKHNpemUgPT0gNCkgeworICAgICAgICAgICAgICAgIC8qIHRp
bWVjbXBfaGkgZm9yIFJWMzIvUlY2NCAqLworICAgICAgICAgICAgICAgIHVp
bnQ2NF90IHRpbWVjbXBfbG8gPSBtdGltZXItPnRpbWVjbXBbaGFydGlkXTsK
KyAgICAgICAgICAgICAgICB2ZWdhX2FjbGludF9tdGltZXJfd3JpdGVfdGlt
ZWNtcChtdGltZXIsIFJJU0NWX0NQVShjcHUpLCBoYXJ0aWQsCisgICAgICAg
ICAgICAgICAgICAgIHZhbHVlIDw8IDMyIHwgKHRpbWVjbXBfbG8gJiAweEZG
RkZGRkZGKSk7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAg
ICAgIHFlbXVfbG9nX21hc2soTE9HX0dVRVNUX0VSUk9SLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgImFjbGludC1tdGltZXI6IGludmFsaWQg
dGltZWNtcF9oaSB3cml0ZTogJTA4eCIsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAodWludDMyX3QpYWRkcik7CisgICAgICAgICAgICB9Cisg
ICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBxZW11X2xvZ19tYXNrKExP
R19VTklNUCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgImFjbGludC1t
dGltZXI6IGludmFsaWQgdGltZWNtcCB3cml0ZTogJTA4eCIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICh1aW50MzJfdClhZGRyKTsKKyAgICAgICAg
fQorICAgICAgICByZXR1cm47CisgICAgfSBlbHNlIGlmIChhZGRyID09IG10
aW1lci0+dGltZV9iYXNlIHx8IGFkZHIgPT0gbXRpbWVyLT50aW1lX2Jhc2Ug
KyA0KSB7CisgICAgICAgIHVpbnQ2NF90IHJ0Y19yID0gY3B1X3ZlZ2FfcmVh
ZF9ydGNfcmF3KG10aW1lci0+dGltZWJhc2VfZnJlcSk7CisgICAgICAgIHVp
bnQ2NF90IHJ0YyA9IGNwdV92ZWdhX3JlYWRfcnRjKG10aW1lcik7CisKKyAg
ICAgICAgaWYgKGFkZHIgPT0gbXRpbWVyLT50aW1lX2Jhc2UpIHsKKyAgICAg
ICAgICAgIGlmIChzaXplID09IDQpIHsKKyAgICAgICAgICAgICAgICAvKiB0
aW1lX2xvIGZvciBSVjMyL1JWNjQgKi8KKyAgICAgICAgICAgICAgICBtdGlt
ZXItPnRpbWVfZGVsdGEgPSAoKHJ0YyAmIH4weEZGRkZGRkZGVUxMKSB8IHZh
bHVlKSAtIHJ0Y19yOworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAg
ICAgICAgICAvKiB0aW1lIGZvciBSVjY0ICovCisgICAgICAgICAgICAgICAg
bXRpbWVyLT50aW1lX2RlbHRhID0gdmFsdWUgLSBydGNfcjsKKyAgICAgICAg
ICAgIH0KKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIGlmIChzaXpl
ID09IDQpIHsKKyAgICAgICAgICAgICAgICAvKiB0aW1lX2hpIGZvciBSVjMy
L1JWNjQgKi8KKyAgICAgICAgICAgICAgICBtdGltZXItPnRpbWVfZGVsdGEg
PSAodmFsdWUgPDwgMzIgfCAocnRjICYgMHhGRkZGRkZGRikpIC0gcnRjX3I7
CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIHFlbXVf
bG9nX21hc2soTE9HX0dVRVNUX0VSUk9SLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgImFjbGludC1tdGltZXI6IGludmFsaWQgdGltZV9oaSB3
cml0ZTogJTA4eCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAo
dWludDMyX3QpYWRkcik7CisgICAgICAgICAgICAgICAgcmV0dXJuOworICAg
ICAgICAgICAgfQorICAgICAgICB9CisKKyAgICAgICAgLyogQ2hlY2sgaWYg
dGltZXIgaW50ZXJydXB0IGlzIHRyaWdnZXJlZCBmb3IgZWFjaCBoYXJ0LiAq
LworICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbXRpbWVyLT5udW1faGFydHM7
IGkrKykgeworICAgICAgICAgICAgQ1BVU3RhdGUgKmNwdSA9IGNwdV9ieV9h
cmNoX2lkKG10aW1lci0+aGFydGlkX2Jhc2UgKyBpKTsKKyAgICAgICAgICAg
IENQVVJJU0NWU3RhdGUgKmVudiA9IGNwdSA/IGNwdV9lbnYoY3B1KSA6IE5V
TEw7CisgICAgICAgICAgICBpZiAoIWVudikgeworICAgICAgICAgICAgICAg
IGNvbnRpbnVlOworICAgICAgICAgICAgfQorICAgICAgICAgICAgdmVnYV9h
Y2xpbnRfbXRpbWVyX3dyaXRlX3RpbWVjbXAobXRpbWVyLCBSSVNDVl9DUFUo
Y3B1KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBtdGltZXItPmhhcnRpZF9iYXNlICsgaSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdGltZXItPnRp
bWVjbXBbaV0pOworICAgICAgICAgICAgcmlzY3ZfdGltZXJfd3JpdGVfdGlt
ZWNtcChlbnYsIGVudi0+c3RpbWVyLCBlbnYtPnN0aW1lY21wLCAwLCBNSVBf
U1RJUCk7CisgICAgICAgICAgICByaXNjdl90aW1lcl93cml0ZV90aW1lY21w
KGVudiwgZW52LT52c3RpbWVyLCBlbnYtPnZzdGltZWNtcCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW52LT5odGltZWRlbHRh
LCBNSVBfVlNUSVApOworCisgICAgICAgIH0KKyAgICAgICAgcmV0dXJuOwor
ICAgIH0KKworICAgIHFlbXVfbG9nX21hc2soTE9HX1VOSU1QLAorICAgICAg
ICAgICAgICAgICAgImFjbGludC1tdGltZXI6IGludmFsaWQgd3JpdGU6ICUw
OHgiLCAodWludDMyX3QpYWRkcik7Cit9CisKK3N0YXRpYyBjb25zdCBNZW1v
cnlSZWdpb25PcHMgdmVnYV9hY2xpbnRfbXRpbWVyX29wcyA9IHsKKyAgICAu
cmVhZCA9IHZlZ2FfYWNsaW50X210aW1lcl9yZWFkLAorICAgIC53cml0ZSA9
IHZlZ2FfYWNsaW50X210aW1lcl93cml0ZSwKKyAgICAuZW5kaWFubmVzcyA9
IERFVklDRV9MSVRUTEVfRU5ESUFOLAorICAgIC52YWxpZCA9IHsKKyAgICAg
ICAgLm1pbl9hY2Nlc3Nfc2l6ZSA9IDQsCisgICAgICAgIC5tYXhfYWNjZXNz
X3NpemUgPSA4CisgICAgfSwKKyAgICAuaW1wbCA9IHsKKyAgICAgICAgLm1p
bl9hY2Nlc3Nfc2l6ZSA9IDQsCisgICAgICAgIC5tYXhfYWNjZXNzX3NpemUg
PSA4LAorICAgIH0KK307CisKK3N0YXRpYyBjb25zdCBQcm9wZXJ0eSB2ZWdh
X2FjbGludF9tdGltZXJfcHJvcGVydGllc1tdID0geworICAgIERFRklORV9Q
Uk9QX1VJTlQzMigiaGFydGlkLWJhc2UiLCBWRUdBQWNsaW50TVRpbWVyU3Rh
dGUsCisgICAgICAgIGhhcnRpZF9iYXNlLCAwKSwKKyAgICBERUZJTkVfUFJP
UF9VSU5UMzIoIm51bS1oYXJ0cyIsIFZFR0FBY2xpbnRNVGltZXJTdGF0ZSwg
bnVtX2hhcnRzLCAxKSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoInRpbWVj
bXAtYmFzZSIsIFZFR0FBY2xpbnRNVGltZXJTdGF0ZSwKKyAgICAgICAgdGlt
ZWNtcF9iYXNlLCBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FQ01QKSwKKyAg
ICBERUZJTkVfUFJPUF9VSU5UMzIoInRpbWUtYmFzZSIsIFZFR0FBY2xpbnRN
VGltZXJTdGF0ZSwKKyAgICAgICAgdGltZV9iYXNlLCBWRUdBX0FDTElOVF9E
RUZBVUxUX01USU1FKSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoImFwZXJ0
dXJlLXNpemUiLCBWRUdBQWNsaW50TVRpbWVyU3RhdGUsCisgICAgICAgIGFw
ZXJ0dXJlX3NpemUsIFZFR0FfQUNMSU5UX0RFRkFVTFRfTVRJTUVSX1NJWkUp
LAorICAgIERFRklORV9QUk9QX1VJTlQzMigidGltZWJhc2UtZnJlcSIsIFZF
R0FBY2xpbnRNVGltZXJTdGF0ZSwKKyAgICAgICAgdGltZWJhc2VfZnJlcSwg
MCksCit9OworCitzdGF0aWMgdm9pZCB2ZWdhX2FjbGludF9tdGltZXJfcmVh
bGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAqKmVycnApCit7CisgICAg
VkVHQUFjbGludE1UaW1lclN0YXRlICpzID0gVkVHQV9BQ0xJTlRfTVRJTUVS
KGRldik7CisgICAgaW50IGk7CisKKyAgICBtZW1vcnlfcmVnaW9uX2luaXRf
aW8oJnMtPm1taW8sIE9CSkVDVChkZXYpLCAmdmVnYV9hY2xpbnRfbXRpbWVy
X29wcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgcywgVFlQRV9WRUdB
X0FDTElOVF9NVElNRVIsIHMtPmFwZXJ0dXJlX3NpemUpOworICAgIHN5c2J1
c19pbml0X21taW8oU1lTX0JVU19ERVZJQ0UoZGV2KSwgJnMtPm1taW8pOwor
CisgICAgcy0+dGltZXJfaXJxcyA9IGdfbmV3KHFlbXVfaXJxLCBzLT5udW1f
aGFydHMpOworICAgIHFkZXZfaW5pdF9ncGlvX291dChkZXYsIHMtPnRpbWVy
X2lycXMsIHMtPm51bV9oYXJ0cyk7CisKKyAgICBzLT50aW1lcnMgPSBnX25l
dzAoUUVNVVRpbWVyICosIHMtPm51bV9oYXJ0cyk7CisgICAgcy0+dGltZWNt
cCA9IGdfbmV3MCh1aW50NjRfdCwgcy0+bnVtX2hhcnRzKTsKKyAgICAvKiBD
bGFpbSB0aW1lciBpbnRlcnJ1cHQgYml0cyAqLworICAgIGZvciAoaSA9IDA7
IGkgPCBzLT5udW1faGFydHM7IGkrKykgeworICAgICAgICBSSVNDVkNQVSAq
Y3B1ID0gUklTQ1ZfQ1BVKGNwdV9ieV9hcmNoX2lkKHMtPmhhcnRpZF9iYXNl
ICsgaSkpOworICAgICAgICBpZiAocmlzY3ZfY3B1X2NsYWltX2ludGVycnVw
dHMoY3B1LCBNSVBfTVRJUCkgPCAwKSB7CisgICAgICAgICAgICBlcnJvcl9y
ZXBvcnQoIk1USVAgYWxyZWFkeSBjbGFpbWVkIik7CisgICAgICAgICAgICBl
eGl0KDEpOworICAgICAgICB9CisgICAgfQorfQorCitzdGF0aWMgdm9pZCB2
ZWdhX2FjbGludF9tdGltZXJfcmVzZXRfZW50ZXIoT2JqZWN0ICpvYmosIFJl
c2V0VHlwZSB0eXBlKQoreworICAgIC8qCisgICAgICogQWNjb3JkaW5nIHRv
IFJJU0MtViBBQ0xJTlQgc3BlYzoKKyAgICAgKiAgIC0gT24gTVRJTUVSIGRl
dmljZSByZXNldCwgdGhlIE1USU1FIHJlZ2lzdGVyIGlzIGNsZWFyZWQgdG8g
emVyby4KKyAgICAgKiAgIC0gT24gTVRJTUVSIGRldmljZSByZXNldCwgdGhl
IE1USU1FQ01QIHJlZ2lzdGVycyBhcmUgaW4gdW5rbm93biBzdGF0ZS4KKyAg
ICAgKi8KKyAgICBWRUdBQWNsaW50TVRpbWVyU3RhdGUgKm10aW1lciA9IFZF
R0FfQUNMSU5UX01USU1FUihvYmopOworCisgICAgLyoKKyAgICAgKiBDbGVh
ciBtdGltZSByZWdpc3RlciBieSB3cml0aW5nIHRvIDAgaXQuCisgICAgICog
UGVuZGluZyBtdGltZSBpbnRlcnJ1cHRzIHdpbGwgYWxzbyBiZSBjbGVhcmVk
IGF0IHRoZSBzYW1lIHRpbWUuCisgICAgICovCisgICAgdmVnYV9hY2xpbnRf
bXRpbWVyX3dyaXRlKG10aW1lciwgbXRpbWVyLT50aW1lX2Jhc2UsIDAsIDgp
OworfQorCitzdGF0aWMgY29uc3QgVk1TdGF0ZURlc2NyaXB0aW9uIHZtc3Rh
dGVfdmVnYV9tdGltZXIgPSB7CisgICAgLm5hbWUgPSAidmVnYV9tdGltZXIi
LAorICAgIC52ZXJzaW9uX2lkID0gMSwKKyAgICAubWluaW11bV92ZXJzaW9u
X2lkID0gMSwKKyAgICAuZmllbGRzID0gKGNvbnN0IFZNU3RhdGVGaWVsZFtd
KSB7CisgICAgICAgICAgICBWTVNUQVRFX1ZBUlJBWV9VSU5UMzIodGltZWNt
cCwgVkVHQUFjbGludE1UaW1lclN0YXRlLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIG51bV9oYXJ0cywgMCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB2bXN0YXRlX2luZm9fdWludDY0LCB1aW50
NjRfdCksCisgICAgICAgICAgICBWTVNUQVRFX0VORF9PRl9MSVNUKCkKKyAg
ICAgICAgfQorfTsKKworc3RhdGljIHZvaWQgdmVnYV9hY2xpbnRfbXRpbWVy
X2NsYXNzX2luaXQoT2JqZWN0Q2xhc3MgKmtsYXNzLCBjb25zdCB2b2lkICpk
YXRhKQoreworICAgIERldmljZUNsYXNzICpkYyA9IERFVklDRV9DTEFTUyhr
bGFzcyk7CisgICAgZGMtPnJlYWxpemUgPSB2ZWdhX2FjbGludF9tdGltZXJf
cmVhbGl6ZTsKKyAgICBkZXZpY2VfY2xhc3Nfc2V0X3Byb3BzKGRjLCB2ZWdh
X2FjbGludF9tdGltZXJfcHJvcGVydGllcyk7CisgICAgUmVzZXR0YWJsZUNs
YXNzICpyYyA9IFJFU0VUVEFCTEVfQ0xBU1Moa2xhc3MpOworICAgIHJjLT5w
aGFzZXMuZW50ZXIgPSB2ZWdhX2FjbGludF9tdGltZXJfcmVzZXRfZW50ZXI7
CisgICAgZGMtPnZtc2QgPSAmdm1zdGF0ZV92ZWdhX210aW1lcjsKK30KKwor
c3RhdGljIGNvbnN0IFR5cGVJbmZvIHZlZ2FfYWNsaW50X210aW1lcl9pbmZv
ID0geworICAgIC5uYW1lICAgICAgICAgID0gVFlQRV9WRUdBX0FDTElOVF9N
VElNRVIsCisgICAgLnBhcmVudCAgICAgICAgPSBUWVBFX1NZU19CVVNfREVW
SUNFLAorICAgIC5pbnN0YW5jZV9zaXplID0gc2l6ZW9mKFZFR0FBY2xpbnRN
VGltZXJTdGF0ZSksCisgICAgLmNsYXNzX2luaXQgICAgPSB2ZWdhX2FjbGlu
dF9tdGltZXJfY2xhc3NfaW5pdCwKK307CisKKy8qCisgKiBDcmVhdGUgQUNM
SU5UIE1USU1FUiBkZXZpY2UuCisgKi8KK0RldmljZVN0YXRlICp2ZWdhX2Fj
bGludF9tdGltZXJfY3JlYXRlKGh3YWRkciBhZGRyLCBod2FkZHIgc2l6ZSwK
KyAgICB1aW50MzJfdCBoYXJ0aWRfYmFzZSwgdWludDMyX3QgbnVtX2hhcnRz
LAorICAgIHVpbnQzMl90IHRpbWVjbXBfYmFzZSwgdWludDMyX3QgdGltZV9i
YXNlLCB1aW50MzJfdCB0aW1lYmFzZV9mcmVxLAorICAgIGJvb2wgcHJvdmlk
ZV9yZHRpbWUpCit7CisgICAgaW50IGk7CisgICAgRGV2aWNlU3RhdGUgKmRl
diA9IHFkZXZfbmV3KFRZUEVfVkVHQV9BQ0xJTlRfTVRJTUVSKTsKKyAgICBW
RUdBQWNsaW50TVRpbWVyU3RhdGUgKnMgPSBWRUdBX0FDTElOVF9NVElNRVIo
ZGV2KTsKKworICAgIGFzc2VydChudW1faGFydHMgPD0gVkVHQV9BQ0xJTlRf
TUFYX0hBUlRTKTsKKyAgICBhc3NlcnQoIShhZGRyICYgMHg3KSk7CisgICAg
YXNzZXJ0KCEodGltZWNtcF9iYXNlICYgMHg3KSk7CisgICAgYXNzZXJ0KCEo
dGltZV9iYXNlICYgMHg3KSk7CisKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQz
MihkZXYsICJoYXJ0aWQtYmFzZSIsIGhhcnRpZF9iYXNlKTsKKyAgICBxZGV2
X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJudW0taGFydHMiLCBudW1faGFydHMp
OworICAgIHFkZXZfcHJvcF9zZXRfdWludDMyKGRldiwgInRpbWVjbXAtYmFz
ZSIsIHRpbWVjbXBfYmFzZSk7CisgICAgcWRldl9wcm9wX3NldF91aW50MzIo
ZGV2LCAidGltZS1iYXNlIiwgdGltZV9iYXNlKTsKKyAgICBxZGV2X3Byb3Bf
c2V0X3VpbnQzMihkZXYsICJhcGVydHVyZS1zaXplIiwgc2l6ZSk7CisgICAg
cWRldl9wcm9wX3NldF91aW50MzIoZGV2LCAidGltZWJhc2UtZnJlcSIsIHRp
bWViYXNlX2ZyZXEpOworICAgIHN5c2J1c19yZWFsaXplX2FuZF91bnJlZihT
WVNfQlVTX0RFVklDRShkZXYpLCAmZXJyb3JfZmF0YWwpOworICAgIHN5c2J1
c19tbWlvX21hcChTWVNfQlVTX0RFVklDRShkZXYpLCAwLCBhZGRyKTsKKwor
ICAgIGZvciAoaSA9IDA7IGkgPCBudW1faGFydHM7IGkrKykgeworICAgICAg
ICBDUFVTdGF0ZSAqY3B1ID0gY3B1X2J5X2FyY2hfaWQoaGFydGlkX2Jhc2Ug
KyBpKTsKKyAgICAgICAgUklTQ1ZDUFUgKnJ2Y3B1ID0gUklTQ1ZfQ1BVKGNw
dSk7CisgICAgICAgIENQVVJJU0NWU3RhdGUgKmVudiA9IGNwdSA/IGNwdV9l
bnYoY3B1KSA6IE5VTEw7CisgICAgICAgIHZlZ2FfYWNsaW50X210aW1lcl9j
YWxsYmFjayAqY2IgPQorICAgICAgICAgICAgZ19uZXcwKHZlZ2FfYWNsaW50
X210aW1lcl9jYWxsYmFjaywgMSk7CisKKyAgICAgICAgaWYgKCFlbnYpIHsK
KyAgICAgICAgICAgIGdfZnJlZShjYik7CisgICAgICAgICAgICBjb250aW51
ZTsKKyAgICAgICAgfQorICAgICAgICBpZiAocHJvdmlkZV9yZHRpbWUpIHsK
KyAgICAgICAgICAgIHJpc2N2X2NwdV9zZXRfcmR0aW1lX2ZuKGVudiwgY3B1
X3ZlZ2FfcmVhZF9ydGMsIGRldik7CisgICAgICAgIH0KKworICAgICAgICBj
Yi0+cyA9IHM7CisgICAgICAgIGNiLT5udW0gPSBpOworICAgICAgICBzLT50
aW1lcnNbaV0gPSB0aW1lcl9uZXdfbnMoUUVNVV9DTE9DS19WSVJUVUFMLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZ2ZWdhX2FjbGlu
dF9tdGltZXJfY2IsIGNiKTsKKyAgICAgICAgcy0+dGltZWNtcFtpXSA9IDA7
CisKKyAgICAgICAgcWRldl9jb25uZWN0X2dwaW9fb3V0KGRldiwgaSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFkZXZfZ2V0X2dwaW9faW4o
REVWSUNFKHJ2Y3B1KSwgSVJRX01fVElNRVIpKTsKKyAgICB9CisKKyAgICBy
ZXR1cm4gZGV2OworfQorCisvKiBDUFUgcmVhZCBbTXxTXVNXSSByZWdpc3Rl
ciAqLworc3RhdGljIHVpbnQ2NF90IHZlZ2FfYWNsaW50X3N3aV9yZWFkKHZv
aWQgKm9wYXF1ZSwgaHdhZGRyIGFkZHIsCisgICAgdW5zaWduZWQgc2l6ZSkK
K3sKKyAgICBWRUdBQWNsaW50U3dpU3RhdGUgKnN3aSA9IG9wYXF1ZTsKKwor
ICAgIGlmIChhZGRyIDwgKHN3aS0+bnVtX2hhcnRzIDw8IDQpKSB7CisgICAg
ICAgIHNpemVfdCBoYXJ0aWQgPSBzd2ktPmhhcnRpZF9iYXNlICsgKGFkZHIg
Pj4gNCk7CisgICAgICAgIENQVVN0YXRlICpjcHUgPSBjcHVfYnlfYXJjaF9p
ZChoYXJ0aWQpOworICAgICAgICBDUFVSSVNDVlN0YXRlICplbnYgPSBjcHUg
PyBjcHVfZW52KGNwdSkgOiBOVUxMOworICAgICAgICBpZiAoIWVudikgewor
ICAgICAgICAgICAgcWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICJhY2xpbnQtc3dpOiBpbnZhbGlk
IGhhcnRpZDogJXp1IiwgaGFydGlkKTsKKyAgICAgICAgfSBlbHNlIGlmICgo
YWRkciAmIDB4MykgPT0gMCkgeworICAgICAgICAgICAgcmV0dXJuIChzd2kt
PnNzd2kpID8gMCA6ICgoZW52LT5taXAgJiBNSVBfTVNJUCkgPiAwKTsKKyAg
ICAgICAgfQorICAgIH0KKworICAgIHFlbXVfbG9nX21hc2soTE9HX1VOSU1Q
LAorICAgICAgICAgICAgICAgICAgImFjbGludC1zd2k6IGludmFsaWQgcmVh
ZDogJTA4eCIsICh1aW50MzJfdClhZGRyKTsKKyAgICByZXR1cm4gMDsKK30K
KworLyogQ1BVIHdyaXRlIFtNfFNdU1dJIHJlZ2lzdGVyICovCitzdGF0aWMg
dm9pZCB2ZWdhX2FjbGludF9zd2lfd3JpdGUodm9pZCAqb3BhcXVlLCBod2Fk
ZHIgYWRkciwgdWludDY0X3QgdmFsdWUsCisgICAgICAgIHVuc2lnbmVkIHNp
emUpCit7CisgICAgVkVHQUFjbGludFN3aVN0YXRlICpzd2kgPSBvcGFxdWU7
CisKKyAgICBpZiAoYWRkciA8IChzd2ktPm51bV9oYXJ0cyA8PCA0KSkgewor
ICAgICAgICBzaXplX3QgaGFydGlkID0gc3dpLT5oYXJ0aWRfYmFzZSArIChh
ZGRyID4+IDQpOworCisgICAgICAgIENQVVN0YXRlICpjcHUgPSBjcHVfYnlf
YXJjaF9pZChoYXJ0aWQpOworICAgICAgICBDUFVSSVNDVlN0YXRlICplbnYg
PSBjcHUgPyBjcHVfZW52KGNwdSkgOiBOVUxMOworICAgICAgICBpZiAoIWVu
dikgeworICAgICAgICAgICAgcWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJS
T1IsCisgICAgICAgICAgICAgICAgICAgICAgICAgICJhY2xpbnQtc3dpOiBp
bnZhbGlkIGhhcnRpZDogJXp1IiwgaGFydGlkKTsKKyAgICAgICAgfSBlbHNl
IGlmICgoYWRkciAmIDB4MykgPT0gMCkgeworICAgICAgICAgICAgaWYgKHZh
bHVlICYgMHgxKSB7CisgICAgICAgICAgICAgICAgcWVtdV9pcnFfcmFpc2Uo
c3dpLT5zb2Z0X2lycXNbaGFydGlkIC0gc3dpLT5oYXJ0aWRfYmFzZV0pOwor
ICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBpZiAoIXN3
aS0+c3N3aSkgeworICAgICAgICAgICAgICAgICAgICBxZW11X2lycV9sb3dl
cihzd2ktPnNvZnRfaXJxc1toYXJ0aWQgLSBzd2ktPmhhcnRpZF9iYXNlXSk7
CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICAg
ICAgcmV0dXJuOworICAgICAgICB9CisgICAgfQorCisgICAgcWVtdV9sb2df
bWFzayhMT0dfVU5JTVAsCisgICAgICAgICAgICAgICAgICAiYWNsaW50LXN3
aTogaW52YWxpZCB3cml0ZTogJTA4eCIsICh1aW50MzJfdClhZGRyKTsKK30K
Kworc3RhdGljIGNvbnN0IE1lbW9yeVJlZ2lvbk9wcyB2ZWdhX2FjbGludF9z
d2lfb3BzID0geworICAgIC5yZWFkID0gdmVnYV9hY2xpbnRfc3dpX3JlYWQs
CisgICAgLndyaXRlID0gdmVnYV9hY2xpbnRfc3dpX3dyaXRlLAorICAgIC5l
bmRpYW5uZXNzID0gREVWSUNFX0xJVFRMRV9FTkRJQU4sCisgICAgLnZhbGlk
ID0geworICAgICAgICAubWluX2FjY2Vzc19zaXplID0gNCwKKyAgICAgICAg
Lm1heF9hY2Nlc3Nfc2l6ZSA9IDQKKyAgICB9Cit9OworCitzdGF0aWMgY29u
c3QgUHJvcGVydHkgdmVnYV9hY2xpbnRfc3dpX3Byb3BlcnRpZXNbXSA9IHsK
KyAgICBERUZJTkVfUFJPUF9VSU5UMzIoImhhcnRpZC1iYXNlIiwgVkVHQUFj
bGludFN3aVN0YXRlLCBoYXJ0aWRfYmFzZSwgMCksCisgICAgREVGSU5FX1BS
T1BfVUlOVDMyKCJudW0taGFydHMiLCBWRUdBQWNsaW50U3dpU3RhdGUsIG51
bV9oYXJ0cywgMSksCisgICAgREVGSU5FX1BST1BfVUlOVDMyKCJzc3dpIiwg
VkVHQUFjbGludFN3aVN0YXRlLCBzc3dpLCBmYWxzZSksCit9OworCitzdGF0
aWMgdm9pZCB2ZWdhX2FjbGludF9zd2lfcmVhbGl6ZShEZXZpY2VTdGF0ZSAq
ZGV2LCBFcnJvciAqKmVycnApCit7CisgICAgVkVHQUFjbGludFN3aVN0YXRl
ICpzd2kgPSBWRUdBX0FDTElOVF9TV0koZGV2KTsKKyAgICBpbnQgaTsKKwor
ICAgIG1lbW9yeV9yZWdpb25faW5pdF9pbygmc3dpLT5tbWlvLCBPQkpFQ1Qo
ZGV2KSwgJnZlZ2FfYWNsaW50X3N3aV9vcHMsIHN3aSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgVFlQRV9WRUdBX0FDTElOVF9TV0ksIFZFR0FfQUNM
SU5UX1NXSV9TSVpFKTsKKyAgICBzeXNidXNfaW5pdF9tbWlvKFNZU19CVVNf
REVWSUNFKGRldiksICZzd2ktPm1taW8pOworCisgICAgc3dpLT5zb2Z0X2ly
cXMgPSBnX25ldyhxZW11X2lycSwgc3dpLT5udW1faGFydHMpOworICAgIHFk
ZXZfaW5pdF9ncGlvX291dChkZXYsIHN3aS0+c29mdF9pcnFzLCBzd2ktPm51
bV9oYXJ0cyk7CisKKyAgICAvKiBDbGFpbSBzb2Z0d2FyZSBpbnRlcnJ1cHQg
Yml0cyAqLworICAgIGZvciAoaSA9IDA7IGkgPCBzd2ktPm51bV9oYXJ0czsg
aSsrKSB7CisgICAgICAgIFJJU0NWQ1BVICpjcHUgPSBSSVNDVl9DUFUocWVt
dV9nZXRfY3B1KHN3aS0+aGFydGlkX2Jhc2UgKyBpKSk7CisgICAgICAgIC8q
IFdlIGRvbid0IGNsYWltIG1pcC5TU0lQIGJlY2F1c2UgaXQgaXMgd3JpdGFi
bGUgYnkgc29mdHdhcmUgKi8KKyAgICAgICAgaWYgKHJpc2N2X2NwdV9jbGFp
bV9pbnRlcnJ1cHRzKGNwdSwgc3dpLT5zc3dpID8gMCA6IE1JUF9NU0lQKSA8
IDApIHsKKyAgICAgICAgICAgIGVycm9yX3JlcG9ydCgiTVNJUCBhbHJlYWR5
IGNsYWltZWQiKTsKKyAgICAgICAgICAgIGV4aXQoMSk7CisgICAgICAgIH0K
KyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfYWNsaW50X3N3aV9yZXNl
dF9lbnRlcihPYmplY3QgKm9iaiwgUmVzZXRUeXBlIHR5cGUpCit7CisgICAg
LyoKKyAgICAgKiBBY2NvcmRpbmcgdG8gUklTQy1WIEFDTElOVCBzcGVjOgor
ICAgICAqICAgLSBPbiBNU1dJIGRldmljZSByZXNldCwgZWFjaCBNU0lQIHJl
Z2lzdGVyIGlzIGNsZWFyZWQgdG8gemVyby4KKyAgICAgKgorICAgICAqIHAu
cy4gU1NXSSBkZXZpY2UgcmVzZXQgZG9lcyBub3RoaW5nIHNpbmNlIFNFVFNJ
UCByZWdpc3RlciBhbHdheXMgcmVhZHMgMC4KKyAgICAgKi8KKyAgICBWRUdB
QWNsaW50U3dpU3RhdGUgKnN3aSA9IFZFR0FfQUNMSU5UX1NXSShvYmopOwor
ICAgIGludCBpOworCisgICAgaWYgKCFzd2ktPnNzd2kpIHsKKyAgICAgICAg
Zm9yIChpID0gMDsgaSA8IHN3aS0+bnVtX2hhcnRzOyBpKyspIHsKKyAgICAg
ICAgICAgIC8qIENsZWFyIE1TSVAgcmVnaXN0ZXJzIGJ5IGxvd2VyaW5nIHNv
ZnR3YXJlIGludGVycnVwdHMuICovCisgICAgICAgICAgICBxZW11X2lycV9s
b3dlcihzd2ktPnNvZnRfaXJxc1tpXSk7CisgICAgICAgIH0KKyAgICB9Cit9
CisKK3N0YXRpYyB2b2lkIHZlZ2FfYWNsaW50X3N3aV9jbGFzc19pbml0KE9i
amVjdENsYXNzICprbGFzcywgY29uc3Qgdm9pZCAqZGF0YSkKK3sKKyAgICBE
ZXZpY2VDbGFzcyAqZGMgPSBERVZJQ0VfQ0xBU1Moa2xhc3MpOworICAgIGRj
LT5yZWFsaXplID0gdmVnYV9hY2xpbnRfc3dpX3JlYWxpemU7CisgICAgZGV2
aWNlX2NsYXNzX3NldF9wcm9wcyhkYywgdmVnYV9hY2xpbnRfc3dpX3Byb3Bl
cnRpZXMpOworICAgIFJlc2V0dGFibGVDbGFzcyAqcmMgPSBSRVNFVFRBQkxF
X0NMQVNTKGtsYXNzKTsKKyAgICByYy0+cGhhc2VzLmVudGVyID0gdmVnYV9h
Y2xpbnRfc3dpX3Jlc2V0X2VudGVyOworfQorCitzdGF0aWMgY29uc3QgVHlw
ZUluZm8gdmVnYV9hY2xpbnRfc3dpX2luZm8gPSB7CisgICAgLm5hbWUgICAg
ICAgICAgPSBUWVBFX1ZFR0FfQUNMSU5UX1NXSSwKKyAgICAucGFyZW50ICAg
ICAgICA9IFRZUEVfU1lTX0JVU19ERVZJQ0UsCisgICAgLmluc3RhbmNlX3Np
emUgPSBzaXplb2YoVkVHQUFjbGludFN3aVN0YXRlKSwKKyAgICAuY2xhc3Nf
aW5pdCAgICA9IHZlZ2FfYWNsaW50X3N3aV9jbGFzc19pbml0LAorfTsKKwor
LyoKKyAqIENyZWF0ZSBBQ0xJTlQgW018U11TV0kgZGV2aWNlLgorICovCitE
ZXZpY2VTdGF0ZSAqdmVnYV9hY2xpbnRfc3dpX2NyZWF0ZShod2FkZHIgYWRk
ciwgdWludDMyX3QgaGFydGlkX2Jhc2UsCisgICAgdWludDMyX3QgbnVtX2hh
cnRzLCBib29sIHNzd2kpCit7CisgICAgaW50IGk7CisgICAgRGV2aWNlU3Rh
dGUgKmRldiA9IHFkZXZfbmV3KFRZUEVfVkVHQV9BQ0xJTlRfU1dJKTsKKwor
ICAgIGFzc2VydChudW1faGFydHMgPD0gVkVHQV9BQ0xJTlRfTUFYX0hBUlRT
KTsKKyAgICBhc3NlcnQoIShhZGRyICYgMHgzKSk7CisKKyAgICBxZGV2X3By
b3Bfc2V0X3VpbnQzMihkZXYsICJoYXJ0aWQtYmFzZSIsIGhhcnRpZF9iYXNl
KTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJudW0taGFydHMi
LCBudW1faGFydHMpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDMyKGRldiwg
InNzd2kiLCBzc3dpID8gdHJ1ZSA6IGZhbHNlKTsKKyAgICBzeXNidXNfcmVh
bGl6ZV9hbmRfdW5yZWYoU1lTX0JVU19ERVZJQ0UoZGV2KSwgJmVycm9yX2Zh
dGFsKTsKKyAgICBzeXNidXNfbW1pb19tYXAoU1lTX0JVU19ERVZJQ0UoZGV2
KSwgMCwgYWRkcik7CisKKyAgICBmb3IgKGkgPSAwOyBpIDwgbnVtX2hhcnRz
OyBpKyspIHsKKyAgICAgICAgQ1BVU3RhdGUgKmNwdSA9IGNwdV9ieV9hcmNo
X2lkKGhhcnRpZF9iYXNlICsgaSk7CisgICAgICAgIFJJU0NWQ1BVICpydmNw
dSA9IFJJU0NWX0NQVShjcHUpOworCisgICAgICAgIHFkZXZfY29ubmVjdF9n
cGlvX291dChkZXYsIGksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBxZGV2X2dldF9ncGlvX2luKERFVklDRShydmNwdSksCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgKHNzd2kpID8gSVJRX1NfU09GVCA6
IElSUV9NX1NPRlQpKTsKKyAgICB9CisKKyAgICByZXR1cm4gZGV2OworfQor
CitzdGF0aWMgdm9pZCB2ZWdhX2FjbGludF9yZWdpc3Rlcl90eXBlcyh2b2lk
KQoreworICAgIHR5cGVfcmVnaXN0ZXJfc3RhdGljKCZ2ZWdhX2FjbGludF9t
dGltZXJfaW5mbyk7CisgICAgdHlwZV9yZWdpc3Rlcl9zdGF0aWMoJnZlZ2Ff
YWNsaW50X3N3aV9pbmZvKTsKK30KKwordHlwZV9pbml0KHZlZ2FfYWNsaW50
X3JlZ2lzdGVyX3R5cGVzKQpkaWZmIC0tZ2l0IGEvaHcvaW50Yy92ZWdhX3Bs
aWMuYyBiL2h3L2ludGMvdmVnYV9wbGljLmMKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMDAwMC4uN2U0YzZiOWFjNQotLS0gL2Rldi9udWxs
CisrKyBiL2h3L2ludGMvdmVnYV9wbGljLmMKQEAgLTAsMCArMSw0OTYgQEAK
Ky8qCisgKiBWRUdBIFBMSUMgKFBsYXRmb3JtIExldmVsIEludGVycnVwdCBD
b250cm9sbGVyKQorICovCisjaW5jbHVkZSAicWVtdS9vc2RlcC5oIgorI2lu
Y2x1ZGUgInFhcGkvZXJyb3IuaCIKKyNpbmNsdWRlICJxZW11L2xvZy5oIgor
I2luY2x1ZGUgInFlbXUvbW9kdWxlLmgiCisjaW5jbHVkZSAicWVtdS9lcnJv
ci1yZXBvcnQuaCIKKyNpbmNsdWRlICJody9zeXNidXMuaCIKKyNpbmNsdWRl
ICJody9wY2kvbXNpLmgiCisjaW5jbHVkZSAiaHcvcWRldi1wcm9wZXJ0aWVz
LmgiCisjaW5jbHVkZSAiaHcvaW50Yy92ZWdhX3BsaWMuaCIKKyNpbmNsdWRl
ICJ0YXJnZXQvcmlzY3YvY3B1LmgiCisjaW5jbHVkZSAibWlncmF0aW9uL3Zt
c3RhdGUuaCIKKyNpbmNsdWRlICJody9pcnEuaCIKKyNpbmNsdWRlICJzeXN0
ZW0va3ZtLmgiCisKK3N0YXRpYyBib29sIGFkZHJfYmV0d2Vlbih1aW50MzJf
dCBhZGRyLCB1aW50MzJfdCBiYXNlLCB1aW50MzJfdCBudW0pCit7CisgICAg
cmV0dXJuIGFkZHIgPj0gYmFzZSAmJiBhZGRyIC0gYmFzZSA8IG51bTsKK30K
Kworc3RhdGljIFBMSUNNb2RlIGNoYXJfdG9fbW9kZShjaGFyIGMpCit7Cisg
ICAgc3dpdGNoIChjKSB7CisgICAgY2FzZSAnVSc6IHJldHVybiBQTElDTW9k
ZV9VOworICAgIGNhc2UgJ1MnOiByZXR1cm4gUExJQ01vZGVfUzsKKyAgICBj
YXNlICdNJzogcmV0dXJuIFBMSUNNb2RlX007CisgICAgZGVmYXVsdDoKKyAg
ICAgICAgZXJyb3JfcmVwb3J0KCJwbGljOiBpbnZhbGlkIG1vZGUgJyVjJyIs
IGMpOworICAgICAgICBleGl0KDEpOworICAgIH0KK30KKworc3RhdGljIHVp
bnQzMl90IGF0b21pY19zZXRfbWFza2VkKHVpbnQzMl90ICphLCB1aW50MzJf
dCBtYXNrLCB1aW50MzJfdCB2YWx1ZSkKK3sKKyAgICB1aW50MzJfdCBvbGQs
IG5ldywgY21wID0gcWF0b21pY19yZWFkKGEpOworCisgICAgZG8geworICAg
ICAgICBvbGQgPSBjbXA7CisgICAgICAgIG5ldyA9IChvbGQgJiB+bWFzaykg
fCAodmFsdWUgJiBtYXNrKTsKKyAgICAgICAgY21wID0gcWF0b21pY19jbXB4
Y2hnKGEsIG9sZCwgbmV3KTsKKyAgICB9IHdoaWxlIChvbGQgIT0gY21wKTsK
KworICAgIHJldHVybiBvbGQ7Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfcGxp
Y19zZXRfcGVuZGluZyhWZWdhUExJQ1N0YXRlICpwbGljLCBpbnQgaXJxLCBi
b29sIGxldmVsKQoreworICAgIGF0b21pY19zZXRfbWFza2VkKCZwbGljLT5w
ZW5kaW5nW2lycSA+PiA1XSwgMSA8PCAoaXJxICYgMzEpLCAtISFsZXZlbCk7
Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfcGxpY19zZXRfY2xhaW1lZChWZWdh
UExJQ1N0YXRlICpwbGljLCBpbnQgaXJxLCBib29sIGxldmVsKQoreworICAg
IGF0b21pY19zZXRfbWFza2VkKCZwbGljLT5jbGFpbWVkW2lycSA+PiA1XSwg
MSA8PCAoaXJxICYgMzEpLCAtISFsZXZlbCk7Cit9CisKK3N0YXRpYyB1aW50
MzJfdCB2ZWdhX3BsaWNfY2xhaW1lZChWZWdhUExJQ1N0YXRlICpwbGljLCB1
aW50MzJfdCBhZGRyaWQpCit7CisgICAgdWludDMyX3QgbWF4X2lycSA9IDA7
CisgICAgdWludDMyX3QgbWF4X3ByaW8gPSBwbGljLT50YXJnZXRfcHJpb3Jp
dHlbYWRkcmlkXTsKKyAgICBpbnQgaSwgajsKKyAgICBpbnQgbnVtX2lycV9p
bl93b3JkID0gMzI7CisKKyAgICBmb3IgKGkgPSAwOyBpIDwgcGxpYy0+Yml0
ZmllbGRfd29yZHM7IGkrKykgeworICAgICAgICB1aW50MzJfdCBwZW5kaW5n
X2VuYWJsZWRfbm90X2NsYWltZWQgPQorICAgICAgICAgICAgICAgICAgICAg
ICAgKHBsaWMtPnBlbmRpbmdbaV0gJiB+cGxpYy0+Y2xhaW1lZFtpXSkgJgor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsaWMtPmVuYWJsZVthZGRy
aWQgKiBwbGljLT5iaXRmaWVsZF93b3JkcyArIGldOworCisgICAgICAgIGlm
ICghcGVuZGluZ19lbmFibGVkX25vdF9jbGFpbWVkKSB7CisgICAgICAgICAg
ICBjb250aW51ZTsKKyAgICAgICAgfQorCisgICAgICAgIGlmIChpID09IChw
bGljLT5iaXRmaWVsZF93b3JkcyAtIDEpKSB7CisgICAgICAgICAgICAvKgor
ICAgICAgICAgICAgICogSWYgcGxpYy0+bnVtX3NvdXJjZXMgaXMgbm90IG11
bHRpcGxlIG9mIDMyLCBudW0tb2YtaXJxIGluIGxhc3QKKyAgICAgICAgICAg
ICAqIHdvcmQgaXMgbm90IDMyLiBDb21wdXRlIHRoZSBudW0tb2YtaXJxIG9m
IGxhc3Qgd29yZCB0byBhdm9pZAorICAgICAgICAgICAgICogb3V0LW9mLWJv
dW5kIGFjY2VzcyBvZiBzb3VyY2VfcHJpb3JpdHkgYXJyYXkuCisgICAgICAg
ICAgICAgKi8KKyAgICAgICAgICAgIG51bV9pcnFfaW5fd29yZCA9IHBsaWMt
Pm51bV9zb3VyY2VzIC0gKChwbGljLT5iaXRmaWVsZF93b3JkcyAtIDEpIDw8
IDUpOworICAgICAgICB9CisKKyAgICAgICAgZm9yIChqID0gMDsgaiA8IG51
bV9pcnFfaW5fd29yZDsgaisrKSB7CisgICAgICAgICAgICBpbnQgaXJxID0g
KGkgPDwgNSkgKyBqOworICAgICAgICAgICAgdWludDMyX3QgcHJpbyA9IHBs
aWMtPnNvdXJjZV9wcmlvcml0eVtpcnFdOworICAgICAgICAgICAgaW50IGVu
YWJsZWQgPSBwZW5kaW5nX2VuYWJsZWRfbm90X2NsYWltZWQgJiAoMSA8PCBq
KTsKKworICAgICAgICAgICAgaWYgKGVuYWJsZWQgJiYgcHJpbyA+IG1heF9w
cmlvKSB7CisgICAgICAgICAgICAgICAgbWF4X2lycSA9IGlycTsKKyAgICAg
ICAgICAgICAgICBtYXhfcHJpbyA9IHByaW87CisgICAgICAgICAgICB9Cisg
ICAgICAgIH0KKyAgICB9CisKKyAgICByZXR1cm4gbWF4X2lycTsKK30KKwor
c3RhdGljIHZvaWQgdmVnYV9wbGljX3VwZGF0ZShWZWdhUExJQ1N0YXRlICpw
bGljKQoreworICAgIGludCBhZGRyaWQ7CisKKyAgICAvKiByYWlzZSBpcnEg
b24gaGFydHMgd2hlcmUgdGhpcyBpcnEgaXMgZW5hYmxlZCAqLworICAgIGZv
ciAoYWRkcmlkID0gMDsgYWRkcmlkIDwgcGxpYy0+bnVtX2FkZHJzOyBhZGRy
aWQrKykgeworICAgICAgICB1aW50MzJfdCBoYXJ0aWQgPSBwbGljLT5hZGRy
X2NvbmZpZ1thZGRyaWRdLmhhcnRpZDsKKyAgICAgICAgUExJQ01vZGUgbW9k
ZSA9IHBsaWMtPmFkZHJfY29uZmlnW2FkZHJpZF0ubW9kZTsKKyAgICAgICAg
Ym9vbCBsZXZlbCA9ICEhdmVnYV9wbGljX2NsYWltZWQocGxpYywgYWRkcmlk
KTsKKworICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKKyAgICAgICAgY2FzZSBQ
TElDTW9kZV9NOgorICAgICAgICAgICAgcWVtdV9zZXRfaXJxKHBsaWMtPm1f
ZXh0ZXJuYWxfaXJxc1toYXJ0aWQgLSBwbGljLT5oYXJ0aWRfYmFzZV0sIGxl
dmVsKTsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICBjYXNlIFBMSUNN
b2RlX1M6CisgICAgICAgICAgICBxZW11X3NldF9pcnEocGxpYy0+c19leHRl
cm5hbF9pcnFzW2hhcnRpZCAtIHBsaWMtPmhhcnRpZF9iYXNlXSwgbGV2ZWwp
OworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIGRlZmF1bHQ6CisgICAg
ICAgICAgICBicmVhazsKKyAgICAgICAgfQorICAgIH0KK30KKworICAgIHVp
bnQzMl90IHZlZ2FfcHJpb3JpdHlfcmVncyA9IDB4MTA7ICAgIC8vMTYgSVBS
cyAocHJpb3JpdHkpCisgICAgdWludDMyX3QgdmVnYV9wZW5kaW5nX3JlZ3Mg
PSAweDQ7ICAgICAgLy80IElQUnMgKHBlbmRpbmcpCisgICAgdWludDMyX3Qg
dmVnYV9lbmFibGVfcmVnX3NpemUgPSAweDEwMDsgLy80IElFUnMgKGVuYWJs
ZSkKKworc3RhdGljIHVpbnQ2NF90IHZlZ2FfcGxpY19yZWFkKHZvaWQgKm9w
YXF1ZSwgaHdhZGRyIGFkZHIsIHVuc2lnbmVkIHNpemUpCit7CisgICAgVmVn
YVBMSUNTdGF0ZSAqcGxpYyA9IG9wYXF1ZTsKKworICAgIGlmIChhZGRyX2Jl
dHdlZW4oYWRkciwgcGxpYy0+cHJpb3JpdHlfYmFzZSwgdmVnYV9wcmlvcml0
eV9yZWdzIDw8IDIpKSB7ICAgICAgLy9CZXR3ZWVuICAweDAwIGFuZCAweDQw
IChXcml0ZSBvbmx5KQorICAgICAgICB1aW50MzJfdCBpcnEgPSAoYWRkciA+
PiAyKSAqIDg7CisgICAgICAgIHVpbnQzMl90IHJlc3VsdCA9IDA7CisKKyAg
ICAgICAgZm9yKHVpbnQzMl90IGkgPSAwOyBpIDwgODsgaSsrKQorICAgICAg
ICB7CisgICAgICAgICAgICBpZihpcnEgIT0gMCkKKyAgICAgICAgICAgIHsK
KyAgICAgICAgICAgICAgICByZXN1bHQgfD0gKHBsaWMtPnNvdXJjZV9wcmlv
cml0eVtpcnFdICYmIDB4ZikgPDwgKGkgKiA0KTsKKyAgICAgICAgICAgIH0K
KyAgICAgICAgICBpcnEgKys7CisgICAgICAgIH0KKyAgICAgICAgcmV0dXJu
IHJlc3VsdDsKKyAgICB9IGVsc2UgaWYgKGFkZHJfYmV0d2VlbihhZGRyLCBw
bGljLT5wZW5kaW5nX2Jhc2UsIHZlZ2FfcGVuZGluZ19yZWdzIDw8IDIpKXsg
IC8vQmV0d2VlbiAweDgwIGFuZCAweDkwIChSZWFkIG9ubHkpCisgICAgICAg
IHVpbnQzMl90IHdvcmQgPSAoYWRkciAtIHBsaWMtPnBlbmRpbmdfYmFzZSkg
Pj4gMjsKKworICAgICAgICByZXR1cm4gcGxpYy0+cGVuZGluZ1t3b3JkXTsK
KyAgICB9ZWxzZSBpZiAoYWRkcl9iZXR3ZWVuKGFkZHIsIHBsaWMtPmVuYWJs
ZV9iYXNlLHZlZ2FfZW5hYmxlX3JlZ19zaXplKSkgeyAgICAgLy9CZXR3ZWVu
IDB4MTAwIGFuZCAweDIwMAorICAgICAgICB1aW50MzJfdCBhZGRyaWQgPSAo
YWRkciAtIHBsaWMtPmVuYWJsZV9iYXNlKSAvIHBsaWMtPmVuYWJsZV9zdHJp
ZGU7CisgICAgICAgIHVpbnQzMl90IHdvcmRpZCA9IChhZGRyIC0gcGxpYy0+
ZW5hYmxlX2Jhc2UgLSAoYWRkcmlkICogcGxpYy0+ZW5hYmxlX3N0cmlkZSkp
ID4+IDI7CisKKyAgICAgICAgaWYgKHdvcmRpZCA8IHBsaWMtPmJpdGZpZWxk
X3dvcmRzKSB7CisgICAgICAgICAgICByZXR1cm4gcGxpYy0+ZW5hYmxlW2Fk
ZHJpZCAqIHBsaWMtPmJpdGZpZWxkX3dvcmRzICsgd29yZGlkXTsKKyAgICAg
ICAgfQorICAgIH0gZWxzZSBpZiAoYWRkcl9iZXR3ZWVuKGFkZHIsIHBsaWMt
PmNvbnRleHRfYmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBw
bGljLT5udW1fYWRkcnMgKiBwbGljLT5jb250ZXh0X3N0cmlkZSkpIHsKKyAg
ICAgICAgdWludDMyX3QgYWRkcmlkID0gKGFkZHIgLSBwbGljLT5jb250ZXh0
X2Jhc2UpIC8gcGxpYy0+Y29udGV4dF9zdHJpZGU7CisgICAgICAgIHVpbnQz
Ml90IGNvbnRleHRpZCA9IChhZGRyICYgKHBsaWMtPmNvbnRleHRfc3RyaWRl
IC0gMSkpOworCisgICAgICAgIGlmIChjb250ZXh0aWQgPT0gMCkgeworICAg
ICAgICAgICAgcmV0dXJuIHBsaWMtPnRhcmdldF9wcmlvcml0eVthZGRyaWRd
OworICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHRpZCA9PSA0KSB7CisgICAg
ICAgICAgICB1aW50MzJfdCBtYXhfaXJxID0gdmVnYV9wbGljX2NsYWltZWQo
cGxpYywgYWRkcmlkKTsKKworICAgICAgICAgICAgaWYgKG1heF9pcnEpIHsK
KyAgICAgICAgICAgICAgICB2ZWdhX3BsaWNfc2V0X3BlbmRpbmcocGxpYywg
bWF4X2lycSwgZmFsc2UpOworICAgICAgICAgICAgICAgIHZlZ2FfcGxpY19z
ZXRfY2xhaW1lZChwbGljLCBtYXhfaXJxLCB0cnVlKTsKKyAgICAgICAgICAg
IH0KKworICAgICAgICAgICAgdmVnYV9wbGljX3VwZGF0ZShwbGljKTsKKyAg
ICAgICAgICAgIHJldHVybiBtYXhfaXJxOworICAgICAgICB9CisgICAgfQor
CisgICAgcWVtdV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCisgICAgICAg
ICAgICAgICAgICAiJXM6IEludmFsaWQgcmVnaXN0ZXIgcmVhZCAweCUiIEhX
QUREUl9QUkl4ICJcbiIsCisgICAgICAgICAgICAgICAgICBfX2Z1bmNfXywg
YWRkcik7CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2Ff
cGxpY193cml0ZSh2b2lkICpvcGFxdWUsIGh3YWRkciBhZGRyLCB1aW50NjRf
dCB2YWx1ZSwKKyAgICAgICAgdW5zaWduZWQgc2l6ZSkKK3sKKyAgICBWZWdh
UExJQ1N0YXRlICpwbGljID0gb3BhcXVlOworIAorICAgIGlmIChhZGRyX2Jl
dHdlZW4oYWRkciwgcGxpYy0+cHJpb3JpdHlfYmFzZSwgdmVnYV9wcmlvcml0
eV9yZWdzIDw8IDIpKSB7ICAvL0JldHdlZW4gIDB4MDAgYW5kIDB4NDAgKFdy
aXRlIG9ubHkpCisgICAgICAgIAorICAgICAgICB1aW50MzJfdCBpcnEgPSAo
YWRkciA+PiAyKSAqIDg7CisgICAgICAgIGZvcih1aW50MzJfdCBpID0gMDsg
aSA8IDg7IGkrKykKKyAgICAgICAgeworICAgICAgICAgICAgaWYoaXJxICE9
IDApeworICAgICAgICAgICAgICAgIHBsaWMtPnNvdXJjZV9wcmlvcml0eVtp
cnFdID0gKHZhbHVlID4+IChpICogNCkpICYmIDB4ZmY7CisgICAgICAgICAg
ICAgICAgdmVnYV9wbGljX3VwZGF0ZShwbGljKTsKKyAgICAgICAgICAgIH0K
KyAgICAgICAgICAgIGlycSArKzsgCisgICAgICAgIH0KKyAgICB9IGVsc2Ug
aWYgKGFkZHJfYmV0d2VlbihhZGRyLCBwbGljLT5wZW5kaW5nX2Jhc2UsIHZl
Z2FfcGVuZGluZ19yZWdzIDw8IDIpKSB7IC8vQmV0d2VlbiAweDgwIGFuZCAw
eDkwIChSZWFkIG9ubHkpCisgICAgICAgIHFlbXVfbG9nX21hc2soTE9HX0dV
RVNUX0VSUk9SLAorICAgICAgICAgICAgICAgICAgICAgICIlczogaW52YWxp
ZCBwZW5kaW5nIHdyaXRlOiAweCUiIEhXQUREUl9QUkl4ICIiLAorICAgICAg
ICAgICAgICAgICAgICAgIF9fZnVuY19fLCBhZGRyKTsKKyAgICB9IGVsc2Ug
aWYgKGFkZHJfYmV0d2VlbihhZGRyLCBwbGljLT5lbmFibGVfYmFzZSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWdhX2VuYWJsZV9yZWdfc2l6
ZSkpIHsgIC8vQmV0d2VlbiAweDEwMCBhbmQgMHgyMDAKKyAgICAgICAgdWlu
dDMyX3QgYWRkcmlkID0gKGFkZHIgLSBwbGljLT5lbmFibGVfYmFzZSkgLyBw
bGljLT5lbmFibGVfc3RyaWRlOworICAgICAgICB1aW50MzJfdCB3b3JkaWQg
PSAoYWRkciAtIHBsaWMtPmVuYWJsZV9iYXNlIC0gKGFkZHJpZCAqIHBsaWMt
PmVuYWJsZV9zdHJpZGUpKSA+PiAyOworCisgICAgICAgIGlmICh3b3JkaWQg
PCBwbGljLT5iaXRmaWVsZF93b3JkcykgeworICAgICAgICAgICAgcGxpYy0+
ZW5hYmxlW2FkZHJpZCAqIHBsaWMtPmJpdGZpZWxkX3dvcmRzICsgd29yZGlk
XSA9IHZhbHVlOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgcWVt
dV9sb2dfbWFzayhMT0dfR1VFU1RfRVJST1IsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICIlczogSW52YWxpZCBlbmFibGUgd3JpdGUgMHglIiBIV0FE
RFJfUFJJeCAiXG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgYWRkcik7CisgICAgICAgIH0KKyAgICB9IGVsc2UgaWYgKGFkZHJf
YmV0d2VlbihhZGRyLCBwbGljLT5jb250ZXh0X2Jhc2UsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcGxpYy0+bnVtX2FkZHJzICogcGxpYy0+Y29u
dGV4dF9zdHJpZGUpKSB7CisgICAgICAgIHVpbnQzMl90IGFkZHJpZCA9IChh
ZGRyIC0gcGxpYy0+Y29udGV4dF9iYXNlKSAvIHBsaWMtPmNvbnRleHRfc3Ry
aWRlOworICAgICAgICB1aW50MzJfdCBjb250ZXh0aWQgPSAoYWRkciAmIChw
bGljLT5jb250ZXh0X3N0cmlkZSAtIDEpKTsKKworICAgICAgICBpZiAoY29u
dGV4dGlkID09IDApIHsKKyAgICAgICAgICAgIGlmICh2YWx1ZSA8PSBwbGlj
LT5udW1fcHJpb3JpdGllcykgeworICAgICAgICAgICAgICAgIHBsaWMtPnRh
cmdldF9wcmlvcml0eVthZGRyaWRdID0gdmFsdWU7CisgICAgICAgICAgICAg
ICAgdmVnYV9wbGljX3VwZGF0ZShwbGljKTsKKyAgICAgICAgICAgIH0KKyAg
ICAgICAgfSBlbHNlIGlmIChjb250ZXh0aWQgPT0gNCkgeworICAgICAgICAg
ICAgICAgIGlmICh2YWx1ZSA8IHBsaWMtPm51bV9zb3VyY2VzKSB7CisgICAg
ICAgICAgICAgICAgICAgIHZlZ2FfcGxpY19zZXRfY2xhaW1lZChwbGljLCB2
YWx1ZSwgZmFsc2UpOworICAgICAgICAgICAgICAgICAgICB2ZWdhX3BsaWNf
dXBkYXRlKHBsaWMpOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgfSBl
bHNlIHsKKyAgICAgICAgICAgIHFlbXVfbG9nX21hc2soTE9HX0dVRVNUX0VS
Uk9SLAorICAgICAgICAgICAgICAgICAgICAgICAgICAiJXM6IEludmFsaWQg
Y29udGV4dCB3cml0ZSAweCUiIEhXQUREUl9QUkl4ICJcbiIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgIF9fZnVuY19fLCBhZGRyKTsKKyAgICAgICAg
fQorICAgIH0gZWxzZSB7CisgICAgICAgIHFlbXVfbG9nX21hc2soTE9HX0dV
RVNUX0VSUk9SLAorICAgICAgICAgICAgICAgICAgICAgICIlczogSW52YWxp
ZCByZWdpc3RlciB3cml0ZSAweCUiIEhXQUREUl9QUkl4ICJcbiIsCisgICAg
ICAgICAgICAgICAgICAgICAgX19mdW5jX18sIGFkZHIpOworICAgIH0KK30K
Kworc3RhdGljIGNvbnN0IE1lbW9yeVJlZ2lvbk9wcyB2ZWdhX3BsaWNfb3Bz
ID0geworICAgIC5yZWFkID0gdmVnYV9wbGljX3JlYWQsCisgICAgLndyaXRl
ID0gdmVnYV9wbGljX3dyaXRlLAorICAgIC5lbmRpYW5uZXNzID0gREVWSUNF
X0xJVFRMRV9FTkRJQU4sCisgICAgLnZhbGlkID0geworICAgICAgICAubWlu
X2FjY2Vzc19zaXplID0gNCwKKyAgICAgICAgLm1heF9hY2Nlc3Nfc2l6ZSA9
IDQKKyAgICB9Cit9OworCitzdGF0aWMgdm9pZCB2ZWdhX3BsaWNfcmVzZXQo
RGV2aWNlU3RhdGUgKmRldikKK3sKKyAgICBWZWdhUExJQ1N0YXRlICpzID0g
VkVHQV9QTElDKGRldik7CisgICAgaW50IGk7CisKKyAgICBtZW1zZXQocy0+
c291cmNlX3ByaW9yaXR5LCAwLCBzaXplb2YodWludDMyX3QpICogcy0+bnVt
X3NvdXJjZXMpOworICAgIG1lbXNldChzLT50YXJnZXRfcHJpb3JpdHksIDAs
IHNpemVvZih1aW50MzJfdCkgKiBzLT5udW1fYWRkcnMpOworICAgIG1lbXNl
dChzLT5wZW5kaW5nLCAwLCBzaXplb2YodWludDMyX3QpICogcy0+Yml0Zmll
bGRfd29yZHMpOworICAgIG1lbXNldChzLT5jbGFpbWVkLCAwLCBzaXplb2Yo
dWludDMyX3QpICogcy0+Yml0ZmllbGRfd29yZHMpOworICAgIG1lbXNldChz
LT5lbmFibGUsIDAsIHNpemVvZih1aW50MzJfdCkgKiBzLT5udW1fZW5hYmxl
cyk7CisKKyAgICBmb3IgKGkgPSAwOyBpIDwgcy0+bnVtX2hhcnRzOyBpKysp
IHsKKyAgICAgICAgcWVtdV9zZXRfaXJxKHMtPm1fZXh0ZXJuYWxfaXJxc1tp
XSwgMCk7CisgICAgICAgIHFlbXVfc2V0X2lycShzLT5zX2V4dGVybmFsX2ly
cXNbaV0sIDApOworICAgIH0KK30KKworLyoKKyAqIHBhcnNlIFBMSUMgaGFy
dC9tb2RlIGFkZHJlc3Mgb2Zmc2V0IGNvbmZpZworICoKKyAqICJNIiAgICAg
ICAgICAgICAgMSBoYXJ0IHdpdGggTSBtb2RlCisgKiAiTVMsTVMiICAgICAg
ICAgIDIgaGFydHMsIDAtMSB3aXRoIE0gYW5kIFMgbW9kZQorICogIk0sTVMs
TVMsTVMsTVMiICA1IGhhcnRzLCAwIHdpdGggTSBtb2RlLCAxLTUgd2l0aCBN
IGFuZCBTIG1vZGUKKyAqLworc3RhdGljIHZvaWQgcGFyc2VfaGFydF9jb25m
aWcoVmVnYVBMSUNTdGF0ZSAqcGxpYykKK3sKKyAgICBpbnQgYWRkcmlkLCBo
YXJ0aWQsIG1vZGVzLCBtOworICAgIGNvbnN0IGNoYXIgKnA7CisgICAgY2hh
ciBjOworCisgICAgLyogY291bnQgYW5kIHZhbGlkYXRlIGhhcnQvbW9kZSBj
b21iaW5hdGlvbnMgKi8KKyAgICBhZGRyaWQgPSAwLCBoYXJ0aWQgPSAwLCBt
b2RlcyA9IDA7CisgICAgcCA9IHBsaWMtPmhhcnRfY29uZmlnOworICAgIHdo
aWxlICgoYyA9ICpwKyspKSB7CisgICAgICAgIGlmIChjID09ICcsJykgewor
ICAgICAgICAgICAgaWYgKG1vZGVzKSB7CisgICAgICAgICAgICAgICAgYWRk
cmlkICs9IGN0cG9wOChtb2Rlcyk7CisgICAgICAgICAgICAgICAgaGFydGlk
Kys7CisgICAgICAgICAgICAgICAgbW9kZXMgPSAwOworICAgICAgICAgICAg
fQorICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgbSA9IDEgPDwgY2hh
cl90b19tb2RlKGMpOworICAgICAgICAgICAgaWYgKG1vZGVzID09IChtb2Rl
cyB8IG0pKSB7CisgICAgICAgICAgICAgICAgZXJyb3JfcmVwb3J0KCJwbGlj
OiBkdXBsaWNhdGUgbW9kZSAnJWMnIGluIGNvbmZpZzogJXMiLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBjLCBwbGljLT5oYXJ0X2NvbmZpZyk7
CisgICAgICAgICAgICAgICAgZXhpdCgxKTsKKyAgICAgICAgICAgIH0KKyAg
ICAgICAgICAgIG1vZGVzIHw9IG07CisgICAgICAgIH0KKyAgICB9CisgICAg
aWYgKG1vZGVzKSB7CisgICAgICAgIGFkZHJpZCArPSBjdHBvcDgobW9kZXMp
OworICAgICAgICBoYXJ0aWQrKzsKKyAgICAgICAgbW9kZXMgPSAwOworICAg
IH0KKworICAgIHBsaWMtPm51bV9hZGRycyA9IGFkZHJpZDsKKyAgICBwbGlj
LT5udW1faGFydHMgPSBoYXJ0aWQ7CisKKyAgICAvKiBzdG9yZSBoYXJ0L21v
ZGUgY29tYmluYXRpb25zICovCisgICAgcGxpYy0+YWRkcl9jb25maWcgPSBn
X25ldyhQTElDQWRkciwgcGxpYy0+bnVtX2FkZHJzKTsKKyAgICBhZGRyaWQg
PSAwLCBoYXJ0aWQgPSBwbGljLT5oYXJ0aWRfYmFzZTsKKyAgICBwID0gcGxp
Yy0+aGFydF9jb25maWc7CisgICAgd2hpbGUgKChjID0gKnArKykpIHsKKyAg
ICAgICAgaWYgKGMgPT0gJywnKSB7CisgICAgICAgICAgICBpZiAobW9kZXMp
IHsKKyAgICAgICAgICAgICAgICBoYXJ0aWQrKzsKKyAgICAgICAgICAgICAg
ICBtb2RlcyA9IDA7CisgICAgICAgICAgICB9CisgICAgICAgIH0gZWxzZSB7
CisgICAgICAgICAgICBtID0gY2hhcl90b19tb2RlKGMpOworICAgICAgICAg
ICAgcGxpYy0+YWRkcl9jb25maWdbYWRkcmlkXS5hZGRyaWQgPSBhZGRyaWQ7
CisgICAgICAgICAgICBwbGljLT5hZGRyX2NvbmZpZ1thZGRyaWRdLmhhcnRp
ZCA9IGhhcnRpZDsKKyAgICAgICAgICAgIHBsaWMtPmFkZHJfY29uZmlnW2Fk
ZHJpZF0ubW9kZSA9IG07CisgICAgICAgICAgICBtb2RlcyB8PSAoMSA8PCBt
KTsKKyAgICAgICAgICAgIGFkZHJpZCsrOworICAgICAgICB9CisgICAgfQor
fQorCitzdGF0aWMgdm9pZCB2ZWdhX3BsaWNfaXJxX3JlcXVlc3Qodm9pZCAq
b3BhcXVlLCBpbnQgaXJxLCBpbnQgbGV2ZWwpCit7CisgICAgVmVnYVBMSUNT
dGF0ZSAqcyA9IG9wYXF1ZTsKKworICAgIGlmIChsZXZlbCA+IDApIHsKKyAg
ICAgICAgdmVnYV9wbGljX3NldF9wZW5kaW5nKHMsIGlycSwgdHJ1ZSk7Cisg
ICAgICAgIHZlZ2FfcGxpY191cGRhdGUocyk7CisgICAgfQorfQorCitzdGF0
aWMgdm9pZCB2ZWdhX3BsaWNfcmVhbGl6ZShEZXZpY2VTdGF0ZSAqZGV2LCBF
cnJvciAqKmVycnApCit7CisgICAgVmVnYVBMSUNTdGF0ZSAqcyA9IFZFR0Ff
UExJQyhkZXYpOworICAgIGludCBpOworCisgICAgbWVtb3J5X3JlZ2lvbl9p
bml0X2lvKCZzLT5tbWlvLCBPQkpFQ1QoZGV2KSwgJnZlZ2FfcGxpY19vcHMs
IHMsCisgICAgICAgICAgICAgICAgICAgICAgICAgIFRZUEVfVkVHQV9QTElD
LCBzLT5hcGVydHVyZV9zaXplKTsKKyAgICBzeXNidXNfaW5pdF9tbWlvKFNZ
U19CVVNfREVWSUNFKGRldiksICZzLT5tbWlvKTsKKworICAgIHBhcnNlX2hh
cnRfY29uZmlnKHMpOworCisgICAgaWYgKCFzLT5udW1fc291cmNlcykgewor
ICAgICAgICBlcnJvcl9zZXRnKGVycnAsICJwbGljOiBpbnZhbGlkIG51bWJl
ciBvZiBpbnRlcnJ1cHQgc291cmNlcyIpOworICAgICAgICByZXR1cm47Cisg
ICAgfQorCisgICAgcy0+Yml0ZmllbGRfd29yZHMgPSAocy0+bnVtX3NvdXJj
ZXMgKyAzMSkgPj4gNTsKKyAgICBzLT5udW1fZW5hYmxlcyA9IHMtPmJpdGZp
ZWxkX3dvcmRzICogcy0+bnVtX2FkZHJzOworICAgIHMtPnNvdXJjZV9wcmlv
cml0eSA9IGdfbmV3MCh1aW50MzJfdCwgcy0+bnVtX3NvdXJjZXMpOworICAg
IHMtPnRhcmdldF9wcmlvcml0eSA9IGdfbmV3KHVpbnQzMl90LCBzLT5udW1f
YWRkcnMpOworICAgIHMtPnBlbmRpbmcgPSBnX25ldzAodWludDMyX3QsIHMt
PmJpdGZpZWxkX3dvcmRzKTsKKyAgICBzLT5jbGFpbWVkID0gZ19uZXcwKHVp
bnQzMl90LCBzLT5iaXRmaWVsZF93b3Jkcyk7CisgICAgcy0+ZW5hYmxlID0g
Z19uZXcwKHVpbnQzMl90LCBzLT5udW1fZW5hYmxlcyk7CisKKyAgICBxZGV2
X2luaXRfZ3Bpb19pbihkZXYsIHZlZ2FfcGxpY19pcnFfcmVxdWVzdCwgcy0+
bnVtX3NvdXJjZXMpOworCisgICAgcy0+c19leHRlcm5hbF9pcnFzID0gZ19t
YWxsb2Moc2l6ZW9mKHFlbXVfaXJxKSAqIHMtPm51bV9oYXJ0cyk7CisgICAg
cWRldl9pbml0X2dwaW9fb3V0KGRldiwgcy0+c19leHRlcm5hbF9pcnFzLCBz
LT5udW1faGFydHMpOworCisgICAgcy0+bV9leHRlcm5hbF9pcnFzID0gZ19t
YWxsb2Moc2l6ZW9mKHFlbXVfaXJxKSAqIHMtPm51bV9oYXJ0cyk7CisgICAg
cWRldl9pbml0X2dwaW9fb3V0KGRldiwgcy0+bV9leHRlcm5hbF9pcnFzLCBz
LT5udW1faGFydHMpOworCisgICAgLyoKKyAgICAgKiBXZSBjYW4ndCBhbGxv
dyB0aGUgc3VwZXJ2aXNvciB0byBjb250cm9sIFNFSVAgYXMgdGhpcyB3b3Vs
ZCBhbGxvdyB0aGUKKyAgICAgKiBzdXBlcnZpc29yIHRvIGNsZWFyIGEgcGVu
ZGluZyBleHRlcm5hbCBpbnRlcnJ1cHQgd2hpY2ggd2lsbCByZXN1bHQgaW4K
KyAgICAgKiBsb3N0IGEgaW50ZXJydXB0IGluIHRoZSBjYXNlIGEgUExJQyBp
cyBhdHRhY2hlZC4gVGhlIFNFSVAgYml0IG11c3QgYmUKKyAgICAgKiBoYXJk
d2FyZSBjb250cm9sbGVkIHdoZW4gYSBQTElDIGlzIGF0dGFjaGVkLgorICAg
ICAqLworICAgIGZvciAoaSA9IDA7IGkgPCBzLT5udW1faGFydHM7IGkrKykg
eworICAgICAgICBSSVNDVkNQVSAqY3B1ID0gUklTQ1ZfQ1BVKHFlbXVfZ2V0
X2NwdShzLT5oYXJ0aWRfYmFzZSArIGkpKTsKKyAgICAgICAgaWYgKHJpc2N2
X2NwdV9jbGFpbV9pbnRlcnJ1cHRzKGNwdSwgTUlQX1NFSVApIDwgMCkgewor
ICAgICAgICAgICAgZXJyb3Jfc2V0ZyhlcnJwLCAiU0VJUCBhbHJlYWR5IGNs
YWltZWQiKTsKKyAgICAgICAgICAgIHJldHVybjsKKyAgICAgICAgfQorICAg
IH0KKworICAgIG1zaV9ub25icm9rZW4gPSB0cnVlOworfQorCitzdGF0aWMg
Y29uc3QgVk1TdGF0ZURlc2NyaXB0aW9uIHZtc3RhdGVfdmVnYV9wbGljID0g
eworICAgIC5uYW1lID0gInJpc2N2X3ZlZ2FfcGxpYyIsCisgICAgLnZlcnNp
b25faWQgPSAxLAorICAgIC5taW5pbXVtX3ZlcnNpb25faWQgPSAxLAorICAg
IC5maWVsZHMgPSAoY29uc3QgVk1TdGF0ZUZpZWxkW10pIHsKKyAgICAgICAg
ICAgIFZNU1RBVEVfVkFSUkFZX1VJTlQzMihzb3VyY2VfcHJpb3JpdHksIFZl
Z2FQTElDU3RhdGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgbnVtX3NvdXJjZXMsIDAsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdm1zdGF0ZV9pbmZvX3VpbnQzMiwgdWludDMyX3QpLAorICAg
ICAgICAgICAgVk1TVEFURV9WQVJSQVlfVUlOVDMyKHRhcmdldF9wcmlvcml0
eSwgVmVnYVBMSUNTdGF0ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBudW1fYWRkcnMsIDAsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdm1zdGF0ZV9pbmZvX3VpbnQzMiwgdWludDMyX3QpLAor
ICAgICAgICAgICAgVk1TVEFURV9WQVJSQVlfVUlOVDMyKHBlbmRpbmcsIFZl
Z2FQTElDU3RhdGUsIGJpdGZpZWxkX3dvcmRzLCAwLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHZtc3RhdGVfaW5mb191aW50MzIsIHVp
bnQzMl90KSwKKyAgICAgICAgICAgIFZNU1RBVEVfVkFSUkFZX1VJTlQzMihj
bGFpbWVkLCBWZWdhUExJQ1N0YXRlLCBiaXRmaWVsZF93b3JkcywgMCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bXN0YXRlX2luZm9f
dWludDMyLCB1aW50MzJfdCksCisgICAgICAgICAgICBWTVNUQVRFX1ZBUlJB
WV9VSU5UMzIoZW5hYmxlLCBWZWdhUExJQ1N0YXRlLCBudW1fZW5hYmxlcywg
MCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bXN0YXRl
X2luZm9fdWludDMyLCB1aW50MzJfdCksCisgICAgICAgICAgICBWTVNUQVRF
X0VORF9PRl9MSVNUKCkKKyAgICAgICAgfQorfTsKKworc3RhdGljIGNvbnN0
IFByb3BlcnR5IHZlZ2FfcGxpY19wcm9wZXJ0aWVzW10gPSB7CisgICAgREVG
SU5FX1BST1BfU1RSSU5HKCJoYXJ0LWNvbmZpZyIsIFZlZ2FQTElDU3RhdGUs
IGhhcnRfY29uZmlnKSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoImhhcnRp
ZC1iYXNlIiwgVmVnYVBMSUNTdGF0ZSwgaGFydGlkX2Jhc2UsIDApLAorICAg
IC8qIG51bWJlciBvZiBpbnRlcnJ1cHQgc291cmNlcyBpbmNsdWRpbmcgaW50
ZXJydXB0IHNvdXJjZSAwICovCisgICAgREVGSU5FX1BST1BfVUlOVDMyKCJu
dW0tc291cmNlcyIsIFZlZ2FQTElDU3RhdGUsIG51bV9zb3VyY2VzLCAxKSwK
KyAgICBERUZJTkVfUFJPUF9VSU5UMzIoIm51bS1wcmlvcml0aWVzIiwgVmVn
YVBMSUNTdGF0ZSwgbnVtX3ByaW9yaXRpZXMsIDApLAorICAgIC8qIGludGVy
cnVwdCBwcmlvcml0eSByZWdpc3RlciBiYXNlIHN0YXJ0aW5nIGZyb20gc291
cmNlIDAgKi8KKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoInByaW9yaXR5LWJh
c2UiLCBWZWdhUExJQ1N0YXRlLCBwcmlvcml0eV9iYXNlLCAwKSwKKyAgICBE
RUZJTkVfUFJPUF9VSU5UMzIoInBlbmRpbmctYmFzZSIsIFZlZ2FQTElDU3Rh
dGUsIHBlbmRpbmdfYmFzZSwgMCksCisgICAgREVGSU5FX1BST1BfVUlOVDMy
KCJlbmFibGUtYmFzZSIsIFZlZ2FQTElDU3RhdGUsIGVuYWJsZV9iYXNlLCAw
KSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoImVuYWJsZS1zdHJpZGUiLCBW
ZWdhUExJQ1N0YXRlLCBlbmFibGVfc3RyaWRlLCAwKSwKKyAgICBERUZJTkVf
UFJPUF9VSU5UMzIoImNvbnRleHQtYmFzZSIsIFZlZ2FQTElDU3RhdGUsIGNv
bnRleHRfYmFzZSwgMCksCisgICAgREVGSU5FX1BST1BfVUlOVDMyKCJjb250
ZXh0LXN0cmlkZSIsIFZlZ2FQTElDU3RhdGUsIGNvbnRleHRfc3RyaWRlLCAw
KSwKKyAgICBERUZJTkVfUFJPUF9VSU5UMzIoImFwZXJ0dXJlLXNpemUiLCBW
ZWdhUExJQ1N0YXRlLCBhcGVydHVyZV9zaXplLCAwKSwKK307CisKK3N0YXRp
YyB2b2lkIHZlZ2FfcGxpY19jbGFzc19pbml0KE9iamVjdENsYXNzICprbGFz
cywgY29uc3Qgdm9pZCAqZGF0YSkKK3sKKyAgICBEZXZpY2VDbGFzcyAqZGMg
PSBERVZJQ0VfQ0xBU1Moa2xhc3MpOworCisgICAgZGV2aWNlX2NsYXNzX3Nl
dF9sZWdhY3lfcmVzZXQoZGMsIHZlZ2FfcGxpY19yZXNldCk7CisgICAgZGV2
aWNlX2NsYXNzX3NldF9wcm9wcyhkYywgdmVnYV9wbGljX3Byb3BlcnRpZXMp
OworICAgIGRjLT5yZWFsaXplID0gdmVnYV9wbGljX3JlYWxpemU7CisgICAg
ZGMtPnZtc2QgPSAmdm1zdGF0ZV92ZWdhX3BsaWM7Cit9CisKK3N0YXRpYyBj
b25zdCBUeXBlSW5mbyB2ZWdhX3BsaWNfaW5mbyA9IHsKKyAgICAubmFtZSAg
ICAgICAgICA9IFRZUEVfVkVHQV9QTElDLAorICAgIC5wYXJlbnQgICAgICAg
ID0gVFlQRV9TWVNfQlVTX0RFVklDRSwKKyAgICAuaW5zdGFuY2Vfc2l6ZSA9
IHNpemVvZihWZWdhUExJQ1N0YXRlKSwKKyAgICAuY2xhc3NfaW5pdCAgICA9
IHZlZ2FfcGxpY19jbGFzc19pbml0LAorfTsKKworc3RhdGljIHZvaWQgdmVn
YV9wbGljX3JlZ2lzdGVyX3R5cGVzKHZvaWQpCit7CisgICAgdHlwZV9yZWdp
c3Rlcl9zdGF0aWMoJnZlZ2FfcGxpY19pbmZvKTsKK30KKwordHlwZV9pbml0
KHZlZ2FfcGxpY19yZWdpc3Rlcl90eXBlcykKKworLyoKKyAqIENyZWF0ZSBQ
TElDIGRldmljZS4KKyAqLworRGV2aWNlU3RhdGUgKnZlZ2FfcGxpY19jcmVh
dGUoaHdhZGRyIGFkZHIsIGNoYXIgKmhhcnRfY29uZmlnLAorICAgIHVpbnQz
Ml90IG51bV9oYXJ0cywKKyAgICB1aW50MzJfdCBoYXJ0aWRfYmFzZSwgdWlu
dDMyX3QgbnVtX3NvdXJjZXMsCisgICAgdWludDMyX3QgbnVtX3ByaW9yaXRp
ZXMsIHVpbnQzMl90IHByaW9yaXR5X2Jhc2UsCisgICAgdWludDMyX3QgcGVu
ZGluZ19iYXNlLCB1aW50MzJfdCBlbmFibGVfYmFzZSwKKyAgICB1aW50MzJf
dCBlbmFibGVfc3RyaWRlLCB1aW50MzJfdCBjb250ZXh0X2Jhc2UsCisgICAg
dWludDMyX3QgY29udGV4dF9zdHJpZGUsIHVpbnQzMl90IGFwZXJ0dXJlX3Np
emUpCit7CisgICAgRGV2aWNlU3RhdGUgKmRldiA9IHFkZXZfbmV3KFRZUEVf
VkVHQV9QTElDKTsKKyAgICBpbnQgaTsKKyAgICBWZWdhUExJQ1N0YXRlICpw
bGljOworCisgICAgYXNzZXJ0KGVuYWJsZV9zdHJpZGUgPT0gKGVuYWJsZV9z
dHJpZGUgJiAtZW5hYmxlX3N0cmlkZSkpOworICAgIGFzc2VydChjb250ZXh0
X3N0cmlkZSA9PSAoY29udGV4dF9zdHJpZGUgJiAtY29udGV4dF9zdHJpZGUp
KTsKKyAgICBxZGV2X3Byb3Bfc2V0X3N0cmluZyhkZXYsICJoYXJ0LWNvbmZp
ZyIsIGhhcnRfY29uZmlnKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihk
ZXYsICJoYXJ0aWQtYmFzZSIsIGhhcnRpZF9iYXNlKTsKKyAgICBxZGV2X3By
b3Bfc2V0X3VpbnQzMihkZXYsICJudW0tc291cmNlcyIsIG51bV9zb3VyY2Vz
KTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJudW0tcHJpb3Jp
dGllcyIsIG51bV9wcmlvcml0aWVzKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3Vp
bnQzMihkZXYsICJwcmlvcml0eS1iYXNlIiwgcHJpb3JpdHlfYmFzZSk7Cisg
ICAgcWRldl9wcm9wX3NldF91aW50MzIoZGV2LCAicGVuZGluZy1iYXNlIiwg
cGVuZGluZ19iYXNlKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYs
ICJlbmFibGUtYmFzZSIsIGVuYWJsZV9iYXNlKTsKKyAgICBxZGV2X3Byb3Bf
c2V0X3VpbnQzMihkZXYsICJlbmFibGUtc3RyaWRlIiwgZW5hYmxlX3N0cmlk
ZSk7CisgICAgcWRldl9wcm9wX3NldF91aW50MzIoZGV2LCAiY29udGV4dC1i
YXNlIiwgY29udGV4dF9iYXNlKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQz
MihkZXYsICJjb250ZXh0LXN0cmlkZSIsIGNvbnRleHRfc3RyaWRlKTsKKyAg
ICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihkZXYsICJhcGVydHVyZS1zaXplIiwg
YXBlcnR1cmVfc2l6ZSk7CisgICAgc3lzYnVzX3JlYWxpemVfYW5kX3VucmVm
KFNZU19CVVNfREVWSUNFKGRldiksICZlcnJvcl9mYXRhbCk7CisgICAgc3lz
YnVzX21taW9fbWFwKFNZU19CVVNfREVWSUNFKGRldiksIDAsIGFkZHIpOwor
CisgICAgcGxpYyA9IFZFR0FfUExJQyhkZXYpOworCisgICAgZm9yIChpID0g
MDsgaSA8IHBsaWMtPm51bV9hZGRyczsgaSsrKSB7CisgICAgICAgIGludCBj
cHVfbnVtID0gcGxpYy0+YWRkcl9jb25maWdbaV0uaGFydGlkOworICAgICAg
ICBDUFVTdGF0ZSAqY3B1ID0gcWVtdV9nZXRfY3B1KGNwdV9udW0pOworCisg
ICAgICAgIGlmIChwbGljLT5hZGRyX2NvbmZpZ1tpXS5tb2RlID09IFBMSUNN
b2RlX00pIHsKKyAgICAgICAgICAgIHFkZXZfY29ubmVjdF9ncGlvX291dChk
ZXYsIGNwdV9udW0gLSBoYXJ0aWRfYmFzZSArIG51bV9oYXJ0cywKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZGV2X2dldF9ncGlvX2lu
KERFVklDRShjcHUpLCBJUlFfTV9FWFQpKTsKKyAgICAgICAgfQorICAgICAg
ICBpZiAocGxpYy0+YWRkcl9jb25maWdbaV0ubW9kZSA9PSBQTElDTW9kZV9T
KSB7CisgICAgICAgICAgICBxZGV2X2Nvbm5lY3RfZ3Bpb19vdXQoZGV2LCBj
cHVfbnVtIC0gaGFydGlkX2Jhc2UsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcWRldl9nZXRfZ3Bpb19pbihERVZJQ0UoY3B1KSwgSVJR
X1NfRVhUKSk7CisgICAgICAgIH0KKyAgICB9CisKKyAgICByZXR1cm4gZGV2
OworfQpcIE5vIG5ld2xpbmUgYXQgZW5kIG9mIGZpbGUKZGlmZiAtLWdpdCBh
L2h3L3Jpc2N2L0tjb25maWcgYi9ody9yaXNjdi9LY29uZmlnCmluZGV4IGZj
OWMzNWJkOTguLjBkZWZlMWI3ZDMgMTAwNjQ0Ci0tLSBhL2h3L3Jpc2N2L0tj
b25maWcKKysrIGIvaHcvcmlzY3YvS2NvbmZpZwpAQCAtMTI4LDMgKzEyOCwz
MSBAQCBjb25maWcgWElBTkdTSEFOX0tVTk1JTkdIVQogICAgIHNlbGVjdCBS
SVNDVl9BUExJQwogICAgIHNlbGVjdCBSSVNDVl9JTVNJQwogICAgIHNlbGVj
dCBTRVJJQUxfTU0KKyAgICAKK2NvbmZpZyBWRUdBCisgICAgYm9vbAorICAg
IGRlZmF1bHQgeQorICAgIGRlcGVuZHMgb24gUklTQ1YzMiB8fCBSSVNDVjY0
CisgICAgaW1wbHkgUENJX0RFVklDRVMKKyAgICBpbXBseSBWSVJUSU9fVkdB
CisgICAgaW1wbHkgVEVTVF9ERVZJQ0VTCisgICAgaW1wbHkgVFBNX1RJU19T
WVNCVVMKKyAgICBzZWxlY3QgREVWSUNFX1RSRUUKKyAgICBzZWxlY3QgUklT
Q1ZfTlVNQQorICAgIHNlbGVjdCBHT0xERklTSF9SVEMKKyAgICBzZWxlY3Qg
UENJCisgICAgc2VsZWN0IFBDSV9FWFBSRVNTX0dFTkVSSUNfQlJJREdFCisg
ICAgc2VsZWN0IFBGTEFTSF9DRkkwMQorICAgIHNlbGVjdCBTRVJJQUxfTU0K
KyAgICBzZWxlY3QgVkVHQV9BQ0xJTlQgIAorICAgIHNlbGVjdCBSSVNDVl9B
UExJQworICAgIHNlbGVjdCBSSVNDVl9JT01NVQorICAgIHNlbGVjdCBSSVND
Vl9JTVNJQworICAgIHNlbGVjdCBWRUdBX1BMSUMgICAgCisgICAgc2VsZWN0
IFNJRklWRV9URVNUCisgICAgc2VsZWN0IFNNQklPUworICAgIHNlbGVjdCBW
SVJUSU9fTU1JTworICAgIHNlbGVjdCBGV19DRkdfRE1BCisgICAgc2VsZWN0
IFBMQVRGT1JNX0JVUworICAgIHNlbGVjdCBBQ1BJCisgICAgc2VsZWN0IEFD
UElfUENJCmRpZmYgLS1naXQgYS9ody9yaXNjdi9tZXNvbi5idWlsZCBiL2h3
L3Jpc2N2L21lc29uLmJ1aWxkCmluZGV4IDJhOGQ1YjEzNmMuLmZlNTA0ZTY4
MTkgMTAwNjQ0Ci0tLSBhL2h3L3Jpc2N2L21lc29uLmJ1aWxkCisrKyBiL2h3
L3Jpc2N2L21lc29uLmJ1aWxkCkBAIC0xNCw1ICsxNCw2IEBAIHJpc2N2X3Nz
LmFkZCh3aGVuOiAnQ09ORklHX1JJU0NWX0lPTU1VJywgaWZfdHJ1ZTogZmls
ZXMoCiAJJ3Jpc2N2LWlvbW11LmMnLCAncmlzY3YtaW9tbXUtcGNpLmMnLCAn
cmlzY3YtaW9tbXUtc3lzLmMnLCAncmlzY3YtaW9tbXUtaHBtLmMnKSkKIHJp
c2N2X3NzLmFkZCh3aGVuOiAnQ09ORklHX01JQ1JPQkxBWkVfVicsIGlmX3Ry
dWU6IGZpbGVzKCdtaWNyb2JsYXplLXYtZ2VuZXJpYy5jJykpCiByaXNjdl9z
cy5hZGQod2hlbjogJ0NPTkZJR19YSUFOR1NIQU5fS1VOTUlOR0hVJywgaWZf
dHJ1ZTogZmlsZXMoJ3hpYW5nc2hhbl9rbWguYycpKQorcmlzY3Zfc3MuYWRk
KHdoZW46ICdDT05GSUdfVkVHQScsIGlmX3RydWU6IGZpbGVzKCd2ZWdhLmMn
KSkgIAogCiBod19hcmNoICs9IHsncmlzY3YnOiByaXNjdl9zc30KZGlmZiAt
LWdpdCBhL2h3L3Jpc2N2L3ZlZ2EuYyBiL2h3L3Jpc2N2L3ZlZ2EuYwpuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi5mN2U3OGYyNGRi
Ci0tLSAvZGV2L251bGwKKysrIGIvaHcvcmlzY3YvdmVnYS5jCkBAIC0wLDAg
KzEsMjA3NiBAQAorLyoKKyAqIFFFTVUgUklTQy1WIFZpcnRJTyBCb2FyZAor
ICovCisKKyNpbmNsdWRlICJxZW11L29zZGVwLmgiCisjaW5jbHVkZSAicWVt
dS91bml0cy5oIgorI2luY2x1ZGUgInFlbXUvZXJyb3ItcmVwb3J0LmgiCisj
aW5jbHVkZSAicWVtdS9ndWVzdC1yYW5kb20uaCIKKyNpbmNsdWRlICJxYXBp
L2Vycm9yLmgiCisjaW5jbHVkZSAiaHcvYm9hcmRzLmgiCisjaW5jbHVkZSAi
aHcvbG9hZGVyLmgiCisjaW5jbHVkZSAiaHcvc3lzYnVzLmgiCisjaW5jbHVk
ZSAiaHcvcWRldi1wcm9wZXJ0aWVzLmgiCisjaW5jbHVkZSAiaHcvY2hhci9z
ZXJpYWwtbW0uaCIKKyNpbmNsdWRlICJ0YXJnZXQvcmlzY3YvY3B1LmgiCisj
aW5jbHVkZSAiaHcvY29yZS9zeXNidXMtZmR0LmgiCisjaW5jbHVkZSAidGFy
Z2V0L3Jpc2N2L3BtdS5oIgorI2luY2x1ZGUgImh3L3Jpc2N2L3Jpc2N2X2hh
cnQuaCIKKyNpbmNsdWRlICJody9yaXNjdi9pb21tdS5oIgorI2luY2x1ZGUg
Imh3L3Jpc2N2L3Jpc2N2LWlvbW11LWJpdHMuaCIKKyNpbmNsdWRlICJody9y
aXNjdi92ZWdhLmgiICAgICAgICAgICAgICAgICAgCisjaW5jbHVkZSAiaHcv
cmlzY3YvYm9vdC5oIgorI2luY2x1ZGUgImh3L3Jpc2N2L251bWEuaCIKKyNp
bmNsdWRlICJrdm0va3ZtX3Jpc2N2LmgiCisjaW5jbHVkZSAiaHcvZmlybXdh
cmUvc21iaW9zLmgiCisjaW5jbHVkZSAiaHcvaW50Yy92ZWdhX2FjbGludC5o
IgorI2luY2x1ZGUgImh3L2ludGMvcmlzY3ZfYXBsaWMuaCIKKyNpbmNsdWRl
ICJody9pbnRjL3ZlZ2FfcGxpYy5oIgorI2luY2x1ZGUgImh3L21pc2Mvc2lm
aXZlX3Rlc3QuaCIKKyNpbmNsdWRlICJody9wbGF0Zm9ybS1idXMuaCIKKyNp
bmNsdWRlICJjaGFyZGV2L2NoYXIuaCIKKyNpbmNsdWRlICJzeXN0ZW0vZGV2
aWNlX3RyZWUuaCIKKyNpbmNsdWRlICJzeXN0ZW0vc3lzdGVtLmgiCisjaW5j
bHVkZSAic3lzdGVtL3RjZy5oIgorI2luY2x1ZGUgInN5c3RlbS9rdm0uaCIK
KyNpbmNsdWRlICJzeXN0ZW0vdHBtLmgiCisjaW5jbHVkZSAic3lzdGVtL3F0
ZXN0LmgiCisjaW5jbHVkZSAiaHcvcGNpL3BjaS5oIgorI2luY2x1ZGUgImh3
L3BjaS1ob3N0L2dwZXguaCIKKyNpbmNsdWRlICJody9kaXNwbGF5L3JhbWZi
LmgiCisjaW5jbHVkZSAiaHcvYWNwaS9hbWwtYnVpbGQuaCIKKyNpbmNsdWRl
ICJxYXBpL3FhcGktdmlzaXQtY29tbW9uLmgiCisjaW5jbHVkZSAiaHcvdmly
dGlvL3ZpcnRpby1pb21tdS5oIgorI2luY2x1ZGUgImh3L3VlZmkvdmFyLXNl
cnZpY2UtYXBpLmgiCisjaW5jbHVkZSAiaHcvbWlzYy91bmltcC5oIgorCitz
dGF0aWMgdWludDY0X3QgdmVnYV9kcmFtX2Jhc2VfcHJvcGVydHk7CisKKy8q
IEtWTSBBSUEgb25seSBzdXBwb3J0cyBBUExJQyBNU0kuIEFQTElDIFdpcmVk
IGlzIGFsd2F5cyBlbXVsYXRlZCBieSBRRU1VLiAqLworc3RhdGljIGJvb2wg
dmVnYV91c2Vfa3ZtX2FpYV9hcGxpY19pbXNpYyhSSVNDVlZlZ2FBSUFUeXBl
IGFpYV90eXBlKQoreworICAgIGJvb2wgbXNpbW9kZSA9IGFpYV90eXBlID09
IFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUM7CisKKyAgICByZXR1cm4gcmlz
Y3ZfaXNfa3ZtX2FpYV9hcGxpY19pbXNpYyhtc2ltb2RlKTsKK30KKworc3Rh
dGljIGJvb2wgdmVnYV91c2VfZW11bGF0ZWRfYXBsaWMoUklTQ1ZWZWdhQUlB
VHlwZSBhaWFfdHlwZSkKK3sKKyAgICBib29sIG1zaW1vZGUgPSBhaWFfdHlw
ZSA9PSBWRUdBX0FJQV9UWVBFX0FQTElDX0lNU0lDOworCisgICAgcmV0dXJu
IHJpc2N2X3VzZV9lbXVsYXRlZF9hcGxpYyhtc2ltb2RlKTsKK30KKworc3Rh
dGljIGJvb2wgdmVnYV9hY2xpbnRfYWxsb3dlZCh2b2lkKQoreworICAgIHJl
dHVybiB0Y2dfZW5hYmxlZCgpIHx8IHF0ZXN0X2VuYWJsZWQoKTsKK30KKwor
c3RhdGljICBNZW1NYXBFbnRyeSB2ZWdhX21lbW1hcFtdID0geworICAgIFtW
RUdBX0RFQlVHXSA9ICAgICAgICB7ICAgICAgICAweDAsICAgICAgICAgMHgx
MDAgfSwKKyAgICBbVkVHQV9NUk9NXSA9ICAgICAgICAgeyAgICAgMHgxMDAw
LCAgICAgICAgMHhmMDAwIH0sCisgICAgW1ZFR0FfVEVTVF0gPSAgICAgICAg
IHsgICAweDEwMDAwMCwgICAgICAgIDB4MTAwMCB9LAorICAgIFtWRUdBX1JU
Q10gPSAgICAgICAgICB7ICAgMHgxMDEwMDAsICAgICAgICAweDEwMDAgfSwK
KyAgICBbVkVHQV9DTElOVF0gPSAgICAgICAgeyAgMHgyMDAwMDAwLCAgICAg
ICAweDEwMDAwIH0sCisgICAgW1ZFR0FfQUNMSU5UX1NTV0ldID0gIHsgIDB4
MkYwMDAwMCwgICAgICAgIDB4NDAwMCB9LAorICAgIFtWRUdBX1BDSUVfUElP
XSA9ICAgICB7ICAweDMwMDAwMDAsICAgICAgIDB4MTAwMDAgfSwKKyAgICBb
VkVHQV9JT01NVV9TWVNdID0gICAgeyAgMHgzMDEwMDAwLCAgICAgICAgMHgx
MDAwIH0sCisgICAgW1ZFR0FfUExBVEZPUk1fQlVTXSA9IHsgIDB4NDAwMDAw
MCwgICAgIDB4MjAwMDAwMCB9LAorICAgIFtWRUdBX1BMSUNfSURdID0gICAg
ICAgICB7ICAweGMwMDAwMDAsIFZFR0FfUExJQ19TSVpFKFZFR0FfQ1BVU19N
QVggKiAyKSB9LAorICAgIFtWRUdBX0FQTElDX01dID0gICAgICB7ICAweGMw
MDAwMDAsIEFQTElDX1NJWkUoVkVHQV9DUFVTX01BWCkgfSwKKyAgICBbVkVH
QV9BUExJQ19TXSA9ICAgICAgeyAgMHhkMDAwMDAwLCBBUExJQ19TSVpFKFZF
R0FfQ1BVU19NQVgpIH0sCisgICAgW1ZFR0FfVUFSVDBdID0gICAgICAgIHsg
MHgxMDAwMDEwMCwgICAgICAgICAweDEwMCB9LAorICAgIFtWRUdBX1ZJUlRJ
T10gPSAgICAgICB7IDB4MTAwMDEwMDAsICAgICAgICAweDEwMDAgfSwKKyAg
ICBbVkVHQV9GV19DRkddID0gICAgICAgeyAweDEwMTAwMDAwLCAgICAgICAg
ICAweDE4IH0sCisgICAgW1ZFR0FfRkxBU0hdID0gICAgICAgIHsgMHgyMDAw
MDAwMCwgICAgIDB4NDAwMDAwMCB9LAorICAgIFtWRUdBX0lNU0lDX01dID0g
ICAgICB7IDB4MjQwMDAwMDAsIFZFR0FfSU1TSUNfTUFYX1NJWkUgfSwKKyAg
ICBbVkVHQV9JTVNJQ19TXSA9ICAgICAgeyAweDI4MDAwMDAwLCBWRUdBX0lN
U0lDX01BWF9TSVpFIH0sCisgICAgW1ZFR0FfUENJRV9FQ0FNXSA9ICAgIHsg
MHgzMDAwMDAwMCwgICAgMHgxMDAwMDAwMCB9LAorICAgIFtWRUdBX1BDSUVf
TU1JT10gPSAgICB7IDB4NDAwMDAwMDAsICAgIDB4NDAwMDAwMDAgfSwKKyAg
ICBbVkVHQV9VQVJUMV0gPSAgICAgICAgeyAweDEwMDAwMjAwLCAweDEwMCB9
LAorICAgIFtWRUdBX1VBUlQyXSA9ICAgICAgICB7IDB4MTAwMDAzMDAsIDB4
MTAwIH0sCisgICAgW1ZFR0FfVUFSVDNdID0gICAgICAgIHsgMHgxMDAwMDQw
MCwgMHgxMDAgfSwKKyAgICBbVkVHQV9VQVJUNF0gPSAgICAgICAgeyAweDEw
MDAwNTAwLCAweDEwMCB9LAorICAgIFtWRUdBX1NQSTBdICA9ICAgICAgICB7
IDB4MTAwMDA2MDAsIDB4MTAwIH0sCisgICAgW1ZFR0FfU1BJMV0gID0gICAg
ICAgIHsgMHgxMDAwMDcwMCwgMHgxMDAgfSwKKyAgICBbVkVHQV9JSUMwXSAg
PSAgICAgICAgeyAweDEwMDAwODAwLCAweDEwMCB9LAorICAgIFtWRUdBX0lJ
QzFdICA9ICAgICAgICB7IDB4MTAwMDA5MDAsIDB4MTAwIH0sCisgICAgW1ZF
R0FfRFJBTV0gPSAgICAgICAgIHsgMHg0MDAwMDAwMDAsIDB4MCB9LAorfTsK
KworLyogUENJZSBoaWdoIG1taW8gaXMgZml4ZWQgZm9yIFJWMzIgKi8KKyNk
ZWZpbmUgVkVHQTMyX0hJR0hfUENJRV9NTUlPX0JBU0UgIDB4MzAwMDAwMDAw
VUxMCisjZGVmaW5lIFZFR0EzMl9ISUdIX1BDSUVfTU1JT19TSVpFICAoNCAq
IEdpQikKKworLyogUENJZSBoaWdoIG1taW8gZm9yIFJWNjQsIHNpemUgaXMg
Zml4ZWQgYnV0IGJhc2UgZGVwZW5kcyBvbiB0b3Agb2YgUkFNICovCisjZGVm
aW5lIFZFR0E2NF9ISUdIX1BDSUVfTU1JT19TSVpFICAoMTYgKiBHaUIpCisK
K3N0YXRpYyBNZW1NYXBFbnRyeSB2ZWdhX2hpZ2hfcGNpZV9tZW1tYXA7CisK
KyNkZWZpbmUgVkVHQV9GTEFTSF9TRUNUT1JfU0laRSAoMjU2ICogS2lCKQor
CitzdGF0aWMgUEZsYXNoQ0ZJMDEgKnZlZ2FfZmxhc2hfY3JlYXRlMShSSVND
VlZlZ2FTdGF0ZSAqcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGNvbnN0IGNoYXIgKm5hbWUsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFyICphbGlhc19wcm9w
X25hbWUpCit7CisgICAgLyoKKyAgICAgKiBDcmVhdGUgYSBzaW5nbGUgZmxh
c2ggZGV2aWNlLiAgV2UgdXNlIHRoZSBzYW1lIHBhcmFtZXRlcnMgYXMKKyAg
ICAgKiB0aGUgZmxhc2ggZGV2aWNlcyBvbiB0aGUgQVJNIHZlZ2EgYm9hcmQu
CisgICAgICovCisgICAgRGV2aWNlU3RhdGUgKmRldiA9IHFkZXZfbmV3KFRZ
UEVfUEZMQVNIX0NGSTAxKTsKKworICAgIHFkZXZfcHJvcF9zZXRfdWludDY0
KGRldiwgInNlY3Rvci1sZW5ndGgiLCBWRUdBX0ZMQVNIX1NFQ1RPUl9TSVpF
KTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQ4KGRldiwgIndpZHRoIiwgNCk7
CisgICAgcWRldl9wcm9wX3NldF91aW50OChkZXYsICJkZXZpY2Utd2lkdGgi
LCAyKTsKKyAgICBxZGV2X3Byb3Bfc2V0X2JpdChkZXYsICJiaWctZW5kaWFu
IiwgZmFsc2UpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDE2KGRldiwgImlk
MCIsIDB4ODkpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDE2KGRldiwgImlk
MSIsIDB4MTgpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDE2KGRldiwgImlk
MiIsIDB4MDApOworICAgIHFkZXZfcHJvcF9zZXRfdWludDE2KGRldiwgImlk
MyIsIDB4MDApOworICAgIHFkZXZfcHJvcF9zZXRfc3RyaW5nKGRldiwgIm5h
bWUiLCBuYW1lKTsKKworICAgIG9iamVjdF9wcm9wZXJ0eV9hZGRfY2hpbGQo
T0JKRUNUKHMpLCBuYW1lLCBPQkpFQ1QoZGV2KSk7CisgICAgb2JqZWN0X3By
b3BlcnR5X2FkZF9hbGlhcyhPQkpFQ1QocyksIGFsaWFzX3Byb3BfbmFtZSwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9CSkVDVChkZXYpLCAi
ZHJpdmUiKTsKKworICAgIHJldHVybiBQRkxBU0hfQ0ZJMDEoZGV2KTsKK30K
Kworc3RhdGljIHZvaWQgdmVnYV9mbGFzaF9jcmVhdGUoUklTQ1ZWZWdhU3Rh
dGUgKnMpCit7CisgICAgcy0+Zmxhc2hbMF0gPSB2ZWdhX2ZsYXNoX2NyZWF0
ZTEocywgInZlZ2EuZmxhc2gwIiwgInBmbGFzaDAiKTsKKyAgICBzLT5mbGFz
aFsxXSA9IHZlZ2FfZmxhc2hfY3JlYXRlMShzLCAidmVnYS5mbGFzaDEiLCAi
cGZsYXNoMSIpOworfQorCitzdGF0aWMgdm9pZCB2ZWdhX2ZsYXNoX21hcDEo
UEZsYXNoQ0ZJMDEgKmZsYXNoLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGh3YWRkciBiYXNlLCBod2FkZHIgc2l6ZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBNZW1vcnlSZWdpb24gKnN5c21lbSkKK3sKKyAgICBE
ZXZpY2VTdGF0ZSAqZGV2ID0gREVWSUNFKGZsYXNoKTsKKworICAgIGFzc2Vy
dChRRU1VX0lTX0FMSUdORUQoc2l6ZSwgVkVHQV9GTEFTSF9TRUNUT1JfU0la
RSkpOworICAgIGFzc2VydChzaXplIC8gVkVHQV9GTEFTSF9TRUNUT1JfU0la
RSA8PSBVSU5UMzJfTUFYKTsKKyAgICBxZGV2X3Byb3Bfc2V0X3VpbnQzMihk
ZXYsICJudW0tYmxvY2tzIiwgc2l6ZSAvIFZFR0FfRkxBU0hfU0VDVE9SX1NJ
WkUpOworICAgIHN5c2J1c19yZWFsaXplX2FuZF91bnJlZihTWVNfQlVTX0RF
VklDRShkZXYpLCAmZXJyb3JfZmF0YWwpOworCisgICAgbWVtb3J5X3JlZ2lv
bl9hZGRfc3VicmVnaW9uKHN5c21lbSwgYmFzZSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3lzYnVzX21taW9fZ2V0X3JlZ2lvbihTWVNf
QlVTX0RFVklDRShkZXYpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIDApKTsKK30KKworc3RhdGlj
IHZvaWQgdmVnYV9mbGFzaF9tYXAoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICBNZW1vcnlSZWdpb24gKnN5c21lbSkK
K3sKKyAgICBod2FkZHIgZmxhc2hzaXplID0gcy0+bWVtbWFwW1ZFR0FfRkxB
U0hdLnNpemUgLyAyOworICAgIGh3YWRkciBmbGFzaGJhc2UgPSBzLT5tZW1t
YXBbVkVHQV9GTEFTSF0uYmFzZTsKKworICAgIHZlZ2FfZmxhc2hfbWFwMShz
LT5mbGFzaFswXSwgZmxhc2hiYXNlLCBmbGFzaHNpemUsCisgICAgICAgICAg
ICAgICAgICAgIHN5c21lbSk7CisgICAgdmVnYV9mbGFzaF9tYXAxKHMtPmZs
YXNoWzFdLCBmbGFzaGJhc2UgKyBmbGFzaHNpemUsIGZsYXNoc2l6ZSwKKyAg
ICAgICAgICAgICAgICAgICAgc3lzbWVtKTsKK30KKworc3RhdGljIHZvaWQg
Y3JlYXRlX3BjaWVfaXJxX21hcChSSVNDVlZlZ2FTdGF0ZSAqcywgdm9pZCAq
ZmR0LCBjaGFyICpub2RlbmFtZSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDMyX3QgaXJxY2hpcF9waGFuZGxlKQoreworICAgIGlu
dCBwaW4sIGRldjsKKyAgICB1aW50MzJfdCBpcnFfbWFwX3N0cmlkZSA9IDA7
CisgICAgdWludDMyX3QgZnVsbF9pcnFfbWFwW1BDSV9OVU1fUElOUyAqIFBD
SV9OVU1fUElOUyAqCisgICAgICAgICAgICAgICAgICAgICAgICAgIEZEVF9N
QVhfSU5UX01BUF9XSURUSF0gPSB7fTsKKyAgICB1aW50MzJfdCAqaXJxX21h
cCA9IGZ1bGxfaXJxX21hcDsKKworICAgIC8qIFRoaXMgY29kZSBjcmVhdGVz
IGEgc3RhbmRhcmQgc3dpenpsZSBvZiBpbnRlcnJ1cHRzIHN1Y2ggdGhhdAor
ICAgICAqIGVhY2ggZGV2aWNlJ3MgZmlyc3QgaW50ZXJydXB0IGlzIGJhc2Vk
IG9uIGl0J3MgUENJX1NMT1QgbnVtYmVyLgorICAgICAqIChTZWUgcGNpX3N3
aXp6bGVfbWFwX2lycV9mbigpKQorICAgICAqCisgICAgICogV2Ugb25seSBu
ZWVkIG9uZSBlbnRyeSBwZXIgaW50ZXJydXB0IGluIHRoZSB0YWJsZSAobm90
IG9uZSBwZXIKKyAgICAgKiBwb3NzaWJsZSBzbG90KSBzZWVpbmcgdGhlIGlu
dGVycnVwdC1tYXAtbWFzayB3aWxsIGFsbG93IHRoZSB0YWJsZQorICAgICAq
IHRvIHdyYXAgdG8gYW55IG51bWJlciBvZiBkZXZpY2VzLgorICAgICAqLwor
ICAgIGZvciAoZGV2ID0gMDsgZGV2IDwgUENJX05VTV9QSU5TOyBkZXYrKykg
eworICAgICAgICBpbnQgZGV2Zm4gPSBkZXYgKiAweDg7CisKKyAgICAgICAg
Zm9yIChwaW4gPSAwOyBwaW4gPCBQQ0lfTlVNX1BJTlM7IHBpbisrKSB7Cisg
ICAgICAgICAgICBpbnQgaXJxX25yID0gUENJRV9JUlEgKyAoKHBpbiArIFBD
SV9TTE9UKGRldmZuKSkgJSBQQ0lfTlVNX1BJTlMpOworICAgICAgICAgICAg
aW50IGkgPSAwOworCisgICAgICAgICAgICAvKiBGaWxsIFBDSSBhZGRyZXNz
IGNlbGxzICovCisgICAgICAgICAgICBpcnFfbWFwW2ldID0gY3B1X3RvX2Jl
MzIoZGV2Zm4gPDwgOCk7CisgICAgICAgICAgICBpICs9IEZEVF9QQ0lfQURE
Ul9DRUxMUzsKKworICAgICAgICAgICAgLyogRmlsbCBQQ0kgSW50ZXJydXB0
IGNlbGxzICovCisgICAgICAgICAgICBpcnFfbWFwW2ldID0gY3B1X3RvX2Jl
MzIocGluICsgMSk7CisgICAgICAgICAgICBpICs9IEZEVF9QQ0lfSU5UX0NF
TExTOworCisgICAgICAgICAgICAvKiBGaWxsIGludGVycnVwdCBjb250cm9s
bGVyIHBoYW5kbGUgYW5kIGNlbGxzICovCisgICAgICAgICAgICBpcnFfbWFw
W2krK10gPSBjcHVfdG9fYmUzMihpcnFjaGlwX3BoYW5kbGUpOworICAgICAg
ICAgICAgaXJxX21hcFtpKytdID0gY3B1X3RvX2JlMzIoaXJxX25yKTsKKyAg
ICAgICAgICAgIGlmIChzLT5haWFfdHlwZSAhPSBWRUdBX0FJQV9UWVBFX05P
TkUpIHsKKyAgICAgICAgICAgICAgICBpcnFfbWFwW2krK10gPSBjcHVfdG9f
YmUzMigweDQpOworICAgICAgICAgICAgfQorCisgICAgICAgICAgICBpZiAo
IWlycV9tYXBfc3RyaWRlKSB7CisgICAgICAgICAgICAgICAgaXJxX21hcF9z
dHJpZGUgPSBpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgaXJxX21h
cCArPSBpcnFfbWFwX3N0cmlkZTsKKyAgICAgICAgfQorICAgIH0KKworICAg
IHFlbXVfZmR0X3NldHByb3AoZmR0LCBub2RlbmFtZSwgImludGVycnVwdC1t
YXAiLCBmdWxsX2lycV9tYXAsCisgICAgICAgICAgICAgICAgICAgICBQQ0lf
TlVNX1BJTlMgKiBQQ0lfTlVNX1BJTlMgKgorICAgICAgICAgICAgICAgICAg
ICAgaXJxX21hcF9zdHJpZGUgKiBzaXplb2YodWludDMyX3QpKTsKKworICAg
IHFlbXVfZmR0X3NldHByb3BfY2VsbHMoZmR0LCBub2RlbmFtZSwgImludGVy
cnVwdC1tYXAtbWFzayIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAw
eDE4MDAsIDAsIDAsIDB4Nyk7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9m
ZHRfc29ja2V0X2NwdXMoUklTQ1ZWZWdhU3RhdGUgKnMsIGludCBzb2NrZXQs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgKmNs
dXN0X25hbWUsIHVpbnQzMl90ICpwaGFuZGxlLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAqaW50Y19waGFuZGxlcykK
K3sKKyAgICBpbnQgY3B1OworICAgIHVpbnQzMl90IGNwdV9waGFuZGxlOwor
ICAgIE1hY2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHMpOworICAgIGJvb2wg
aXNfMzJfYml0ID0gcmlzY3ZfaXNfMzJiaXQoJnMtPnNvY1swXSk7CisKKyAg
ICBmb3IgKGNwdSA9IHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0cyAtIDE7IGNw
dSA+PSAwOyBjcHUtLSkgeworICAgICAgICBSSVNDVkNQVSAqY3B1X3B0ciA9
ICZzLT5zb2Nbc29ja2V0XS5oYXJ0c1tjcHVdOworICAgICAgICBpbnQ4X3Qg
c2F0cF9tb2RlX21heCA9IGNwdV9wdHItPmNmZy5tYXhfc2F0cF9tb2RlOwor
ICAgICAgICBnX2F1dG9mcmVlIGNoYXIgKmNwdV9uYW1lID0gTlVMTDsKKyAg
ICAgICAgZ19hdXRvZnJlZSBjaGFyICpjb3JlX25hbWUgPSBOVUxMOworICAg
ICAgICBnX2F1dG9mcmVlIGNoYXIgKmludGNfbmFtZSA9IE5VTEw7CisgICAg
ICAgIGdfYXV0b2ZyZWUgY2hhciAqc3ZfbmFtZSA9IE5VTEw7CisKKyAgICAg
ICAgY3B1X3BoYW5kbGUgPSAoKnBoYW5kbGUpKys7CisKKyAgICAgICAgY3B1
X25hbWUgPSBnX3N0cmR1cF9wcmludGYoIi9jcHVzL2NwdUAlZCIsCisgICAg
ICAgICAgICBzLT5zb2Nbc29ja2V0XS5oYXJ0aWRfYmFzZSArIGNwdSk7Cisg
ICAgICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIGNwdV9uYW1l
KTsKKworICAgICAgICBpZiAoc2F0cF9tb2RlX21heCAhPSAtMSkgeworICAg
ICAgICAgICAgc3ZfbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigicmlzY3YsJXMi
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXRw
X21vZGVfc3RyKHNhdHBfbW9kZV9tYXgsIGlzXzMyX2JpdCkpOworICAgICAg
ICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgY3B1X25h
bWUsICJtbXUtdHlwZSIsIHN2X25hbWUpOworICAgICAgICB9CisKKyAgICAg
ICAgcmlzY3ZfaXNhX3dyaXRlX2ZkdChjcHVfcHRyLCBtcy0+ZmR0LCBjcHVf
bmFtZSk7CisKKyAgICAgICAgaWYgKGNwdV9wdHItPmNmZy5leHRfemljYm9t
KSB7CisgICAgICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZk
dCwgY3B1X25hbWUsICJyaXNjdixjYm9tLWJsb2NrLXNpemUiLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNwdV9wdHItPmNmZy5jYm9t
X2Jsb2Nrc2l6ZSk7CisgICAgICAgIH0KKworICAgICAgICBpZiAoY3B1X3B0
ci0+Y2ZnLmV4dF96aWNib3opIHsKKyAgICAgICAgICAgIHFlbXVfZmR0X3Nl
dHByb3BfY2VsbChtcy0+ZmR0LCBjcHVfbmFtZSwgInJpc2N2LGNib3otYmxv
Y2stc2l6ZSIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Y3B1X3B0ci0+Y2ZnLmNib3pfYmxvY2tzaXplKTsKKyAgICAgICAgfQorCisg
ICAgICAgIGlmIChjcHVfcHRyLT5jZmcuZXh0X3ppY2JvcCkgeworICAgICAg
ICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIGNwdV9uYW1l
LCAicmlzY3YsY2JvcC1ibG9jay1zaXplIiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBjcHVfcHRyLT5jZmcuY2JvcF9ibG9ja3NpemUp
OworICAgICAgICB9CisKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJp
bmcobXMtPmZkdCwgY3B1X25hbWUsICJjb21wYXRpYmxlIiwgInJpc2N2Iik7
CisgICAgICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIGNw
dV9uYW1lLCAic3RhdHVzIiwgIm9rYXkiKTsKKyAgICAgICAgcWVtdV9mZHRf
c2V0cHJvcF9jZWxsKG1zLT5mZHQsIGNwdV9uYW1lLCAicmVnIiwKKyAgICAg
ICAgICAgIHMtPnNvY1tzb2NrZXRdLmhhcnRpZF9iYXNlICsgY3B1KTsKKyAg
ICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgY3B1X25h
bWUsICJkZXZpY2VfdHlwZSIsICJjcHUiKTsKKyAgICAgICAgcmlzY3Zfc29j
a2V0X2ZkdF93cml0ZV9pZChtcywgY3B1X25hbWUsIHNvY2tldCk7CisgICAg
ICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBjcHVfbmFtZSwg
InBoYW5kbGUiLCBjcHVfcGhhbmRsZSk7CisKKyAgICAgICAgaW50Y19waGFu
ZGxlc1tjcHVdID0gKCpwaGFuZGxlKSsrOworCisgICAgICAgIGludGNfbmFt
ZSA9IGdfc3RyZHVwX3ByaW50ZigiJXMvaW50ZXJydXB0LWNvbnRyb2xsZXIi
LCBjcHVfbmFtZSk7CisgICAgICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1z
LT5mZHQsIGludGNfbmFtZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3Bf
Y2VsbChtcy0+ZmR0LCBpbnRjX25hbWUsICJwaGFuZGxlIiwKKyAgICAgICAg
ICAgIGludGNfcGhhbmRsZXNbY3B1XSk7CisgICAgICAgIHFlbXVfZmR0X3Nl
dHByb3Bfc3RyaW5nKG1zLT5mZHQsIGludGNfbmFtZSwgImNvbXBhdGlibGUi
LAorICAgICAgICAgICAgInJpc2N2LGNwdS1pbnRjIik7CisgICAgICAgIHFl
bXVfZmR0X3NldHByb3AobXMtPmZkdCwgaW50Y19uYW1lLCAiaW50ZXJydXB0
LWNvbnRyb2xsZXIiLCBOVUxMLCAwKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0
cHJvcF9jZWxsKG1zLT5mZHQsIGludGNfbmFtZSwgIiNpbnRlcnJ1cHQtY2Vs
bHMiLCAxKTsKKworICAgICAgICBjb3JlX25hbWUgPSBnX3N0cmR1cF9wcmlu
dGYoIiVzL2NvcmUlZCIsIGNsdXN0X25hbWUsIGNwdSk7CisgICAgICAgIHFl
bXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIGNvcmVfbmFtZSk7CisgICAg
ICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBjb3JlX25hbWUs
ICJjcHUiLCBjcHVfcGhhbmRsZSk7CisgICAgfQorfQorCitzdGF0aWMgdm9p
ZCBjcmVhdGVfZmR0X3NvY2tldF9tZW1vcnkoUklTQ1ZWZWdhU3RhdGUgKnMs
IGludCBzb2NrZXQpCit7CisgICAgZ19hdXRvZnJlZSBjaGFyICptZW1fbmFt
ZSA9IE5VTEw7CisgICAgaHdhZGRyIGFkZHI7CisgICAgdWludDY0X3Qgc2l6
ZTsKKyAgICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsKKworICAg
IGFkZHIgPSBzLT5tZW1tYXBbVkVHQV9EUkFNXS5iYXNlICsgcmlzY3Zfc29j
a2V0X21lbV9vZmZzZXQobXMsIHNvY2tldCk7CisgICAgc2l6ZSA9IHJpc2N2
X3NvY2tldF9tZW1fc2l6ZShtcywgc29ja2V0KTsKKyAgICBtZW1fbmFtZSA9
IGdfc3RyZHVwX3ByaW50ZigiL21lbW9yeUAlIkhXQUREUl9QUkl4LCBhZGRy
KTsKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCBtZW1fbmFt
ZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxscyhtcy0+ZmR0
LCBtZW1fbmFtZSwgInJlZyIsIDIsIGFkZHIsIDIsIHNpemUpOworICAgIHFl
bXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIG1lbV9uYW1lLCAiZGV2
aWNlX3R5cGUiLCAibWVtb3J5Iik7CisgICAgcmlzY3Zfc29ja2V0X2ZkdF93
cml0ZV9pZChtcywgbWVtX25hbWUsIHNvY2tldCk7Cit9CisKK3N0YXRpYyB2
b2lkIGNyZWF0ZV9mZHRfc29ja2V0X2NsaW50KFJJU0NWVmVnYVN0YXRlICpz
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNv
Y2tldCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQzMl90ICppbnRjX3BoYW5kbGVzKQoreworICAgIGludCBjcHU7CisgICAg
Z19hdXRvZnJlZSBjaGFyICpjbGludF9uYW1lID0gTlVMTDsKKyAgICBnX2F1
dG9mcmVlIHVpbnQzMl90ICpjbGludF9jZWxscyA9IE5VTEw7CisgICAgaHdh
ZGRyIGNsaW50X2FkZHI7CisgICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJ
TkUocyk7CisgICAgc3RhdGljIGNvbnN0IGNoYXIgKiBjb25zdCBjbGludF9j
b21wYXRbMl0gPSB7CisgICAgICAgICJzaWZpdmUsY2xpbnQwIiwgInJpc2N2
LGNsaW50MCIKKyAgICB9OworCisgICAgY2xpbnRfY2VsbHMgPSBnX25ldzAo
dWludDMyX3QsIHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0cyAqIDQpOworCisg
ICAgZm9yIChjcHUgPSAwOyBjcHUgPCBzLT5zb2Nbc29ja2V0XS5udW1faGFy
dHM7IGNwdSsrKSB7CisgICAgICAgIGNsaW50X2NlbGxzW2NwdSAqIDQgKyAw
XSA9IGNwdV90b19iZTMyKGludGNfcGhhbmRsZXNbY3B1XSk7CisgICAgICAg
IGNsaW50X2NlbGxzW2NwdSAqIDQgKyAxXSA9IGNwdV90b19iZTMyKElSUV9N
X1NPRlQpOworICAgICAgICBjbGludF9jZWxsc1tjcHUgKiA0ICsgMl0gPSBj
cHVfdG9fYmUzMihpbnRjX3BoYW5kbGVzW2NwdV0pOworICAgICAgICBjbGlu
dF9jZWxsc1tjcHUgKiA0ICsgM10gPSBjcHVfdG9fYmUzMihJUlFfTV9USU1F
Uik7CisgICAgfQorCisgICAgY2xpbnRfYWRkciA9IHMtPm1lbW1hcFtWRUdB
X0NMSU5UXS5iYXNlICsKKyAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZF
R0FfQ0xJTlRdLnNpemUgKiBzb2NrZXQ7CisgICAgY2xpbnRfbmFtZSA9IGdf
c3RyZHVwX3ByaW50ZigiL3NvYy9jbGludEAlIkhXQUREUl9QUkl4LCBjbGlu
dF9hZGRyKTsKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCBj
bGludF9uYW1lKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX3N0cmluZ19hcnJh
eShtcy0+ZmR0LCBjbGludF9uYW1lLCAiY29tcGF0aWJsZSIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNoYXIgKiopJmNsaW50X2Nv
bXBhdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBUlJB
WV9TSVpFKGNsaW50X2NvbXBhdCkpOworICAgIHFlbXVfZmR0X3NldHByb3Bf
c2l6ZWRfY2VsbHMobXMtPmZkdCwgY2xpbnRfbmFtZSwgInJlZyIsCisgICAg
ICAgIDIsIGNsaW50X2FkZHIsIDIsIHMtPm1lbW1hcFtWRUdBX0NMSU5UXS5z
aXplKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIGNsaW50X25h
bWUsICJpbnRlcnJ1cHRzLWV4dGVuZGVkIiwKKyAgICAgICAgY2xpbnRfY2Vs
bHMsIHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0cyAqIHNpemVvZih1aW50MzJf
dCkgKiA0KTsKKyAgICByaXNjdl9zb2NrZXRfZmR0X3dyaXRlX2lkKG1zLCBj
bGludF9uYW1lLCBzb2NrZXQpOworfQorCitzdGF0aWMgdm9pZCBjcmVhdGVf
ZmR0X3NvY2tldF9hY2xpbnQoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNvY2tldCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAq
aW50Y19waGFuZGxlcykKK3sKKyAgICBpbnQgY3B1OworICAgIGNoYXIgKm5h
bWU7CisgICAgdW5zaWduZWQgbG9uZyBhZGRyLCBzaXplOworICAgIHVpbnQz
Ml90IGFjbGludF9jZWxsc19zaXplOworICAgIGdfYXV0b2ZyZWUgdWludDMy
X3QgKmFjbGludF9tc3dpX2NlbGxzID0gTlVMTDsKKyAgICBnX2F1dG9mcmVl
IHVpbnQzMl90ICphY2xpbnRfc3N3aV9jZWxscyA9IE5VTEw7CisgICAgZ19h
dXRvZnJlZSB1aW50MzJfdCAqYWNsaW50X210aW1lcl9jZWxscyA9IE5VTEw7
CisgICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7CisKKyAgICBh
Y2xpbnRfbXN3aV9jZWxscyA9IGdfbmV3MCh1aW50MzJfdCwgcy0+c29jW3Nv
Y2tldF0ubnVtX2hhcnRzICogMik7CisgICAgYWNsaW50X210aW1lcl9jZWxs
cyA9IGdfbmV3MCh1aW50MzJfdCwgcy0+c29jW3NvY2tldF0ubnVtX2hhcnRz
ICogMik7CisgICAgYWNsaW50X3Nzd2lfY2VsbHMgPSBnX25ldzAodWludDMy
X3QsIHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0cyAqIDIpOworCisgICAgZm9y
IChjcHUgPSAwOyBjcHUgPCBzLT5zb2Nbc29ja2V0XS5udW1faGFydHM7IGNw
dSsrKSB7CisgICAgICAgIGFjbGludF9tc3dpX2NlbGxzW2NwdSAqIDIgKyAw
XSA9IGNwdV90b19iZTMyKGludGNfcGhhbmRsZXNbY3B1XSk7CisgICAgICAg
IGFjbGludF9tc3dpX2NlbGxzW2NwdSAqIDIgKyAxXSA9IGNwdV90b19iZTMy
KElSUV9NX1NPRlQpOworICAgICAgICBhY2xpbnRfbXRpbWVyX2NlbGxzW2Nw
dSAqIDIgKyAwXSA9IGNwdV90b19iZTMyKGludGNfcGhhbmRsZXNbY3B1XSk7
CisgICAgICAgIGFjbGludF9tdGltZXJfY2VsbHNbY3B1ICogMiArIDFdID0g
Y3B1X3RvX2JlMzIoSVJRX01fVElNRVIpOworICAgICAgICBhY2xpbnRfc3N3
aV9jZWxsc1tjcHUgKiAyICsgMF0gPSBjcHVfdG9fYmUzMihpbnRjX3BoYW5k
bGVzW2NwdV0pOworICAgICAgICBhY2xpbnRfc3N3aV9jZWxsc1tjcHUgKiAy
ICsgMV0gPSBjcHVfdG9fYmUzMihJUlFfU19TT0ZUKTsKKyAgICB9CisgICAg
YWNsaW50X2NlbGxzX3NpemUgPSBzLT5zb2Nbc29ja2V0XS5udW1faGFydHMg
KiBzaXplb2YodWludDMyX3QpICogMjsKKworICAgIGlmIChzLT5haWFfdHlw
ZSAhPSBWRUdBX0FJQV9UWVBFX0FQTElDX0lNU0lDKSB7CisgICAgICAgIGFk
ZHIgPSBzLT5tZW1tYXBbVkVHQV9DTElOVF0uYmFzZSArCisgICAgICAgICAg
ICAgICAocy0+bWVtbWFwW1ZFR0FfQ0xJTlRdLnNpemUgKiBzb2NrZXQpOwor
ICAgICAgICBuYW1lID0gZ19zdHJkdXBfcHJpbnRmKCIvc29jL21zd2lAJWx4
IiwgYWRkcik7CisKKyAgICAgICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMt
PmZkdCwgbmFtZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5n
KG1zLT5mZHQsIG5hbWUsICJjb21wYXRpYmxlIiwKKyAgICAgICAgICAgICJy
aXNjdixhY2xpbnQtbXN3aSIpOworICAgICAgICBxZW11X2ZkdF9zZXRwcm9w
X3NpemVkX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJyZWciLAorICAgICAgICAg
ICAgMiwgYWRkciwgMiwgVkVHQV9BQ0xJTlRfU1dJX1NJWkUpOworICAgICAg
ICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIG5hbWUsICJpbnRlcnJ1cHRz
LWV4dGVuZGVkIiwKKyAgICAgICAgICAgIGFjbGludF9tc3dpX2NlbGxzLCBh
Y2xpbnRfY2VsbHNfc2l6ZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3Ao
bXMtPmZkdCwgbmFtZSwgImludGVycnVwdC1jb250cm9sbGVyIiwgTlVMTCwg
MCk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBu
YW1lLCAiI2ludGVycnVwdC1jZWxscyIsIDApOworICAgICAgICByaXNjdl9z
b2NrZXRfZmR0X3dyaXRlX2lkKG1zLCBuYW1lLCBzb2NrZXQpOworICAgICAg
ICBnX2ZyZWUobmFtZSk7CisgICAgfQorCisgICAgaWYgKHMtPmFpYV90eXBl
ID09IFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMpIHsKKyAgICAgICAgYWRk
ciA9IHMtPm1lbW1hcFtWRUdBX0NMSU5UXS5iYXNlICsKKyAgICAgICAgICAg
ICAgIChWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FUl9TSVpFICogc29ja2V0
KTsKKyAgICAgICAgc2l6ZSA9IFZFR0FfQUNMSU5UX0RFRkFVTFRfTVRJTUVS
X1NJWkU7CisgICAgfSBlbHNlIHsKKyAgICAgICAgYWRkciA9IHMtPm1lbW1h
cFtWRUdBX0NMSU5UXS5iYXNlICsgVkVHQV9BQ0xJTlRfU1dJX1NJWkUgKwor
ICAgICAgICAgICAgICAgKHMtPm1lbW1hcFtWRUdBX0NMSU5UXS5zaXplICog
c29ja2V0KTsKKyAgICAgICAgc2l6ZSA9IHMtPm1lbW1hcFtWRUdBX0NMSU5U
XS5zaXplIC0gVkVHQV9BQ0xJTlRfU1dJX1NJWkU7CisgICAgfQorICAgIG5h
bWUgPSBnX3N0cmR1cF9wcmludGYoIi9zb2MvbXRpbWVyQCVseCIsIGFkZHIp
OworICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIG5hbWUpOwor
ICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIG5hbWUsICJj
b21wYXRpYmxlIiwKKyAgICAgICAgInJpc2N2LGFjbGludC1tdGltZXIiKTsK
KyAgICBxZW11X2ZkdF9zZXRwcm9wX3NpemVkX2NlbGxzKG1zLT5mZHQsIG5h
bWUsICJyZWciLAorICAgICAgICAyLCBhZGRyICsgVkVHQV9BQ0xJTlRfREVG
QVVMVF9NVElNRSwKKyAgICAgICAgMiwgc2l6ZSAtIFZFR0FfQUNMSU5UX0RF
RkFVTFRfTVRJTUUsCisgICAgICAgIDIsIGFkZHIgKyBWRUdBX0FDTElOVF9E
RUZBVUxUX01USU1FQ01QLAorICAgICAgICAyLCBWRUdBX0FDTElOVF9ERUZB
VUxUX01USU1FKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIG5h
bWUsICJpbnRlcnJ1cHRzLWV4dGVuZGVkIiwKKyAgICAgICAgYWNsaW50X210
aW1lcl9jZWxscywgYWNsaW50X2NlbGxzX3NpemUpOworICAgIHJpc2N2X3Nv
Y2tldF9mZHRfd3JpdGVfaWQobXMsIG5hbWUsIHNvY2tldCk7CisgICAgZ19m
cmVlKG5hbWUpOworCisgICAgaWYgKHMtPmFpYV90eXBlICE9IFZFR0FfQUlB
X1RZUEVfQVBMSUNfSU1TSUMpIHsKKyAgICAgICAgYWRkciA9IHMtPm1lbW1h
cFtWRUdBX0FDTElOVF9TU1dJXS5iYXNlICsKKyAgICAgICAgICAgICAgIChz
LT5tZW1tYXBbVkVHQV9BQ0xJTlRfU1NXSV0uc2l6ZSAqIHNvY2tldCk7CisK
KyAgICAgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy9zc3dpQCVs
eCIsIGFkZHIpOworICAgICAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+
ZmR0LCBuYW1lKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmco
bXMtPmZkdCwgbmFtZSwgImNvbXBhdGlibGUiLAorICAgICAgICAgICAgInJp
c2N2LGFjbGludC1zc3dpIik7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3Bf
c2l6ZWRfY2VsbHMobXMtPmZkdCwgbmFtZSwgInJlZyIsCisgICAgICAgICAg
ICAyLCBhZGRyLCAyLCBzLT5tZW1tYXBbVkVHQV9BQ0xJTlRfU1NXSV0uc2l6
ZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3AobXMtPmZkdCwgbmFtZSwg
ImludGVycnVwdHMtZXh0ZW5kZWQiLAorICAgICAgICAgICAgYWNsaW50X3Nz
d2lfY2VsbHMsIGFjbGludF9jZWxsc19zaXplKTsKKyAgICAgICAgcWVtdV9m
ZHRfc2V0cHJvcChtcy0+ZmR0LCBuYW1lLCAiaW50ZXJydXB0LWNvbnRyb2xs
ZXIiLCBOVUxMLCAwKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxs
KG1zLT5mZHQsIG5hbWUsICIjaW50ZXJydXB0LWNlbGxzIiwgMCk7CisgICAg
ICAgIHJpc2N2X3NvY2tldF9mZHRfd3JpdGVfaWQobXMsIG5hbWUsIHNvY2tl
dCk7CisgICAgICAgIGdfZnJlZShuYW1lKTsKKyAgICB9Cit9CisKK3N0YXRp
YyB2b2lkIGNyZWF0ZV9mZHRfc29ja2V0X3BsaWMoUklTQ1ZWZWdhU3RhdGUg
KnMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBz
b2NrZXQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQzMl90ICpwaGFuZGxlLCB1aW50MzJfdCAqaW50Y19waGFuZGxlcywKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKnBs
aWNfcGhhbmRsZXMpCit7CisgICAgaW50IGNwdTsKKyAgICBnX2F1dG9mcmVl
IGNoYXIgKnBsaWNfbmFtZSA9IE5VTEw7CisgICAgZ19hdXRvZnJlZSB1aW50
MzJfdCAqcGxpY19jZWxsczsKKyAgICB1bnNpZ25lZCBsb25nIHBsaWNfYWRk
cjsKKyAgICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsKKworICAg
IHN0YXRpYyBjb25zdCBjaGFyICpjb25zdCBwbGljX2NvbXBhdFsyXSA9IHsi
Y2RhYyxwbGljLTEuMC4wIiwgInJpc2N2LHBsaWMwIn07CisKKyAgICBwbGlj
X3BoYW5kbGVzW3NvY2tldF0gPSAoKnBoYW5kbGUpKys7CisgICAgcGxpY19h
ZGRyID0gcy0+bWVtbWFwW1ZFR0FfUExJQ19JRF0uYmFzZSArCisgICAgICAg
ICAgICAgICAgKHMtPm1lbW1hcFtWRUdBX1BMSUNfSURdLnNpemUgKiBzb2Nr
ZXQpOworICAgIHBsaWNfbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy9w
bGljQCVseCIsIHBsaWNfYWRkcik7CisgICAgcWVtdV9mZHRfYWRkX3N1Ym5v
ZGUobXMtPmZkdCwgcGxpY19uYW1lKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9w
X2NlbGwobXMtPmZkdCwgcGxpY19uYW1lLAorICAgICAgICAiI2ludGVycnVw
dC1jZWxscyIsIEZEVF9QTElDX0lOVF9DRUxMUyk7CisgICAgcWVtdV9mZHRf
c2V0cHJvcF9jZWxsKG1zLT5mZHQsIHBsaWNfbmFtZSwKKyAgICAgICAgIiNh
ZGRyZXNzLWNlbGxzIiwgRkRUX1BMSUNfQUREUl9DRUxMUyk7CisgICAgcWVt
dV9mZHRfc2V0cHJvcF9zdHJpbmdfYXJyYXkobXMtPmZkdCwgcGxpY19uYW1l
LCAiY29tcGF0aWJsZSIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKGNoYXIgKiopJnBsaWNfY29tcGF0LAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEFSUkFZX1NJWkUocGxpY19jb21wYXQpKTsK
KyAgICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIHBsaWNfbmFtZSwgImlu
dGVycnVwdC1jb250cm9sbGVyIiwgTlVMTCwgMCk7CisKKyAgICBpZiAoa3Zt
X2VuYWJsZWQoKSkgeworICAgICAgICBwbGljX2NlbGxzID0gZ19uZXcwKHVp
bnQzMl90LCBzLT5zb2Nbc29ja2V0XS5udW1faGFydHMgKiAyKTsKKworICAg
ICAgICBmb3IgKGNwdSA9IDA7IGNwdSA8IHMtPnNvY1tzb2NrZXRdLm51bV9o
YXJ0czsgY3B1KyspIHsKKyAgICAgICAgICAgIHBsaWNfY2VsbHNbY3B1ICog
MiArIDBdID0gY3B1X3RvX2JlMzIoaW50Y19waGFuZGxlc1tjcHVdKTsKKyAg
ICAgICAgICAgIHBsaWNfY2VsbHNbY3B1ICogMiArIDFdID0gY3B1X3RvX2Jl
MzIoSVJRX1NfRVhUKTsKKyAgICAgICAgfQorCisgICAgICAgIHFlbXVfZmR0
X3NldHByb3AobXMtPmZkdCwgcGxpY19uYW1lLCAiaW50ZXJydXB0cy1leHRl
bmRlZCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgcGxpY19jZWxscywK
KyAgICAgICAgICAgICAgICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5udW1f
aGFydHMgKiBzaXplb2YodWludDMyX3QpICogMik7CisgICB9IGVsc2Ugewor
ICAgICAgICBwbGljX2NlbGxzID0gZ19uZXcwKHVpbnQzMl90LCBzLT5zb2Nb
c29ja2V0XS5udW1faGFydHMgKiA0KTsKKworICAgICAgICBmb3IgKGNwdSA9
IDA7IGNwdSA8IHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0czsgY3B1KyspIHsK
KyAgICAgICAgICAgIHBsaWNfY2VsbHNbY3B1ICogNCArIDBdID0gY3B1X3Rv
X2JlMzIoaW50Y19waGFuZGxlc1tjcHVdKTsKKyAgICAgICAgICAgIHBsaWNf
Y2VsbHNbY3B1ICogNCArIDFdID0gY3B1X3RvX2JlMzIoSVJRX01fRVhUKTsK
KyAgICAgICAgICAgIHBsaWNfY2VsbHNbY3B1ICogNCArIDJdID0gY3B1X3Rv
X2JlMzIoaW50Y19waGFuZGxlc1tjcHVdKTsKKyAgICAgICAgICAgIHBsaWNf
Y2VsbHNbY3B1ICogNCArIDNdID0gY3B1X3RvX2JlMzIoSVJRX1NfRVhUKTsK
KyAgICAgICAgfQorCisgICAgICAgIHFlbXVfZmR0X3NldHByb3AobXMtPmZk
dCwgcGxpY19uYW1lLCAiaW50ZXJydXB0cy1leHRlbmRlZCIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgcGxpY19jZWxscywKKyAgICAgICAgICAgICAg
ICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5udW1faGFydHMgKiBzaXplb2Yo
dWludDMyX3QpICogNCk7CisgICAgfQorCisgICAgcWVtdV9mZHRfc2V0cHJv
cF9zaXplZF9jZWxscyhtcy0+ZmR0LCBwbGljX25hbWUsICJyZWciLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMiwgcGxpY19hZGRyLCAy
LCBzLT5tZW1tYXBbVkVHQV9QTElDX0lEXS5zaXplKTsKKyAgICBxZW11X2Zk
dF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgcGxpY19uYW1lLCAicmlzY3YsbmRl
diIsCisgICAgICAgICAgICAgICAgICAgICAgICAgIFZFR0FfSVJRQ0hJUF9O
VU1fU09VUkNFUyAtIDEpOworICAgIHJpc2N2X3NvY2tldF9mZHRfd3JpdGVf
aWQobXMsIHBsaWNfbmFtZSwgc29ja2V0KTsKKyAgICBxZW11X2ZkdF9zZXRw
cm9wX2NlbGwobXMtPmZkdCwgcGxpY19uYW1lLCAicGhhbmRsZSIsCisgICAg
ICAgIHBsaWNfcGhhbmRsZXNbc29ja2V0XSk7CisKKyAgICBpZiAoIXNvY2tl
dCkgeworICAgICAgICBwbGF0Zm9ybV9idXNfYWRkX2FsbF9mZHRfbm9kZXMo
bXMtPmZkdCwgcGxpY19uYW1lLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfUExBVEZPUk1fQlVTXS5i
YXNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cy0+bWVtbWFwW1ZFR0FfUExBVEZPUk1fQlVTXS5zaXplLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVklSVF9QTEFURk9STV9C
VVNfSVJRKTsKKyAgICB9Cit9CisKK3VpbnQzMl90IGltc2ljX251bV9iaXRz
X3ZlZ2EodWludDMyX3QgY291bnQpCit7CisgICAgdWludDMyX3QgcmV0ID0g
MDsKKworICAgIHdoaWxlIChCSVQocmV0KSA8IGNvdW50KSB7CisgICAgICAg
IHJldCsrOworICAgIH0KKworICAgIHJldHVybiByZXQ7Cit9CisKK3N0YXRp
YyB2b2lkIGNyZWF0ZV9mZHRfb25lX2ltc2ljKFJJU0NWVmVnYVN0YXRlICpz
LCBod2FkZHIgYmFzZV9hZGRyLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDMyX3QgKmludGNfcGhhbmRsZXMsIHVpbnQzMl90IG1z
aV9waGFuZGxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Ym9vbCBtX21vZGUsIHVpbnQzMl90IGltc2ljX2d1ZXN0X2JpdHMpCit7Cisg
ICAgaW50IGNwdSwgc29ja2V0OworICAgIGdfYXV0b2ZyZWUgY2hhciAqaW1z
aWNfbmFtZSA9IE5VTEw7CisgICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJ
TkUocyk7CisgICAgaW50IHNvY2tldF9jb3VudCA9IHJpc2N2X3NvY2tldF9j
b3VudChtcyk7CisgICAgdWludDMyX3QgaW1zaWNfbWF4X2hhcnRfcGVyX3Nv
Y2tldCwgaW1zaWNfYWRkciwgaW1zaWNfc2l6ZTsKKyAgICBnX2F1dG9mcmVl
IHVpbnQzMl90ICppbXNpY19jZWxscyA9IE5VTEw7CisgICAgZ19hdXRvZnJl
ZSB1aW50MzJfdCAqaW1zaWNfcmVncyA9IE5VTEw7CisgICAgc3RhdGljIGNv
bnN0IGNoYXIgKiBjb25zdCBpbXNpY19jb21wYXRbMl0gPSB7CisgICAgICAg
ICJxZW11LGltc2ljcyIsICJyaXNjdixpbXNpY3MiCisgICAgfTsKKworICAg
IGltc2ljX2NlbGxzID0gZ19uZXcwKHVpbnQzMl90LCBtcy0+c21wLmNwdXMg
KiAyKTsKKyAgICBpbXNpY19yZWdzID0gZ19uZXcwKHVpbnQzMl90LCBzb2Nr
ZXRfY291bnQgKiA0KTsKKworICAgIGZvciAoY3B1ID0gMDsgY3B1IDwgbXMt
PnNtcC5jcHVzOyBjcHUrKykgeworICAgICAgICBpbXNpY19jZWxsc1tjcHUg
KiAyICsgMF0gPSBjcHVfdG9fYmUzMihpbnRjX3BoYW5kbGVzW2NwdV0pOwor
ICAgICAgICBpbXNpY19jZWxsc1tjcHUgKiAyICsgMV0gPSBjcHVfdG9fYmUz
MihtX21vZGUgPyBJUlFfTV9FWFQgOiBJUlFfU19FWFQpOworICAgIH0KKwor
ICAgIGltc2ljX21heF9oYXJ0X3Blcl9zb2NrZXQgPSAwOworICAgIGZvciAo
c29ja2V0ID0gMDsgc29ja2V0IDwgc29ja2V0X2NvdW50OyBzb2NrZXQrKykg
eworICAgICAgICBpbXNpY19hZGRyID0gYmFzZV9hZGRyICsgc29ja2V0ICog
VkVHQV9JTVNJQ19HUk9VUF9NQVhfU0laRTsKKyAgICAgICAgaW1zaWNfc2l6
ZSA9IElNU0lDX0hBUlRfU0laRShpbXNpY19ndWVzdF9iaXRzKSAqCisgICAg
ICAgICAgICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5udW1faGFydHM7Cisg
ICAgICAgIGltc2ljX3JlZ3Nbc29ja2V0ICogNCArIDBdID0gMDsKKyAgICAg
ICAgaW1zaWNfcmVnc1tzb2NrZXQgKiA0ICsgMV0gPSBjcHVfdG9fYmUzMihp
bXNpY19hZGRyKTsKKyAgICAgICAgaW1zaWNfcmVnc1tzb2NrZXQgKiA0ICsg
Ml0gPSAwOworICAgICAgICBpbXNpY19yZWdzW3NvY2tldCAqIDQgKyAzXSA9
IGNwdV90b19iZTMyKGltc2ljX3NpemUpOworICAgICAgICBpZiAoaW1zaWNf
bWF4X2hhcnRfcGVyX3NvY2tldCA8IHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0
cykgeworICAgICAgICAgICAgaW1zaWNfbWF4X2hhcnRfcGVyX3NvY2tldCA9
IHMtPnNvY1tzb2NrZXRdLm51bV9oYXJ0czsKKyAgICAgICAgfQorICAgIH0K
KworICAgIGltc2ljX25hbWUgPSBnX3N0cmR1cF9wcmludGYoIi9zb2MvaW50
ZXJydXB0LWNvbnRyb2xsZXJAJWx4IiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICh1bnNpZ25lZCBsb25nKWJhc2VfYWRkcik7CisgICAg
cWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwgaW1zaWNfbmFtZSk7Cisg
ICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmdfYXJyYXkobXMtPmZkdCwgaW1z
aWNfbmFtZSwgImNvbXBhdGlibGUiLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIChjaGFyICoqKSZpbXNpY19jb21wYXQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgQVJSQVlfU0laRShpbXNpY19j
b21wYXQpKTsKKworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0
LCBpbXNpY19uYW1lLCAiI2ludGVycnVwdC1jZWxscyIsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgIEZEVF9JTVNJQ19JTlRfQ0VMTFMpOworICAgIHFl
bXVfZmR0X3NldHByb3AobXMtPmZkdCwgaW1zaWNfbmFtZSwgImludGVycnVw
dC1jb250cm9sbGVyIiwgTlVMTCwgMCk7CisgICAgcWVtdV9mZHRfc2V0cHJv
cChtcy0+ZmR0LCBpbXNpY19uYW1lLCAibXNpLWNvbnRyb2xsZXIiLCBOVUxM
LCAwKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIGltc2ljX25h
bWUsICJpbnRlcnJ1cHRzLWV4dGVuZGVkIiwKKyAgICAgICAgICAgICAgICAg
ICAgIGltc2ljX2NlbGxzLCBtcy0+c21wLmNwdXMgKiBzaXplb2YodWludDMy
X3QpICogMik7CisgICAgcWVtdV9mZHRfc2V0cHJvcChtcy0+ZmR0LCBpbXNp
Y19uYW1lLCAicmVnIiwgaW1zaWNfcmVncywKKyAgICAgICAgICAgICAgICAg
ICAgIHNvY2tldF9jb3VudCAqIHNpemVvZih1aW50MzJfdCkgKiA0KTsKKyAg
ICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgaW1zaWNfbmFtZSwg
InJpc2N2LG51bS1pZHMiLAorICAgICAgICAgICAgICAgICAgICAgVkVHQV9J
UlFDSElQX05VTV9NU0lTKTsKKworICAgIGlmIChpbXNpY19ndWVzdF9iaXRz
KSB7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBp
bXNpY19uYW1lLCAicmlzY3YsZ3Vlc3QtaW5kZXgtYml0cyIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpbXNpY19ndWVzdF9iaXRzKTsKKyAg
ICB9CisKKyAgICBpZiAoc29ja2V0X2NvdW50ID4gMSkgeworICAgICAgICBx
ZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgaW1zaWNfbmFtZSwgInJp
c2N2LGhhcnQtaW5kZXgtYml0cyIsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpbXNpY19udW1fYml0c192ZWdhKGltc2ljX21heF9oYXJ0X3Bl
cl9zb2NrZXQpKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1z
LT5mZHQsIGltc2ljX25hbWUsICJyaXNjdixncm91cC1pbmRleC1iaXRzIiwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltc2ljX251bV9iaXRz
X3ZlZ2Eoc29ja2V0X2NvdW50KSk7CisgICAgICAgIHFlbXVfZmR0X3NldHBy
b3BfY2VsbChtcy0+ZmR0LCBpbXNpY19uYW1lLCAicmlzY3YsZ3JvdXAtaW5k
ZXgtc2hpZnQiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSU1T
SUNfTU1JT19HUk9VUF9NSU5fU0hJRlQpOworICAgIH0KKyAgICBxZW11X2Zk
dF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgaW1zaWNfbmFtZSwgInBoYW5kbGUi
LCBtc2lfcGhhbmRsZSk7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRf
aW1zaWMoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHVpbnQzMl90ICpwaGFuZGxlLCB1aW50MzJfdCAqaW50Y19w
aGFuZGxlcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMy
X3QgKm1zaV9tX3BoYW5kbGUsIHVpbnQzMl90ICptc2lfc19waGFuZGxlKQor
eworICAgICptc2lfbV9waGFuZGxlID0gKCpwaGFuZGxlKSsrOworICAgICpt
c2lfc19waGFuZGxlID0gKCpwaGFuZGxlKSsrOworCisgICAgaWYgKCFrdm1f
ZW5hYmxlZCgpKSB7CisgICAgICAgIC8qIE0tbGV2ZWwgSU1TSUMgbm9kZSAq
LworICAgICAgICBjcmVhdGVfZmR0X29uZV9pbXNpYyhzLCBzLT5tZW1tYXBb
VkVHQV9JTVNJQ19NXS5iYXNlLCBpbnRjX3BoYW5kbGVzLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAqbXNpX21fcGhhbmRsZSwgdHJ1ZSwgMCk7
CisgICAgfQorCisgICAgLyogUy1sZXZlbCBJTVNJQyBub2RlICovCisgICAg
Y3JlYXRlX2ZkdF9vbmVfaW1zaWMocywgcy0+bWVtbWFwW1ZFR0FfSU1TSUNf
U10uYmFzZSwgaW50Y19waGFuZGxlcywKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAqbXNpX3NfcGhhbmRsZSwgZmFsc2UsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgaW1zaWNfbnVtX2JpdHNfdmVnYShzLT5haWFfZ3Vlc3RzICsg
MSkpOworCit9CisKKy8qIENhbGxlciBtdXN0IGZyZWUgc3RyaW5nIGFmdGVy
IHVzZSAqLworc3RhdGljIGNoYXIgKmZkdF9nZXRfYXBsaWNfbm9kZW5hbWUo
dW5zaWduZWQgbG9uZyBhcGxpY19hZGRyKQoreworICAgIHJldHVybiBnX3N0
cmR1cF9wcmludGYoIi9zb2MvaW50ZXJydXB0LWNvbnRyb2xsZXJAJWx4Iiwg
YXBsaWNfYWRkcik7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRfb25l
X2FwbGljKFJJU0NWVmVnYVN0YXRlICpzLCBpbnQgc29ja2V0LAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgbG9uZyBhcGxp
Y19hZGRyLCB1aW50MzJfdCBhcGxpY19zaXplLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdWludDMyX3QgbXNpX3BoYW5kbGUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAqaW50Y19w
aGFuZGxlcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVp
bnQzMl90IGFwbGljX3BoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB1aW50MzJfdCBhcGxpY19jaGlsZF9waGFuZGxlLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBtX21vZGUsIGlu
dCBudW1faGFydHMpCit7CisgICAgaW50IGNwdTsKKyAgICBnX2F1dG9mcmVl
IGNoYXIgKmFwbGljX25hbWUgPSBmZHRfZ2V0X2FwbGljX25vZGVuYW1lKGFw
bGljX2FkZHIpOworICAgIGdfYXV0b2ZyZWUgdWludDMyX3QgKmFwbGljX2Nl
bGxzID0gZ19uZXcwKHVpbnQzMl90LCBudW1faGFydHMgKiAyKTsKKyAgICBN
YWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsKKyAgICBzdGF0aWMgY29u
c3QgY2hhciAqIGNvbnN0IGFwbGljX2NvbXBhdFsyXSA9IHsKKyAgICAgICAg
InFlbXUsYXBsaWMiLCAicmlzY3YsYXBsaWMiCisgICAgfTsKKworICAgIGZv
ciAoY3B1ID0gMDsgY3B1IDwgbnVtX2hhcnRzOyBjcHUrKykgeworICAgICAg
ICBhcGxpY19jZWxsc1tjcHUgKiAyICsgMF0gPSBjcHVfdG9fYmUzMihpbnRj
X3BoYW5kbGVzW2NwdV0pOworICAgICAgICBhcGxpY19jZWxsc1tjcHUgKiAy
ICsgMV0gPSBjcHVfdG9fYmUzMihtX21vZGUgPyBJUlFfTV9FWFQgOiBJUlFf
U19FWFQpOworICAgIH0KKworICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1z
LT5mZHQsIGFwbGljX25hbWUpOworICAgIHFlbXVfZmR0X3NldHByb3Bfc3Ry
aW5nX2FycmF5KG1zLT5mZHQsIGFwbGljX25hbWUsICJjb21wYXRpYmxlIiwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2hhciAqKikm
YXBsaWNfY29tcGF0LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIEFSUkFZX1NJWkUoYXBsaWNfY29tcGF0KSk7CisgICAgcWVtdV9mZHRf
c2V0cHJvcF9jZWxsKG1zLT5mZHQsIGFwbGljX25hbWUsICIjYWRkcmVzcy1j
ZWxscyIsCisgICAgICAgICAgICAgICAgICAgICAgICAgIEZEVF9BUExJQ19B
RERSX0NFTExTKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZk
dCwgYXBsaWNfbmFtZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIiNp
bnRlcnJ1cHQtY2VsbHMiLCBGRFRfQVBMSUNfSU5UX0NFTExTKTsKKyAgICBx
ZW11X2ZkdF9zZXRwcm9wKG1zLT5mZHQsIGFwbGljX25hbWUsICJpbnRlcnJ1
cHQtY29udHJvbGxlciIsIE5VTEwsIDApOworCisgICAgaWYgKHMtPmFpYV90
eXBlID09IFZFR0FfQUlBX1RZUEVfQVBMSUMpIHsKKyAgICAgICAgcWVtdV9m
ZHRfc2V0cHJvcChtcy0+ZmR0LCBhcGxpY19uYW1lLCAiaW50ZXJydXB0cy1l
eHRlbmRlZCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgYXBsaWNfY2Vs
bHMsIG51bV9oYXJ0cyAqIHNpemVvZih1aW50MzJfdCkgKiAyKTsKKyAgICB9
IGVsc2UgeworICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZk
dCwgYXBsaWNfbmFtZSwgIm1zaS1wYXJlbnQiLCBtc2lfcGhhbmRsZSk7Cisg
ICAgfQorCisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxscyhtcy0+
ZmR0LCBhcGxpY19uYW1lLCAicmVnIiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIDIsIGFwbGljX2FkZHIsIDIsIGFwbGljX3NpemUpOwor
ICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBhcGxpY19uYW1l
LCAicmlzY3YsbnVtLXNvdXJjZXMiLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICBWRUdBX0lSUUNISVBfTlVNX1NPVVJDRVMpOworCisgICAgaWYgKGFw
bGljX2NoaWxkX3BoYW5kbGUpIHsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJv
cF9jZWxsKG1zLT5mZHQsIGFwbGljX25hbWUsICJyaXNjdixjaGlsZHJlbiIs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGxpY19jaGlsZF9w
aGFuZGxlKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxscyhtcy0+
ZmR0LCBhcGxpY19uYW1lLCAicmlzY3YsZGVsZWdhdGlvbiIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgYXBsaWNfY2hpbGRfcGhhbmRsZSwg
MHgxLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZFR0FfSVJR
Q0hJUF9OVU1fU09VUkNFUyk7CisgICAgICAgIC8qCisgICAgICAgICAqIERF
UFJFQ0FURURfOS4xOiBDb21wYXQgcHJvcGVydHkga2VwdCB0ZW1wb3Jhcmls
eQorICAgICAgICAgKiB0byBhbGxvdyBvbGQgZmlybXdhcmVzIHRvIHdvcmsg
d2l0aCBBSUEuIERvICpub3QqCisgICAgICAgICAqIHVzZSAncmlzY3YsZGVs
ZWdhdGUnIGluIG5ldyBjb2RlOiB1c2UKKyAgICAgICAgICogJ3Jpc2N2LGRl
bGVnYXRpb24nIGluc3RlYWQuCisgICAgICAgICAqLworICAgICAgICBxZW11
X2ZkdF9zZXRwcm9wX2NlbGxzKG1zLT5mZHQsIGFwbGljX25hbWUsICJyaXNj
dixkZWxlZ2F0ZSIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
YXBsaWNfY2hpbGRfcGhhbmRsZSwgMHgxLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFZFR0FfSVJRQ0hJUF9OVU1fU09VUkNFUyk7CisgICAg
fQorCisgICAgcmlzY3Zfc29ja2V0X2ZkdF93cml0ZV9pZChtcywgYXBsaWNf
bmFtZSwgc29ja2V0KTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMt
PmZkdCwgYXBsaWNfbmFtZSwgInBoYW5kbGUiLCBhcGxpY19waGFuZGxlKTsK
K30KKworc3RhdGljIHZvaWQgY3JlYXRlX2ZkdF9zb2NrZXRfYXBsaWMoUklT
Q1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpbnQgc29ja2V0LAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgdWludDMyX3QgbXNpX21fcGhhbmRsZSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IG1zaV9zX3Bo
YW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1
aW50MzJfdCAqcGhhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHVpbnQzMl90ICppbnRjX3BoYW5kbGVzLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmFwbGljX3Bo
YW5kbGVzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
aW50IG51bV9oYXJ0cykKK3sKKyAgICB1bnNpZ25lZCBsb25nIGFwbGljX2Fk
ZHI7CisgICAgTWFjaGluZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7CisgICAg
dWludDMyX3QgYXBsaWNfbV9waGFuZGxlLCBhcGxpY19zX3BoYW5kbGU7CisK
KyAgICBhcGxpY19tX3BoYW5kbGUgPSAoKnBoYW5kbGUpKys7CisgICAgYXBs
aWNfc19waGFuZGxlID0gKCpwaGFuZGxlKSsrOworCisgICAgaWYgKCFrdm1f
ZW5hYmxlZCgpKSB7CisgICAgICAgIC8qIE0tbGV2ZWwgQVBMSUMgbm9kZSAq
LworICAgICAgICBhcGxpY19hZGRyID0gcy0+bWVtbWFwW1ZFR0FfQVBMSUNf
TV0uYmFzZSArCisgICAgICAgICAgICAgICAgICAgICAocy0+bWVtbWFwW1ZF
R0FfQVBMSUNfTV0uc2l6ZSAqIHNvY2tldCk7CisgICAgICAgIGNyZWF0ZV9m
ZHRfb25lX2FwbGljKHMsIHNvY2tldCwgYXBsaWNfYWRkciwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfQVBMSUNfTV0u
c2l6ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNpX21fcGhh
bmRsZSwgaW50Y19waGFuZGxlcywKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYXBsaWNfbV9waGFuZGxlLCBhcGxpY19zX3BoYW5kbGUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUsIG51bV9oYXJ0cyk7Cisg
ICAgfQorCisgICAgLyogUy1sZXZlbCBBUExJQyBub2RlICovCisgICAgYXBs
aWNfYWRkciA9IHMtPm1lbW1hcFtWRUdBX0FQTElDX1NdLmJhc2UgKworICAg
ICAgICAgICAgICAgICAocy0+bWVtbWFwW1ZFR0FfQVBMSUNfU10uc2l6ZSAq
IHNvY2tldCk7CisgICAgY3JlYXRlX2ZkdF9vbmVfYXBsaWMocywgc29ja2V0
LCBhcGxpY19hZGRyLCBzLT5tZW1tYXBbVkVHQV9BUExJQ19TXS5zaXplLAor
ICAgICAgICAgICAgICAgICAgICAgICAgIG1zaV9zX3BoYW5kbGUsIGludGNf
cGhhbmRsZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgYXBsaWNfc19w
aGFuZGxlLCAwLAorICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCBu
dW1faGFydHMpOworCisgICAgaWYgKCFzb2NrZXQpIHsKKyAgICAgICAgZ19h
dXRvZnJlZSBjaGFyICphcGxpY19uYW1lID0gZmR0X2dldF9hcGxpY19ub2Rl
bmFtZShhcGxpY19hZGRyKTsKKyAgICAgICAgcGxhdGZvcm1fYnVzX2FkZF9h
bGxfZmR0X25vZGVzKG1zLT5mZHQsIGFwbGljX25hbWUsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzLT5tZW1tYXBbVkVHQV9Q
TEFURk9STV9CVVNdLmJhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzLT5tZW1tYXBbVkVHQV9QTEFURk9STV9CVVNdLnNp
emUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBW
SVJUX1BMQVRGT1JNX0JVU19JUlEpOworICAgIH0KKworICAgIGFwbGljX3Bo
YW5kbGVzW3NvY2tldF0gPSBhcGxpY19zX3BoYW5kbGU7Cit9CisKK3N0YXRp
YyB2b2lkIGNyZWF0ZV9mZHRfcG11KFJJU0NWVmVnYVN0YXRlICpzKQorewor
ICAgIGdfYXV0b2ZyZWUgY2hhciAqcG11X25hbWUgPSBnX3N0cmR1cF9wcmlu
dGYoIi9wbXUiKTsKKyAgICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShz
KTsKKyAgICBSSVNDVkNQVSBoYXJ0ID0gcy0+c29jWzBdLmhhcnRzWzBdOwor
CisgICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwgcG11X25hbWUp
OworICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIHBtdV9u
YW1lLCAiY29tcGF0aWJsZSIsICJyaXNjdixwbXUiKTsKKyAgICByaXNjdl9w
bXVfZ2VuZXJhdGVfZmR0X25vZGUobXMtPmZkdCwgaGFydC5wbXVfYXZhaWxf
Y3RycywgcG11X25hbWUpOworfQorCitzdGF0aWMgdm9pZCBjcmVhdGVfZmR0
X3NvY2tldHMoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWludDMyX3QgKnBoYW5kbGUsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKmlycV9tbWlvX3BoYW5k
bGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
KmlycV9wY2llX3BoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdWludDMyX3QgKmlycV92aXJ0aW9fcGhhbmRsZSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCAqbXNpX3BjaWVfcGhh
bmRsZSkKK3sKKyAgICBpbnQgc29ja2V0LCBwaGFuZGxlX3BvczsKKyAgICBN
YWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsKKyAgICB1aW50MzJfdCBt
c2lfbV9waGFuZGxlID0gMCwgbXNpX3NfcGhhbmRsZSA9IDA7CisgICAgdWlu
dDMyX3QgeHBsaWNfcGhhbmRsZXNbTUFYX05PREVTXTsKKyAgICBnX2F1dG9m
cmVlIHVpbnQzMl90ICppbnRjX3BoYW5kbGVzID0gTlVMTDsKKyAgICBpbnQg
c29ja2V0X2NvdW50ID0gcmlzY3Zfc29ja2V0X2NvdW50KG1zKTsKKworICAg
IHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsICIvY3B1cyIpOworICAg
IHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCAiL2NwdXMiLCAidGlt
ZWJhc2UtZnJlcXVlbmN5IiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
a3ZtX2VuYWJsZWQoKSA/CisgICAgICAgICAgICAgICAgICAgICAgICAgIGt2
bV9yaXNjdl9nZXRfdGltZWJhc2VfZnJlcXVlbmN5KCZzLT5zb2MtPmhhcnRz
WzBdKSA6CisgICAgICAgICAgICAgICAgICAgICAgICAgIFZFR0FfQUNMSU5U
X0RFRkFVTFRfVElNRUJBU0VfRlJFUSk7CisgICAgcWVtdV9mZHRfc2V0cHJv
cF9jZWxsKG1zLT5mZHQsICIvY3B1cyIsICIjc2l6ZS1jZWxscyIsIDB4MCk7
CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsICIvY3B1cyIs
ICIjYWRkcmVzcy1jZWxscyIsIDB4MSk7CisgICAgcWVtdV9mZHRfYWRkX3N1
Ym5vZGUobXMtPmZkdCwgIi9jcHVzL2NwdS1tYXAiKTsKKworICAgIGludGNf
cGhhbmRsZXMgPSBnX25ldzAodWludDMyX3QsIG1zLT5zbXAuY3B1cyk7CisK
KyAgICBwaGFuZGxlX3BvcyA9IG1zLT5zbXAuY3B1czsKKyAgICBmb3IgKHNv
Y2tldCA9IChzb2NrZXRfY291bnQgLSAxKTsgc29ja2V0ID49IDA7IHNvY2tl
dC0tKSB7CisgICAgICAgIGdfYXV0b2ZyZWUgY2hhciAqY2x1c3RfbmFtZSA9
IE5VTEw7CisgICAgICAgIHBoYW5kbGVfcG9zIC09IHMtPnNvY1tzb2NrZXRd
Lm51bV9oYXJ0czsKKworICAgICAgICBjbHVzdF9uYW1lID0gZ19zdHJkdXBf
cHJpbnRmKCIvY3B1cy9jcHUtbWFwL2NsdXN0ZXIlZCIsIHNvY2tldCk7Cisg
ICAgICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIGNsdXN0X25h
bWUpOworCisgICAgICAgIGNyZWF0ZV9mZHRfc29ja2V0X2NwdXMocywgc29j
a2V0LCBjbHVzdF9uYW1lLCBwaGFuZGxlLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZpbnRjX3BoYW5kbGVzW3BoYW5kbGVfcG9zXSk7CisK
KyAgICAgICAgY3JlYXRlX2ZkdF9zb2NrZXRfbWVtb3J5KHMsIHNvY2tldCk7
CisKKyAgICAgICAgaWYgKHZlZ2FfYWNsaW50X2FsbG93ZWQoKSAmJiBzLT5o
YXZlX2FjbGludCkgeworICAgICAgICAgICAgY3JlYXRlX2ZkdF9zb2NrZXRf
YWNsaW50KHMsIHNvY2tldCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmaW50Y19waGFuZGxlc1twaGFuZGxlX3Bvc10pOworICAg
ICAgICB9IGVsc2UgaWYgKHRjZ19lbmFibGVkKCkpIHsKKyAgICAgICAgICAg
IGNyZWF0ZV9mZHRfc29ja2V0X2NsaW50KHMsIHNvY2tldCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICZpbnRjX3BoYW5kbGVzW3Bo
YW5kbGVfcG9zXSk7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAocy0+
YWlhX3R5cGUgPT0gVkVHQV9BSUFfVFlQRV9BUExJQ19JTVNJQykgeworICAg
ICAgICBjcmVhdGVfZmR0X2ltc2ljKHMsIHBoYW5kbGUsIGludGNfcGhhbmRs
ZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgJm1zaV9tX3BoYW5kbGUs
ICZtc2lfc19waGFuZGxlKTsKKyAgICAgICAgKm1zaV9wY2llX3BoYW5kbGUg
PSBtc2lfc19waGFuZGxlOworICAgIH0KKworICAgIC8qCisgICAgICogV2l0
aCBLVk0gQUlBIGFwbGljLWltc2ljLCB1c2luZyBhbiBpcnFjaGlwIHdpdGhv
dXQgc3BsaXQKKyAgICAgKiBtb2RlLCB3ZSdsbCB1c2Ugb25seSBvbmUgQVBM
SUMgaW5zdGFuY2UuCisgICAgICovCisgICAgaWYgKCF2ZWdhX3VzZV9lbXVs
YXRlZF9hcGxpYyhzLT5haWFfdHlwZSkpIHsKKyAgICAgICAgY3JlYXRlX2Zk
dF9zb2NrZXRfYXBsaWMocywgMCwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbXNpX21fcGhhbmRsZSwgbXNpX3NfcGhhbmRsZSwgcGhhbmRs
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmludGNfcGhh
bmRsZXNbMF0sIHhwbGljX3BoYW5kbGVzLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBtcy0+c21wLmNwdXMpOworCisgICAgICAgICppcnFf
bW1pb19waGFuZGxlID0geHBsaWNfcGhhbmRsZXNbMF07CisgICAgICAgICpp
cnFfdmlydGlvX3BoYW5kbGUgPSB4cGxpY19waGFuZGxlc1swXTsKKyAgICAg
ICAgKmlycV9wY2llX3BoYW5kbGUgPSB4cGxpY19waGFuZGxlc1swXTsKKyAg
ICB9IGVsc2UgeworICAgICAgICBwaGFuZGxlX3BvcyA9IG1zLT5zbXAuY3B1
czsKKyAgICAgICAgZm9yIChzb2NrZXQgPSAoc29ja2V0X2NvdW50IC0gMSk7
IHNvY2tldCA+PSAwOyBzb2NrZXQtLSkgeworICAgICAgICAgICAgcGhhbmRs
ZV9wb3MgLT0gcy0+c29jW3NvY2tldF0ubnVtX2hhcnRzOworCisgICAgICAg
ICAgICBpZiAocy0+YWlhX3R5cGUgPT0gVkVHQV9BSUFfVFlQRV9OT05FKSB7
CisgICAgICAgICAgICAgICAgY3JlYXRlX2ZkdF9zb2NrZXRfcGxpYyhzLCBz
b2NrZXQsIHBoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAmaW50Y19waGFuZGxlc1twaGFuZGxlX3Bvc10sCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4cGxpY19waGFu
ZGxlcyk7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAg
IGNyZWF0ZV9mZHRfc29ja2V0X2FwbGljKHMsIHNvY2tldCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2lfbV9waGFuZGxl
LCBtc2lfc19waGFuZGxlLCBwaGFuZGxlLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICZpbnRjX3BoYW5kbGVzW3BoYW5kbGVf
cG9zXSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB4cGxpY19waGFuZGxlcywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzLT5zb2Nbc29ja2V0XS5udW1faGFydHMpOworICAg
ICAgICAgICAgfQorICAgICAgICB9CisKKyAgICAgICAgZm9yIChzb2NrZXQg
PSAwOyBzb2NrZXQgPCBzb2NrZXRfY291bnQ7IHNvY2tldCsrKSB7CisgICAg
ICAgICAgICBpZiAoc29ja2V0ID09IDApIHsKKyAgICAgICAgICAgICAgICAq
aXJxX21taW9fcGhhbmRsZSA9IHhwbGljX3BoYW5kbGVzW3NvY2tldF07Cisg
ICAgICAgICAgICAgICAgKmlycV92aXJ0aW9fcGhhbmRsZSA9IHhwbGljX3Bo
YW5kbGVzW3NvY2tldF07CisgICAgICAgICAgICAgICAgKmlycV9wY2llX3Bo
YW5kbGUgPSB4cGxpY19waGFuZGxlc1tzb2NrZXRdOworICAgICAgICAgICAg
fQorICAgICAgICAgICAgaWYgKHNvY2tldCA9PSAxKSB7CisgICAgICAgICAg
ICAgICAgKmlycV92aXJ0aW9fcGhhbmRsZSA9IHhwbGljX3BoYW5kbGVzW3Nv
Y2tldF07CisgICAgICAgICAgICAgICAgKmlycV9wY2llX3BoYW5kbGUgPSB4
cGxpY19waGFuZGxlc1tzb2NrZXRdOworICAgICAgICAgICAgfQorICAgICAg
ICAgICAgaWYgKHNvY2tldCA9PSAyKSB7CisgICAgICAgICAgICAgICAgKmly
cV9wY2llX3BoYW5kbGUgPSB4cGxpY19waGFuZGxlc1tzb2NrZXRdOworICAg
ICAgICAgICAgfQorICAgICAgICB9CisgICAgfQorCisgICAgcmlzY3Zfc29j
a2V0X2ZkdF93cml0ZV9kaXN0YW5jZV9tYXRyaXgobXMpOworfQorCitzdGF0
aWMgdm9pZCBjcmVhdGVfZmR0X3ZpcnRpbyhSSVNDVlZlZ2FTdGF0ZSAqcywg
dWludDMyX3QgaXJxX3ZpcnRpb19waGFuZGxlKQoreworICAgIGludCBpOwor
ICAgIE1hY2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHMpOworICAgIGh3YWRk
ciB2aXJ0aW9fYmFzZSA9IHMtPm1lbW1hcFtWRUdBX1ZJUlRJT10uYmFzZTsK
KworICAgIGZvciAoaSA9IDA7IGkgPCBWSVJUSU9fQ09VTlQ7IGkrKykgewor
ICAgICAgICBnX2F1dG9mcmVlIGNoYXIgKm5hbWUgPSBOVUxMOworICAgICAg
ICB1aW50NjRfdCBzaXplID0gcy0+bWVtbWFwW1ZFR0FfVklSVElPXS5zaXpl
OworICAgICAgICBod2FkZHIgYWRkciA9IHZpcnRpb19iYXNlICsgaSAqIHNp
emU7CisKKyAgICAgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy92
aXJ0aW9fbW1pb0AlIkhXQUREUl9QUkl4LCBhZGRyKTsKKworICAgICAgICBx
ZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCBuYW1lKTsKKyAgICAgICAg
cWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgbmFtZSwgImNvbXBh
dGlibGUiLCAidmlydGlvLG1taW8iKTsKKyAgICAgICAgcWVtdV9mZHRfc2V0
cHJvcF9zaXplZF9jZWxscyhtcy0+ZmR0LCBuYW1lLCAicmVnIiwgMiwgYWRk
ciwgMiwgc2l6ZSk7CisgICAgICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbCht
cy0+ZmR0LCBuYW1lLCAiaW50ZXJydXB0LXBhcmVudCIsCisgICAgICAgICAg
ICBpcnFfdmlydGlvX3BoYW5kbGUpOworICAgICAgICBpZiAocy0+YWlhX3R5
cGUgPT0gVkVHQV9BSUFfVFlQRV9OT05FKSB7CisgICAgICAgICAgICBxZW11
X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgImludGVycnVwdHMi
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZJUlRJT19J
UlEgKyBpKTsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIHFlbXVf
ZmR0X3NldHByb3BfY2VsbHMobXMtPmZkdCwgbmFtZSwgImludGVycnVwdHMi
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWSVJUSU9f
SVJRICsgaSwgMHg0KTsKKyAgICAgICAgfQorICAgIH0KK30KKworc3RhdGlj
IHZvaWQgY3JlYXRlX2ZkdF9wY2llKFJJU0NWVmVnYVN0YXRlICpzLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGlycV9wY2llX3Bo
YW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3Qg
bXNpX3BjaWVfcGhhbmRsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1aW50MzJfdCBpb21tdV9zeXNfcGhhbmRsZSkKK3sKKyAgICBnX2F1dG9m
cmVlIGNoYXIgKm5hbWUgPSBOVUxMOworICAgIE1hY2hpbmVTdGF0ZSAqbXMg
PSBNQUNISU5FKHMpOworCisgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50Zigi
L3NvYy9wY2lAJSJIV0FERFJfUFJJeCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHMtPm1lbW1hcFtWRUdBX1BDSUVfRUNBTV0uYmFzZSk7CisgICAg
cWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICIjYWRkcmVz
cy1jZWxscyIsCisgICAgICAgIEZEVF9QQ0lfQUREUl9DRUxMUyk7CisgICAg
cWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICIjaW50ZXJy
dXB0LWNlbGxzIiwKKyAgICAgICAgRkRUX1BDSV9JTlRfQ0VMTFMpOworICAg
IHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAiI3NpemUt
Y2VsbHMiLCAweDIpOworICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1z
LT5mZHQsIG5hbWUsICJjb21wYXRpYmxlIiwKKyAgICAgICAgInBjaS1ob3N0
LWVjYW0tZ2VuZXJpYyIpOworICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5n
KG1zLT5mZHQsIG5hbWUsICJkZXZpY2VfdHlwZSIsICJwY2kiKTsKKyAgICBx
ZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgImxpbnV4LHBj
aS1kb21haW4iLCAwKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGxzKG1z
LT5mZHQsIG5hbWUsICJidXMtcmFuZ2UiLCAwLAorICAgICAgICBzLT5tZW1t
YXBbVkVHQV9QQ0lFX0VDQU1dLnNpemUgLyBQQ0lFX01NQ0ZHX1NJWkVfTUlO
IC0gMSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcChtcy0+ZmR0LCBuYW1lLCAi
ZG1hLWNvaGVyZW50IiwgTlVMTCwgMCk7CisgICAgaWYgKHMtPmFpYV90eXBl
ID09IFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMpIHsKKyAgICAgICAgcWVt
dV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICJtc2ktcGFyZW50
IiwgbXNpX3BjaWVfcGhhbmRsZSk7CisgICAgfQorICAgIHFlbXVfZmR0X3Nl
dHByb3Bfc2l6ZWRfY2VsbHMobXMtPmZkdCwgbmFtZSwgInJlZyIsIDIsCisg
ICAgICAgIHMtPm1lbW1hcFtWRUdBX1BDSUVfRUNBTV0uYmFzZSwgMiwgcy0+
bWVtbWFwW1ZFR0FfUENJRV9FQ0FNXS5zaXplKTsKKyAgICBxZW11X2ZkdF9z
ZXRwcm9wX3NpemVkX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJyYW5nZXMiLAor
ICAgICAgICAxLCBGRFRfUENJX1JBTkdFX0lPUE9SVCwgMiwgMCwKKyAgICAg
ICAgMiwgcy0+bWVtbWFwW1ZFR0FfUENJRV9QSU9dLmJhc2UsIDIsIHMtPm1l
bW1hcFtWRUdBX1BDSUVfUElPXS5zaXplLAorICAgICAgICAxLCBGRFRfUENJ
X1JBTkdFX01NSU8sCisgICAgICAgIDIsIHMtPm1lbW1hcFtWRUdBX1BDSUVf
TU1JT10uYmFzZSwKKyAgICAgICAgMiwgcy0+bWVtbWFwW1ZFR0FfUENJRV9N
TUlPXS5iYXNlLCAyLCBzLT5tZW1tYXBbVkVHQV9QQ0lFX01NSU9dLnNpemUs
CisgICAgICAgIDEsIEZEVF9QQ0lfUkFOR0VfTU1JT182NEJJVCwKKyAgICAg
ICAgMiwgdmVnYV9oaWdoX3BjaWVfbWVtbWFwLmJhc2UsCisgICAgICAgIDIs
IHZlZ2FfaGlnaF9wY2llX21lbW1hcC5iYXNlLCAyLCB2ZWdhX2hpZ2hfcGNp
ZV9tZW1tYXAuc2l6ZSk7CisKKyAgICBpZiAodmVnYV9pc19pb21tdV9zeXNf
ZW5hYmxlZChzKSkgeworICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGxz
KG1zLT5mZHQsIG5hbWUsICJpb21tdS1tYXAiLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIDAsIGlvbW11X3N5c19waGFuZGxlLCAwLCAwLCAw
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlvbW11X3N5c19w
aGFuZGxlLCAwLCAweGZmZmYpOworICAgIH0KKworICAgIGNyZWF0ZV9wY2ll
X2lycV9tYXAocywgbXMtPmZkdCwgbmFtZSwgaXJxX3BjaWVfcGhhbmRsZSk7
Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRfcmVzZXQoUklTQ1ZWZWdh
U3RhdGUgKnMsIHVpbnQzMl90ICpwaGFuZGxlKQoreworICAgIGNoYXIgKm5h
bWU7CisgICAgdWludDMyX3QgdGVzdF9waGFuZGxlOworICAgIE1hY2hpbmVT
dGF0ZSAqbXMgPSBNQUNISU5FKHMpOworCisgICAgdGVzdF9waGFuZGxlID0g
KCpwaGFuZGxlKSsrOworICAgIG5hbWUgPSBnX3N0cmR1cF9wcmludGYoIi9z
b2MvdGVzdEAlIkhXQUREUl9QUkl4LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcy0+bWVtbWFwW1ZFR0FfVEVTVF0uYmFzZSk7CisgICAgcWVtdV9m
ZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwgbmFtZSk7CisgICAgeworICAgICAg
ICBzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IGNvbXBhdFszXSA9IHsKKyAg
ICAgICAgICAgICJzaWZpdmUsdGVzdDEiLCAic2lmaXZlLHRlc3QwIiwgInN5
c2NvbiIKKyAgICAgICAgfTsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9z
dHJpbmdfYXJyYXkobXMtPmZkdCwgbmFtZSwgImNvbXBhdGlibGUiLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2hhciAqKikm
Y29tcGF0LCBBUlJBWV9TSVpFKGNvbXBhdCkpOworICAgIH0KKyAgICBxZW11
X2ZkdF9zZXRwcm9wX3NpemVkX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJyZWci
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMiwgcy0+bWVt
bWFwW1ZFR0FfVEVTVF0uYmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIDIsIHMtPm1lbW1hcFtWRUdBX1RFU1RdLnNpemUpOworICAg
IHFlbXVfZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAicGhhbmRs
ZSIsIHRlc3RfcGhhbmRsZSk7CisgICAgdGVzdF9waGFuZGxlID0gcWVtdV9m
ZHRfZ2V0X3BoYW5kbGUobXMtPmZkdCwgbmFtZSk7CisgICAgZ19mcmVlKG5h
bWUpOworCisgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiL3JlYm9vdCIp
OworICAgIHFlbXVfZmR0X2FkZF9zdWJub2RlKG1zLT5mZHQsIG5hbWUpOwor
ICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsIG5hbWUsICJj
b21wYXRpYmxlIiwgInN5c2Nvbi1yZWJvb3QiKTsKKyAgICBxZW11X2ZkdF9z
ZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgInJlZ21hcCIsIHRlc3RfcGhh
bmRsZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5h
bWUsICJvZmZzZXQiLCAweDApOworICAgIHFlbXVfZmR0X3NldHByb3BfY2Vs
bChtcy0+ZmR0LCBuYW1lLCAidmFsdWUiLCBGSU5JU0hFUl9SRVNFVCk7Cisg
ICAgZ19mcmVlKG5hbWUpOworCisgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50
ZigiL3Bvd2Vyb2ZmIik7CisgICAgcWVtdV9mZHRfYWRkX3N1Ym5vZGUobXMt
PmZkdCwgbmFtZSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMt
PmZkdCwgbmFtZSwgImNvbXBhdGlibGUiLCAic3lzY29uLXBvd2Vyb2ZmIik7
CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICJy
ZWdtYXAiLCB0ZXN0X3BoYW5kbGUpOworICAgIHFlbXVfZmR0X3NldHByb3Bf
Y2VsbChtcy0+ZmR0LCBuYW1lLCAib2Zmc2V0IiwgMHgwKTsKKyAgICBxZW11
X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgInZhbHVlIiwgRklO
SVNIRVJfUEFTUyk7CisgICAgZ19mcmVlKG5hbWUpOworfQorCitzdGF0aWMg
dm9pZCBjcmVhdGVfZmR0X3VhcnQoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgaXJxX21taW9fcGhh
bmRsZSkKK3sKKyAgICBnX2F1dG9mcmVlIGNoYXIgKm5hbWUgPSBOVUxMOwor
ICAgIE1hY2hpbmVTdGF0ZSAqbXMgPSBNQUNISU5FKHMpOworCisgICAgbmFt
ZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy9zZXJpYWxAJSJIV0FERFJfUFJJ
eCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1lbW1hcFtWRUdB
X1VBUlQwXS5iYXNlKTsKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+
ZmR0LCBuYW1lKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX3N0cmluZyhtcy0+
ZmR0LCBuYW1lLCAiY29tcGF0aWJsZSIsICJuczE2NTUwYSIpOworICAgIHFl
bXVfZmR0X3NldHByb3Bfc2l6ZWRfY2VsbHMobXMtPmZkdCwgbmFtZSwgInJl
ZyIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAyLCBzLT5t
ZW1tYXBbVkVHQV9VQVJUMF0uYmFzZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIDIsIHMtPm1lbW1hcFtWRUdBX1VBUlQwXS5zaXplKTsK
KyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgImNs
b2NrLWZyZXF1ZW5jeSIsIDM2ODY0MDApOworICAgIHFlbXVfZmR0X3NldHBy
b3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAiaW50ZXJydXB0LXBhcmVudCIsIGly
cV9tbWlvX3BoYW5kbGUpOworICAgIGlmIChzLT5haWFfdHlwZSA9PSBWRUdB
X0FJQV9UWVBFX05PTkUpIHsKKyAgICAgICAgcWVtdV9mZHRfc2V0cHJvcF9j
ZWxsKG1zLT5mZHQsIG5hbWUsICJpbnRlcnJ1cHRzIiwgVUFSVDBfSVJRKTsK
KyAgICB9IGVsc2UgeworICAgICAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGxz
KG1zLT5mZHQsIG5hbWUsICJpbnRlcnJ1cHRzIiwgVUFSVDBfSVJRLCAweDQp
OworICAgIH0KKworICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5m
ZHQsICIvY2hvc2VuIiwgInN0ZG91dC1wYXRoIiwgbmFtZSk7CisgICAgcWVt
dV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgIi9hbGlhc2VzIiwgInNl
cmlhbDAiLCBuYW1lKTsKK30KKworc3RhdGljIHZvaWQgY3JlYXRlX2ZkdF9y
dGMoUklTQ1ZWZWdhU3RhdGUgKnMsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1aW50MzJfdCBpcnFfbW1pb19waGFuZGxlKQoreworICAgIGdfYXV0
b2ZyZWUgY2hhciAqbmFtZSA9IE5VTEw7CisgICAgTWFjaGluZVN0YXRlICpt
cyA9IE1BQ0hJTkUocyk7CisKKyAgICBuYW1lID0gZ19zdHJkdXBfcHJpbnRm
KCIvc29jL3J0Y0AlIkhXQUREUl9QUkl4LAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfUlRDXS5iYXNlKTsKKyAgICBxZW11
X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCBuYW1lKTsKKyAgICBxZW11X2Zk
dF9zZXRwcm9wX3N0cmluZyhtcy0+ZmR0LCBuYW1lLCAiY29tcGF0aWJsZSIs
CisgICAgICAgICJnb29nbGUsZ29sZGZpc2gtcnRjIik7CisgICAgcWVtdV9m
ZHRfc2V0cHJvcF9zaXplZF9jZWxscyhtcy0+ZmR0LCBuYW1lLCAicmVnIiwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIsIHMtPm1lbW1h
cFtWRUdBX1JUQ10uYmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIDIsIHMtPm1lbW1hcFtWRUdBX1JUQ10uc2l6ZSk7CisgICAgcWVt
dV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQsIG5hbWUsICJpbnRlcnJ1cHQt
cGFyZW50IiwKKyAgICAgICAgaXJxX21taW9fcGhhbmRsZSk7CisgICAgaWYg
KHMtPmFpYV90eXBlID09IFZFR0FfQUlBX1RZUEVfTk9ORSkgeworICAgICAg
ICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwobXMtPmZkdCwgbmFtZSwgImludGVy
cnVwdHMiLCBSVENfSVJRKTsKKyAgICB9IGVsc2UgeworICAgICAgICBxZW11
X2ZkdF9zZXRwcm9wX2NlbGxzKG1zLT5mZHQsIG5hbWUsICJpbnRlcnJ1cHRz
IiwgUlRDX0lSUSwgMHg0KTsKKyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIGNy
ZWF0ZV9mZHRfZmxhc2goUklTQ1ZWZWdhU3RhdGUgKnMpCit7CisgICAgTWFj
aGluZVN0YXRlICptcyA9IE1BQ0hJTkUocyk7CisgICAgaHdhZGRyIGZsYXNo
c2l6ZSA9IHMtPm1lbW1hcFtWRUdBX0ZMQVNIXS5zaXplIC8gMjsKKyAgICBo
d2FkZHIgZmxhc2hiYXNlID0gcy0+bWVtbWFwW1ZFR0FfRkxBU0hdLmJhc2U7
CisgICAgZ19hdXRvZnJlZSBjaGFyICpuYW1lID0gZ19zdHJkdXBfcHJpbnRm
KCIvZmxhc2hAJSIgUFJJeDY0LCBmbGFzaGJhc2UpOworCisgICAgcWVtdV9m
ZHRfYWRkX3N1Ym5vZGUobXMtPmZkdCwgbmFtZSk7CisgICAgcWVtdV9mZHRf
c2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgbmFtZSwgImNvbXBhdGlibGUiLCAi
Y2ZpLWZsYXNoIik7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxs
cyhtcy0+ZmR0LCBuYW1lLCAicmVnIiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIDIsIGZsYXNoYmFzZSwgMiwgZmxhc2hzaXplLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMiwgZmxhc2hiYXNlICsg
Zmxhc2hzaXplLCAyLCBmbGFzaHNpemUpOworICAgIHFlbXVfZmR0X3NldHBy
b3BfY2VsbChtcy0+ZmR0LCBuYW1lLCAiYmFuay13aWR0aCIsIDQpOworfQor
CitzdGF0aWMgdm9pZCBjcmVhdGVfZmR0X2Z3X2NmZyhSSVNDVlZlZ2FTdGF0
ZSAqcykKK3sKKyAgICBNYWNoaW5lU3RhdGUgKm1zID0gTUFDSElORShzKTsK
KyAgICBod2FkZHIgYmFzZSA9IHMtPm1lbW1hcFtWRUdBX0ZXX0NGR10uYmFz
ZTsKKyAgICBod2FkZHIgc2l6ZSA9IHMtPm1lbW1hcFtWRUdBX0ZXX0NGR10u
c2l6ZTsKKyAgICBnX2F1dG9mcmVlIGNoYXIgKm5vZGVuYW1lID0gZ19zdHJk
dXBfcHJpbnRmKCIvZnctY2ZnQCUiIFBSSXg2NCwgYmFzZSk7CisKKyAgICBx
ZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCBub2RlbmFtZSk7CisgICAg
cWVtdV9mZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgbm9kZW5hbWUsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgImNvbXBhdGlibGUiLCAicWVt
dSxmdy1jZmctbW1pbyIpOworICAgIHFlbXVfZmR0X3NldHByb3Bfc2l6ZWRf
Y2VsbHMobXMtPmZkdCwgbm9kZW5hbWUsICJyZWciLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgMiwgYmFzZSwgMiwgc2l6ZSk7CisgICAg
cWVtdV9mZHRfc2V0cHJvcChtcy0+ZmR0LCBub2RlbmFtZSwgImRtYS1jb2hl
cmVudCIsIE5VTEwsIDApOworfQorCitzdGF0aWMgdm9pZCBjcmVhdGVfZmR0
X3ZpcnRpb19pb21tdShSSVNDVlZlZ2FTdGF0ZSAqcywgdWludDE2X3QgYmRm
KQoreworICAgIGNvbnN0IGNoYXIgY29tcGF0W10gPSAidmlydGlvLHBjaS1p
b21tdVwwcGNpMWFmNCwxMDU3IjsKKyAgICB2b2lkICpmZHQgPSBNQUNISU5F
KHMpLT5mZHQ7CisgICAgdWludDMyX3QgaW9tbXVfcGhhbmRsZTsKKyAgICBn
X2F1dG9mcmVlIGNoYXIgKmlvbW11X25vZGUgPSBOVUxMOworICAgIGdfYXV0
b2ZyZWUgY2hhciAqcGNpX25vZGUgPSBOVUxMOworCisgICAgcGNpX25vZGUg
PSBnX3N0cmR1cF9wcmludGYoIi9zb2MvcGNpQCUiSFdBRERSX1BSSXgsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+bWVtbWFwW1ZFR0Ff
UENJRV9FQ0FNXS5iYXNlKTsKKyAgICBpb21tdV9ub2RlID0gZ19zdHJkdXBf
cHJpbnRmKCIlcy92aXJ0aW9faW9tbXVAJXgsJXgiLCBwY2lfbm9kZSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9TTE9UKGJkZiks
IFBDSV9GVU5DKGJkZikpOworICAgIGlvbW11X3BoYW5kbGUgPSBxZW11X2Zk
dF9hbGxvY19waGFuZGxlKGZkdCk7CisKKyAgICBxZW11X2ZkdF9hZGRfc3Vi
bm9kZShmZHQsIGlvbW11X25vZGUpOworCisgICAgcWVtdV9mZHRfc2V0cHJv
cChmZHQsIGlvbW11X25vZGUsICJjb21wYXRpYmxlIiwgY29tcGF0LCBzaXpl
b2YoY29tcGF0KSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxs
cyhmZHQsIGlvbW11X25vZGUsICJyZWciLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgMSwgYmRmIDw8IDgsIDEsIDAsIDEsIDAsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLCAwLCAxLCAwKTsKKyAg
ICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwoZmR0LCBpb21tdV9ub2RlLCAiI2lv
bW11LWNlbGxzIiwgMSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKGZk
dCwgaW9tbXVfbm9kZSwgInBoYW5kbGUiLCBpb21tdV9waGFuZGxlKTsKKwor
ICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbHMoZmR0LCBwY2lfbm9kZSwgImlv
bW11LW1hcCIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCBpb21t
dV9waGFuZGxlLCAwLCBiZGYsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICBiZGYgKyAxLCBpb21tdV9waGFuZGxlLCBiZGYgKyAxLCAweGZmZmYgLSBi
ZGYpOworfQorCitzdGF0aWMgdm9pZCBjcmVhdGVfZmR0X2lvbW11X3N5cyhS
SVNDVlZlZ2FTdGF0ZSAqcywgdWludDMyX3QgaXJxX2NoaXAsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBtc2lfcGhhbmRs
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90
ICppb21tdV9zeXNfcGhhbmRsZSkKK3sKKyAgICBjb25zdCBjaGFyIGNvbXBb
XSA9ICJyaXNjdixpb21tdSI7CisgICAgdm9pZCAqZmR0ID0gTUFDSElORShz
KS0+ZmR0OworICAgIHVpbnQzMl90IGlvbW11X3BoYW5kbGU7CisgICAgZ19h
dXRvZnJlZSBjaGFyICppb21tdV9ub2RlID0gTlVMTDsKKyAgICBod2FkZHIg
YWRkciA9IHMtPm1lbW1hcFtWRUdBX0lPTU1VX1NZU10uYmFzZTsKKyAgICBo
d2FkZHIgc2l6ZSA9IHMtPm1lbW1hcFtWRUdBX0lPTU1VX1NZU10uc2l6ZTsK
KyAgICB1aW50MzJfdCBpb21tdV9pcnFfbWFwW1JJU0NWX0lPTU1VX0lOVFJf
Q09VTlRdID0geworICAgICAgICBJT01NVV9TWVNfSVJRICsgUklTQ1ZfSU9N
TVVfSU5UUl9DUSwKKyAgICAgICAgSU9NTVVfU1lTX0lSUSArIFJJU0NWX0lP
TU1VX0lOVFJfRlEsCisgICAgICAgIElPTU1VX1NZU19JUlEgKyBSSVNDVl9J
T01NVV9JTlRSX1BNLAorICAgICAgICBJT01NVV9TWVNfSVJRICsgUklTQ1Zf
SU9NTVVfSU5UUl9QUSwKKyAgICB9OworCisgICAgaW9tbXVfbm9kZSA9IGdf
c3RyZHVwX3ByaW50ZigiL3NvYy9pb21tdUAleCIsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgKHVuc2lnbmVkIGludCkgcy0+bWVtbWFwW1ZF
R0FfSU9NTVVfU1lTXS5iYXNlKTsKKyAgICBpb21tdV9waGFuZGxlID0gcWVt
dV9mZHRfYWxsb2NfcGhhbmRsZShmZHQpOworICAgIHFlbXVfZmR0X2FkZF9z
dWJub2RlKGZkdCwgaW9tbXVfbm9kZSk7CisKKyAgICBxZW11X2ZkdF9zZXRw
cm9wKGZkdCwgaW9tbXVfbm9kZSwgImNvbXBhdGlibGUiLCBjb21wLCBzaXpl
b2YoY29tcCkpOworICAgIHFlbXVfZmR0X3NldHByb3BfY2VsbChmZHQsIGlv
bW11X25vZGUsICIjaW9tbXUtY2VsbHMiLCAxKTsKKyAgICBxZW11X2ZkdF9z
ZXRwcm9wX2NlbGwoZmR0LCBpb21tdV9ub2RlLCAicGhhbmRsZSIsIGlvbW11
X3BoYW5kbGUpOworCisgICAgcWVtdV9mZHRfc2V0cHJvcF9zaXplZF9jZWxs
cyhmZHQsIGlvbW11X25vZGUsICJyZWciLCAyLCBhZGRyLCAyLCBzaXplKTsK
KyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwoZmR0LCBpb21tdV9ub2RlLCAi
aW50ZXJydXB0LXBhcmVudCIsIGlycV9jaGlwKTsKKworICAgIHFlbXVfZmR0
X3NldHByb3BfY2VsbHMoZmR0LCBpb21tdV9ub2RlLCAiaW50ZXJydXB0cyIs
CisgICAgICAgIGlvbW11X2lycV9tYXBbMF0sIEZEVF9JUlFfVFlQRV9FREdF
X0xPVywKKyAgICAgICAgaW9tbXVfaXJxX21hcFsxXSwgRkRUX0lSUV9UWVBF
X0VER0VfTE9XLAorICAgICAgICBpb21tdV9pcnFfbWFwWzJdLCBGRFRfSVJR
X1RZUEVfRURHRV9MT1csCisgICAgICAgIGlvbW11X2lycV9tYXBbM10sIEZE
VF9JUlFfVFlQRV9FREdFX0xPVyk7CisKKyAgICBxZW11X2ZkdF9zZXRwcm9w
X2NlbGwoZmR0LCBpb21tdV9ub2RlLCAibXNpLXBhcmVudCIsIG1zaV9waGFu
ZGxlKTsKKworICAgICppb21tdV9zeXNfcGhhbmRsZSA9IGlvbW11X3BoYW5k
bGU7Cit9CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9mZHRfaW9tbXUoUklTQ1ZW
ZWdhU3RhdGUgKnMsIHVpbnQxNl90IGJkZikKK3sKKyAgICBjb25zdCBjaGFy
IGNvbXBbXSA9ICJyaXNjdixwY2ktaW9tbXUiOworICAgIHZvaWQgKmZkdCA9
IE1BQ0hJTkUocyktPmZkdDsKKyAgICB1aW50MzJfdCBpb21tdV9waGFuZGxl
OworICAgIGdfYXV0b2ZyZWUgY2hhciAqaW9tbXVfbm9kZSA9IE5VTEw7Cisg
ICAgZ19hdXRvZnJlZSBjaGFyICpwY2lfbm9kZSA9IE5VTEw7CisKKyAgICBw
Y2lfbm9kZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy9wY2lAJSJIV0FERFJf
UFJJeCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzLT5tZW1t
YXBbVkVHQV9QQ0lFX0VDQU1dLmJhc2UpOworICAgIGlvbW11X25vZGUgPSBn
X3N0cmR1cF9wcmludGYoIiVzL2lvbW11QCV4IiwgcGNpX25vZGUsIGJkZik7
CisgICAgaW9tbXVfcGhhbmRsZSA9IHFlbXVfZmR0X2FsbG9jX3BoYW5kbGUo
ZmR0KTsKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShmZHQsIGlvbW11X25v
ZGUpOworCisgICAgcWVtdV9mZHRfc2V0cHJvcChmZHQsIGlvbW11X25vZGUs
ICJjb21wYXRpYmxlIiwgY29tcCwgc2l6ZW9mKGNvbXApKTsKKyAgICBxZW11
X2ZkdF9zZXRwcm9wX2NlbGwoZmR0LCBpb21tdV9ub2RlLCAiI2lvbW11LWNl
bGxzIiwgMSk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKGZkdCwgaW9t
bXVfbm9kZSwgInBoYW5kbGUiLCBpb21tdV9waGFuZGxlKTsKKyAgICBxZW11
X2ZkdF9zZXRwcm9wX2NlbGxzKGZkdCwgaW9tbXVfbm9kZSwgInJlZyIsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICBiZGYgPDwgOCwgMCwgMCwgMCwg
MCk7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxscyhmZHQsIHBjaV9ub2Rl
LCAiaW9tbXUtbWFwIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIDAs
IGlvbW11X3BoYW5kbGUsIDAsIGJkZiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGJkZiArIDEsIGlvbW11X3BoYW5kbGUsIGJkZiArIDEsIDB4ZmZm
ZiAtIGJkZik7CisgICAgcy0+cGNpX2lvbW11X2JkZiA9IGJkZjsKK30KKwor
c3RhdGljIHZvaWQgZmluYWxpemVfZmR0KFJJU0NWVmVnYVN0YXRlICpzKQor
eworICAgIHVpbnQzMl90IHBoYW5kbGUgPSAxLCBpcnFfbW1pb19waGFuZGxl
ID0gMSwgbXNpX3BjaWVfcGhhbmRsZSA9IDE7CisgICAgdWludDMyX3QgaXJx
X3BjaWVfcGhhbmRsZSA9IDEsIGlycV92aXJ0aW9fcGhhbmRsZSA9IDE7Cisg
ICAgdWludDMyX3QgaW9tbXVfc3lzX3BoYW5kbGUgPSAxOworCisgICAgY3Jl
YXRlX2ZkdF9zb2NrZXRzKHMsICZwaGFuZGxlLCAmaXJxX21taW9fcGhhbmRs
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgJmlycV9wY2llX3BoYW5kbGUs
ICZpcnFfdmlydGlvX3BoYW5kbGUsCisgICAgICAgICAgICAgICAgICAgICAg
ICZtc2lfcGNpZV9waGFuZGxlKTsKKworICAgIGNyZWF0ZV9mZHRfdmlydGlv
KHMsIGlycV92aXJ0aW9fcGhhbmRsZSk7CisKKyAgICBpZiAodmVnYV9pc19p
b21tdV9zeXNfZW5hYmxlZChzKSkgeworICAgICAgICBjcmVhdGVfZmR0X2lv
bW11X3N5cyhzLCBpcnFfbW1pb19waGFuZGxlLCBtc2lfcGNpZV9waGFuZGxl
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmaW9tbXVfc3lzX3Bo
YW5kbGUpOworICAgIH0KKyAgICBjcmVhdGVfZmR0X3BjaWUocywgaXJxX3Bj
aWVfcGhhbmRsZSwgbXNpX3BjaWVfcGhhbmRsZSwKKyAgICAgICAgICAgICAg
ICAgICAgaW9tbXVfc3lzX3BoYW5kbGUpOworCisgICAgY3JlYXRlX2ZkdF9y
ZXNldChzLCAmcGhhbmRsZSk7CisKKyAgICBjcmVhdGVfZmR0X3VhcnQocywg
aXJxX21taW9fcGhhbmRsZSk7CisKKyAgICBjcmVhdGVfZmR0X3J0YyhzLCBp
cnFfbW1pb19waGFuZGxlKTsKK30KKworc3RhdGljIHZvaWQgY3JlYXRlX2Zk
dChSSVNDVlZlZ2FTdGF0ZSAqcykKK3sKKyAgICBNYWNoaW5lU3RhdGUgKm1z
ID0gTUFDSElORShzKTsKKyAgICB1aW50OF90IHJuZ19zZWVkWzMyXTsKKyAg
ICBnX2F1dG9mcmVlIGNoYXIgKm5hbWUgPSBOVUxMOworCisgICAgbXMtPmZk
dCA9IGNyZWF0ZV9kZXZpY2VfdHJlZSgmcy0+ZmR0X3NpemUpOworICAgIGlm
ICghbXMtPmZkdCkgeworICAgICAgICBlcnJvcl9yZXBvcnQoImNyZWF0ZV9k
ZXZpY2VfdHJlZSgpIGZhaWxlZCIpOworICAgICAgICBleGl0KDEpOworICAg
IH0KKworICAgIHFlbXVfZmR0X3NldHByb3Bfc3RyaW5nKG1zLT5mZHQsICIv
IiwgIm1vZGVsIiwgInJpc2N2LXZpcnRpbyxxZW11Iik7CisgICAgcWVtdV9m
ZHRfc2V0cHJvcF9zdHJpbmcobXMtPmZkdCwgIi8iLCAiY29tcGF0aWJsZSIs
ICJyaXNjdi12aXJ0aW8iKTsKKyAgICBxZW11X2ZkdF9zZXRwcm9wX2NlbGwo
bXMtPmZkdCwgIi8iLCAiI3NpemUtY2VsbHMiLCAweDIpOworICAgIHFlbXVf
ZmR0X3NldHByb3BfY2VsbChtcy0+ZmR0LCAiLyIsICIjYWRkcmVzcy1jZWxs
cyIsIDB4Mik7CisKKyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0
LCAiL3NvYyIpOworICAgIHFlbXVfZmR0X3NldHByb3AobXMtPmZkdCwgIi9z
b2MiLCAicmFuZ2VzIiwgTlVMTCwgMCk7CisgICAgcWVtdV9mZHRfc2V0cHJv
cF9zdHJpbmcobXMtPmZkdCwgIi9zb2MiLCAiY29tcGF0aWJsZSIsICJzaW1w
bGUtYnVzIik7CisgICAgcWVtdV9mZHRfc2V0cHJvcF9jZWxsKG1zLT5mZHQs
ICIvc29jIiwgIiNzaXplLWNlbGxzIiwgMHgyKTsKKyAgICBxZW11X2ZkdF9z
ZXRwcm9wX2NlbGwobXMtPmZkdCwgIi9zb2MiLCAiI2FkZHJlc3MtY2VsbHMi
LCAweDIpOworCisgICAgLyoKKyAgICAgKiBUaGUgIi9zb2MvcGNpQC4uLiIg
bm9kZSBpcyBuZWVkZWQgZm9yIFBDSUUgaG90cGx1Z3MKKyAgICAgKiB0aGF0
IG1pZ2h0IGhhcHBlbiBiZWZvcmUgZmluYWxpemVfZmR0KCkuCisgICAgICov
CisgICAgbmFtZSA9IGdfc3RyZHVwX3ByaW50ZigiL3NvYy9wY2lAJSJIV0FE
RFJfUFJJeCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1lbW1h
cFtWRUdBX1BDSUVfRUNBTV0uYmFzZSk7CisgICAgcWVtdV9mZHRfYWRkX3N1
Ym5vZGUobXMtPmZkdCwgbmFtZSk7CisKKyAgICBxZW11X2ZkdF9hZGRfc3Vi
bm9kZShtcy0+ZmR0LCAiL2Nob3NlbiIpOworCisgICAgLyogUGFzcyBzZWVk
IHRvIFJORyAqLworICAgIHFlbXVfZ3Vlc3RfZ2V0cmFuZG9tX25vZmFpbChy
bmdfc2VlZCwgc2l6ZW9mKHJuZ19zZWVkKSk7CisgICAgcWVtdV9mZHRfc2V0
cHJvcChtcy0+ZmR0LCAiL2Nob3NlbiIsICJybmctc2VlZCIsCisgICAgICAg
ICAgICAgICAgICAgICBybmdfc2VlZCwgc2l6ZW9mKHJuZ19zZWVkKSk7CisK
KyAgICBxZW11X2ZkdF9hZGRfc3Vibm9kZShtcy0+ZmR0LCAiL2FsaWFzZXMi
KTsKKworICAgIGNyZWF0ZV9mZHRfZmxhc2gocyk7CisgICAgY3JlYXRlX2Zk
dF9md19jZmcocyk7CisgICAgY3JlYXRlX2ZkdF9wbXUocyk7Cit9CisKK3N0
YXRpYyBpbmxpbmUgRGV2aWNlU3RhdGUgKmdwZXhfcGNpZV9pbml0KE1lbW9y
eVJlZ2lvbiAqc3lzX21lbSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIERldmljZVN0YXRlICppcnFjaGlwLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUklTQ1ZWZWdh
U3RhdGUgKnMpCit7CisgICAgRGV2aWNlU3RhdGUgKmRldjsKKyAgICBNZW1v
cnlSZWdpb24gKmVjYW1fYWxpYXMsICplY2FtX3JlZzsKKyAgICBNZW1vcnlS
ZWdpb24gKm1taW9fYWxpYXMsICpoaWdoX21taW9fYWxpYXMsICptbWlvX3Jl
ZzsKKyAgICBod2FkZHIgZWNhbV9iYXNlID0gcy0+bWVtbWFwW1ZFR0FfUENJ
RV9FQ0FNXS5iYXNlOworICAgIGh3YWRkciBlY2FtX3NpemUgPSBzLT5tZW1t
YXBbVkVHQV9QQ0lFX0VDQU1dLnNpemU7CisgICAgaHdhZGRyIG1taW9fYmFz
ZSA9IHMtPm1lbW1hcFtWRUdBX1BDSUVfTU1JT10uYmFzZTsKKyAgICBod2Fk
ZHIgbW1pb19zaXplID0gcy0+bWVtbWFwW1ZFR0FfUENJRV9NTUlPXS5zaXpl
OworICAgIGh3YWRkciBoaWdoX21taW9fYmFzZSA9IHZlZ2FfaGlnaF9wY2ll
X21lbW1hcC5iYXNlOworICAgIGh3YWRkciBoaWdoX21taW9fc2l6ZSA9IHZl
Z2FfaGlnaF9wY2llX21lbW1hcC5zaXplOworICAgIGh3YWRkciBwaW9fYmFz
ZSA9IHMtPm1lbW1hcFtWRUdBX1BDSUVfUElPXS5iYXNlOworICAgIGh3YWRk
ciBwaW9fc2l6ZSA9IHMtPm1lbW1hcFtWRUdBX1BDSUVfUElPXS5zaXplOwor
ICAgIHFlbXVfaXJxIGlycTsKKyAgICBpbnQgaTsKKworICAgIGRldiA9IHFk
ZXZfbmV3KFRZUEVfR1BFWF9IT1NUKTsKKworICAgIC8qIFNldCBHUEVYIG9i
amVjdCBwcm9wZXJ0aWVzIGZvciB0aGUgVkVHQSBtYWNoaW5lICovCisgICAg
b2JqZWN0X3Byb3BlcnR5X3NldF91aW50KE9CSkVDVChkZXYpLCBQQ0lfSE9T
VF9FQ0FNX0JBU0UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNh
bV9iYXNlLCBOVUxMKTsKKyAgICBvYmplY3RfcHJvcGVydHlfc2V0X2ludChP
QkpFQ1QoZGV2KSwgUENJX0hPU1RfRUNBTV9TSVpFLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGVjYW1fc2l6ZSwgTlVMTCk7CisgICAgb2JqZWN0
X3Byb3BlcnR5X3NldF91aW50KE9CSkVDVChkZXYpLCBQQ0lfSE9TVF9CRUxP
V180R19NTUlPX0JBU0UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IG1taW9fYmFzZSwgTlVMTCk7CisgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9p
bnQoT0JKRUNUKGRldiksIFBDSV9IT1NUX0JFTE9XXzRHX01NSU9fU0laRSwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICBtbWlvX3NpemUsIE5VTEwp
OworICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfdWludChPQkpFQ1QoZGV2KSwg
UENJX0hPU1RfQUJPVkVfNEdfTU1JT19CQVNFLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBoaWdoX21taW9fYmFzZSwgTlVMTCk7CisgICAgb2Jq
ZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKGRldiksIFBDSV9IT1NUX0FC
T1ZFXzRHX01NSU9fU0laRSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBoaWdoX21taW9fc2l6ZSwgTlVMTCk7CisgICAgb2JqZWN0X3Byb3BlcnR5
X3NldF91aW50KE9CSkVDVChkZXYpLCBQQ0lfSE9TVF9QSU9fQkFTRSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBwaW9fYmFzZSwgTlVMTCk7Cisg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKGRldiksIFBDSV9I
T1NUX1BJT19TSVpFLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBp
b19zaXplLCBOVUxMKTsKKworICAgIHN5c2J1c19yZWFsaXplX2FuZF91bnJl
ZihTWVNfQlVTX0RFVklDRShkZXYpLCAmZXJyb3JfZmF0YWwpOworCisgICAg
ZWNhbV9hbGlhcyA9IGdfbmV3MChNZW1vcnlSZWdpb24sIDEpOworICAgIGVj
YW1fcmVnID0gc3lzYnVzX21taW9fZ2V0X3JlZ2lvbihTWVNfQlVTX0RFVklD
RShkZXYpLCAwKTsKKyAgICBtZW1vcnlfcmVnaW9uX2luaXRfYWxpYXMoZWNh
bV9hbGlhcywgT0JKRUNUKGRldiksICJwY2llLWVjYW0iLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBlY2FtX3JlZywgMCwgZWNhbV9zaXplKTsK
KyAgICBtZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdpb24oZ2V0X3N5c3RlbV9t
ZW1vcnkoKSwgZWNhbV9iYXNlLCBlY2FtX2FsaWFzKTsKKworICAgIG1taW9f
YWxpYXMgPSBnX25ldzAoTWVtb3J5UmVnaW9uLCAxKTsKKyAgICBtbWlvX3Jl
ZyA9IHN5c2J1c19tbWlvX2dldF9yZWdpb24oU1lTX0JVU19ERVZJQ0UoZGV2
KSwgMSk7CisgICAgbWVtb3J5X3JlZ2lvbl9pbml0X2FsaWFzKG1taW9fYWxp
YXMsIE9CSkVDVChkZXYpLCAicGNpZS1tbWlvIiwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbW1pb19yZWcsIG1taW9fYmFzZSwgbW1pb19zaXpl
KTsKKyAgICBtZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdpb24oZ2V0X3N5c3Rl
bV9tZW1vcnkoKSwgbW1pb19iYXNlLCBtbWlvX2FsaWFzKTsKKworICAgIC8q
IE1hcCBoaWdoIE1NSU8gc3BhY2UgKi8KKyAgICBoaWdoX21taW9fYWxpYXMg
PSBnX25ldzAoTWVtb3J5UmVnaW9uLCAxKTsKKyAgICBtZW1vcnlfcmVnaW9u
X2luaXRfYWxpYXMoaGlnaF9tbWlvX2FsaWFzLCBPQkpFQ1QoZGV2KSwgInBj
aWUtbW1pby1oaWdoIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
bW1pb19yZWcsIGhpZ2hfbW1pb19iYXNlLCBoaWdoX21taW9fc2l6ZSk7Cisg
ICAgbWVtb3J5X3JlZ2lvbl9hZGRfc3VicmVnaW9uKGdldF9zeXN0ZW1fbWVt
b3J5KCksIGhpZ2hfbW1pb19iYXNlLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBoaWdoX21taW9fYWxpYXMpOworCisgICAgc3lzYnVzX21t
aW9fbWFwKFNZU19CVVNfREVWSUNFKGRldiksIDIsIHBpb19iYXNlKTsKKwor
ICAgIGZvciAoaSA9IDA7IGkgPCBQQ0lfTlVNX1BJTlM7IGkrKykgeworICAg
ICAgICBpcnEgPSBxZGV2X2dldF9ncGlvX2luKGlycWNoaXAsIFBDSUVfSVJR
ICsgaSk7CisKKyAgICAgICAgc3lzYnVzX2Nvbm5lY3RfaXJxKFNZU19CVVNf
REVWSUNFKGRldiksIGksIGlycSk7CisgICAgICAgIGdwZXhfc2V0X2lycV9u
dW0oR1BFWF9IT1NUKGRldiksIGksIFBDSUVfSVJRICsgaSk7CisgICAgfQor
CisgICAgR1BFWF9IT1NUKGRldiktPmdwZXhfY2ZnLmJ1cyA9IFBDSV9IT1NU
X0JSSURHRShkZXYpLT5idXM7CisgICAgcmV0dXJuIGRldjsKK30KKworc3Rh
dGljIEZXQ2ZnU3RhdGUgKmNyZWF0ZV9md19jZmcoY29uc3QgTWFjaGluZVN0
YXRlICptcywgaHdhZGRyIGJhc2UpCit7CisgICAgRldDZmdTdGF0ZSAqZndf
Y2ZnOworCisgICAgZndfY2ZnID0gZndfY2ZnX2luaXRfbWVtX3dpZGUoYmFz
ZSArIDgsIGJhc2UsIDgsIGJhc2UgKyAxNiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmYWRkcmVzc19zcGFjZV9tZW1vcnkpOworICAg
IGZ3X2NmZ19hZGRfaTE2KGZ3X2NmZywgRldfQ0ZHX05CX0NQVVMsICh1aW50
MTZfdCltcy0+c21wLmNwdXMpOworCisgICAgcmV0dXJuIGZ3X2NmZzsKK30K
Kworc3RhdGljIERldmljZVN0YXRlICp2ZWdhX2NyZWF0ZV9wbGljKGNvbnN0
IE1lbU1hcEVudHJ5ICptZW1tYXAsIGludCBzb2NrZXQsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGJhc2VfaGFydGlkLCBp
bnQgaGFydF9jb3VudCkKK3sKKyAgICBnX2F1dG9mcmVlIGNoYXIgKnBsaWNf
aGFydF9jb25maWcgPSBOVUxMOworCisgICAgLyogUGVyLXNvY2tldCBQTElD
IGhhcnQgdG9wb2xvZ3kgY29uZmlndXJhdGlvbiBzdHJpbmcgKi8KKyAgICBw
bGljX2hhcnRfY29uZmlnID0gcmlzY3ZfcGxpY19oYXJ0X2NvbmZpZ19zdHJp
bmcoaGFydF9jb3VudCk7CisKKyAgICAvKiBQZXItc29ja2V0IFBMSUMgKi8K
KyAgICByZXR1cm4gdmVnYV9wbGljX2NyZWF0ZSgKKyAgICAgICAgICAgICBt
ZW1tYXBbVkVHQV9QTElDX0lEXS5iYXNlICsgc29ja2V0ICogbWVtbWFwW1ZF
R0FfUExJQ19JRF0uc2l6ZSwgICAgIC8vQ2hhbmdlZCBmb3IgQ0RBQworICAg
ICAgICAgICAgIHBsaWNfaGFydF9jb25maWcsIGhhcnRfY291bnQsIGJhc2Vf
aGFydGlkLAorICAgICAgICAgICAgIFZFR0FfSVJRQ0hJUF9OVU1fU09VUkNF
UywKKyAgICAgICAgICAgICAoKDFVIDw8IFZFR0FfSVJRQ0hJUF9OVU1fUFJJ
T19CSVRTKSAtIDEpLAorICAgICAgICAgICAgIFZFR0FfUExJQ19QUklPUklU
WV9CQVNFLCBWRUdBX1BMSUNfUEVORElOR19CQVNFLAorICAgICAgICAgICAg
IFZFR0FfUExJQ19FTkFCTEVfQkFTRSwgVkVHQV9QTElDX0VOQUJMRV9TVFJJ
REUsCisgICAgICAgICAgICAgVkVHQV9QTElDX0NPTlRFWFRfQkFTRSwKKyAg
ICAgICAgICAgICBWRUdBX1BMSUNfQ09OVEVYVF9TVFJJREUsCisgICAgICAg
ICAgICAgbWVtbWFwW1ZFR0FfUExJQ19JRF0uc2l6ZSk7Cit9CisKK3N0YXRp
YyBEZXZpY2VTdGF0ZSAqdmVnYV9jcmVhdGVfYWlhKFJJU0NWVmVnYUFJQVR5
cGUgYWlhX3R5cGUsIGludCBhaWFfZ3Vlc3RzLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29uc3QgTWVtTWFwRW50cnkgKm1lbW1h
cCwgaW50IHNvY2tldCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGludCBiYXNlX2hhcnRpZCwgaW50IGhhcnRfY291bnQpCit7Cisg
ICAgaW50IGk7CisgICAgaHdhZGRyIGFkZHIgPSAwOworICAgIHVpbnQzMl90
IGd1ZXN0X2JpdHM7CisgICAgRGV2aWNlU3RhdGUgKmFwbGljX3MgPSBOVUxM
OworICAgIERldmljZVN0YXRlICphcGxpY19tID0gTlVMTDsKKyAgICBib29s
IG1zaW1vZGUgPSBhaWFfdHlwZSA9PSBWRUdBX0FJQV9UWVBFX0FQTElDX0lN
U0lDOworCisgICAgaWYgKG1zaW1vZGUpIHsKKyAgICAgICAgaWYgKCFrdm1f
ZW5hYmxlZCgpKSB7CisgICAgICAgICAgICAvKiBQZXItc29ja2V0IE0tbGV2
ZWwgSU1TSUNzICovCisgICAgICAgICAgICBhZGRyID0gbWVtbWFwW1ZFR0Ff
SU1TSUNfTV0uYmFzZSArCisgICAgICAgICAgICAgICAgICAgc29ja2V0ICog
VkVHQV9JTVNJQ19HUk9VUF9NQVhfU0laRTsKKyAgICAgICAgICAgIGZvciAo
aSA9IDA7IGkgPCBoYXJ0X2NvdW50OyBpKyspIHsKKyAgICAgICAgICAgICAg
ICByaXNjdl9pbXNpY19jcmVhdGUoYWRkciArIGkgKiBJTVNJQ19IQVJUX1NJ
WkUoMCksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJh
c2VfaGFydGlkICsgaSwgdHJ1ZSwgMSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgVkVHQV9JUlFDSElQX05VTV9NU0lTKTsKKyAgICAg
ICAgICAgIH0KKyAgICAgICAgfQorCisgICAgICAgIC8qIFBlci1zb2NrZXQg
Uy1sZXZlbCBJTVNJQ3MgKi8KKyAgICAgICAgZ3Vlc3RfYml0cyA9IGltc2lj
X251bV9iaXRzX3ZlZ2EoYWlhX2d1ZXN0cyArIDEpOworICAgICAgICBhZGRy
ID0gbWVtbWFwW1ZFR0FfSU1TSUNfU10uYmFzZSArIHNvY2tldCAqIFZFR0Ff
SU1TSUNfR1JPVVBfTUFYX1NJWkU7CisgICAgICAgIGZvciAoaSA9IDA7IGkg
PCBoYXJ0X2NvdW50OyBpKyspIHsKKyAgICAgICAgICAgIHJpc2N2X2ltc2lj
X2NyZWF0ZShhZGRyICsgaSAqIElNU0lDX0hBUlRfU0laRShndWVzdF9iaXRz
KSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2hhcnRp
ZCArIGksIGZhbHNlLCAxICsgYWlhX2d1ZXN0cywKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBWRUdBX0lSUUNISVBfTlVNX01TSVMpOworICAg
ICAgICB9CisgICAgfQorCisgICAgaWYgKCFrdm1fZW5hYmxlZCgpKSB7Cisg
ICAgICAgIC8qIFBlci1zb2NrZXQgTS1sZXZlbCBBUExJQyAqLworICAgICAg
ICBhcGxpY19tID0gcmlzY3ZfYXBsaWNfY3JlYXRlKG1lbW1hcFtWRUdBX0FQ
TElDX01dLmJhc2UgKworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHNvY2tldCAqIG1lbW1hcFtWRUdBX0FQTElDX01dLnNpemUsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtbWFwW1ZF
R0FfQVBMSUNfTV0uc2l6ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAobXNpbW9kZSkgPyAwIDogYmFzZV9oYXJ0aWQsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1zaW1vZGUpID8g
MCA6IGhhcnRfY291bnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgVkVHQV9JUlFDSElQX05VTV9TT1VSQ0VTLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZFR0FfSVJRQ0hJUF9OVU1f
UFJJT19CSVRTLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIG1zaW1vZGUsIHRydWUsIE5VTEwpOworICAgIH0KKworICAgIC8qIFBl
ci1zb2NrZXQgUy1sZXZlbCBBUExJQyAqLworICAgIGFwbGljX3MgPSByaXNj
dl9hcGxpY19jcmVhdGUobWVtbWFwW1ZFR0FfQVBMSUNfU10uYmFzZSArCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2NrZXQgKiBtZW1t
YXBbVkVHQV9BUExJQ19TXS5zaXplLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbWVtbWFwW1ZFR0FfQVBMSUNfU10uc2l6ZSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtc2ltb2RlKSA/IDAgOiBi
YXNlX2hhcnRpZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IChtc2ltb2RlKSA/IDAgOiBoYXJ0X2NvdW50LAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgVkVHQV9JUlFDSElQX05VTV9TT1VSQ0VTLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9JUlFDSElQ
X05VTV9QUklPX0JJVFMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBtc2ltb2RlLCBmYWxzZSwgYXBsaWNfbSk7CisKKyAgICBpZiAoa3Zt
X2VuYWJsZWQoKSAmJiBtc2ltb2RlKSB7CisgICAgICAgIHJpc2N2X2FwbGlj
X3NldF9rdm1fbXNpY2ZnYWRkcihSSVNDVl9BUExJQyhhcGxpY19zKSwgYWRk
cik7CisgICAgfQorCisgICAgcmV0dXJuIGt2bV9lbmFibGVkKCkgPyBhcGxp
Y19zIDogYXBsaWNfbTsKK30KKworc3RhdGljIHZvaWQgY3JlYXRlX3BsYXRm
b3JtX2J1cyhSSVNDVlZlZ2FTdGF0ZSAqcywgRGV2aWNlU3RhdGUgKmlycWNo
aXApCit7CisgICAgRGV2aWNlU3RhdGUgKmRldjsKKyAgICBTeXNCdXNEZXZp
Y2UgKnN5c2J1czsKKyAgICBpbnQgaTsKKyAgICBNZW1vcnlSZWdpb24gKnN5
c21lbSA9IGdldF9zeXN0ZW1fbWVtb3J5KCk7CisKKyAgICBkZXYgPSBxZGV2
X25ldyhUWVBFX1BMQVRGT1JNX0JVU19ERVZJQ0UpOworICAgIGRldi0+aWQg
PSBnX3N0cmR1cChUWVBFX1BMQVRGT1JNX0JVU19ERVZJQ0UpOworICAgIHFk
ZXZfcHJvcF9zZXRfdWludDMyKGRldiwgIm51bV9pcnFzIiwgVkVHQV9QTEFU
Rk9STV9CVVNfTlVNX0lSUVMpOworICAgIHFkZXZfcHJvcF9zZXRfdWludDMy
KGRldiwgIm1taW9fc2l6ZSIsIHMtPm1lbW1hcFtWRUdBX1BMQVRGT1JNX0JV
U10uc2l6ZSk7CisgICAgc3lzYnVzX3JlYWxpemVfYW5kX3VucmVmKFNZU19C
VVNfREVWSUNFKGRldiksICZlcnJvcl9mYXRhbCk7CisgICAgcy0+cGxhdGZv
cm1fYnVzX2RldiA9IGRldjsKKworICAgIHN5c2J1cyA9IFNZU19CVVNfREVW
SUNFKGRldik7CisgICAgZm9yIChpID0gMDsgaSA8IFZFR0FfUExBVEZPUk1f
QlVTX05VTV9JUlFTOyBpKyspIHsKKyAgICAgICAgaW50IGlycSA9IFZJUlRf
UExBVEZPUk1fQlVTX0lSUSArIGk7CisgICAgICAgIHN5c2J1c19jb25uZWN0
X2lycShzeXNidXMsIGksIHFkZXZfZ2V0X2dwaW9faW4oaXJxY2hpcCwgaXJx
KSk7CisgICAgfQorCisgICAgbWVtb3J5X3JlZ2lvbl9hZGRfc3VicmVnaW9u
KHN5c21lbSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcy0+
bWVtbWFwW1ZFR0FfUExBVEZPUk1fQlVTXS5iYXNlLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBzeXNidXNfbW1pb19nZXRfcmVnaW9uKHN5
c2J1cywgMCkpOworfQorCitzdGF0aWMgdm9pZCB2ZWdhX2J1aWxkX3NtYmlv
cyhSSVNDVlZlZ2FTdGF0ZSAqcykKK3sKKyAgICBNYWNoaW5lQ2xhc3MgKm1j
ID0gTUFDSElORV9HRVRfQ0xBU1Mocyk7CisgICAgTWFjaGluZVN0YXRlICpt
cyA9IE1BQ0hJTkUocyk7CisgICAgdWludDhfdCAqc21iaW9zX3RhYmxlcywg
KnNtYmlvc19hbmNob3I7CisgICAgc2l6ZV90IHNtYmlvc190YWJsZXNfbGVu
LCBzbWJpb3NfYW5jaG9yX2xlbjsKKyAgICBzdHJ1Y3Qgc21iaW9zX3BoeXNf
bWVtX2FyZWEgbWVtX2FycmF5OworICAgIGNvbnN0IGNoYXIgKnByb2R1Y3Qg
PSAiUUVNVSBWaXJ0dWFsIE1hY2hpbmUiOworCisgICAgaWYgKGt2bV9lbmFi
bGVkKCkpIHsKKyAgICAgICAgcHJvZHVjdCA9ICJLVk0gVmlydHVhbCBNYWNo
aW5lIjsKKyAgICB9CisKKyAgICBzbWJpb3Nfc2V0X2RlZmF1bHRzKCJRRU1V
IiwgcHJvZHVjdCwgbWMtPm5hbWUpOworCisgICAgaWYgKHJpc2N2X2lzXzMy
Yml0KCZzLT5zb2NbMF0pKSB7CisgICAgICAgIHNtYmlvc19zZXRfZGVmYXVs
dF9wcm9jZXNzb3JfZmFtaWx5KDB4MjAwKTsKKyAgICB9IGVsc2UgeworICAg
ICAgICBzbWJpb3Nfc2V0X2RlZmF1bHRfcHJvY2Vzc29yX2ZhbWlseSgweDIw
MSk7CisgICAgfQorCisgICAgLyogYnVpbGQgdGhlIGFycmF5IG9mIHBoeXNp
Y2FsIG1lbSBhcmVhIGZyb20gYmFzZV9tZW1tYXAgKi8KKyAgICBtZW1fYXJy
YXkuYWRkcmVzcyA9IHMtPm1lbW1hcFtWRUdBX0RSQU1dLmJhc2U7CisgICAg
bWVtX2FycmF5Lmxlbmd0aCA9IG1zLT5yYW1fc2l6ZTsKKworICAgIHNtYmlv
c19nZXRfdGFibGVzKG1zLCBTTUJJT1NfRU5UUllfUE9JTlRfVFlQRV82NCwK
KyAgICAgICAgICAgICAgICAgICAgICAmbWVtX2FycmF5LCAxLAorICAgICAg
ICAgICAgICAgICAgICAgICZzbWJpb3NfdGFibGVzLCAmc21iaW9zX3RhYmxl
c19sZW4sCisgICAgICAgICAgICAgICAgICAgICAgJnNtYmlvc19hbmNob3Is
ICZzbWJpb3NfYW5jaG9yX2xlbiwKKyAgICAgICAgICAgICAgICAgICAgICAm
ZXJyb3JfZmF0YWwpOworCisgICAgaWYgKHNtYmlvc19hbmNob3IpIHsKKyAg
ICAgICAgZndfY2ZnX2FkZF9maWxlKHMtPmZ3X2NmZywgImV0Yy9zbWJpb3Mv
c21iaW9zLXRhYmxlcyIsCisgICAgICAgICAgICAgICAgICAgICAgICBzbWJp
b3NfdGFibGVzLCBzbWJpb3NfdGFibGVzX2xlbik7CisgICAgICAgIGZ3X2Nm
Z19hZGRfZmlsZShzLT5md19jZmcsICJldGMvc21iaW9zL3NtYmlvcy1hbmNo
b3IiLAorICAgICAgICAgICAgICAgICAgICAgICAgc21iaW9zX2FuY2hvciwg
c21iaW9zX2FuY2hvcl9sZW4pOworICAgIH0KK30KKworc3RhdGljIHZvaWQg
dmVnYV9tYWNoaW5lX2RvbmUoTm90aWZpZXIgKm5vdGlmaWVyLCB2b2lkICpk
YXRhKQoreworICAgIFJJU0NWVmVnYVN0YXRlICpzID0gY29udGFpbmVyX29m
KG5vdGlmaWVyLCBSSVNDVlZlZ2FTdGF0ZSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBtYWNoaW5lX2RvbmUpOworICAgIE1hY2hp
bmVTdGF0ZSAqbWFjaGluZSA9IE1BQ0hJTkUocyk7CisgICAgaHdhZGRyIHN0
YXJ0X2FkZHIgPSBzLT5tZW1tYXBbVkVHQV9EUkFNXS5iYXNlOworICAgIHRh
cmdldF91bG9uZyBmaXJtd2FyZV9lbmRfYWRkciwga2VybmVsX3N0YXJ0X2Fk
ZHI7CisgICAgY29uc3QgY2hhciAqZmlybXdhcmVfbmFtZSA9IHJpc2N2X2Rl
ZmF1bHRfZmlybXdhcmVfbmFtZSgmcy0+c29jWzBdKTsKKyAgICB1aW50NjRf
dCBmZHRfbG9hZF9hZGRyOworICAgIHVpbnQ2NF90IGtlcm5lbF9lbnRyeSA9
IDA7CisgICAgQmxvY2tCYWNrZW5kICpwZmxhc2hfYmxrMDsKKyAgICBSSVND
VkJvb3RJbmZvIGJvb3RfaW5mbzsKKworICAgIC8qCisgICAgICogQW4gdXNl
ciBwcm92aWRlZCBkdGIgbXVzdCBpbmNsdWRlIGV2ZXJ5dGhpbmcsIGluY2x1
ZGluZworICAgICAqIGR5bmFtaWMgc3lzYnVzIGRldmljZXMuIE91ciBGRFQg
bmVlZHMgdG8gYmUgZmluYWxpemVkLgorICAgICAqLworICAgIGlmIChtYWNo
aW5lLT5kdGIgPT0gTlVMTCkgeworICAgICAgICBmaW5hbGl6ZV9mZHQocyk7
CisgICAgfQorCisgICAgLyoKKyAgICAgKiBPbmx5IGRpcmVjdCBib290IGtl
cm5lbCBpcyBjdXJyZW50bHkgc3VwcG9ydGVkIGZvciBLVk0gVk0sCisgICAg
ICogc28gdGhlICItYmlvcyIgcGFyYW1ldGVyIGlzIG5vdCBzdXBwb3J0ZWQg
d2hlbiBLVk0gaXMgZW5hYmxlZC4KKyAgICAgKi8KKyAgICBpZiAoa3ZtX2Vu
YWJsZWQoKSkgeworICAgICAgICBpZiAobWFjaGluZS0+ZmlybXdhcmUpIHsK
KyAgICAgICAgICAgIGlmIChzdHJjbXAobWFjaGluZS0+ZmlybXdhcmUsICJu
b25lIikpIHsKKyAgICAgICAgICAgICAgICBlcnJvcl9yZXBvcnQoIk1hY2hp
bmUgbW9kZSBmaXJtd2FyZSBpcyBub3Qgc3VwcG9ydGVkIGluICIKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgImNvbWJpbmF0aW9uIHdpdGggS1ZN
LiIpOworICAgICAgICAgICAgICAgIGV4aXQoMSk7CisgICAgICAgICAgICB9
CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBtYWNoaW5lLT5maXJt
d2FyZSA9IGdfc3RyZHVwKCJub25lIik7CisgICAgICAgIH0KKyAgICB9CisK
KyAgICBmaXJtd2FyZV9lbmRfYWRkciA9IHJpc2N2X2ZpbmRfYW5kX2xvYWRf
ZmlybXdhcmUobWFjaGluZSwgZmlybXdhcmVfbmFtZSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnN0
YXJ0X2FkZHIsIE5VTEwpOworCisgICAgcGZsYXNoX2JsazAgPSBwZmxhc2hf
Y2ZpMDFfZ2V0X2JsayhzLT5mbGFzaFswXSk7CisgICAgaWYgKHBmbGFzaF9i
bGswKSB7CisgICAgICAgIGlmIChtYWNoaW5lLT5maXJtd2FyZSAmJiAhc3Ry
Y21wKG1hY2hpbmUtPmZpcm13YXJlLCAibm9uZSIpICYmCisgICAgICAgICAg
ICAha3ZtX2VuYWJsZWQoKSkgeworICAgICAgICAgICAgLyoKKyAgICAgICAg
ICAgICAqIFBmbGFzaCB3YXMgc3VwcGxpZWQgYnV0IGJpb3MgaXMgbm9uZSBh
bmQgbm90IEtWTSBndWVzdCwKKyAgICAgICAgICAgICAqIGxldCdzIG92ZXJ3
cml0ZSB0aGUgYWRkcmVzcyB3ZSBqdW1wIHRvIGFmdGVyIHJlc2V0IHRvCisg
ICAgICAgICAgICAgKiB0aGUgYmFzZSBvZiB0aGUgZmxhc2guCisgICAgICAg
ICAgICAgKi8KKyAgICAgICAgICAgIHN0YXJ0X2FkZHIgPSBzLT5tZW1tYXBb
VkVHQV9GTEFTSF0uYmFzZTsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAg
ICAgIC8qCisgICAgICAgICAgICAgKiBQZmxhc2ggd2FzIHN1cHBsaWVkIGJ1
dCBlaXRoZXIgS1ZNIGd1ZXN0IG9yIGJpb3MgaXMgbm90IG5vbmUuCisgICAg
ICAgICAgICAgKiBJbiB0aGlzIGNhc2UsIGJhc2Ugb2YgdGhlIGZsYXNoIHdv
dWxkIGNvbnRhaW4gUy1tb2RlIHBheWxvYWQuCisgICAgICAgICAgICAgKi8K
KyAgICAgICAgICAgIHJpc2N2X3NldHVwX2Zpcm13YXJlX2Jvb3QobWFjaGlu
ZSk7CisgICAgICAgICAgICBrZXJuZWxfZW50cnkgPSBzLT5tZW1tYXBbVkVH
QV9GTEFTSF0uYmFzZTsKKyAgICAgICAgfQorICAgIH0KKworICAgIHJpc2N2
X2Jvb3RfaW5mb19pbml0KCZib290X2luZm8sICZzLT5zb2NbMF0pOworCisg
ICAgaWYgKG1hY2hpbmUtPmtlcm5lbF9maWxlbmFtZSAmJiAha2VybmVsX2Vu
dHJ5KSB7CisgICAgICAgIGtlcm5lbF9zdGFydF9hZGRyID0gcmlzY3ZfY2Fs
Y19rZXJuZWxfc3RhcnRfYWRkcigmYm9vdF9pbmZvLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ZmlybXdhcmVfZW5kX2FkZHIpOworICAgICAgICByaXNjdl9sb2FkX2tlcm5l
bChtYWNoaW5lLCAmYm9vdF9pbmZvLCBrZXJuZWxfc3RhcnRfYWRkciwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSwgTlVMTCk7CisgICAgICAg
IGtlcm5lbF9lbnRyeSA9IGJvb3RfaW5mby5pbWFnZV9sb3dfYWRkcjsKKyAg
ICB9CisKKyAgICBmZHRfbG9hZF9hZGRyID0gcmlzY3ZfY29tcHV0ZV9mZHRf
YWRkcihzLT5tZW1tYXBbVkVHQV9EUkFNXS5iYXNlLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1lbW1hcFtWRUdB
X0RSQU1dLnNpemUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbWFjaGluZSwgJmJvb3RfaW5mbyk7CisgICAgcmlzY3Zf
bG9hZF9mZHQoZmR0X2xvYWRfYWRkciwgbWFjaGluZS0+ZmR0KTsKKworICAg
IC8qIGxvYWQgdGhlIHJlc2V0IHZlY3RvciAqLworICAgIHJpc2N2X3NldHVw
X3JvbV9yZXNldF92ZWMobWFjaGluZSwgJnMtPnNvY1swXSwgc3RhcnRfYWRk
ciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1lbW1hcFtW
RUdBX01ST01dLmJhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBzLT5tZW1tYXBbVkVHQV9NUk9NXS5zaXplLCBrZXJuZWxfZW50cnksCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmZHRfbG9hZF9hZGRyKTsK
KworICAgIC8qCisgICAgICogT25seSBkaXJlY3QgYm9vdCBrZXJuZWwgaXMg
Y3VycmVudGx5IHN1cHBvcnRlZCBmb3IgS1ZNIFZNLAorICAgICAqIFNvIGhl
cmUgc2V0dXAga2VybmVsIHN0YXJ0IGFkZHJlc3MgYW5kIGZkdCBhZGRyZXNz
LgorICAgICAqIFRPRE86U3VwcG9ydCBmaXJtd2FyZSBsb2FkaW5nIGFuZCBp
bnRlZ3JhdGUgdG8gVENHIHN0YXJ0CisgICAgICovCisgICAgaWYgKGt2bV9l
bmFibGVkKCkpIHsKKyAgICAgICAgcmlzY3Zfc2V0dXBfZGlyZWN0X2tlcm5l
bChrZXJuZWxfZW50cnksIGZkdF9sb2FkX2FkZHIpOworICAgIH0KKworICAg
IHZlZ2FfYnVpbGRfc21iaW9zKHMpOworCisgICAgaWYgKHZlZ2FfaXNfYWNw
aV9lbmFibGVkKHMpKSB7CisgICAgICAgIHZpcnRfYWNwaV9zZXR1cChzKTsK
KyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfbWFjaGluZV9pbml0KE1h
Y2hpbmVTdGF0ZSAqbWFjaGluZSkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAq
cyA9IFJJU0NWX1ZFR0FfTUFDSElORShtYWNoaW5lKTsKKyAgICBNZW1vcnlS
ZWdpb24gKnN5c3RlbV9tZW1vcnkgPSBnZXRfc3lzdGVtX21lbW9yeSgpOwor
ICAgIE1lbW9yeVJlZ2lvbiAqbWFza19yb20gPSBnX25ldyhNZW1vcnlSZWdp
b24sIDEpOworICAgIERldmljZVN0YXRlICptbWlvX2lycWNoaXAsICp2aXJ0
aW9faXJxY2hpcCwgKnBjaWVfaXJxY2hpcDsKKyAgICBpbnQgaSwgYmFzZV9o
YXJ0aWQsIGhhcnRfY291bnQ7CisgICAgaW50IHNvY2tldF9jb3VudCA9IHJp
c2N2X3NvY2tldF9jb3VudChtYWNoaW5lKTsKKworICAgIHMtPm1lbW1hcCA9
IHZlZ2FfbWVtbWFwOworCisgICAgLyogQ2hlY2sgc29ja2V0IGNvdW50IGxp
bWl0ICovCisgICAgaWYgKFZFR0FfU09DS0VUU19NQVggPCBzb2NrZXRfY291
bnQpIHsKKyAgICAgICAgZXJyb3JfcmVwb3J0KCJudW1iZXIgb2Ygc29ja2V0
cy9ub2RlcyBzaG91bGQgYmUgbGVzcyB0aGFuICVkIiwKKyAgICAgICAgICAg
IFZFR0FfU09DS0VUU19NQVgpOworICAgICAgICBleGl0KDEpOworICAgIH0K
KworICAgIGlmICghdmVnYV9hY2xpbnRfYWxsb3dlZCgpICYmIHMtPmhhdmVf
YWNsaW50KSB7CisgICAgICAgIGVycm9yX3JlcG9ydCgiJ2FjbGludCcgaXMg
b25seSBhdmFpbGFibGUgd2l0aCBUQ0cgYWNjZWxlcmF0aW9uIik7CisgICAg
ICAgIGV4aXQoMSk7CisgICAgfQorCisgICAgLyogSW5pdGlhbGl6ZSBzb2Nr
ZXRzICovCisgICAgbW1pb19pcnFjaGlwID0gdmlydGlvX2lycWNoaXAgPSBw
Y2llX2lycWNoaXAgPSBOVUxMOworICAgIC8vcHJpbnRmKCJzb2NrZXRfY291
bnQtPiVkXG4iLHNvY2tldF9jb3VudCk7CisgICAgZm9yIChpID0gMDsgaSA8
IHNvY2tldF9jb3VudDsgaSsrKSB7CisgICAgICAgIGdfYXV0b2ZyZWUgY2hh
ciAqc29jX25hbWUgPSBnX3N0cmR1cF9wcmludGYoInNvYyVkIiwgaSk7CisK
KyAgICAgICAgaWYgKCFyaXNjdl9zb2NrZXRfY2hlY2tfaGFydGlkcyhtYWNo
aW5lLCBpKSkgeworICAgICAgICAgICAgZXJyb3JfcmVwb3J0KCJkaXNjb250
aW51b3VzIGhhcnRpZHMgaW4gc29ja2V0JWQiLCBpKTsKKyAgICAgICAgICAg
IGV4aXQoMSk7CisgICAgICAgIH0KKworICAgICAgICBiYXNlX2hhcnRpZCA9
IHJpc2N2X3NvY2tldF9maXJzdF9oYXJ0aWQobWFjaGluZSwgaSk7CisgICAg
ICAgIGlmIChiYXNlX2hhcnRpZCA8IDApIHsKKyAgICAgICAgICAgIGVycm9y
X3JlcG9ydCgiY2FuJ3QgZmluZCBoYXJ0aWQgYmFzZSBmb3Igc29ja2V0JWQi
LCBpKTsKKyAgICAgICAgICAgIGV4aXQoMSk7CisgICAgICAgIH0KKworICAg
ICAgICBoYXJ0X2NvdW50ID0gcmlzY3Zfc29ja2V0X2hhcnRfY291bnQobWFj
aGluZSwgaSk7CisgICAgICAgIGlmIChoYXJ0X2NvdW50IDwgMCkgeworICAg
ICAgICAgICAgZXJyb3JfcmVwb3J0KCJjYW4ndCBmaW5kIGhhcnQgY291bnQg
Zm9yIHNvY2tldCVkIiwgaSk7CisgICAgICAgICAgICBleGl0KDEpOworICAg
ICAgICB9CisKKyAgICAgICAgb2JqZWN0X2luaXRpYWxpemVfY2hpbGQoT0JK
RUNUKG1hY2hpbmUpLCBzb2NfbmFtZSwgJnMtPnNvY1tpXSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgVFlQRV9SSVNDVl9IQVJUX0FSUkFZ
KTsKKyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9zdHIoT0JKRUNUKCZz
LT5zb2NbaV0pLCAiY3B1LXR5cGUiLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBtYWNoaW5lLT5jcHVfdHlwZSwgJmVycm9yX2Fib3J0KTsK
KyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5z
b2NbaV0pLCAiaGFydGlkLWJhc2UiLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBiYXNlX2hhcnRpZCwgJmVycm9yX2Fib3J0KTsKKyAgICAg
ICAgb2JqZWN0X3Byb3BlcnR5X3NldF9pbnQoT0JKRUNUKCZzLT5zb2NbaV0p
LCAibnVtLWhhcnRzIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaGFydF9jb3VudCwgJmVycm9yX2Fib3J0KTsKKyAgICAgICAgc3lzYnVz
X3JlYWxpemUoU1lTX0JVU19ERVZJQ0UoJnMtPnNvY1tpXSksICZlcnJvcl9m
YXRhbCk7CisKKyAgICAgICAgaWYgKHZlZ2FfYWNsaW50X2FsbG93ZWQoKSAm
JiBzLT5oYXZlX2FjbGludCkgeworICAgICAgICAgICAgaWYgKHMtPmFpYV90
eXBlID09IFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMpIHsKKyAgICAgICAg
ICAgICAgICAvKiBQZXItc29ja2V0IEFDTElOVCBNVElNRVIgKi8KKyAgICAg
ICAgICAgICAgICB2ZWdhX2FjbGludF9tdGltZXJfY3JlYXRlKHMtPm1lbW1h
cFtWRUdBX0NMSU5UXS5iYXNlICsKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBpICogVkVHQV9BQ0xJTlRfREVGQVVMVF9NVElNRVJfU0laRSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgIFZFR0FfQUNMSU5UX0RFRkFVTFRfTVRJ
TUVSX1NJWkUsCisgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2hhcnRp
ZCwgaGFydF9jb3VudCwKKyAgICAgICAgICAgICAgICAgICAgICAgIFZFR0Ff
QUNMSU5UX0RFRkFVTFRfTVRJTUVDTVAsCisgICAgICAgICAgICAgICAgICAg
ICAgICBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FLAorICAgICAgICAgICAg
ICAgICAgICAgICAgVkVHQV9BQ0xJTlRfREVGQVVMVF9USU1FQkFTRV9GUkVR
LCB0cnVlKTsKKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAg
ICAgLyogUGVyLXNvY2tldCBBQ0xJTlQgTVNXSSwgTVRJTUVSLCBhbmQgU1NX
SSAqLworICAgICAgICAgICAgICAgIHZlZ2FfYWNsaW50X3N3aV9jcmVhdGUo
cy0+bWVtbWFwW1ZFR0FfQ0xJTlRdLmJhc2UgKyAKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBpICogcy0+bWVtbWFwW1ZFR0FfQ0xJTlRdLnNpemUs
CisgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2hhcnRpZCwgaGFydF9j
b3VudCwgZmFsc2UpOworICAgICAgICAgICAgICAgIHZlZ2FfYWNsaW50X210
aW1lcl9jcmVhdGUocy0+bWVtbWFwW1ZFR0FfQ0xJTlRdLmJhc2UgKworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGkgKiBzLT5tZW1tYXBbVkVHQV9D
TElOVF0uc2l6ZSArCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgVkVH
QV9BQ0xJTlRfU1dJX1NJWkUsCisgICAgICAgICAgICAgICAgICAgICAgICBW
RUdBX0FDTElOVF9ERUZBVUxUX01USU1FUl9TSVpFLAorICAgICAgICAgICAg
ICAgICAgICAgICAgYmFzZV9oYXJ0aWQsIGhhcnRfY291bnQsCisgICAgICAg
ICAgICAgICAgICAgICAgICBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FQ01Q
LAorICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9BQ0xJTlRfREVGQVVM
VF9NVElNRSwKKyAgICAgICAgICAgICAgICAgICAgICAgIFZFR0FfQUNMSU5U
X0RFRkFVTFRfVElNRUJBU0VfRlJFUSwgdHJ1ZSk7CisKKyAgICAgICAgICAg
ICAgICB2ZWdhX2FjbGludF9zd2lfY3JlYXRlKHMtPm1lbW1hcFtWRUdBX0FD
TElOVF9TU1dJXS5iYXNlICsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBpICogcy0+bWVtbWFwW1ZFR0FfQUNMSU5UX1NTV0ldLnNpemUsCisgICAg
ICAgICAgICAgICAgICAgICAgICBiYXNlX2hhcnRpZCwgaGFydF9jb3VudCwg
dHJ1ZSk7CisgICAgICAgICAgICB9CisgICAgICAgIH0gZWxzZSBpZiAodGNn
X2VuYWJsZWQoKSkgeyAgICAgICAvL0NoYW5nZWQgZm9yIENEQUMKKyAgICAg
ICAgICAgIC8qIFBlci1zb2NrZXQgU2lGaXZlIENMSU5UICovCisgICAgICAg
ICAgICB2ZWdhX2FjbGludF9zd2lfY3JlYXRlKHMtPm1lbW1hcFtWRUdBX0NM
SU5UXS5iYXNlICsgIGkgKiBzLT5tZW1tYXBbVkVHQV9DTElOVF0uc2l6ZQor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAweDQwMCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgIGJhc2VfaGFydGlkLCBoYXJ0X2NvdW50LCBmYWxz
ZSk7IAorICAgICAgICAgICAgIHZlZ2FfYWNsaW50X210aW1lcl9jcmVhdGUo
cy0+bWVtbWFwW1ZFR0FfQ0xJTlRdLmJhc2UgKyAgIGkgKiBzLT5tZW1tYXBb
VkVHQV9DTElOVF0uc2l6ZQorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICsgVkVHQV9BQ0xJTlRfU1dJX1NJWkUsCisgICAgICAgICAgICAgICAgICAg
ICAgICBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1FUl9TSVpFLAorICAgICAg
ICAgICAgICAgICAgICAgICAgYmFzZV9oYXJ0aWQsIGhhcnRfY291bnQsCisg
ICAgICAgICAgICAgICAgICAgICAgICBWRUdBX0FDTElOVF9ERUZBVUxUX01U
SU1FQ01QLAorICAgICAgICAgICAgICAgICAgICAgICAgVkVHQV9BQ0xJTlRf
REVGQVVMVF9NVElNRSwKKyAgICAgICAgICAgICAgICAgICAgICAgIFZFR0Ff
QUNMSU5UX0RFRkFVTFRfVElNRUJBU0VfRlJFUSwgdHJ1ZSk7CisgICAgICAg
IH0KKworICAgICAgICAvKiBQZXItc29ja2V0IGludGVycnVwdCBjb250cm9s
bGVyICovCisgICAgICAgIGlmIChzLT5haWFfdHlwZSA9PSBWRUdBX0FJQV9U
WVBFX05PTkUpIHsKKyAgICAgICAgICAgIHMtPmlycWNoaXBbaV0gPSB2ZWdh
X2NyZWF0ZV9wbGljKHMtPm1lbW1hcCwgaSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VfaGFydGlkLCBoYXJ0
X2NvdW50KTsKKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIHMtPmly
cWNoaXBbaV0gPSB2ZWdhX2NyZWF0ZV9haWEocy0+YWlhX3R5cGUsIHMtPmFp
YV9ndWVzdHMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHMtPm1lbW1hcCwgaSwgYmFzZV9oYXJ0aWQsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhcnRfY291
bnQpOworICAgICAgICB9CisKKyAgICAgICAgLyogVHJ5IHRvIHVzZSBkaWZm
ZXJlbnQgSVJRQ0hJUCBpbnN0YW5jZSBiYXNlZCBkZXZpY2UgdHlwZSAqLwor
ICAgICAgICBpZiAoaSA9PSAwKSB7CisgICAgICAgICAgICBtbWlvX2lycWNo
aXAgPSBzLT5pcnFjaGlwW2ldOworICAgICAgICAgICAgdmlydGlvX2lycWNo
aXAgPSBzLT5pcnFjaGlwW2ldOworICAgICAgICAgICAgcGNpZV9pcnFjaGlw
ID0gcy0+aXJxY2hpcFtpXTsKKyAgICAgICAgfQorICAgICAgICBpZiAoaSA9
PSAxKSB7CisgICAgICAgICAgICB2aXJ0aW9faXJxY2hpcCA9IHMtPmlycWNo
aXBbaV07CisgICAgICAgICAgICBwY2llX2lycWNoaXAgPSBzLT5pcnFjaGlw
W2ldOworICAgICAgICB9CisgICAgICAgIGlmIChpID09IDIpIHsKKyAgICAg
ICAgICAgIHBjaWVfaXJxY2hpcCA9IHMtPmlycWNoaXBbaV07CisgICAgICAg
IH0KKyAgICB9CisKKyAgICBpZiAoa3ZtX2VuYWJsZWQoKSAmJiB2ZWdhX3Vz
ZV9rdm1fYWlhX2FwbGljX2ltc2ljKHMtPmFpYV90eXBlKSkgeworICAgICAg
ICBrdm1fcmlzY3ZfYWlhX2NyZWF0ZShtYWNoaW5lLCBJTVNJQ19NTUlPX0dS
T1VQX01JTl9TSElGVCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
VkVHQV9JUlFDSElQX05VTV9TT1VSQ0VTLCBWRUdBX0lSUUNISVBfTlVNX01T
SVMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMtPm1lbW1hcFtW
RUdBX0FQTElDX1NdLmJhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHMtPm1lbW1hcFtWRUdBX0lNU0lDX1NdLmJhc2UsCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHMtPmFpYV9ndWVzdHMpOworICAgIH0KKwor
ICAgIGlmIChyaXNjdl9pc18zMmJpdCgmcy0+c29jWzBdKSkgeworI2lmIEhP
U1RfTE9OR19CSVRTID09IDY0CisgICAgICAgIC8qIGxpbWl0IFJBTSBzaXpl
IGluIGEgMzItYml0IHN5c3RlbSAqLworICAgICAgICBpZiAobWFjaGluZS0+
cmFtX3NpemUgPiAxMCAqIEdpQikgeworICAgICAgICAgICAgbWFjaGluZS0+
cmFtX3NpemUgPSAxMCAqIEdpQjsKKyAgICAgICAgICAgIGVycm9yX3JlcG9y
dCgiTGltaXRpbmcgUkFNIHNpemUgdG8gMTAgR2lCIik7CisgICAgICAgIH0K
KyNlbmRpZgorICAgICAgICB2ZWdhX2hpZ2hfcGNpZV9tZW1tYXAuYmFzZSA9
IFZFR0EzMl9ISUdIX1BDSUVfTU1JT19CQVNFOworICAgICAgICB2ZWdhX2hp
Z2hfcGNpZV9tZW1tYXAuc2l6ZSA9IFZFR0EzMl9ISUdIX1BDSUVfTU1JT19T
SVpFOworICAgIH0gZWxzZSB7CisgICAgICAgIHZlZ2FfaGlnaF9wY2llX21l
bW1hcC5zaXplID0gVkVHQTY0X0hJR0hfUENJRV9NTUlPX1NJWkU7CisgICAg
ICAgIHZlZ2FfaGlnaF9wY2llX21lbW1hcC5iYXNlID0gcy0+bWVtbWFwW1ZF
R0FfRFJBTV0uYmFzZSArCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbWFjaGluZS0+cmFtX3NpemU7CisgICAgICAgIHZlZ2FfaGln
aF9wY2llX21lbW1hcC5iYXNlID0KKyAgICAgICAgICAgIFJPVU5EX1VQKHZl
Z2FfaGlnaF9wY2llX21lbW1hcC5iYXNlLCB2ZWdhX2hpZ2hfcGNpZV9tZW1t
YXAuc2l6ZSk7CisgICAgfQorCisgICAgLypDTEEgY29uZmlndXJhdGlvbiBv
ZiBkcmFtKi8KKyAgICBzLT5kcmFtX2Jhc2UgPSB2ZWdhX2RyYW1fYmFzZV9w
cm9wZXJ0eTsKKyAgICBwcmludGYoIkRFQlVHOiBwYXJzZWQgZHJhbV9iYXNl
ID0gMHglbHhcbiIsICh1bnNpZ25lZCBsb25nKXMtPmRyYW1fYmFzZSk7CisK
KyAgICBpZiAoIXMtPmRyYW1fYmFzZSkKKyAgICB7CisgICAgICAgIGVycm9y
X3JlcG9ydCgiUGxlYXNlIHNwZWNpZnkgLU0gdmVnYSxkcmFtLWJhc2U9PGFk
ZHI+Iik7CisgICAgICAgIGV4aXQoMSk7CisgICAgfQorICAgIGVsc2UKKyAg
ICB7CisgICAgICAgIHZlZ2FfbWVtbWFwW1ZFR0FfRFJBTV0uYmFzZSA9IHMt
PmRyYW1fYmFzZTsKKyAgICB9CisKKyAgICBtZW1vcnlfcmVnaW9uX2FkZF9z
dWJyZWdpb24oc3lzdGVtX21lbW9yeSwgcy0+bWVtbWFwW1ZFR0FfRFJBTV0u
YmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFjaGlu
ZS0+cmFtKTsKKworICAgIHByaW50ZigiVkVHQTogRFJBTSBpbml0aWFsaXpl
ZCBhdCBiYXNlIDB4JWx4IHdpdGggc2l6ZSAweCVseFxuIiwKKyAgICAgICAg
ICAgKHVuc2lnbmVkIGxvbmcpcy0+ZHJhbV9iYXNlLCAodW5zaWduZWQgbG9u
ZyltYWNoaW5lLT5yYW1fc2l6ZSk7CisKKyAgICAvKiBib290IHJvbSAqLwor
ICAgIG1lbW9yeV9yZWdpb25faW5pdF9yb20obWFza19yb20sIE5VTEwsICJy
aXNjdl92ZWdhX2JvYXJkLm1yb20iLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcy0+bWVtbWFwW1ZFR0FfTVJPTV0uc2l6ZSwgJmVycm9yX2ZhdGFs
KTsKKyAgICBtZW1vcnlfcmVnaW9uX2FkZF9zdWJyZWdpb24oc3lzdGVtX21l
bW9yeSwgcy0+bWVtbWFwW1ZFR0FfTVJPTV0uYmFzZSwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgbWFza19yb20pOworCisgICAgLyoKKyAg
ICAgKiBJbml0IGZ3X2NmZy4gTXVzdCBiZSBkb25lIGJlZm9yZSByaXNjdl9s
b2FkX2ZkdCwgb3RoZXJ3aXNlIHRoZQorICAgICAqIGRldmljZSB0cmVlIGNh
bm5vdCBiZSBhbHRlcmVkIGFuZCB3ZSBnZXQgRkRUX0VSUl9OT1NQQUNFLgor
ICAgICAqLworICAgIHMtPmZ3X2NmZyA9IGNyZWF0ZV9md19jZmcobWFjaGlu
ZSwgcy0+bWVtbWFwW1ZFR0FfRldfQ0ZHXS5iYXNlKTsKKyAgICByb21fc2V0
X2Z3KHMtPmZ3X2NmZyk7CisKKyAgICAvKiBTaUZpdmUgVGVzdCBNTUlPIGRl
dmljZSAqLworICAgIHNpZml2ZV90ZXN0X2NyZWF0ZShzLT5tZW1tYXBbVkVH
QV9URVNUXS5iYXNlKTsKKworICAgIC8qIFZpcnRJTyBNTUlPIGRldmljZXMg
Ki8KKyAgICBmb3IgKGkgPSAwOyBpIDwgVklSVElPX0NPVU5UOyBpKyspIHsK
KyAgICAgICAgc3lzYnVzX2NyZWF0ZV9zaW1wbGUoInZpcnRpby1tbWlvIiwK
KyAgICAgICAgICAgIHMtPm1lbW1hcFtWRUdBX1ZJUlRJT10uYmFzZSArIGkg
KiBzLT5tZW1tYXBbVkVHQV9WSVJUSU9dLnNpemUsCisgICAgICAgICAgICBx
ZGV2X2dldF9ncGlvX2luKHZpcnRpb19pcnFjaGlwLCBWSVJUSU9fSVJRICsg
aSkpOworICAgIH0KKworICAgIGdwZXhfcGNpZV9pbml0KHN5c3RlbV9tZW1v
cnksIHBjaWVfaXJxY2hpcCwgcyk7CisKKyAgICBjcmVhdGVfcGxhdGZvcm1f
YnVzKHMsIG1taW9faXJxY2hpcCk7CisKKyAgICAvKkZvciByZWcgc2hpZnQg
aW4gVUFSVCAoMCBvciAyKSovCisgICAgYm9vbCBpc19iYXJlbWV0YWwgPSBz
LT5iYXJlbWV0YWxfbW9kZTsKKyAgICBzZXJpYWxfbW1faW5pdChzeXN0ZW1f
bWVtb3J5LCBzLT5tZW1tYXBbVkVHQV9VQVJUMF0uYmFzZSwKKyAgICAgICAg
aXNfYmFyZW1ldGFsID8gMiA6IDAsCisgICAgICAgIHFkZXZfZ2V0X2dwaW9f
aW4obW1pb19pcnFjaGlwLCBVQVJUMF9JUlEpLAorICAgICAgICAzOTkxOTMs
CisgICAgICAgIHNlcmlhbF9oZCgwKSwKKyAgICAgICAgREVWSUNFX0xJVFRM
RV9FTkRJQU4pOworCisgICAgc3lzYnVzX2NyZWF0ZV9zaW1wbGUoImdvbGRm
aXNoX3J0YyIsIHMtPm1lbW1hcFtWRUdBX1JUQ10uYmFzZSwKKyAgICAgICAg
cWRldl9nZXRfZ3Bpb19pbihtbWlvX2lycWNoaXAsIFJUQ19JUlEpKTsKKwor
ICAgIGZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHMtPmZsYXNoKTsgaSsr
KSB7CisgICAgICAgIC8qIE1hcCBsZWdhY3kgLWRyaXZlIGlmPXBmbGFzaCB0
byBtYWNoaW5lIHByb3BlcnRpZXMgKi8KKyAgICAgICAgcGZsYXNoX2NmaTAx
X2xlZ2FjeV9kcml2ZShzLT5mbGFzaFtpXSwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBkcml2ZV9nZXQoSUZfUEZMQVNILCAwLCBpKSk7
CisgICAgfQorICAgIHZlZ2FfZmxhc2hfbWFwKHMsIHN5c3RlbV9tZW1vcnkp
OworCisgICAgLyogbG9hZC9jcmVhdGUgZGV2aWNlIHRyZWUgKi8KKyAgICBp
ZiAobWFjaGluZS0+ZHRiKSB7CisgICAgICAgIG1hY2hpbmUtPmZkdCA9IGxv
YWRfZGV2aWNlX3RyZWUobWFjaGluZS0+ZHRiLCAmcy0+ZmR0X3NpemUpOwor
ICAgICAgICBpZiAoIW1hY2hpbmUtPmZkdCkgeworICAgICAgICAgICAgZXJy
b3JfcmVwb3J0KCJsb2FkX2RldmljZV90cmVlKCkgZmFpbGVkIik7CisgICAg
ICAgICAgICBleGl0KDEpOworICAgICAgICB9CisgICAgfSBlbHNlIHsKKyAg
ICAgICAgY3JlYXRlX2ZkdChzKTsKKyAgICB9CisKKyAgICBpZiAodmVnYV9p
c19pb21tdV9zeXNfZW5hYmxlZChzKSkgeworICAgICAgICBEZXZpY2VTdGF0
ZSAqaW9tbXVfc3lzID0gcWRldl9uZXcoVFlQRV9SSVNDVl9JT01NVV9TWVMp
OworCisgICAgICAgIG9iamVjdF9wcm9wZXJ0eV9zZXRfdWludChPQkpFQ1Qo
aW9tbXVfc3lzKSwgImFkZHIiLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfSU9NTVVfU1lTXS5iYXNlLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmVycm9yX2ZhdGFsKTsK
KyAgICAgICAgb2JqZWN0X3Byb3BlcnR5X3NldF91aW50KE9CSkVDVChpb21t
dV9zeXMpLCAiYmFzZS1pcnEiLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgSU9NTVVfU1lTX0lSUSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICZlcnJvcl9mYXRhbCk7CisgICAgICAgIG9iamVjdF9w
cm9wZXJ0eV9zZXRfbGluayhPQkpFQ1QoaW9tbXVfc3lzKSwgImlycWNoaXAi
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT0JKRUNUKG1t
aW9faXJxY2hpcCksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmZXJyb3JfZmF0YWwpOworCisgICAgICAgIHN5c2J1c19yZWFsaXplX2Fu
ZF91bnJlZihTWVNfQlVTX0RFVklDRShpb21tdV9zeXMpLCAmZXJyb3JfZmF0
YWwpOworICAgIH0KKworICAgIHMtPm1hY2hpbmVfZG9uZS5ub3RpZnkgPSB2
ZWdhX21hY2hpbmVfZG9uZTsKKyAgICBxZW11X2FkZF9tYWNoaW5lX2luaXRf
ZG9uZV9ub3RpZmllcigmcy0+bWFjaGluZV9kb25lKTsKKworICAgIC8qVUFS
VDEgLSBVQVJUNCovCisgICAgY3JlYXRlX3VuaW1wbGVtZW50ZWRfZGV2aWNl
KCJ2ZWdhLnVhcnQxIiwKKyAgICAgICAgIHMtPm1lbW1hcFtWRUdBX1VBUlQx
XS5iYXNlLAorICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfVUFSVDFdLnNpemUp
OworICAgIGNyZWF0ZV91bmltcGxlbWVudGVkX2RldmljZSgidmVnYS51YXJ0
MiIsCisgICAgICAgICBzLT5tZW1tYXBbVkVHQV9VQVJUMl0uYmFzZSwKKyAg
ICAgICAgIHMtPm1lbW1hcFtWRUdBX1VBUlQyXS5zaXplKTsKKyAgICBjcmVh
dGVfdW5pbXBsZW1lbnRlZF9kZXZpY2UoInZlZ2EudWFydDMiLAorICAgICAg
ICAgcy0+bWVtbWFwW1ZFR0FfVUFSVDNdLmJhc2UsCisgICAgICAgICBzLT5t
ZW1tYXBbVkVHQV9VQVJUM10uc2l6ZSk7CisgICAgY3JlYXRlX3VuaW1wbGVt
ZW50ZWRfZGV2aWNlKCJ2ZWdhLnVhcnQ0IiwKKyAgICAgICAgIHMtPm1lbW1h
cFtWRUdBX1VBUlQ0XS5iYXNlLAorICAgICAgICAgcy0+bWVtbWFwW1ZFR0Ff
VUFSVDRdLnNpemUpOworCisgICAgLyogU1BJIE1NSU8qLworICAgIGNyZWF0
ZV91bmltcGxlbWVudGVkX2RldmljZSgidmVnYS5zcGkwIiwKKyAgICAgICAg
IHMtPm1lbW1hcFtWRUdBX1NQSTBdLmJhc2UsCisgICAgICAgICBzLT5tZW1t
YXBbVkVHQV9TUEkwXS5zaXplKTsKKyAgICBjcmVhdGVfdW5pbXBsZW1lbnRl
ZF9kZXZpY2UoInZlZ2Euc3BpMSIsCisgICAgICAgICBzLT5tZW1tYXBbVkVH
QV9TUEkxXS5iYXNlLAorICAgICAgICAgcy0+bWVtbWFwW1ZFR0FfU1BJMV0u
c2l6ZSk7CisKKyAgICAvKiBJMkMgTU1JTyovCisgICAgY3JlYXRlX3VuaW1w
bGVtZW50ZWRfZGV2aWNlKCJ2ZWdhLmkyYzAiLAorICAgICAgICAgcy0+bWVt
bWFwW1ZFR0FfSUlDMF0uYmFzZSwKKyAgICAgICAgIHMtPm1lbW1hcFtWRUdB
X0lJQzBdLnNpemUpOworICAgIGNyZWF0ZV91bmltcGxlbWVudGVkX2Rldmlj
ZSgidmVnYS5pMmMxIiwKKyAgICAgICAgIHMtPm1lbW1hcFtWRUdBX0lJQzFd
LmJhc2UsCisgICAgICAgICBzLT5tZW1tYXBbVkVHQV9JSUMxXS5zaXplKTsK
KyAgICAKK30KKworc3RhdGljIHZvaWQgdmVnYV9tYWNoaW5lX2luc3RhbmNl
X2luaXQoT2JqZWN0ICpvYmopCit7CisgICAgUklTQ1ZWZWdhU3RhdGUgKnMg
PSBSSVNDVl9WRUdBX01BQ0hJTkUob2JqKTsKKworICAgIHZlZ2FfZmxhc2hf
Y3JlYXRlKHMpOworCisgICAgcy0+b2VtX2lkID0gZ19zdHJuZHVwKEFDUElf
QlVJTERfQVBQTkFNRTYsIDYpOworICAgIHMtPm9lbV90YWJsZV9pZCA9IGdf
c3RybmR1cChBQ1BJX0JVSUxEX0FQUE5BTUU4LCA4KTsKKyAgICBzLT5hY3Bp
ID0gT05fT0ZGX0FVVE9fQVVUTzsKKyAgICBzLT5pb21tdV9zeXMgPSBPTl9P
RkZfQVVUT19BVVRPOworfQorCitzdGF0aWMgY2hhciAqdmVnYV9nZXRfYWlh
X2d1ZXN0cyhPYmplY3QgKm9iaiwgRXJyb3IgKiplcnJwKQoreworICAgIFJJ
U0NWVmVnYVN0YXRlICpzID0gUklTQ1ZfVkVHQV9NQUNISU5FKG9iaik7CisK
KyAgICByZXR1cm4gZ19zdHJkdXBfcHJpbnRmKCIlZCIsIHMtPmFpYV9ndWVz
dHMpOworfQorCitzdGF0aWMgdm9pZCB2ZWdhX3NldF9haWFfZ3Vlc3RzKE9i
amVjdCAqb2JqLCBjb25zdCBjaGFyICp2YWwsIEVycm9yICoqZXJycCkKK3sK
KyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElORShv
YmopOworCisgICAgcy0+YWlhX2d1ZXN0cyA9IGF0b2kodmFsKTsKKyAgICBp
ZiAocy0+YWlhX2d1ZXN0cyA8IDAgfHwgcy0+YWlhX2d1ZXN0cyA+IFZFR0Ff
SVJRQ0hJUF9NQVhfR1VFU1RTKSB7CisgICAgICAgIGVycm9yX3NldGcoZXJy
cCwgIkludmFsaWQgbnVtYmVyIG9mIEFJQSBJTVNJQyBndWVzdHMiKTsKKyAg
ICAgICAgZXJyb3JfYXBwZW5kX2hpbnQoZXJycCwgIlZhbGlkIHZhbHVlcyBi
ZSBiZXR3ZWVuIDAgYW5kICVkLlxuIiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgVkVHQV9JUlFDSElQX01BWF9HVUVTVFMpOworICAgIH0KK30KKwor
c3RhdGljIGNoYXIgKnZlZ2FfZ2V0X2FpYShPYmplY3QgKm9iaiwgRXJyb3Ig
KiplcnJwKQoreworICAgIFJJU0NWVmVnYVN0YXRlICpzID0gUklTQ1ZfVkVH
QV9NQUNISU5FKG9iaik7CisgICAgY29uc3QgY2hhciAqdmFsOworCisgICAg
c3dpdGNoIChzLT5haWFfdHlwZSkgeworICAgIGNhc2UgVkVHQV9BSUFfVFlQ
RV9BUExJQzoKKyAgICAgICAgdmFsID0gImFwbGljIjsKKyAgICAgICAgYnJl
YWs7CisgICAgY2FzZSBWRUdBX0FJQV9UWVBFX0FQTElDX0lNU0lDOgorICAg
ICAgICB2YWwgPSAiYXBsaWMtaW1zaWMiOworICAgICAgICBicmVhazsKKyAg
ICBkZWZhdWx0OgorICAgICAgICB2YWwgPSAibm9uZSI7CisgICAgICAgIGJy
ZWFrOworICAgIH07CisKKyAgICByZXR1cm4gZ19zdHJkdXAodmFsKTsKK30K
Kworc3RhdGljIHZvaWQgdmVnYV9zZXRfYWlhKE9iamVjdCAqb2JqLCBjb25z
dCBjaGFyICp2YWwsIEVycm9yICoqZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FT
dGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElORShvYmopOworCisgICAgaWYg
KCFzdHJjbXAodmFsLCAibm9uZSIpKSB7CisgICAgICAgIHMtPmFpYV90eXBl
ID0gVkVHQV9BSUFfVFlQRV9OT05FOworICAgIH0gZWxzZSBpZiAoIXN0cmNt
cCh2YWwsICJhcGxpYyIpKSB7CisgICAgICAgIHMtPmFpYV90eXBlID0gVkVH
QV9BSUFfVFlQRV9BUExJQzsKKyAgICB9IGVsc2UgaWYgKCFzdHJjbXAodmFs
LCAiYXBsaWMtaW1zaWMiKSkgeworICAgICAgICBzLT5haWFfdHlwZSA9IFZF
R0FfQUlBX1RZUEVfQVBMSUNfSU1TSUM7CisgICAgfSBlbHNlIHsKKyAgICAg
ICAgZXJyb3Jfc2V0ZyhlcnJwLCAiSW52YWxpZCBBSUEgaW50ZXJydXB0IGNv
bnRyb2xsZXIgdHlwZSIpOworICAgICAgICBlcnJvcl9hcHBlbmRfaGludChl
cnJwLCAiVmFsaWQgdmFsdWVzIGFyZSBub25lLCBhcGxpYywgYW5kICIKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgImFwbGljLWltc2ljLlxuIik7Cisg
ICAgfQorfQorCitzdGF0aWMgYm9vbCB2ZWdhX2dldF9hY2xpbnQoT2JqZWN0
ICpvYmosIEVycm9yICoqZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAq
cyA9IFJJU0NWX1ZFR0FfTUFDSElORShvYmopOworCisgICAgcmV0dXJuIHMt
PmhhdmVfYWNsaW50OworfQorCitzdGF0aWMgdm9pZCB2ZWdhX3NldF9hY2xp
bnQoT2JqZWN0ICpvYmosIGJvb2wgdmFsdWUsIEVycm9yICoqZXJycCkKK3sK
KyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElORShv
YmopOworCisgICAgcy0+aGF2ZV9hY2xpbnQgPSB2YWx1ZTsKK30KKworYm9v
bCB2ZWdhX2lzX2lvbW11X3N5c19lbmFibGVkKFJJU0NWVmVnYVN0YXRlICpz
KQoreworICAgIHJldHVybiBzLT5pb21tdV9zeXMgPT0gT05fT0ZGX0FVVE9f
T047Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfZ2V0X2lvbW11X3N5cyhPYmpl
Y3QgKm9iaiwgVmlzaXRvciAqdiwgY29uc3QgY2hhciAqbmFtZSwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkICpvcGFxdWUsIEVycm9y
ICoqZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZF
R0FfTUFDSElORShvYmopOworICAgIE9uT2ZmQXV0byBpb21tdV9zeXMgPSBz
LT5pb21tdV9zeXM7CisKKyAgICB2aXNpdF90eXBlX09uT2ZmQXV0byh2LCBu
YW1lLCAmaW9tbXVfc3lzLCBlcnJwKTsKK30KKworc3RhdGljIHZvaWQgdmVn
YV9zZXRfaW9tbXVfc3lzKE9iamVjdCAqb2JqLCBWaXNpdG9yICp2LCBjb25z
dCBjaGFyICpuYW1lLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHZvaWQgKm9wYXF1ZSwgRXJyb3IgKiplcnJwKQoreworICAgIFJJU0NWVmVn
YVN0YXRlICpzID0gUklTQ1ZfVkVHQV9NQUNISU5FKG9iaik7CisKKyAgICB2
aXNpdF90eXBlX09uT2ZmQXV0byh2LCBuYW1lLCAmcy0+aW9tbXVfc3lzLCBl
cnJwKTsKK30KKworYm9vbCB2ZWdhX2lzX2FjcGlfZW5hYmxlZChSSVNDVlZl
Z2FTdGF0ZSAqcykKK3sKKyAgICByZXR1cm4gcy0+YWNwaSAhPSBPTl9PRkZf
QVVUT19PRkY7Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2FfZ2V0X2FjcGkoT2Jq
ZWN0ICpvYmosIFZpc2l0b3IgKnYsIGNvbnN0IGNoYXIgKm5hbWUsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgIHZvaWQgKm9wYXF1ZSwgRXJyb3IgKipl
cnJwKQoreworICAgIFJJU0NWVmVnYVN0YXRlICpzID0gUklTQ1ZfVkVHQV9N
QUNISU5FKG9iaik7CisgICAgT25PZmZBdXRvIGFjcGkgPSBzLT5hY3BpOwor
CisgICAgdmlzaXRfdHlwZV9Pbk9mZkF1dG8odiwgbmFtZSwgJmFjcGksIGVy
cnApOworfQorCitzdGF0aWMgdm9pZCB2ZWdhX3NldF9hY3BpKE9iamVjdCAq
b2JqLCBWaXNpdG9yICp2LCBjb25zdCBjaGFyICpuYW1lLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICB2b2lkICpvcGFxdWUsIEVycm9yICoqZXJycCkK
K3sKKyAgICBSSVNDVlZlZ2FTdGF0ZSAqcyA9IFJJU0NWX1ZFR0FfTUFDSElO
RShvYmopOworCisgICAgdmlzaXRfdHlwZV9Pbk9mZkF1dG8odiwgbmFtZSwg
JnMtPmFjcGksIGVycnApOworfQorCitzdGF0aWMgSG90cGx1Z0hhbmRsZXIg
KnZlZ2FfbWFjaGluZV9nZXRfaG90cGx1Z19oYW5kbGVyKE1hY2hpbmVTdGF0
ZSAqbWFjaGluZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgRGV2aWNlU3RhdGUgKmRldikKK3sK
KyAgICBNYWNoaW5lQ2xhc3MgKm1jID0gTUFDSElORV9HRVRfQ0xBU1MobWFj
aGluZSk7CisgICAgUklTQ1ZWZWdhU3RhdGUgKnMgPSBSSVNDVl9WRUdBX01B
Q0hJTkUobWFjaGluZSk7CisKKyAgICBpZiAoZGV2aWNlX2lzX2R5bmFtaWNf
c3lzYnVzKG1jLCBkZXYpIHx8CisgICAgICAgIG9iamVjdF9keW5hbWljX2Nh
c3QoT0JKRUNUKGRldiksIFRZUEVfVklSVElPX0lPTU1VX1BDSSkgfHwKKyAg
ICAgICAgb2JqZWN0X2R5bmFtaWNfY2FzdChPQkpFQ1QoZGV2KSwgVFlQRV9S
SVNDVl9JT01NVV9QQ0kpKSB7CisgICAgICAgIHMtPmlvbW11X3N5cyA9IE9O
X09GRl9BVVRPX09GRjsKKyAgICAgICAgcmV0dXJuIEhPVFBMVUdfSEFORExF
UihtYWNoaW5lKTsKKyAgICB9CisKKyAgICByZXR1cm4gTlVMTDsKK30KKwor
c3RhdGljIHZvaWQgdmVnYV9tYWNoaW5lX2RldmljZV9wbHVnX2NiKEhvdHBs
dWdIYW5kbGVyICpob3RwbHVnX2RldiwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBEZXZpY2VTdGF0ZSAqZGV2LCBFcnJvciAq
KmVycnApCit7CisgICAgUklTQ1ZWZWdhU3RhdGUgKnMgPSBSSVNDVl9WRUdB
X01BQ0hJTkUoaG90cGx1Z19kZXYpOworCisgICAgaWYgKHMtPnBsYXRmb3Jt
X2J1c19kZXYpIHsKKyAgICAgICAgTWFjaGluZUNsYXNzICptYyA9IE1BQ0hJ
TkVfR0VUX0NMQVNTKHMpOworCisgICAgICAgIGlmIChkZXZpY2VfaXNfZHlu
YW1pY19zeXNidXMobWMsIGRldikpIHsKKyAgICAgICAgICAgIHBsYXRmb3Jt
X2J1c19saW5rX2RldmljZShQTEFURk9STV9CVVNfREVWSUNFKHMtPnBsYXRm
b3JtX2J1c19kZXYpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFNZU19CVVNfREVWSUNFKGRldikpOworICAgICAgICB9CisgICAg
fQorCisgICAgaWYgKG9iamVjdF9keW5hbWljX2Nhc3QoT0JKRUNUKGRldiks
IFRZUEVfVklSVElPX0lPTU1VX1BDSSkpIHsKKyAgICAgICAgY3JlYXRlX2Zk
dF92aXJ0aW9faW9tbXUocywgcGNpX2dldF9iZGYoUENJX0RFVklDRShkZXYp
KSk7CisgICAgfQorCisgICAgaWYgKG9iamVjdF9keW5hbWljX2Nhc3QoT0JK
RUNUKGRldiksIFRZUEVfUklTQ1ZfSU9NTVVfUENJKSkgeworICAgICAgICBj
cmVhdGVfZmR0X2lvbW11KHMsIHBjaV9nZXRfYmRmKFBDSV9ERVZJQ0UoZGV2
KSkpOworICAgICAgICBzLT5pb21tdV9zeXMgPSBPTl9PRkZfQVVUT19PRkY7
CisgICAgfQorfQorCitzdGF0aWMgYm9vbCB2ZWdhX2dldF9iYXJlbWV0YWwo
T2JqZWN0ICpvYmosIEVycm9yICoqZXJycCkKK3sKKyAgICBSSVNDVlZlZ2FT
dGF0ZSAqcyA9IChSSVNDVlZlZ2FTdGF0ZSAqKW9iajsKKyAgICByZXR1cm4g
cy0+YmFyZW1ldGFsX21vZGU7Cit9CisKK3N0YXRpYyB2b2lkIHZlZ2Ffc2V0
X2JhcmVtZXRhbChPYmplY3QgKm9iaiwgYm9vbCB2YWx1ZSwgRXJyb3IgKipl
cnJwKQoreworICAgIFJJU0NWVmVnYVN0YXRlICpzID0gKFJJU0NWVmVnYVN0
YXRlICopb2JqOworICAgIHMtPmJhcmVtZXRhbF9tb2RlID0gdmFsdWU7Cit9
CisKKworc3RhdGljIHZvaWQgdmVnYV9tYWNoaW5lX2NsYXNzX2luaXQoT2Jq
ZWN0Q2xhc3MgKm9jLCBjb25zdCB2b2lkICpkYXRhKQoreworICAgIE1hY2hp
bmVDbGFzcyAqbWMgPSBNQUNISU5FX0NMQVNTKG9jKTsKKyAgICBIb3RwbHVn
SGFuZGxlckNsYXNzICpoYyA9IEhPVFBMVUdfSEFORExFUl9DTEFTUyhvYyk7
CisKKyAgICBtYy0+ZGVzYyA9ICJSSVNDLVYgVmVnYSBib2FyZCI7CisgICAg
bWMtPmluaXQgPSB2ZWdhX21hY2hpbmVfaW5pdDsKKyAgICBtYy0+bWF4X2Nw
dXMgPSBWRUdBX0NQVVNfTUFYOworICAgIG1jLT5kZWZhdWx0X2NwdV90eXBl
ID0gVFlQRV9SSVNDVl9DUFVfQkFTRTsKKyAgICBtYy0+YmxvY2tfZGVmYXVs
dF90eXBlID0gSUZfVklSVElPOworICAgIG1jLT5ub19jZHJvbSA9IDE7Cisg
ICAgbWMtPnBjaV9hbGxvd18wX2FkZHJlc3MgPSB0cnVlOworICAgIG1jLT5w
b3NzaWJsZV9jcHVfYXJjaF9pZHMgPSByaXNjdl9udW1hX3Bvc3NpYmxlX2Nw
dV9hcmNoX2lkczsKKyAgICBtYy0+Y3B1X2luZGV4X3RvX2luc3RhbmNlX3By
b3BzID0gcmlzY3ZfbnVtYV9jcHVfaW5kZXhfdG9fcHJvcHM7CisgICAgbWMt
PmdldF9kZWZhdWx0X2NwdV9ub2RlX2lkID0gcmlzY3ZfbnVtYV9nZXRfZGVm
YXVsdF9jcHVfbm9kZV9pZDsKKyAgICBtYy0+bnVtYV9tZW1fc3VwcG9ydGVk
ID0gdHJ1ZTsKKyAgICAvKiBwbGF0Zm9ybSBpbnN0ZWFkIG9mIGFyY2hpdGVj
dHVyYWwgY2hvaWNlICovCisgICAgbWMtPmNwdV9jbHVzdGVyX2hhc19udW1h
X2JvdW5kYXJ5ID0gdHJ1ZTsKKyAgICBtYy0+ZGVmYXVsdF9yYW1faWQgPSAi
cmlzY3ZfdmVnYV9ib2FyZC5yYW0iOworICAgIGFzc2VydCghbWMtPmdldF9o
b3RwbHVnX2hhbmRsZXIpOworICAgIG1jLT5nZXRfaG90cGx1Z19oYW5kbGVy
ID0gdmVnYV9tYWNoaW5lX2dldF9ob3RwbHVnX2hhbmRsZXI7CisKKyAgICBo
Yy0+cGx1ZyA9IHZlZ2FfbWFjaGluZV9kZXZpY2VfcGx1Z19jYjsKKworICAg
IG1hY2hpbmVfY2xhc3NfYWxsb3dfZHluYW1pY19zeXNidXNfZGV2KG1jLCBU
WVBFX1JBTUZCX0RFVklDRSk7CisgICAgbWFjaGluZV9jbGFzc19hbGxvd19k
eW5hbWljX3N5c2J1c19kZXYobWMsIFRZUEVfVUVGSV9WQVJTX1NZU0JVUyk7
CisjaWZkZWYgQ09ORklHX1RQTQorICAgIG1hY2hpbmVfY2xhc3NfYWxsb3df
ZHluYW1pY19zeXNidXNfZGV2KG1jLCBUWVBFX1RQTV9USVNfU1lTQlVTKTsK
KyNlbmRpZgorCisgICAgb2JqZWN0X2NsYXNzX3Byb3BlcnR5X2FkZF9ib29s
KG9jLCAiYWNsaW50IiwgdmVnYV9nZXRfYWNsaW50LAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2ZWdhX3NldF9hY2xpbnQpOworICAg
IG9iamVjdF9jbGFzc19wcm9wZXJ0eV9zZXRfZGVzY3JpcHRpb24ob2MsICJh
Y2xpbnQiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIihUQ0cgb25seSkgU2V0IG9uL29mZiB0byAiCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZW5hYmxlL2Rpc2Fi
bGUgZW11bGF0aW5nICIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICJBQ0xJTlQgZGV2aWNlcyIpOworCisgICAgb2JqZWN0
X2NsYXNzX3Byb3BlcnR5X2FkZF9zdHIob2MsICJhaWEiLCB2ZWdhX2dldF9h
aWEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVnYV9z
ZXRfYWlhKTsKKyAgICBvYmplY3RfY2xhc3NfcHJvcGVydHlfc2V0X2Rlc2Ny
aXB0aW9uKG9jLCAiYWlhIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICJTZXQgdHlwZSBvZiBBSUEgaW50ZXJydXB0ICIK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJj
b250cm9sbGVyLiBWYWxpZCB2YWx1ZXMgYXJlICIKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICJub25lLCBhcGxpYywgYW5k
IGFwbGljLWltc2ljLiIpOworCisgICAgb2JqZWN0X2NsYXNzX3Byb3BlcnR5
X2FkZF9zdHIob2MsICJhaWEtZ3Vlc3RzIiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB2ZWdhX2dldF9haWFfZ3Vlc3RzLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlZ2Ffc2V0X2FpYV9ndWVz
dHMpOworICAgIHsKKyAgICAgICAgZ19hdXRvZnJlZSBjaGFyICpzdHIgPQor
ICAgICAgICAgICAgZ19zdHJkdXBfcHJpbnRmKCJTZXQgbnVtYmVyIG9mIGd1
ZXN0IE1NSU8gcGFnZXMgZm9yIEFJQSBJTVNJQy4gIgorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICJWYWxpZCB2YWx1ZSBzaG91bGQgYmUgYmV0d2Vl
biAwIGFuZCAlZC4iLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZF
R0FfSVJRQ0hJUF9NQVhfR1VFU1RTKTsKKyAgICAgICAgb2JqZWN0X2NsYXNz
X3Byb3BlcnR5X3NldF9kZXNjcmlwdGlvbihvYywgImFpYS1ndWVzdHMiLCBz
dHIpOworICAgIH0KKworICAgIG9iamVjdF9jbGFzc19wcm9wZXJ0eV9hZGQo
b2MsICJhY3BpIiwgIk9uT2ZmQXV0byIsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB2ZWdhX2dldF9hY3BpLCB2ZWdhX3NldF9hY3BpLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgTlVMTCwgTlVMTCk7CisgICAg
b2JqZWN0X2NsYXNzX3Byb3BlcnR5X3NldF9kZXNjcmlwdGlvbihvYywgImFj
cGkiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIkVuYWJsZSBBQ1BJIik7CisKKyAgICBvYmplY3RfY2xhc3NfcHJvcGVy
dHlfYWRkKG9jLCAiaW9tbXUtc3lzIiwgIk9uT2ZmQXV0byIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2ZWdhX2dldF9pb21tdV9zeXMsIHZl
Z2Ffc2V0X2lvbW11X3N5cywKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIE5VTEwsIE5VTEwpOworICAgIG9iamVjdF9jbGFzc19wcm9wZXJ0eV9z
ZXRfZGVzY3JpcHRpb24ob2MsICJpb21tdS1zeXMiLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkVuYWJsZSBJT01NVSBw
bGF0Zm9ybSBkZXZpY2UiKTsKKyAgICAKKyAgICAvKkFkZCBDTEEgYXJndW1l
bnQgZm9yIGJhcmVtZXRhbCovCisgICAgb2JqZWN0X2NsYXNzX3Byb3BlcnR5
X2FkZF9ib29sKG9jLCAiYmFyZW1ldGFsLW1vZGUiLAorICAgIHZlZ2FfZ2V0
X2JhcmVtZXRhbCwgdmVnYV9zZXRfYmFyZW1ldGFsKTsKKworICAgIC8qIEFk
ZCBDTEEgZm9yIERSQU0gYmFzZSBhZGRyZXNzICovCisKKyAgICAvKiBwZXIt
aW5zdGFuY2UgRFJBTSBiYXNlIGFkZHJlc3MgKi8KKyAgICBvYmplY3RfY2xh
c3NfcHJvcGVydHlfYWRkX3VpbnQ2NF9wdHIob2MsICJkcmFtLWJhc2UiLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmdmVn
YV9kcmFtX2Jhc2VfcHJvcGVydHksCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIE9CSl9QUk9QX0ZMQUdfV1JJVEUpOworICAg
IG9iamVjdF9jbGFzc19wcm9wZXJ0eV9zZXRfZGVzY3JpcHRpb24ob2MsICJk
cmFtLWJhc2UiLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIkJhc2UgYWRkcmVzcyBvZiBEUkFNIChmcm9tIENMQSkiKTsK
K30KKworc3RhdGljIGNvbnN0IFR5cGVJbmZvIHZlZ2FfbWFjaGluZV90eXBl
aW5mbyA9IHsKKyAgICAubmFtZSAgICAgICA9IE1BQ0hJTkVfVFlQRV9OQU1F
KCJ2ZWdhIiksCisgICAgLnBhcmVudCAgICAgPSBUWVBFX01BQ0hJTkUsCisg
ICAgLmNsYXNzX2luaXQgPSB2ZWdhX21hY2hpbmVfY2xhc3NfaW5pdCwKKyAg
ICAuaW5zdGFuY2VfaW5pdCA9IHZlZ2FfbWFjaGluZV9pbnN0YW5jZV9pbml0
LAorICAgIC5pbnN0YW5jZV9zaXplID0gc2l6ZW9mKFJJU0NWVmVnYVN0YXRl
KSwKKyAgICAuaW50ZXJmYWNlcyA9IChjb25zdCBJbnRlcmZhY2VJbmZvW10p
IHsKKyAgICAgICAgIHsgVFlQRV9IT1RQTFVHX0hBTkRMRVIgfSwKKyAgICAg
ICAgIHsgfQorICAgIH0sCit9OworCitzdGF0aWMgdm9pZCB2ZWdhX21hY2hp
bmVfaW5pdF9yZWdpc3Rlcl90eXBlcyh2b2lkKQoreworICAgIHR5cGVfcmVn
aXN0ZXJfc3RhdGljKCZ2ZWdhX21hY2hpbmVfdHlwZWluZm8pOworfQorCit0
eXBlX2luaXQodmVnYV9tYWNoaW5lX2luaXRfcmVnaXN0ZXJfdHlwZXMpCmRp
ZmYgLS1naXQgYS9pbmNsdWRlL2h3L2ludGMvdmVnYV9hY2xpbnQuaCBiL2lu
Y2x1ZGUvaHcvaW50Yy92ZWdhX2FjbGludC5oCm5ldyBmaWxlIG1vZGUgMTAw
NjQ0CmluZGV4IDAwMDAwMDAwMDAuLjk0NzU3M2YzZTEKLS0tIC9kZXYvbnVs
bAorKysgYi9pbmNsdWRlL2h3L2ludGMvdmVnYV9hY2xpbnQuaApAQCAtMCww
ICsxLDY3IEBACisvKgorICogUklTQy1WIEFDTElOVCAoQWR2YW5jZWQgQ29y
ZSBMb2NhbCBJbnRlcnJ1cHRvcikgaW50ZXJmYWNlCisgKi8KKworI2lmbmRl
ZiBIV19WRUdBX0FDTElOVF9ICisjZGVmaW5lIEhXX1ZFR0FfQUNMSU5UX0gK
KworI2luY2x1ZGUgImh3L3N5c2J1cy5oIgorCisjZGVmaW5lIFRZUEVfVkVH
QV9BQ0xJTlRfTVRJTUVSICJ2ZWdhLmFjbGludC5tdGltZXIiCisKKyNkZWZp
bmUgVkVHQV9BQ0xJTlRfTVRJTUVSKG9iaikgXAorICAgIE9CSkVDVF9DSEVD
SyhWRUdBQWNsaW50TVRpbWVyU3RhdGUsIChvYmopLCBUWVBFX1ZFR0FfQUNM
SU5UX01USU1FUikKKwordHlwZWRlZiBzdHJ1Y3QgVkVHQUFjbGludE1UaW1l
clN0YXRlIHsKKyAgICAvKjwgcHJpdmF0ZSA+Ki8KKyAgICBTeXNCdXNEZXZp
Y2UgcGFyZW50X29iajsKKyAgICB1aW50NjRfdCB0aW1lX2RlbHRhOworICAg
IHVpbnQ2NF90ICp0aW1lY21wOworICAgIFFFTVVUaW1lciAqKnRpbWVyczsK
KworICAgIC8qPCBwdWJsaWMgPiovCisgICAgTWVtb3J5UmVnaW9uIG1taW87
CisgICAgdWludDMyX3QgaGFydGlkX2Jhc2U7CisgICAgdWludDMyX3QgbnVt
X2hhcnRzOworICAgIHVpbnQzMl90IHRpbWVjbXBfYmFzZTsKKyAgICB1aW50
MzJfdCB0aW1lX2Jhc2U7CisgICAgdWludDMyX3QgYXBlcnR1cmVfc2l6ZTsK
KyAgICB1aW50MzJfdCB0aW1lYmFzZV9mcmVxOworICAgIHFlbXVfaXJxICp0
aW1lcl9pcnFzOworfSBWRUdBQWNsaW50TVRpbWVyU3RhdGU7CisKK0Rldmlj
ZVN0YXRlICp2ZWdhX2FjbGludF9tdGltZXJfY3JlYXRlKGh3YWRkciBhZGRy
LCBod2FkZHIgc2l6ZSwKKyAgICB1aW50MzJfdCBoYXJ0aWRfYmFzZSwgdWlu
dDMyX3QgbnVtX2hhcnRzLAorICAgIHVpbnQzMl90IHRpbWVjbXBfYmFzZSwg
dWludDMyX3QgdGltZV9iYXNlLCB1aW50MzJfdCB0aW1lYmFzZV9mcmVxLAor
ICAgIGJvb2wgcHJvdmlkZV9yZHRpbWUpOworCisjZGVmaW5lIFRZUEVfVkVH
QV9BQ0xJTlRfU1dJICJ2ZWdhLmFjbGludC5zd2kiCisKKyNkZWZpbmUgVkVH
QV9BQ0xJTlRfU1dJKG9iaikgXAorICAgIE9CSkVDVF9DSEVDSyhWRUdBQWNs
aW50U3dpU3RhdGUsIChvYmopLCBUWVBFX1ZFR0FfQUNMSU5UX1NXSSkKKwor
dHlwZWRlZiBzdHJ1Y3QgVkVHQUFjbGludFN3aVN0YXRlIHsKKyAgICAvKjwg
cHJpdmF0ZSA+Ki8KKyAgICBTeXNCdXNEZXZpY2UgcGFyZW50X29iajsKKwor
ICAgIC8qPCBwdWJsaWMgPiovCisgICAgTWVtb3J5UmVnaW9uIG1taW87Cisg
ICAgdWludDMyX3QgaGFydGlkX2Jhc2U7CisgICAgdWludDMyX3QgbnVtX2hh
cnRzOworICAgIHVpbnQzMl90IHNzd2k7CisgICAgcWVtdV9pcnEgKnNvZnRf
aXJxczsKK30gVkVHQUFjbGludFN3aVN0YXRlOworCitEZXZpY2VTdGF0ZSAq
dmVnYV9hY2xpbnRfc3dpX2NyZWF0ZShod2FkZHIgYWRkciwgdWludDMyX3Qg
aGFydGlkX2Jhc2UsCisgICAgdWludDMyX3QgbnVtX2hhcnRzLCBib29sIHNz
d2kpOworCitlbnVtIHsKKyAgICBWRUdBX0FDTElOVF9ERUZBVUxUX01USU1F
Q01QICAgICAgPSAweDAsCisgICAgVkVHQV9BQ0xJTlRfREVGQVVMVF9NVElN
RSAgICAgICAgID0gMHgxMDAsCisgICAgVkVHQV9BQ0xJTlRfREVGQVVMVF9N
VElNRVJfU0laRSAgID0gMHg4MDAwLAorICAgIFZFR0FfQUNMSU5UX0RFRkFV
TFRfVElNRUJBU0VfRlJFUSA9IDEwMDAwMDAwLAorICAgIFZFR0FfQUNMSU5U
X01BWF9IQVJUUyAgICAgICAgICAgICA9IDQwOTUsCisgICAgVkVHQV9BQ0xJ
TlRfU1dJX1NJWkUgICAgICAgICAgICAgID0gMHg0ODAKK307CisKKyNlbmRp
ZgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9ody9pbnRjL3ZlZ2FfcGxpYy5oIGIv
aW5jbHVkZS9ody9pbnRjL3ZlZ2FfcGxpYy5oCm5ldyBmaWxlIG1vZGUgMTAw
NjQ0CmluZGV4IDAwMDAwMDAwMDAuLmIwM2I5ZDBjMzQKLS0tIC9kZXYvbnVs
bAorKysgYi9pbmNsdWRlL2h3L2ludGMvdmVnYV9wbGljLmgKQEAgLTAsMCAr
MSw3MCBAQAorLyoKKyogIFZFR0EgUExJQyAoUGxhdGZvcm0gTGV2ZWwgSW50
ZXJydXB0IENvbnRyb2xsZXIpIGludGVyZmFjZQorKi8KKyNpZm5kZWYgSFdf
VkVHQV9QTElDX0gKKyNkZWZpbmUgSFdfVkVHQV9QTElDX0gKKworI2luY2x1
ZGUgImh3L3N5c2J1cy5oIgorI2luY2x1ZGUgInFvbS9vYmplY3QuaCIKKwor
I2RlZmluZSBUWVBFX1ZFR0FfUExJQyAicmlzY3YudmVnYS5wbGljIgorCit0
eXBlZGVmIHN0cnVjdCBWZWdhUExJQ1N0YXRlIFZlZ2FQTElDU3RhdGU7CitE
RUNMQVJFX0lOU1RBTkNFX0NIRUNLRVIoVmVnYVBMSUNTdGF0ZSwgVkVHQV9Q
TElDLAorICAgICAgICAgICAgICAgICAgICAgICAgIFRZUEVfVkVHQV9QTElD
KQorCit0eXBlZGVmIGVudW0gUExJQ01vZGUgeworICAgIFBMSUNNb2RlX1Us
CisgICAgUExJQ01vZGVfUywKKyAgICBQTElDTW9kZV9NCit9IFBMSUNNb2Rl
OworCit0eXBlZGVmIHN0cnVjdCBQTElDQWRkciB7CisgICAgdWludDMyX3Qg
YWRkcmlkOworICAgIHVpbnQzMl90IGhhcnRpZDsKKyAgICBQTElDTW9kZSBt
b2RlOworfSBQTElDQWRkcjsKKworc3RydWN0IFZlZ2FQTElDU3RhdGUgewor
ICAgIC8qPCBwcml2YXRlID4qLworICAgIFN5c0J1c0RldmljZSBwYXJlbnRf
b2JqOworCisgICAgLyo8IHB1YmxpYyA+Ki8KKyAgICBNZW1vcnlSZWdpb24g
bW1pbzsKKyAgICB1aW50MzJfdCBudW1fYWRkcnM7CisgICAgdWludDMyX3Qg
bnVtX2hhcnRzOworICAgIHVpbnQzMl90IGJpdGZpZWxkX3dvcmRzOworICAg
IHVpbnQzMl90IG51bV9lbmFibGVzOworICAgIFBMSUNBZGRyICphZGRyX2Nv
bmZpZzsKKyAgICB1aW50MzJfdCAqc291cmNlX3ByaW9yaXR5OworICAgIHVp
bnQzMl90ICp0YXJnZXRfcHJpb3JpdHk7CisgICAgdWludDMyX3QgKnBlbmRp
bmc7CisgICAgdWludDMyX3QgKmNsYWltZWQ7CisgICAgdWludDMyX3QgKmVu
YWJsZTsKKworICAgIC8qIGNvbmZpZyAqLworICAgIGNoYXIgKmhhcnRfY29u
ZmlnOworICAgIHVpbnQzMl90IGhhcnRpZF9iYXNlOworICAgIHVpbnQzMl90
IG51bV9zb3VyY2VzOworICAgIHVpbnQzMl90IG51bV9wcmlvcml0aWVzOwor
ICAgIHVpbnQzMl90IHByaW9yaXR5X2Jhc2U7CisgICAgdWludDMyX3QgcGVu
ZGluZ19iYXNlOworICAgIHVpbnQzMl90IGVuYWJsZV9iYXNlOworICAgIHVp
bnQzMl90IGVuYWJsZV9zdHJpZGU7CisgICAgdWludDMyX3QgY29udGV4dF9i
YXNlOworICAgIHVpbnQzMl90IGNvbnRleHRfc3RyaWRlOworICAgIHVpbnQz
Ml90IGFwZXJ0dXJlX3NpemU7CisKKyAgICBxZW11X2lycSAqbV9leHRlcm5h
bF9pcnFzOworICAgIHFlbXVfaXJxICpzX2V4dGVybmFsX2lycXM7Cit9Owor
CitEZXZpY2VTdGF0ZSAqdmVnYV9wbGljX2NyZWF0ZShod2FkZHIgYWRkciwg
Y2hhciAqaGFydF9jb25maWcsCisgICAgdWludDMyX3QgbnVtX2hhcnRzLAor
ICAgIHVpbnQzMl90IGhhcnRpZF9iYXNlLCB1aW50MzJfdCBudW1fc291cmNl
cywKKyAgICB1aW50MzJfdCBudW1fcHJpb3JpdGllcywgdWludDMyX3QgcHJp
b3JpdHlfYmFzZSwKKyAgICB1aW50MzJfdCBwZW5kaW5nX2Jhc2UsIHVpbnQz
Ml90IGVuYWJsZV9iYXNlLAorICAgIHVpbnQzMl90IGVuYWJsZV9zdHJpZGUs
IHVpbnQzMl90IGNvbnRleHRfYmFzZSwKKyAgICB1aW50MzJfdCBjb250ZXh0
X3N0cmlkZSwgdWludDMyX3QgYXBlcnR1cmVfc2l6ZSk7CisKKyNlbmRpZgpk
aWZmIC0tZ2l0IGEvaW5jbHVkZS9ody9yaXNjdi92ZWdhLmggYi9pbmNsdWRl
L2h3L3Jpc2N2L3ZlZ2EuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwMDAwLi4yZThmOTRkYWE2Ci0tLSAvZGV2L251bGwKKysrIGIvaW5j
bHVkZS9ody9yaXNjdi92ZWdhLmgKQEAgLTAsMCArMSwxNjYgQEAKKy8qCisg
KiBRRU1VIFJJU0MtViBWZWdhIElPIG1hY2hpbmUgaW50ZXJmYWNlCisgKi8K
KworI2lmbmRlZiBIV19SSVNDVl9WRUdBX0gKKyNkZWZpbmUgSFdfUklTQ1Zf
VkVHQV9ICisKKyNpbmNsdWRlICJody9ib2FyZHMuaCIKKyNpbmNsdWRlICJo
dy9yaXNjdi9yaXNjdl9oYXJ0LmgiCisjaW5jbHVkZSAiaHcvc3lzYnVzLmgi
CisjaW5jbHVkZSAiaHcvYmxvY2svZmxhc2guaCIKKyNpbmNsdWRlICJody9p
bnRjL3Jpc2N2X2ltc2ljLmgiCisKKyNkZWZpbmUgVkVHQV9DUFVTX01BWF9C
SVRTICAgICAgICAgICAgIDkKKyNkZWZpbmUgVkVHQV9DUFVTX01BWCAgICAg
ICAgICAgICAgICAgICgxIDw8IFZFR0FfQ1BVU19NQVhfQklUUykKKyNkZWZp
bmUgVkVHQV9TT0NLRVRTX01BWF9CSVRTICAgICAgICAgIDIKKyNkZWZpbmUg
VkVHQV9TT0NLRVRTX01BWCAgICAgICAgICAgICAgICgxIDw8IFZFR0FfU09D
S0VUU19NQVhfQklUUykKKworI2RlZmluZSBUWVBFX1JJU0NWX1ZFR0FfTUFD
SElORSBNQUNISU5FX1RZUEVfTkFNRSgidmVnYSIpCit0eXBlZGVmIHN0cnVj
dCBSSVNDVlZlZ2FTdGF0ZSBSSVNDVlZlZ2FTdGF0ZTsKK0RFQ0xBUkVfSU5T
VEFOQ0VfQ0hFQ0tFUihSSVNDVlZlZ2FTdGF0ZSwgUklTQ1ZfVkVHQV9NQUNI
SU5FLAorICAgICAgICAgICAgICAgICAgICAgICAgIFRZUEVfUklTQ1ZfVkVH
QV9NQUNISU5FKQorCit0eXBlZGVmIGVudW0gUklTQ1ZWZWdhQUlBVHlwZSB7
CisgICAgVkVHQV9BSUFfVFlQRV9OT05FID0gMCwKKyAgICBWRUdBX0FJQV9U
WVBFX0FQTElDLAorICAgIFZFR0FfQUlBX1RZUEVfQVBMSUNfSU1TSUMsCit9
IFJJU0NWVmVnYUFJQVR5cGU7CisKK3N0cnVjdCBSSVNDVlZlZ2FTdGF0ZSB7
CisgICAgLyo8IHByaXZhdGUgPiovCisgICAgTWFjaGluZVN0YXRlIHBhcmVu
dDsKKworICAgIC8qPCBwdWJsaWMgPiovCisgICAgTm90aWZpZXIgbWFjaGlu
ZV9kb25lOworICAgIERldmljZVN0YXRlICpwbGF0Zm9ybV9idXNfZGV2Owor
ICAgIFJJU0NWSGFydEFycmF5U3RhdGUgc29jW1ZFR0FfU09DS0VUU19NQVhd
OworICAgIERldmljZVN0YXRlICppcnFjaGlwW1ZFR0FfU09DS0VUU19NQVhd
OworICAgIFBGbGFzaENGSTAxICpmbGFzaFsyXTsKKyAgICBGV0NmZ1N0YXRl
ICpmd19jZmc7CisKKyAgICBpbnQgZmR0X3NpemU7CisgICAgYm9vbCBoYXZl
X2FjbGludDsKKyAgICBSSVNDVlZlZ2FBSUFUeXBlIGFpYV90eXBlOworICAg
IGludCBhaWFfZ3Vlc3RzOworICAgIGNoYXIgKm9lbV9pZDsKKyAgICBjaGFy
ICpvZW1fdGFibGVfaWQ7CisgICAgT25PZmZBdXRvIGFjcGk7CisgICAgY29u
c3QgTWVtTWFwRW50cnkgKm1lbW1hcDsKKyAgICBzdHJ1Y3QgR1BFWEhvc3Qg
KmdwZXhfaG9zdDsKKyAgICBPbk9mZkF1dG8gaW9tbXVfc3lzOworICAgIHVp
bnQxNl90IHBjaV9pb21tdV9iZGY7CisKKyAgICAvKkFsbG93IENMQSBjb25m
aWd1cmF0aW9uKi8KKyAgICBib29sIGJhcmVtZXRhbF9tb2RlOyAvKlRvIGVu
YWJsZSByZWdpc3RlciBzaGlmdCBpbiBVQVJUKi8KKyAgICB1aW50NjRfdCBk
cmFtX2Jhc2U7ICAgLyogQ3VzdG9tIGNvbmZpZ3VyYWJsZSBEUkFNIGJhc2Ug
Ki8KK307CisKK2VudW0geworICAgIFZFR0FfREVCVUcsCisgICAgVkVHQV9N
Uk9NLAorICAgIFZFR0FfVEVTVCwKKyAgICBWRUdBX1JUQywKKyAgICBWRUdB
X0NMSU5ULAorICAgIFZFR0FfQUNMSU5UX1NTV0ksCisgICAgVkVHQV9QTElD
X0lELAorICAgIFZFR0FfQVBMSUNfTSwKKyAgICBWRUdBX0FQTElDX1MsCisg
ICAgVkVHQV9VQVJUMCwKKyAgICBWRUdBX1ZJUlRJTywKKyAgICBWRUdBX0ZX
X0NGRywKKyAgICBWRUdBX0lNU0lDX00sCisgICAgVkVHQV9JTVNJQ19TLAor
ICAgIFZFR0FfRkxBU0gsCisgICAgVkVHQV9EUkFNLAorICAgIFZFR0FfUENJ
RV9NTUlPLAorICAgIFZFR0FfVUFSVDEsCisgICAgVkVHQV9VQVJUMiwKKyAg
ICBWRUdBX1VBUlQzLAorICAgIFZFR0FfVUFSVDQsCisgICAgVkVHQV9TUEkw
LAorICAgIFZFR0FfU1BJMSwKKyAgICBWRUdBX0lJQzAsCisgICAgVkVHQV9J
SUMxLAorICAgIFZFR0FfUENJRV9QSU8sCisgICAgVkVHQV9QTEFURk9STV9C
VVMsCisgICAgVkVHQV9QQ0lFX0VDQU0sCisgICAgVkVHQV9JT01NVV9TWVMs
Cit9OworCitlbnVtIHsKKyAgICBVQVJUMF9JUlEgPSAxMCwKKyAgICBVQVJU
MV9JUlEgPSAxMCwKKyAgICBVQVJUMl9JUlEgPSAxMCwKKyAgICBVQVJUM19J
UlEgPSAxMCwKKyAgICBVQVJUNF9JUlEgPSAxMCwKKyAgICBSVENfSVJRID0g
MTEsCisgICAgVklSVElPX0lSUSA9IDEsIC8qIDEgdG8gOCAqLworICAgIFZJ
UlRJT19DT1VOVCA9IDgsCisgICAgUENJRV9JUlEgPSAweDIwLCAvKiAzMiB0
byAzNSAqLworICAgIElPTU1VX1NZU19JUlEgPSAweDI0LCAvKiAzNi0zOSAq
LworICAgIFZJUlRfUExBVEZPUk1fQlVTX0lSUSA9IDY0LCAvKiA2NCB0byA5
NSAqLworfTsKKworI2RlZmluZSBWRUdBX1BMQVRGT1JNX0JVU19OVU1fSVJR
UyAzMgorCisjZGVmaW5lIFZFR0FfSVJRQ0hJUF9OVU1fTVNJUyAyNTUKKyNk
ZWZpbmUgVkVHQV9JUlFDSElQX05VTV9TT1VSQ0VTIDk2CisjZGVmaW5lIFZF
R0FfSVJRQ0hJUF9OVU1fUFJJT19CSVRTIDQgICAvLyBDaGFuZ2VkIGZvciBD
REFDCisjZGVmaW5lIFZFR0FfSVJRQ0hJUF9NQVhfR1VFU1RTX0JJVFMgMwor
I2RlZmluZSBWRUdBX0lSUUNISVBfTUFYX0dVRVNUUyAoKDFVIDw8IFZFR0Ff
SVJRQ0hJUF9NQVhfR1VFU1RTX0JJVFMpIC0gMVUpCisKKyNkZWZpbmUgVkVH
QV9QTElDX1BSSU9SSVRZX0JBU0UgMHgwMAorI2RlZmluZSBWRUdBX1BMSUNf
UEVORElOR19CQVNFIDB4ODAKKyNkZWZpbmUgVkVHQV9QTElDX0VOQUJMRV9C
QVNFIDB4MTIwCisjZGVmaW5lIFZFR0FfUExJQ19FTkFCTEVfU1RSSURFIDB4
NDAKKyNkZWZpbmUgVkVHQV9QTElDX0NPTlRFWFRfQkFTRSAweDMxMAorI2Rl
ZmluZSBWRUdBX1BMSUNfQ09OVEVYVF9TVFJJREUgMHgxMAorCisKKyNkZWZp
bmUgVkVHQV9QTElDX1NJWkUoX19udW1fY29udGV4dCkgXAorICAgIChWRUdB
X1BMSUNfQ09OVEVYVF9CQVNFICsgKF9fbnVtX2NvbnRleHQpICogVkVHQV9Q
TElDX0NPTlRFWFRfU1RSSURFKQorCisjZGVmaW5lIEZEVF9QQ0lfQUREUl9D
RUxMUyAgICAzCisjZGVmaW5lIEZEVF9QQ0lfSU5UX0NFTExTICAgICAxCisj
ZGVmaW5lIEZEVF9QTElDX0FERFJfQ0VMTFMgICAwCisjZGVmaW5lIEZEVF9Q
TElDX0lOVF9DRUxMUyAgICAxCisjZGVmaW5lIEZEVF9BUExJQ19JTlRfQ0VM
TFMgICAyCisjZGVmaW5lIEZEVF9BUExJQ19BRERSX0NFTExTICAwCisjZGVm
aW5lIEZEVF9JTVNJQ19JTlRfQ0VMTFMgICAwCisjZGVmaW5lIEZEVF9NQVhf
SU5UX0NFTExTICAgICAyCisjZGVmaW5lIEZEVF9NQVhfSU5UX01BUF9XSURU
SCAoRkRUX1BDSV9BRERSX0NFTExTICsgRkRUX1BDSV9JTlRfQ0VMTFMgKyBc
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxICsgRkRUX01B
WF9JTlRfQ0VMTFMpCisjZGVmaW5lIEZEVF9QTElDX0lOVF9NQVBfV0lEVEgg
IChGRFRfUENJX0FERFJfQ0VMTFMgKyBGRFRfUENJX0lOVF9DRUxMUyArIFwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgKyBGRFRfUExJ
Q19JTlRfQ0VMTFMpCisjZGVmaW5lIEZEVF9BUExJQ19JTlRfTUFQX1dJRFRI
IChGRFRfUENJX0FERFJfQ0VMTFMgKyBGRFRfUENJX0lOVF9DRUxMUyArIFwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgKyBGRFRfQVBM
SUNfSU5UX0NFTExTKQorCitib29sIHZlZ2FfaXNfYWNwaV9lbmFibGVkKFJJ
U0NWVmVnYVN0YXRlICpzKTsKK2Jvb2wgdmVnYV9pc19pb21tdV9zeXNfZW5h
YmxlZChSSVNDVlZlZ2FTdGF0ZSAqcyk7Cit2b2lkIHZpcnRfYWNwaV9zZXR1
cChSSVNDVlZlZ2FTdGF0ZSAqdm1zKTsKK3VpbnQzMl90IGltc2ljX251bV9i
aXRzX3ZlZ2EodWludDMyX3QgY291bnQpOworCisvKgorICogVGhlIHZlZ2Eg
bWFjaGluZSBwaHlzaWNhbCBhZGRyZXNzIHNwYWNlIHVzZWQgYnkgc29tZSBv
ZiB0aGUgZGV2aWNlcworICogbmFtZWx5IEFDTElOVCwgUExJQywgQVBMSUMs
IGFuZCBJTVNJQyBkZXBlbmQgb24gbnVtYmVyIG9mIFNvY2tldHMsCisgKiBu
dW1iZXIgb2YgQ1BVcywgYW5kIG51bWJlciBvZiBJTVNJQyBndWVzdCBmaWxl
cy4KKyAqCisgKiBWYXJpb3VzIGxpbWl0cyBkZWZpbmVkIGJ5IFZFR0FfU09D
S0VUU19NQVhfQklUUywgVkVHQV9DUFVTX01BWF9CSVRTLAorICogYW5kIFZF
R0FfSVJRQ0hJUF9NQVhfR1VFU1RTX0JJVFMgYXJlIHR1bmVkIGZvciBtYXhp
bXVtIHV0aWxpemF0aW9uCisgKiBvZiB2ZWdhIG1hY2hpbmUgcGh5c2ljYWwg
YWRkcmVzcyBzcGFjZS4KKyAqLworCisjZGVmaW5lIFZFR0FfSU1TSUNfR1JP
VVBfTUFYX1NJWkUgICAgICAoMVUgPDwgSU1TSUNfTU1JT19HUk9VUF9NSU5f
U0hJRlQpCisjaWYgVkVHQV9JTVNJQ19HUk9VUF9NQVhfU0laRSA8IFwKKyAg
ICBJTVNJQ19HUk9VUF9TSVpFKFZFR0FfQ1BVU19NQVhfQklUUywgVkVHQV9J
UlFDSElQX01BWF9HVUVTVFNfQklUUykKKyNlcnJvciAiQ2FuJ3QgYWNjb21t
b2RhdGUgc2luZ2xlIElNU0lDIGdyb3VwIGluIGFkZHJlc3Mgc3BhY2UiCisj
ZW5kaWYKKworI2RlZmluZSBWRUdBX0lNU0lDX01BWF9TSVpFICAgICAgICAg
ICAgKFZFR0FfU09DS0VUU19NQVggKiBcCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgVkVHQV9JTVNJQ19HUk9VUF9NQVhfU0la
RSkKKyNpZiAweDQwMDAwMDAgPCBWRUdBX0lNU0lDX01BWF9TSVpFCisjZXJy
b3IgIkNhbid0IGFjY29tbW9kYXRlIGFsbCBJTVNJQyBncm91cHMgaW4gYWRk
cmVzcyBzcGFjZSIKKyNlbmRpZgorCisjZW5kaWYKLS0gCjIuNDMuMAoK

------=_Part_441364_1251780791.1761727810203--

