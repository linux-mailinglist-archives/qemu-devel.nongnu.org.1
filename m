Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 38383A8A5F0
	for <lists+qemu-devel@lfdr.de>; Tue, 15 Apr 2025 19:46:27 +0200 (CEST)
Received: from localhost ([::1] helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces@nongnu.org>)
	id 1u4kL9-0003Hj-KP; Tue, 15 Apr 2025 13:44:59 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10])
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <pbonzini@redhat.com>)
 id 1u4kKu-0003Gz-5j
 for qemu-devel@nongnu.org; Tue, 15 Apr 2025 13:44:40 -0400
Received: from us-smtp-delivery-124.mimecast.com ([170.10.133.124])
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <pbonzini@redhat.com>)
 id 1u4kKm-0002Ga-LW
 for qemu-devel@nongnu.org; Tue, 15 Apr 2025 13:44:37 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1744739069;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=2sdOp/8M9p8dYtlqbF+COhBZz3bYEEg4OSvnCreOenM=;
 b=YyKlM2nK1WncHZwu7wTY7CZdwuO5kyD5N0W1q6IIWrrP26Ylt9Jegh2K2hcnqcHo1LRuKf
 cnN9WJ4v0hbrwcQZ5G2QLbKOgRWuI4cCrkE5HUcEdGwPo6k/gS9sxVHv5FfwnVSx3ZFSVt
 tH1cGcvbpL5Sm31vwHtCOH9sPpdXu58=
Received: from mail-wr1-f72.google.com (mail-wr1-f72.google.com
 [209.85.221.72]) by relay.mimecast.com with ESMTP with STARTTLS
 (version=TLSv1.3, cipher=TLS_AES_256_GCM_SHA384) id
 us-mta-202-vtMDStT6PUew8yobq0_lDQ-1; Tue, 15 Apr 2025 13:44:26 -0400
X-MC-Unique: vtMDStT6PUew8yobq0_lDQ-1
X-Mimecast-MFC-AGG-ID: vtMDStT6PUew8yobq0_lDQ_1744739065
Received: by mail-wr1-f72.google.com with SMTP id
 ffacd0b85a97d-39123912ff0so2328886f8f.2
 for <qemu-devel@nongnu.org>; Tue, 15 Apr 2025 10:44:26 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20230601; t=1744739065; x=1745343865;
 h=cc:to:subject:message-id:date:from:in-reply-to:references
 :mime-version:x-gm-message-state:from:to:cc:subject:date:message-id
 :reply-to;
 bh=2sdOp/8M9p8dYtlqbF+COhBZz3bYEEg4OSvnCreOenM=;
 b=qECuTpYWJakCsf/Z25wuik1r2Mlp9a/qQXI1CqC0/yOgSlbyMb38TFaFZ+5x5HaKgT
 FzVFuWdf4rcBRYipoGzaM09XijWJ5gGMi2DqUZNfJXYIUzgOgm9ravJoNCAtmeC75mxN
 aHlQrM6SoTVcaN3aM+tB+rvpp3BtRupPTLbrq1jvtl+4wFpxBBvN737db/YKyPYIICQk
 jYdKYCjrbynwCqy15g5GuL9oYuLqXxge8XnWsiRRSoJqcRyxBP2p2Rk4/Fi9jQ9+q1Ay
 YISQywk0putBpYuomHUdVF4jU/t5Vkl4CzLiHAToeRUtB5OJs1QmWznvstvnHaRVLufy
 GjWg==
X-Gm-Message-State: AOJu0YzsbbpG00TjPNG8rani1Ke6/EmSfPD3lMg/dQcLuwADB90kEiBk
 2KFbdIb5b1Ra5b4cO4bLOpD5fFTDxRtEuCeasy2wB2rV+2xVRsdFpD6LgfJsWPvvpHSpxmG7WY1
 KPgtwuXxFUl2DEMKXGSzp+kkNm13+kJpM95VcoHOv8oC0LLNcZKjPht7OWgozZiNSaYWKlLQW95
 Lxx42m2l8SX5caThX4TNGZlM+5ii0=
X-Gm-Gg: ASbGncv+gj/vKqt1jdWs1J8W1Xt7p0vjljkDdSdiorJ+YaAMulSk9XPoVN05oHmte1O
 csI9Qu3DnbRebc170yJcdWpnZKdgajdxV1AbbeAtCmrZ4/B+pnJ9A2cdfLv6G7GCstYk5Hw==
X-Received: by 2002:a5d:6da9:0:b0:391:3aab:a7d0 with SMTP id
 ffacd0b85a97d-39ee2737c99mr306213f8f.19.1744739065573; 
 Tue, 15 Apr 2025 10:44:25 -0700 (PDT)
X-Google-Smtp-Source: AGHT+IEGRmup0BWA7gt9h0cmzlJtLzaHz8eGjIlsl3aGOSQ8wWTGO2ghqGFjoHe9wcSzbbvRGpbH8mIzwq5cx6JVnIA=
X-Received: by 2002:a5d:6da9:0:b0:391:3aab:a7d0 with SMTP id
 ffacd0b85a97d-39ee2737c99mr306200f8f.19.1744739065265; Tue, 15 Apr 2025
 10:44:25 -0700 (PDT)
MIME-Version: 1.0
References: <20250414144943.1112885-1-zhao1.liu@intel.com>
 <20250414144943.1112885-9-zhao1.liu@intel.com>
 <Z/5KlfQgC65g6Kid@intel.com> <78fdfdaf-7c94-4d79-be39-8215c033b423@redhat.com>
In-Reply-To: <78fdfdaf-7c94-4d79-be39-8215c033b423@redhat.com>
From: Paolo Bonzini <pbonzini@redhat.com>
Date: Tue, 15 Apr 2025 19:43:00 +0200
X-Gm-Features: ATxdqUHGOf9QEdlGZDMoAy7R-FrMvPzola77g0WL1Q5VlNOs9yEDrTW1KVGWbW8
Message-ID: <CABgObfb9z6r0vY1ojr1XMoCyYujEt4dX1UONcZEJgzDx8mry3Q@mail.gmail.com>
Subject: Re: [PATCH 8/9] rust/hpet: Support migration
To: Zhao Liu <zhao1.liu@intel.com>
Cc: qemu-devel@nongnu.org, qemu-rust@nongnu.org, 
 Dapeng Mi <dapeng1.mi@intel.com>
Content-Type: multipart/mixed; boundary="000000000000363cd80632d4b835"
Received-SPF: pass client-ip=170.10.133.124; envelope-from=pbonzini@redhat.com;
 helo=us-smtp-delivery-124.mimecast.com
X-Spam_score_int: -20
X-Spam_score: -2.1
X-Spam_bar: --
X-Spam_report: (-2.1 / 5.0 requ) BAYES_00=-1.9, DKIMWL_WL_HIGH=-0.001,
 DKIM_SIGNED=0.1, DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 RCVD_IN_DNSWL_NONE=-0.0001, RCVD_IN_MSPIKE_H5=0.001, RCVD_IN_MSPIKE_WL=0.001,
 RCVD_IN_VALIDITY_RPBL_BLOCKED=0.001, RCVD_IN_VALIDITY_SAFE_BLOCKED=0.001,
 SPF_HELO_NONE=0.001, SPF_PASS=-0.001 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org

--000000000000363cd80632d4b835
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

On Tue, Apr 15, 2025 at 4:21=E2=80=AFPM Paolo Bonzini <pbonzini@redhat.com>=
 wrote:
> > An additional difficult case is vmsd(). Passing the raw VMStateDescript=
ion
> > looks not good, while passing the VMStateDescription<> wrapper requires
> > bounding DeviceImpl with 'static. Ultimately, I added an extra
> > StaticVMStateDescription trait to successfully compile...
>
> Hmm I cannot fully understand it so I'll check it out later.

So the problem is that, in a "&'a Foo<T>", T must also be "T: 'a".
One solution is for vmsd() to return an
Option<VMStateDescription<Self>>, and do Box::into_raw(Box::new(vmsd))
in the class_init method. Once we have const_refs_static, "fn vmsd()"
can become a const and the Box is not needed anymore.

Also please turn get_vmsd_ptr() into get_vmsd_ref() so that we get
more checks that things are not copied behind our back (leaving behind
a dangling pointer)

I attach the conversion I did of the other devices and tests. I am not
sure if it's possible to avoid having a huge patch to do everything at
once (except HPET since that can be added separately).

Paolo

--000000000000363cd80632d4b835
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0001-convert-everything-to-VMStateBuilder.patch"
Content-Disposition: attachment; 
	filename="0001-convert-everything-to-VMStateBuilder.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_m9io90ft0>
X-Attachment-Id: f_m9io90ft0

RnJvbSBkNjdkOTZlNGRhNzE0YjFjZTY2NzZjNjQyZGJhMjhmZjU4OWM4OTAyIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBQYW9sbyBCb256aW5pIDxwYm9uemluaUByZWRoYXQuY29tPgpE
YXRlOiBUdWUsIDE1IEFwciAyMDI1IDE3OjI5OjI0ICswMjAwClN1YmplY3Q6IFtQQVRDSF0gY29u
dmVydCBldmVyeXRoaW5nIHRvIFZNU3RhdGVCdWlsZGVyCgotLS0KIHJ1c3QvaHcvY2hhci9wbDAx
MS9zcmMvZGV2aWNlLnJzICAgICAgIHwgIDE3ICsrLQogcnVzdC9ody9jaGFyL3BsMDExL3NyYy9k
ZXZpY2VfY2xhc3MucnMgfCAxMTcgKysrKysrKystLS0tLS0tLS0tLQogcnVzdC9ody90aW1lci9o
cGV0L3NyYy9ocGV0LnJzICAgICAgICAgfCAxNDkgKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLQog
cnVzdC9xZW11LWFwaS90ZXN0cy90ZXN0cy5ycyAgICAgICAgICAgfCAgMTcgKystCiBydXN0L3Fl
bXUtYXBpL3Rlc3RzL3Ztc3RhdGVfdGVzdHMucnMgICB8IDEzOSArKysrKysrKysrKy0tLS0tLS0t
LS0tLQogNSBmaWxlcyBjaGFuZ2VkLCAxOTcgaW5zZXJ0aW9ucygrKSwgMjQyIGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL3J1c3QvaHcvY2hhci9wbDAxMS9zcmMvZGV2aWNlLnJzIGIvcnVzdC9o
dy9jaGFyL3BsMDExL3NyYy9kZXZpY2UucnMKaW5kZXggYmIyYTBmMjA3YTUuLjJmMTU1MDcwOGI5
IDEwMDY0NAotLS0gYS9ydXN0L2h3L2NoYXIvcGwwMTEvc3JjL2RldmljZS5ycworKysgYi9ydXN0
L2h3L2NoYXIvcGwwMTEvc3JjL2RldmljZS5ycwpAQCAtMTcyLDggKzE3Miw4IEBAIGltcGwgRGV2
aWNlSW1wbCBmb3IgUEwwMTFTdGF0ZSB7CiAgICAgZm4gcHJvcGVydGllcygpIC0+ICYnc3RhdGlj
IFtQcm9wZXJ0eV0gewogICAgICAgICAmZGV2aWNlX2NsYXNzOjpQTDAxMV9QUk9QRVJUSUVTCiAg
ICAgfQotICAgIGZuIHZtc2QoKSAtPiBPcHRpb248JidzdGF0aWMgVk1TdGF0ZURlc2NyaXB0aW9u
PiB7Ci0gICAgICAgIFNvbWUoJmRldmljZV9jbGFzczo6Vk1TVEFURV9QTDAxMSkKKyAgICBmbiB2
bXNkKCkgLT4gT3B0aW9uPFZNU3RhdGVEZXNjcmlwdGlvbjxTZWxmPj4geworICAgICAgICBTb21l
KGRldmljZV9jbGFzczo6Vk1TVEFURV9QTDAxMSkKICAgICB9CiAgICAgY29uc3QgUkVBTElaRTog
T3B0aW9uPGZuKCZTZWxmKT4gPSBTb21lKFNlbGY6OnJlYWxpemUpOwogfQpAQCAtNTI0LDYgKzUy
NCwxMCBAQCBjb25zdCBmbiBjbG9ja191cGRhdGUoJnNlbGYsIF9ldmVudDogQ2xvY2tFdmVudCkg
ewogICAgICAgICAvKiBwbDAxMV90cmFjZV9iYXVkcmF0ZV9jaGFuZ2Uocyk7ICovCiAgICAgfQog
CisgICAgcHViIGZuIGNsb2NrX25lZWRlZCgmc2VsZikgLT4gYm9vbCB7CisgICAgICAgIHNlbGYu
bWlncmF0ZV9jbG9jaworICAgIH0KKwogICAgIGZuIHBvc3RfaW5pdCgmc2VsZikgewogICAgICAg
ICBzZWxmLmluaXRfbW1pbygmc2VsZi5pb21lbSk7CiAgICAgICAgIGZvciBpcnEgaW4gc2VsZi5p
bnRlcnJ1cHRzLml0ZXIoKSB7CkBAIC02MjksOCArNjMzLDEzIEBAIGZuIHVwZGF0ZSgmc2VsZikg
ewogICAgICAgICB9CiAgICAgfQogCi0gICAgcHViIGZuIHBvc3RfbG9hZCgmc2VsZiwgX3ZlcnNp
b25faWQ6IHUzMikgLT4gUmVzdWx0PCgpLCAoKT4gewotICAgICAgICBzZWxmLnJlZ3MuYm9ycm93
X211dCgpLnBvc3RfbG9hZCgpCisgICAgcHViIGZuIHBvc3RfbG9hZCgmc2VsZiwgX3ZlcnNpb25f
aWQ6IHU4KSAtPiBpMzIgeworICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5yZWdzLmJvcnJvd19t
dXQoKS5wb3N0X2xvYWQoKTsKKyAgICAgICAgaWYgcmVzdWx0LmlzX2VycigpIHsKKyAgICAgICAg
ICAgIC0xCisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAwCisgICAgICAgIH0KICAgICB9
CiB9CiAKZGlmZiAtLWdpdCBhL3J1c3QvaHcvY2hhci9wbDAxMS9zcmMvZGV2aWNlX2NsYXNzLnJz
IGIvcnVzdC9ody9jaGFyL3BsMDExL3NyYy9kZXZpY2VfY2xhc3MucnMKaW5kZXggYjRkNGE3ZWI0
MzIuLmFiNjA5NDc4MTNjIDEwMDY0NAotLS0gYS9ydXN0L2h3L2NoYXIvcGwwMTEvc3JjL2Rldmlj
ZV9jbGFzcy5ycworKysgYi9ydXN0L2h3L2NoYXIvcGwwMTEvc3JjL2RldmljZV9jbGFzcy5ycwpA
QCAtMiw4NyArMiw2NiBAQAogLy8gQXV0aG9yKHMpOiBNYW5vcyBQaXRzaWRpYW5ha2lzIDxtYW5v
cy5waXRzaWRpYW5ha2lzQGxpbmFyby5vcmc+CiAvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjog
R1BMLTIuMC1vci1sYXRlcgogCi11c2Ugc3RkOjp7Ci0gICAgb3M6OnJhdzo6e2NfaW50LCBjX3Zv
aWR9LAotICAgIHB0cjo6Tm9uTnVsbCwKLX07Ci0KIHVzZSBxZW11X2FwaTo6ewogICAgIGJpbmRp
bmdzOjp7cWRldl9wcm9wX2Jvb2wsIHFkZXZfcHJvcF9jaHJ9LAogICAgIGNfc3RyLAogICAgIHBy
ZWx1ZGU6OiosCi0gICAgdm1zdGF0ZTo6Vk1TdGF0ZURlc2NyaXB0aW9uLAorICAgIHZtc3RhdGU6
OntWTVN0YXRlRGVzY3JpcHRpb24sIFZNU3RhdGVEZXNjcmlwdGlvbkJ1aWxkZXJ9LAogICAgIHZt
c3RhdGVfY2xvY2ssIHZtc3RhdGVfZmllbGRzLCB2bXN0YXRlX29mLCB2bXN0YXRlX3N0cnVjdCwg
dm1zdGF0ZV9zdWJzZWN0aW9ucywgdm1zdGF0ZV91bnVzZWQsCi0gICAgemVyb2FibGU6Olplcm9h
YmxlLAogfTsKIAogdXNlIGNyYXRlOjpkZXZpY2U6OntQTDAxMVJlZ2lzdGVycywgUEwwMTFTdGF0
ZX07CiAKLWV4dGVybiAiQyIgZm4gcGwwMTFfY2xvY2tfbmVlZGVkKG9wYXF1ZTogKm11dCBjX3Zv
aWQpIC0+IGJvb2wgewotICAgIGxldCBzdGF0ZSA9IE5vbk51bGw6Om5ldyhvcGFxdWUpLnVud3Jh
cCgpLmNhc3Q6OjxQTDAxMVN0YXRlPigpOwotICAgIHVuc2FmZSB7IHN0YXRlLmFzX3JlZigpLm1p
Z3JhdGVfY2xvY2sgfQotfQotCiAvLy8gTWlncmF0aW9uIHN1YnNlY3Rpb24gZm9yIFtgUEwwMTFT
dGF0ZWBdIGNsb2NrLgotc3RhdGljIFZNU1RBVEVfUEwwMTFfQ0xPQ0s6IFZNU3RhdGVEZXNjcmlw
dGlvbiA9IFZNU3RhdGVEZXNjcmlwdGlvbiB7Ci0gICAgbmFtZTogY19zdHIhKCJwbDAxMS9jbG9j
ayIpLmFzX3B0cigpLAotICAgIHZlcnNpb25faWQ6IDEsCi0gICAgbWluaW11bV92ZXJzaW9uX2lk
OiAxLAotICAgIG5lZWRlZDogU29tZShwbDAxMV9jbG9ja19uZWVkZWQpLAotICAgIGZpZWxkczog
dm1zdGF0ZV9maWVsZHMhIHsKLSAgICAgICAgdm1zdGF0ZV9jbG9jayEoUEwwMTFTdGF0ZSwgY2xv
Y2spLAotICAgIH0sCi0gICAgLi5aZXJvYWJsZTo6WkVSTwotfTsKK3N0YXRpYyBWTVNUQVRFX1BM
MDExX0NMT0NLOiBWTVN0YXRlRGVzY3JpcHRpb248UEwwMTFTdGF0ZT4gPQorICAgIFZNU3RhdGVE
ZXNjcmlwdGlvbkJ1aWxkZXI6OjxQTDAxMVN0YXRlPjo6bmV3KCkKKyAgICAgICAgLm5hbWUoY19z
dHIhKCJwbDAxMS9jbG9jayIpKQorICAgICAgICAudmVyc2lvbl9pZCgxKQorICAgICAgICAubWlu
aW11bV92ZXJzaW9uX2lkKDEpCisgICAgICAgIC5uZWVkZWQoJlBMMDExU3RhdGU6OmNsb2NrX25l
ZWRlZCkKKyAgICAgICAgLmZpZWxkcyh2bXN0YXRlX2ZpZWxkcyEgeworICAgICAgICAgICAgIHZt
c3RhdGVfY2xvY2shKFBMMDExU3RhdGUsIGNsb2NrKSwKKyAgICAgICAgfSkKKyAgICAgICAgLmJ1
aWxkKCk7CiAKLWV4dGVybiAiQyIgZm4gcGwwMTFfcG9zdF9sb2FkKG9wYXF1ZTogKm11dCBjX3Zv
aWQsIHZlcnNpb25faWQ6IGNfaW50KSAtPiBjX2ludCB7Ci0gICAgbGV0IHN0YXRlID0gTm9uTnVs
bDo6bmV3KG9wYXF1ZSkudW53cmFwKCkuY2FzdDo6PFBMMDExU3RhdGU+KCk7Ci0gICAgbGV0IHJl
c3VsdCA9IHVuc2FmZSB7IHN0YXRlLmFzX3JlZigpLnBvc3RfbG9hZCh2ZXJzaW9uX2lkIGFzIHUz
MikgfTsKLSAgICBpZiByZXN1bHQuaXNfZXJyKCkgewotICAgICAgICAtMQotICAgIH0gZWxzZSB7
Ci0gICAgICAgIDAKLSAgICB9Ci19CitzdGF0aWMgVk1TVEFURV9QTDAxMV9SRUdTOiBWTVN0YXRl
RGVzY3JpcHRpb248UEwwMTFSZWdpc3RlcnM+ID0KKyAgICBWTVN0YXRlRGVzY3JpcHRpb25CdWls
ZGVyOjo8UEwwMTFSZWdpc3RlcnM+OjpuZXcoKQorICAgICAgICAubmFtZShjX3N0ciEoInBsMDEx
L3JlZ3MiKSkKKyAgICAgICAgLnZlcnNpb25faWQoMikKKyAgICAgICAgLm1pbmltdW1fdmVyc2lv
bl9pZCgyKQorICAgICAgICAuZmllbGRzKHZtc3RhdGVfZmllbGRzISB7CisgICAgICAgICAgICB2
bXN0YXRlX29mIShQTDAxMVJlZ2lzdGVycywgZmxhZ3MpLAorICAgICAgICAgICAgdm1zdGF0ZV9v
ZiEoUEwwMTFSZWdpc3RlcnMsIGxpbmVfY29udHJvbCksCisgICAgICAgICAgICB2bXN0YXRlX29m
IShQTDAxMVJlZ2lzdGVycywgcmVjZWl2ZV9zdGF0dXNfZXJyb3JfY2xlYXIpLAorICAgICAgICAg
ICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGNvbnRyb2wpLAorICAgICAgICAgICAgdm1z
dGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGRtYWNyKSwKKyAgICAgICAgICAgIHZtc3RhdGVfb2Yh
KFBMMDExUmVnaXN0ZXJzLCBpbnRfZW5hYmxlZCksCisgICAgICAgICAgICB2bXN0YXRlX29mIShQ
TDAxMVJlZ2lzdGVycywgaW50X2xldmVsKSwKKyAgICAgICAgICAgIHZtc3RhdGVfb2YhKFBMMDEx
UmVnaXN0ZXJzLCByZWFkX2ZpZm8pLAorICAgICAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdp
c3RlcnMsIGlscHIpLAorICAgICAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGli
cmQpLAorICAgICAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGZicmQpLAorICAg
ICAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGlmbCksCisgICAgICAgICAgICB2
bXN0YXRlX29mIShQTDAxMVJlZ2lzdGVycywgcmVhZF9wb3MpLAorICAgICAgICAgICAgdm1zdGF0
ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIHJlYWRfY291bnQpLAorICAgICAgICAgICAgdm1zdGF0ZV9v
ZiEoUEwwMTFSZWdpc3RlcnMsIHJlYWRfdHJpZ2dlciksCisgICAgICAgIH0pCisgICAgICAgIC5i
dWlsZCgpOwogCi1zdGF0aWMgVk1TVEFURV9QTDAxMV9SRUdTOiBWTVN0YXRlRGVzY3JpcHRpb24g
PSBWTVN0YXRlRGVzY3JpcHRpb24gewotICAgIG5hbWU6IGNfc3RyISgicGwwMTEvcmVncyIpLmFz
X3B0cigpLAotICAgIHZlcnNpb25faWQ6IDIsCi0gICAgbWluaW11bV92ZXJzaW9uX2lkOiAyLAot
ICAgIGZpZWxkczogdm1zdGF0ZV9maWVsZHMhIHsKLSAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFS
ZWdpc3RlcnMsIGZsYWdzKSwKLSAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGxp
bmVfY29udHJvbCksCi0gICAgICAgIHZtc3RhdGVfb2YhKFBMMDExUmVnaXN0ZXJzLCByZWNlaXZl
X3N0YXR1c19lcnJvcl9jbGVhciksCi0gICAgICAgIHZtc3RhdGVfb2YhKFBMMDExUmVnaXN0ZXJz
LCBjb250cm9sKSwKLSAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGRtYWNyKSwK
LSAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGludF9lbmFibGVkKSwKLSAgICAg
ICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGludF9sZXZlbCksCi0gICAgICAgIHZtc3Rh
dGVfb2YhKFBMMDExUmVnaXN0ZXJzLCByZWFkX2ZpZm8pLAotICAgICAgICB2bXN0YXRlX29mIShQ
TDAxMVJlZ2lzdGVycywgaWxwciksCi0gICAgICAgIHZtc3RhdGVfb2YhKFBMMDExUmVnaXN0ZXJz
LCBpYnJkKSwKLSAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFSZWdpc3RlcnMsIGZicmQpLAotICAg
ICAgICB2bXN0YXRlX29mIShQTDAxMVJlZ2lzdGVycywgaWZsKSwKLSAgICAgICAgdm1zdGF0ZV9v
ZiEoUEwwMTFSZWdpc3RlcnMsIHJlYWRfcG9zKSwKLSAgICAgICAgdm1zdGF0ZV9vZiEoUEwwMTFS
ZWdpc3RlcnMsIHJlYWRfY291bnQpLAotICAgICAgICB2bXN0YXRlX29mIShQTDAxMVJlZ2lzdGVy
cywgcmVhZF90cmlnZ2VyKSwKLSAgICB9LAotICAgIC4uWmVyb2FibGU6OlpFUk8KLX07Ci0KLXB1
YiBzdGF0aWMgVk1TVEFURV9QTDAxMTogVk1TdGF0ZURlc2NyaXB0aW9uID0gVk1TdGF0ZURlc2Ny
aXB0aW9uIHsKLSAgICBuYW1lOiBjX3N0ciEoInBsMDExIikuYXNfcHRyKCksCi0gICAgdmVyc2lv
bl9pZDogMiwKLSAgICBtaW5pbXVtX3ZlcnNpb25faWQ6IDIsCi0gICAgcG9zdF9sb2FkOiBTb21l
KHBsMDExX3Bvc3RfbG9hZCksCi0gICAgZmllbGRzOiB2bXN0YXRlX2ZpZWxkcyEgewotICAgICAg
ICB2bXN0YXRlX3VudXNlZCEoY29yZTo6bWVtOjpzaXplX29mOjo8dTMyPigpKSwKLSAgICAgICAg
dm1zdGF0ZV9zdHJ1Y3QhKFBMMDExU3RhdGUsIHJlZ3MsICZWTVNUQVRFX1BMMDExX1JFR1MsIEJx
bFJlZkNlbGw8UEwwMTFSZWdpc3RlcnM+KSwKLSAgICB9LAotICAgIHN1YnNlY3Rpb25zOiB2bXN0
YXRlX3N1YnNlY3Rpb25zISB7Ci0gICAgICAgIFZNU1RBVEVfUEwwMTFfQ0xPQ0sKLSAgICB9LAot
ICAgIC4uWmVyb2FibGU6OlpFUk8KLX07CitwdWIgY29uc3QgVk1TVEFURV9QTDAxMTogVk1TdGF0
ZURlc2NyaXB0aW9uPFBMMDExU3RhdGU+ID0KKyAgICBWTVN0YXRlRGVzY3JpcHRpb25CdWlsZGVy
Ojo8UEwwMTFTdGF0ZT46Om5ldygpCisgICAgICAgIC5uYW1lKGNfc3RyISgicGwwMTEiKSkKKyAg
ICAgICAgLnZlcnNpb25faWQoMikKKyAgICAgICAgLm1pbmltdW1fdmVyc2lvbl9pZCgyKQorICAg
ICAgICAucG9zdF9sb2FkKCZQTDAxMVN0YXRlOjpwb3N0X2xvYWQpCisgICAgICAgIC5maWVsZHMo
dm1zdGF0ZV9maWVsZHMhIHsKKyAgICAgICAgICAgIHZtc3RhdGVfdW51c2VkIShjb3JlOjptZW06
OnNpemVfb2Y6Ojx1MzI+KCkpLAorICAgICAgICAgICAgdm1zdGF0ZV9zdHJ1Y3QhKFBMMDExU3Rh
dGUsIHJlZ3MsICZWTVNUQVRFX1BMMDExX1JFR1MsIEJxbFJlZkNlbGw8UEwwMTFSZWdpc3RlcnM+
KSwKKyAgICAgICAgfSkKKyAgICAgICAgLnN1YnNlY3Rpb25zKHZtc3RhdGVfc3Vic2VjdGlvbnMh
IHsKKyAgICAgICAgICAgICBWTVNUQVRFX1BMMDExX0NMT0NLCisgICAgICAgIH0pCisgICAgICAg
IC5idWlsZCgpOwogCiBxZW11X2FwaTo6ZGVjbGFyZV9wcm9wZXJ0aWVzISB7CiAgICAgUEwwMTFf
UFJPUEVSVElFUywKZGlmZiAtLWdpdCBhL3J1c3QvaHcvdGltZXIvaHBldC9zcmMvaHBldC5ycyBi
L3J1c3QvaHcvdGltZXIvaHBldC9zcmMvaHBldC5ycwppbmRleCAxMmRlMmJhNTlhMS4uNzBiNmZk
NjIwZGIgMTAwNjQ0Ci0tLSBhL3J1c3QvaHcvdGltZXIvaHBldC9zcmMvaHBldC5ycworKysgYi9y
dXN0L2h3L3RpbWVyL2hwZXQvc3JjL2hwZXQucnMKQEAgLTQsNyArNCw2IEBACiAKIHVzZSBzdGQ6
OnsKICAgICBmZmk6OkNTdHIsCi0gICAgb3M6OnJhdzo6e2NfaW50LCBjX3ZvaWR9LAogICAgIHBp
bjo6UGluLAogICAgIHB0cjo6e2FkZHJfb2ZfbXV0LCBudWxsX211dCwgTm9uTnVsbH0sCiAgICAg
c2xpY2U6OmZyb21fcmVmLApAQCAtMjcsOSArMjYsOCBAQAogICAgIHFvbV9pc2EsCiAgICAgc3lz
YnVzOjp7U3lzQnVzRGV2aWNlLCBTeXNCdXNEZXZpY2VJbXBsfSwKICAgICB0aW1lcjo6e1RpbWVy
LCBDTE9DS19WSVJUVUFMLCBOQU5PU0VDT05EU19QRVJfU0VDT05EfSwKLSAgICB2bXN0YXRlOjpW
TVN0YXRlRGVzY3JpcHRpb24sCisgICAgdm1zdGF0ZTo6e1ZNU3RhdGVEZXNjcmlwdGlvbiwgVk1T
dGF0ZURlc2NyaXB0aW9uQnVpbGRlcn0sCiAgICAgdm1zdGF0ZV9maWVsZHMsIHZtc3RhdGVfb2Ys
IHZtc3RhdGVfc3RydWN0LCB2bXN0YXRlX3N1YnNlY3Rpb25zLCB2bXN0YXRlX3ZhbGlkYXRlLAot
ICAgIHplcm9hYmxlOjpaZXJvYWJsZSwKIH07CiAKIHVzZSBjcmF0ZTo6ZndfY2ZnOjpIUEVURndD
b25maWc7CkBAIC05NDMsMTA1ICs5NDEsNzQgQEAgaW1wbCBPYmplY3RJbXBsIGZvciBIUEVUU3Rh
dGUgewogICAgICksCiB9CiAKLXVuc2FmZSBleHRlcm4gIkMiIGZuIGhwZXRfcnRjX2lycV9sZXZl
bF9uZWVkZWQob3BhcXVlOiAqbXV0IGNfdm9pZCkgLT4gYm9vbCB7Ci0gICAgLy8gU0FGRVRZOgot
ICAgIC8vIHRoZSBwb2ludGVyIGlzIGNvbnZlcnRpYmxlIHRvIGEgcmVmZXJlbmNlCi0gICAgbGV0
IHN0YXRlOiAmSFBFVFN0YXRlID0gdW5zYWZlIHsgTm9uTnVsbDo6bmV3KG9wYXF1ZS5jYXN0Ojo8
SFBFVFN0YXRlPigpKS51bndyYXAoKS5hc19yZWYoKSB9OwotICAgIHN0YXRlLmlzX3J0Y19pcnFf
bGV2ZWxfbmVlZGVkKCkKLX0KK3N0YXRpYyBWTVNUQVRFX0hQRVRfUlRDX0lSUV9MRVZFTDogVk1T
dGF0ZURlc2NyaXB0aW9uPEhQRVRTdGF0ZT4gPQorICAgIFZNU3RhdGVEZXNjcmlwdGlvbkJ1aWxk
ZXI6OjxIUEVUU3RhdGU+OjpuZXcoKQorICAgICAgICAubmFtZShjX3N0ciEoImhwZXQvcnRjX2ly
cV9sZXZlbCIpKQorICAgICAgICAudmVyc2lvbl9pZCgxKQorICAgICAgICAubWluaW11bV92ZXJz
aW9uX2lkKDEpCisgICAgICAgIC5uZWVkZWQoJkhQRVRTdGF0ZTo6aXNfcnRjX2lycV9sZXZlbF9u
ZWVkZWQpCisgICAgICAgIC5maWVsZHModm1zdGF0ZV9maWVsZHMhIHsKKyAgICAgICAgICAgIHZt
c3RhdGVfb2YhKEhQRVRTdGF0ZSwgcnRjX2lycV9sZXZlbCksCisgICAgICAgIH0pCisgICAgICAg
IC5idWlsZCgpOwogCi11bnNhZmUgZXh0ZXJuICJDIiBmbiBocGV0X29mZnNldF9uZWVkZWQob3Bh
cXVlOiAqbXV0IGNfdm9pZCkgLT4gYm9vbCB7Ci0gICAgLy8gU0FGRVRZOgotICAgIC8vIHRoZSBw
b2ludGVyIGlzIGNvbnZlcnRpYmxlIHRvIGEgcmVmZXJlbmNlCi0gICAgbGV0IHN0YXRlOiAmSFBF
VFN0YXRlID0gdW5zYWZlIHsgTm9uTnVsbDo6bmV3KG9wYXF1ZS5jYXN0Ojo8SFBFVFN0YXRlPigp
KS51bndyYXAoKS5hc19yZWYoKSB9OwotICAgIHN0YXRlLmlzX29mZnNldF9uZWVkZWQoKQotfQor
c3RhdGljIFZNU1RBVEVfSFBFVF9PRkZTRVQ6IFZNU3RhdGVEZXNjcmlwdGlvbjxIUEVUU3RhdGU+
ID0KKyAgICBWTVN0YXRlRGVzY3JpcHRpb25CdWlsZGVyOjo8SFBFVFN0YXRlPjo6bmV3KCkKKyAg
ICAgICAgLm5hbWUoY19zdHIhKCJocGV0L29mZnNldCIpKQorICAgICAgICAudmVyc2lvbl9pZCgx
KQorICAgICAgICAubWluaW11bV92ZXJzaW9uX2lkKDEpCisgICAgICAgIC5uZWVkZWQoJkhQRVRT
dGF0ZTo6aXNfb2Zmc2V0X25lZWRlZCkKKyAgICAgICAgLmZpZWxkcyh2bXN0YXRlX2ZpZWxkcyEg
eworICAgICAgICAgICAgdm1zdGF0ZV9vZiEoSFBFVFN0YXRlLCBocGV0X29mZnNldCksCisgICAg
ICAgIH0pCisgICAgICAgIC5idWlsZCgpOwogCi11bnNhZmUgZXh0ZXJuICJDIiBmbiBocGV0X3By
ZV9zYXZlKG9wYXF1ZTogKm11dCBjX3ZvaWQpIC0+IGNfaW50IHsKLSAgICAvLyBTQUZFVFk6Ci0g
ICAgLy8gdGhlIHBvaW50ZXIgaXMgY29udmVydGlibGUgdG8gYSByZWZlcmVuY2UKLSAgICBsZXQg
c3RhdGU6ICZtdXQgSFBFVFN0YXRlID0KLSAgICAgICAgdW5zYWZlIHsgTm9uTnVsbDo6bmV3KG9w
YXF1ZS5jYXN0Ojo8SFBFVFN0YXRlPigpKS51bndyYXAoKS5hc19tdXQoKSB9OwotICAgIHN0YXRl
LnByZV9zYXZlKCkgYXMgY19pbnQKLX0KLQotdW5zYWZlIGV4dGVybiAiQyIgZm4gaHBldF9wb3N0
X2xvYWQob3BhcXVlOiAqbXV0IGNfdm9pZCwgdmVyc2lvbl9pZDogY19pbnQpIC0+IGNfaW50IHsK
LSAgICAvLyBTQUZFVFk6Ci0gICAgLy8gdGhlIHBvaW50ZXIgaXMgY29udmVydGlibGUgdG8gYSBy
ZWZlcmVuY2UKLSAgICBsZXQgc3RhdGU6ICZtdXQgSFBFVFN0YXRlID0KLSAgICAgICAgdW5zYWZl
IHsgTm9uTnVsbDo6bmV3KG9wYXF1ZS5jYXN0Ojo8SFBFVFN0YXRlPigpKS51bndyYXAoKS5hc19t
dXQoKSB9OwotICAgIGxldCB2ZXJzaW9uOiB1OCA9IHZlcnNpb25faWQudHJ5X2ludG8oKS51bndy
YXAoKTsKLSAgICBzdGF0ZS5wb3N0X2xvYWQodmVyc2lvbikgYXMgY19pbnQKLX0KLQotc3RhdGlj
IFZNU1RBVEVfSFBFVF9SVENfSVJRX0xFVkVMOiBWTVN0YXRlRGVzY3JpcHRpb24gPSBWTVN0YXRl
RGVzY3JpcHRpb24gewotICAgIG5hbWU6IGNfc3RyISgiaHBldC9ydGNfaXJxX2xldmVsIikuYXNf
cHRyKCksCi0gICAgdmVyc2lvbl9pZDogMSwKLSAgICBtaW5pbXVtX3ZlcnNpb25faWQ6IDEsCi0g
ICAgbmVlZGVkOiBTb21lKGhwZXRfcnRjX2lycV9sZXZlbF9uZWVkZWQpLAotICAgIGZpZWxkczog
dm1zdGF0ZV9maWVsZHMhIHsKLSAgICAgICAgdm1zdGF0ZV9vZiEoSFBFVFN0YXRlLCBydGNfaXJx
X2xldmVsKSwKLSAgICB9LAotICAgIC4uWmVyb2FibGU6OlpFUk8KLX07Ci0KLXN0YXRpYyBWTVNU
QVRFX0hQRVRfT0ZGU0VUOiBWTVN0YXRlRGVzY3JpcHRpb24gPSBWTVN0YXRlRGVzY3JpcHRpb24g
ewotICAgIG5hbWU6IGNfc3RyISgiaHBldC9vZmZzZXQiKS5hc19wdHIoKSwKLSAgICB2ZXJzaW9u
X2lkOiAxLAotICAgIG1pbmltdW1fdmVyc2lvbl9pZDogMSwKLSAgICBuZWVkZWQ6IFNvbWUoaHBl
dF9vZmZzZXRfbmVlZGVkKSwKLSAgICBmaWVsZHM6IHZtc3RhdGVfZmllbGRzISB7Ci0gICAgICAg
IHZtc3RhdGVfb2YhKEhQRVRTdGF0ZSwgaHBldF9vZmZzZXQpLAotICAgIH0sCi0gICAgLi5aZXJv
YWJsZTo6WkVSTwotfTsKLQotc3RhdGljIFZNU1RBVEVfSFBFVF9USU1FUjogVk1TdGF0ZURlc2Ny
aXB0aW9uID0gVk1TdGF0ZURlc2NyaXB0aW9uIHsKLSAgICBuYW1lOiBjX3N0ciEoImhwZXRfdGlt
ZXIiKS5hc19wdHIoKSwKLSAgICB2ZXJzaW9uX2lkOiAxLAotICAgIG1pbmltdW1fdmVyc2lvbl9p
ZDogMSwKLSAgICBmaWVsZHM6IHZtc3RhdGVfZmllbGRzISB7Ci0gICAgICAgIHZtc3RhdGVfb2Yh
KEhQRVRUaW1lciwgaW5kZXgpLAotICAgICAgICB2bXN0YXRlX29mIShIUEVUVGltZXIsIGNvbmZp
ZyksCi0gICAgICAgIHZtc3RhdGVfb2YhKEhQRVRUaW1lciwgY21wKSwKLSAgICAgICAgdm1zdGF0
ZV9vZiEoSFBFVFRpbWVyLCBmc2IpLAotICAgICAgICB2bXN0YXRlX29mIShIUEVUVGltZXIsIHBl
cmlvZCksCi0gICAgICAgIHZtc3RhdGVfb2YhKEhQRVRUaW1lciwgd3JhcF9mbGFnKSwKLSAgICAg
ICAgdm1zdGF0ZV9vZiEoSFBFVFRpbWVyLCBxZW11X3RpbWVyKSwKLSAgICB9LAotICAgIC4uWmVy
b2FibGU6OlpFUk8KLX07CitzdGF0aWMgVk1TVEFURV9IUEVUX1RJTUVSOiBWTVN0YXRlRGVzY3Jp
cHRpb248QnFsUmVmQ2VsbDxIUEVUVGltZXI+PiA9CisgICAgVk1TdGF0ZURlc2NyaXB0aW9uQnVp
bGRlcjo6PEJxbFJlZkNlbGw8SFBFVFRpbWVyPj46Om5ldygpCisgICAgICAgIC5uYW1lKGNfc3Ry
ISgiaHBldF90aW1lciIpKQorICAgICAgICAudmVyc2lvbl9pZCgxKQorICAgICAgICAubWluaW11
bV92ZXJzaW9uX2lkKDEpCisgICAgICAgIC5maWVsZHModm1zdGF0ZV9maWVsZHMhIHsKKyAgICAg
ICAgICAgIHZtc3RhdGVfb2YhKEhQRVRUaW1lciwgaW5kZXgpLAorICAgICAgICAgICAgdm1zdGF0
ZV9vZiEoSFBFVFRpbWVyLCBjb25maWcpLAorICAgICAgICAgICAgdm1zdGF0ZV9vZiEoSFBFVFRp
bWVyLCBjbXApLAorICAgICAgICAgICAgdm1zdGF0ZV9vZiEoSFBFVFRpbWVyLCBmc2IpLAorICAg
ICAgICAgICAgdm1zdGF0ZV9vZiEoSFBFVFRpbWVyLCBwZXJpb2QpLAorICAgICAgICAgICAgdm1z
dGF0ZV9vZiEoSFBFVFRpbWVyLCB3cmFwX2ZsYWcpLAorICAgICAgICAgICAgdm1zdGF0ZV9vZiEo
SFBFVFRpbWVyLCBxZW11X3RpbWVyKSwKKyAgICAgICAgfSkKKyAgICAgICAgLmJ1aWxkKCk7CiAK
IGNvbnN0IFZBTElEQVRFX1RJTUVSU19OQU1FOiAmQ1N0ciA9IGNfc3RyISgibnVtX3RpbWVycyBt
dXN0IG1hdGNoIik7CiAKLXN0YXRpYyBWTVNUQVRFX0hQRVQ6IFZNU3RhdGVEZXNjcmlwdGlvbiA9
IFZNU3RhdGVEZXNjcmlwdGlvbiB7Ci0gICAgbmFtZTogY19zdHIhKCJocGV0IikuYXNfcHRyKCks
Ci0gICAgdmVyc2lvbl9pZDogMiwKLSAgICBtaW5pbXVtX3ZlcnNpb25faWQ6IDEsCi0gICAgcHJl
X3NhdmU6IFNvbWUoaHBldF9wcmVfc2F2ZSksCi0gICAgcG9zdF9sb2FkOiBTb21lKGhwZXRfcG9z
dF9sb2FkKSwKLSAgICBmaWVsZHM6IHZtc3RhdGVfZmllbGRzISB7Ci0gICAgICAgIHZtc3RhdGVf
b2YhKEhQRVRTdGF0ZSwgY29uZmlnKSwKLSAgICAgICAgdm1zdGF0ZV9vZiEoSFBFVFN0YXRlLCBp
bnRfc3RhdHVzKSwKLSAgICAgICAgdm1zdGF0ZV9vZiEoSFBFVFN0YXRlLCBjb3VudGVyKSwKLSAg
ICAgICAgdm1zdGF0ZV9vZiEoSFBFVFN0YXRlLCBudW1fdGltZXJzX3NhdmUpLndpdGhfdmVyc2lv
bl9pZCgyKSwKLSAgICAgICAgdm1zdGF0ZV92YWxpZGF0ZSEoSFBFVFN0YXRlLCBWQUxJREFURV9U
SU1FUlNfTkFNRSwgSFBFVFN0YXRlOjp2YWxpZGF0ZV9udW1fdGltZXJzKSwKLSAgICAgICAgdm1z
dGF0ZV9zdHJ1Y3QhKEhQRVRTdGF0ZSwgdGltZXJzWzAgLi4gbnVtX3RpbWVyc10sICZWTVNUQVRF
X0hQRVRfVElNRVIsIEJxbFJlZkNlbGw8SFBFVFRpbWVyPiwgSFBFVFN0YXRlOjp2YWxpZGF0ZV9u
dW1fdGltZXJzKS53aXRoX3ZlcnNpb25faWQoMCksCi0gICAgfSwKLSAgICBzdWJzZWN0aW9uczog
dm1zdGF0ZV9zdWJzZWN0aW9ucyEgewotICAgICAgICBWTVNUQVRFX0hQRVRfUlRDX0lSUV9MRVZF
TCwKLSAgICAgICAgVk1TVEFURV9IUEVUX09GRlNFVCwKLSAgICB9LAotICAgIC4uWmVyb2FibGU6
OlpFUk8KLX07Citjb25zdCBWTVNUQVRFX0hQRVQ6IFZNU3RhdGVEZXNjcmlwdGlvbjxIUEVUU3Rh
dGU+ID0KKyAgICBWTVN0YXRlRGVzY3JpcHRpb25CdWlsZGVyOjo8SFBFVFN0YXRlPjo6bmV3KCkK
KyAgICAgICAgLm5hbWUoY19zdHIhKCJocGV0IikpCisgICAgICAgIC52ZXJzaW9uX2lkKDIpCisg
ICAgICAgIC5taW5pbXVtX3ZlcnNpb25faWQoMSkKKyAgICAgICAgLnByZV9zYXZlKCZIUEVUU3Rh
dGU6OnByZV9zYXZlKQorICAgICAgICAucG9zdF9sb2FkKCZIUEVUU3RhdGU6OnBvc3RfbG9hZCkK
KyAgICAgICAgLmZpZWxkcyh2bXN0YXRlX2ZpZWxkcyEgeworICAgICAgICAgICAgdm1zdGF0ZV9v
ZiEoSFBFVFN0YXRlLCBjb25maWcpLAorICAgICAgICAgICAgdm1zdGF0ZV9vZiEoSFBFVFN0YXRl
LCBpbnRfc3RhdHVzKSwKKyAgICAgICAgICAgIHZtc3RhdGVfb2YhKEhQRVRTdGF0ZSwgY291bnRl
ciksCisgICAgICAgICAgICB2bXN0YXRlX29mIShIUEVUU3RhdGUsIG51bV90aW1lcnNfc2F2ZSku
d2l0aF92ZXJzaW9uX2lkKDIpLAorICAgICAgICAgICAgdm1zdGF0ZV92YWxpZGF0ZSEoSFBFVFN0
YXRlLCBWQUxJREFURV9USU1FUlNfTkFNRSwgSFBFVFN0YXRlOjp2YWxpZGF0ZV9udW1fdGltZXJz
KSwKKyAgICAgICAgICAgIHZtc3RhdGVfc3RydWN0IShIUEVUU3RhdGUsIHRpbWVyc1swIC4uIG51
bV90aW1lcnNdLCAmVk1TVEFURV9IUEVUX1RJTUVSLCBCcWxSZWZDZWxsPEhQRVRUaW1lcj4sIEhQ
RVRTdGF0ZTo6dmFsaWRhdGVfbnVtX3RpbWVycykud2l0aF92ZXJzaW9uX2lkKDApLAorICAgICAg
ICB9KQorICAgICAgICAuc3Vic2VjdGlvbnModm1zdGF0ZV9zdWJzZWN0aW9ucyEoCisgICAgICAg
ICAgICBWTVNUQVRFX0hQRVRfUlRDX0lSUV9MRVZFTCwKKyAgICAgICAgICAgIFZNU1RBVEVfSFBF
VF9PRkZTRVQsCisgICAgICAgICkpCisgICAgICAgIC5idWlsZCgpOwogCiBpbXBsIERldmljZUlt
cGwgZm9yIEhQRVRTdGF0ZSB7CiAgICAgZm4gcHJvcGVydGllcygpIC0+ICYnc3RhdGljIFtQcm9w
ZXJ0eV0gewogICAgICAgICAmSFBFVF9QUk9QRVJUSUVTCiAgICAgfQogCi0gICAgZm4gdm1zZCgp
IC0+IE9wdGlvbjwmJ3N0YXRpYyBWTVN0YXRlRGVzY3JpcHRpb24+IHsKLSAgICAgICAgU29tZSgm
Vk1TVEFURV9IUEVUKQorICAgIGZuIHZtc2QoKSAtPiBPcHRpb248Vk1TdGF0ZURlc2NyaXB0aW9u
PFNlbGY+PiB7CisgICAgICAgIFNvbWUoVk1TVEFURV9IUEVUKQogICAgIH0KIAogICAgIGNvbnN0
IFJFQUxJWkU6IE9wdGlvbjxmbigmU2VsZik+ID0gU29tZShTZWxmOjpyZWFsaXplKTsKZGlmZiAt
LWdpdCBhL3J1c3QvcWVtdS1hcGkvdGVzdHMvdGVzdHMucnMgYi9ydXN0L3FlbXUtYXBpL3Rlc3Rz
L3Rlc3RzLnJzCmluZGV4IDk5YTdhYWI2ZmVkLi5mNGZmMzY0MWMyNSAxMDA2NDQKLS0tIGEvcnVz
dC9xZW11LWFwaS90ZXN0cy90ZXN0cy5ycworKysgYi9ydXN0L3FlbXUtYXBpL3Rlc3RzL3Rlc3Rz
LnJzCkBAIC0xMywxOCArMTMsMTcgQEAKICAgICBxZGV2Ojp7RGV2aWNlSW1wbCwgRGV2aWNlU3Rh
dGUsIFByb3BlcnR5LCBSZXNldHRhYmxlUGhhc2VzSW1wbH0sCiAgICAgcW9tOjp7T2JqZWN0SW1w
bCwgUGFyZW50RmllbGR9LAogICAgIHN5c2J1czo6U3lzQnVzRGV2aWNlLAotICAgIHZtc3RhdGU6
OlZNU3RhdGVEZXNjcmlwdGlvbiwKLSAgICB6ZXJvYWJsZTo6WmVyb2FibGUsCisgICAgdm1zdGF0
ZTo6e1ZNU3RhdGVEZXNjcmlwdGlvbiwgVk1TdGF0ZURlc2NyaXB0aW9uQnVpbGRlcn0sCiB9Owog
CiBtb2Qgdm1zdGF0ZV90ZXN0czsKIAogLy8gVGVzdCB0aGF0IG1hY3JvcyBjYW4gY29tcGlsZS4K
LXB1YiBzdGF0aWMgVk1TVEFURTogVk1TdGF0ZURlc2NyaXB0aW9uID0gVk1TdGF0ZURlc2NyaXB0
aW9uIHsKLSAgICBuYW1lOiBjX3N0ciEoIm5hbWUiKS5hc19wdHIoKSwKLSAgICB1bm1pZ3JhdGFi
bGU6IHRydWUsCi0gICAgLi5aZXJvYWJsZTo6WkVSTwotfTsKK3B1YiBjb25zdCBWTVNUQVRFOiBW
TVN0YXRlRGVzY3JpcHRpb248RHVtbXlTdGF0ZT4gPQorICAgIFZNU3RhdGVEZXNjcmlwdGlvbkJ1
aWxkZXI6OjxEdW1teVN0YXRlPjo6bmV3KCkKKyAgICAgICAgLm5hbWUoY19zdHIhKCJuYW1lIikp
CisgICAgICAgIC51bm1pZ3JhdGFibGUoKQorICAgICAgICAuYnVpbGQoKTsKIAogI1tkZXJpdmUo
cWVtdV9hcGlfbWFjcm9zOjpvZmZzZXRzKV0KICNbcmVwcihDKV0KQEAgLTc0LDggKzczLDggQEAg
aW1wbCBEZXZpY2VJbXBsIGZvciBEdW1teVN0YXRlIHsKICAgICBmbiBwcm9wZXJ0aWVzKCkgLT4g
JidzdGF0aWMgW1Byb3BlcnR5XSB7CiAgICAgICAgICZEVU1NWV9QUk9QRVJUSUVTCiAgICAgfQot
ICAgIGZuIHZtc2QoKSAtPiBPcHRpb248JidzdGF0aWMgVk1TdGF0ZURlc2NyaXB0aW9uPiB7Ci0g
ICAgICAgIFNvbWUoJlZNU1RBVEUpCisgICAgZm4gdm1zZCgpIC0+IE9wdGlvbjxWTVN0YXRlRGVz
Y3JpcHRpb248U2VsZj4+IHsKKyAgICAgICAgU29tZShWTVNUQVRFKQogICAgIH0KIH0KIApkaWZm
IC0tZ2l0IGEvcnVzdC9xZW11LWFwaS90ZXN0cy92bXN0YXRlX3Rlc3RzLnJzIGIvcnVzdC9xZW11
LWFwaS90ZXN0cy92bXN0YXRlX3Rlc3RzLnJzCmluZGV4IGY3YTkzMTE3ZTFhLi5mYTM1YjlhZGRl
YyAxMDA2NDQKLS0tIGEvcnVzdC9xZW11LWFwaS90ZXN0cy92bXN0YXRlX3Rlc3RzLnJzCisrKyBi
L3J1c3QvcWVtdS1hcGkvdGVzdHMvdm1zdGF0ZV90ZXN0cy5ycwpAQCAtMTIsOSArMTIsOCBAQAog
ICAgIGNfc3RyLAogICAgIGNlbGw6OntCcWxDZWxsLCBPcGFxdWV9LAogICAgIGltcGxfdm1zdGF0
ZV9mb3J3YXJkLAotICAgIHZtc3RhdGU6OntWTVN0YXRlRGVzY3JpcHRpb24sIFZNU3RhdGVGaWVs
ZH0sCisgICAgdm1zdGF0ZTo6e1ZNU3RhdGVEZXNjcmlwdGlvbiwgVk1TdGF0ZURlc2NyaXB0aW9u
QnVpbGRlciwgVk1TdGF0ZUZpZWxkfSwKICAgICB2bXN0YXRlX2ZpZWxkcywgdm1zdGF0ZV9vZiwg
dm1zdGF0ZV9zdHJ1Y3QsIHZtc3RhdGVfdW51c2VkLCB2bXN0YXRlX3ZhbGlkYXRlLAotICAgIHpl
cm9hYmxlOjpaZXJvYWJsZSwKIH07CiAKIGNvbnN0IEZPT19BUlJBWV9NQVg6IHVzaXplID0gMzsK
QEAgLTM3LDIyICszNiwyMiBAQCBzdHJ1Y3QgRm9vQSB7CiAgICAgZWxlbTogaTgsCiB9CiAKLXN0
YXRpYyBWTVNUQVRFX0ZPT0E6IFZNU3RhdGVEZXNjcmlwdGlvbiA9IFZNU3RhdGVEZXNjcmlwdGlv
biB7Ci0gICAgbmFtZTogY19zdHIhKCJmb29fYSIpLmFzX3B0cigpLAotICAgIHZlcnNpb25faWQ6
IDEsCi0gICAgbWluaW11bV92ZXJzaW9uX2lkOiAxLAotICAgIGZpZWxkczogdm1zdGF0ZV9maWVs
ZHMhIHsKLSAgICAgICAgdm1zdGF0ZV9vZiEoRm9vQSwgZWxlbSksCi0gICAgICAgIHZtc3RhdGVf
dW51c2VkIShzaXplX29mOjo8aTY0PigpKSwKLSAgICAgICAgdm1zdGF0ZV9vZiEoRm9vQSwgYXJy
WzAgLi4gbnVtXSkud2l0aF92ZXJzaW9uX2lkKDApLAotICAgICAgICB2bXN0YXRlX29mIShGb29B
LCBhcnJfbXVsWzAgLi4gbnVtX211bCAqIDE2XSksCi0gICAgfSwKLSAgICAuLlplcm9hYmxlOjpa
RVJPCi19Oworc3RhdGljIFZNU1RBVEVfRk9PQTogVk1TdGF0ZURlc2NyaXB0aW9uPEZvb0E+ID0K
KyAgICBWTVN0YXRlRGVzY3JpcHRpb25CdWlsZGVyOjo8Rm9vQT46Om5ldygpCisgICAgICAgIC5u
YW1lKGNfc3RyISgiZm9vX2EiKSkKKyAgICAgICAgLnZlcnNpb25faWQoMSkKKyAgICAgICAgLm1p
bmltdW1fdmVyc2lvbl9pZCgxKQorICAgICAgICAuZmllbGRzKHZtc3RhdGVfZmllbGRzISB7Cisg
ICAgICAgICAgICB2bXN0YXRlX29mIShGb29BLCBlbGVtKSwKKyAgICAgICAgICAgIHZtc3RhdGVf
dW51c2VkIShzaXplX29mOjo8aTY0PigpKSwKKyAgICAgICAgICAgIHZtc3RhdGVfb2YhKEZvb0Es
IGFyclswIC4uIG51bV0pLndpdGhfdmVyc2lvbl9pZCgwKSwKKyAgICAgICAgICAgIHZtc3RhdGVf
b2YhKEZvb0EsIGFycl9tdWxbMCAuLiBudW1fbXVsICogMTZdKSwKKyAgICAgICAgfSkKKyAgICAg
ICAgLmJ1aWxkKCk7CiAKICNbdGVzdF0KIGZuIHRlc3Rfdm1zdGF0ZV91aW50MTYoKSB7Ci0gICAg
bGV0IGZvb19maWVsZHM6ICZbVk1TdGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9tX3Jh
d19wYXJ0cyhWTVNUQVRFX0ZPT0EuZmllbGRzLCA1KSB9OworICAgIGxldCBmb29fZmllbGRzOiAm
W1ZNU3RhdGVGaWVsZF0gPSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9G
T09BLmdldF92bXNkX3JlZigpLmZpZWxkcywgNSkgfTsKIAogICAgIC8vIDFzdCBWTVN0YXRlRmll
bGQgKCJlbGVtIikgaW4gVk1TVEFURV9GT09BIChjb3JyZXNwb25kaW5nIHRvIFZNU1RBVEVfVUlO
VDE2KQogICAgIGFzc2VydF9lcSEoCkBAIC03Miw3ICs3MSw3IEBAIGZuIHRlc3Rfdm1zdGF0ZV91
aW50MTYoKSB7CiAKICNbdGVzdF0KIGZuIHRlc3Rfdm1zdGF0ZV91bnVzZWQoKSB7Ci0gICAgbGV0
IGZvb19maWVsZHM6ICZbVk1TdGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9tX3Jhd19w
YXJ0cyhWTVNUQVRFX0ZPT0EuZmllbGRzLCA1KSB9OworICAgIGxldCBmb29fZmllbGRzOiAmW1ZN
U3RhdGVGaWVsZF0gPSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09B
LmdldF92bXNkX3JlZigpLmZpZWxkcywgNSkgfTsKIAogICAgIC8vIDJuZCBWTVN0YXRlRmllbGQg
KCJ1bnVzZWQiKSBpbiBWTVNUQVRFX0ZPT0EgKGNvcnJlc3BvbmRpbmcgdG8gVk1TVEFURV9VTlVT
RUQpCiAgICAgYXNzZXJ0X2VxISgKQEAgLTkyLDcgKzkxLDcgQEAgZm4gdGVzdF92bXN0YXRlX3Vu
dXNlZCgpIHsKIAogI1t0ZXN0XQogZm4gdGVzdF92bXN0YXRlX3ZhcnJheV91aW50MTZfdW5zYWZl
KCkgewotICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3RhdGVGaWVsZF0gPSB1bnNhZmUgeyBzbGlj
ZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09BLmZpZWxkcywgNSkgfTsKKyAgICBsZXQgZm9v
X2ZpZWxkczogJltWTVN0YXRlRmllbGRdID0gdW5zYWZlIHsgc2xpY2U6OmZyb21fcmF3X3BhcnRz
KFZNU1RBVEVfRk9PQS5nZXRfdm1zZF9yZWYoKS5maWVsZHMsIDUpIH07CiAKICAgICAvLyAzcmQg
Vk1TdGF0ZUZpZWxkICgiYXJyIikgaW4gVk1TVEFURV9GT09BIChjb3JyZXNwb25kaW5nIHRvCiAg
ICAgLy8gVk1TVEFURV9WQVJSQVlfVUlOVDE2X1VOU0FGRSkKQEAgLTExMyw3ICsxMTIsNyBAQCBm
biB0ZXN0X3Ztc3RhdGVfdmFycmF5X3VpbnQxNl91bnNhZmUoKSB7CiAKICNbdGVzdF0KIGZuIHRl
c3Rfdm1zdGF0ZV92YXJyYXlfbXVsdGlwbHkoKSB7Ci0gICAgbGV0IGZvb19maWVsZHM6ICZbVk1T
dGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9tX3Jhd19wYXJ0cyhWTVNUQVRFX0ZPT0Eu
ZmllbGRzLCA1KSB9OworICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3RhdGVGaWVsZF0gPSB1bnNh
ZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09BLmdldF92bXNkX3JlZigpLmZp
ZWxkcywgNSkgfTsKIAogICAgIC8vIDR0aCBWTVN0YXRlRmllbGQgKCJhcnJfbXVsIikgaW4gVk1T
VEFURV9GT09BIChjb3JyZXNwb25kaW5nIHRvCiAgICAgLy8gVk1TVEFURV9WQVJSQVlfTVVMVElQ
TFkpCkBAIC0xNjcsMjQgKzE2NiwyNCBAQCBmbiB2YWxpZGF0ZV9mb29iKF9zdGF0ZTogJkZvb0Is
IF92ZXJzaW9uX2lkOiB1OCkgLT4gYm9vbCB7CiAgICAgdHJ1ZQogfQogCi1zdGF0aWMgVk1TVEFU
RV9GT09COiBWTVN0YXRlRGVzY3JpcHRpb24gPSBWTVN0YXRlRGVzY3JpcHRpb24gewotICAgIG5h
bWU6IGNfc3RyISgiZm9vX2IiKS5hc19wdHIoKSwKLSAgICB2ZXJzaW9uX2lkOiAyLAotICAgIG1p
bmltdW1fdmVyc2lvbl9pZDogMSwKLSAgICBmaWVsZHM6IHZtc3RhdGVfZmllbGRzISB7Ci0gICAg
ICAgIHZtc3RhdGVfb2YhKEZvb0IsIHZhbCkud2l0aF92ZXJzaW9uX2lkKDIpLAotICAgICAgICB2
bXN0YXRlX29mIShGb29CLCB3cmFwKSwKLSAgICAgICAgdm1zdGF0ZV9zdHJ1Y3QhKEZvb0IsIGFy
cl9hWzAgLi4gbnVtX2FdLCAmVk1TVEFURV9GT09BLCBGb29BKS53aXRoX3ZlcnNpb25faWQoMSks
Ci0gICAgICAgIHZtc3RhdGVfc3RydWN0IShGb29CLCBhcnJfYV9tdWxbMCAuLiBudW1fYV9tdWwg
KiAzMl0sICZWTVNUQVRFX0ZPT0EsIEZvb0EpLndpdGhfdmVyc2lvbl9pZCgyKSwKLSAgICAgICAg
dm1zdGF0ZV9vZiEoRm9vQiwgYXJyX2k2NCksCi0gICAgICAgIHZtc3RhdGVfc3RydWN0IShGb29C
LCBhcnJfYV93cmFwWzAgLi4gbnVtX2Ffd3JhcF0sICZWTVNUQVRFX0ZPT0EsIEZvb0EsIHZhbGlk
YXRlX2Zvb2IpLAotICAgIH0sCi0gICAgLi5aZXJvYWJsZTo6WkVSTwotfTsKK3N0YXRpYyBWTVNU
QVRFX0ZPT0I6IFZNU3RhdGVEZXNjcmlwdGlvbjxGb29CPiA9CisgICAgVk1TdGF0ZURlc2NyaXB0
aW9uQnVpbGRlcjo6PEZvb0I+OjpuZXcoKQorICAgICAgICAubmFtZShjX3N0ciEoImZvb19iIikp
CisgICAgICAgIC52ZXJzaW9uX2lkKDIpCisgICAgICAgIC5taW5pbXVtX3ZlcnNpb25faWQoMSkK
KyAgICAgICAgLmZpZWxkcyh2bXN0YXRlX2ZpZWxkcyEgeworICAgICAgICAgICAgdm1zdGF0ZV9v
ZiEoRm9vQiwgdmFsKS53aXRoX3ZlcnNpb25faWQoMiksCisgICAgICAgICAgICB2bXN0YXRlX29m
IShGb29CLCB3cmFwKSwKKyAgICAgICAgICAgIHZtc3RhdGVfc3RydWN0IShGb29CLCBhcnJfYVsw
IC4uIG51bV9hXSwgJlZNU1RBVEVfRk9PQSwgRm9vQSkud2l0aF92ZXJzaW9uX2lkKDEpLAorICAg
ICAgICAgICAgdm1zdGF0ZV9zdHJ1Y3QhKEZvb0IsIGFycl9hX211bFswIC4uIG51bV9hX211bCAq
IDMyXSwgJlZNU1RBVEVfRk9PQSwgRm9vQSkud2l0aF92ZXJzaW9uX2lkKDIpLAorICAgICAgICAg
ICAgdm1zdGF0ZV9vZiEoRm9vQiwgYXJyX2k2NCksCisgICAgICAgICAgICB2bXN0YXRlX3N0cnVj
dCEoRm9vQiwgYXJyX2Ffd3JhcFswIC4uIG51bV9hX3dyYXBdLCAmVk1TVEFURV9GT09BLCBGb29B
LCB2YWxpZGF0ZV9mb29iKSwKKyAgICAgICAgfSkKKyAgICAgICAgLmJ1aWxkKCk7CiAKICNbdGVz
dF0KIGZuIHRlc3Rfdm1zdGF0ZV9ib29sX3YoKSB7Ci0gICAgbGV0IGZvb19maWVsZHM6ICZbVk1T
dGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9tX3Jhd19wYXJ0cyhWTVNUQVRFX0ZPT0Iu
ZmllbGRzLCA3KSB9OworICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3RhdGVGaWVsZF0gPSB1bnNh
ZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09CLmdldF92bXNkX3JlZigpLmZp
ZWxkcywgNykgfTsKIAogICAgIC8vIDFzdCBWTVN0YXRlRmllbGQgKCJ2YWwiKSBpbiBWTVNUQVRF
X0ZPT0IgKGNvcnJlc3BvbmRpbmcgdG8gVk1TVEFURV9CT09MX1YpCiAgICAgYXNzZXJ0X2VxISgK
QEAgLTIwNCw3ICsyMDMsNyBAQCBmbiB0ZXN0X3Ztc3RhdGVfYm9vbF92KCkgewogCiAjW3Rlc3Rd
CiBmbiB0ZXN0X3Ztc3RhdGVfdWludDY0KCkgewotICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3Rh
dGVGaWVsZF0gPSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09CLmZp
ZWxkcywgNykgfTsKKyAgICBsZXQgZm9vX2ZpZWxkczogJltWTVN0YXRlRmllbGRdID0gdW5zYWZl
IHsgc2xpY2U6OmZyb21fcmF3X3BhcnRzKFZNU1RBVEVfRk9PQi5nZXRfdm1zZF9yZWYoKS5maWVs
ZHMsIDcpIH07CiAKICAgICAvLyAybmQgVk1TdGF0ZUZpZWxkICgid3JhcCIpIGluIFZNU1RBVEVf
Rk9PQiAoY29ycmVzcG9uZGluZyB0byBWTVNUQVRFX1U2NCkKICAgICBhc3NlcnRfZXEhKApAQCAt
MjI0LDcgKzIyMyw3IEBAIGZuIHRlc3Rfdm1zdGF0ZV91aW50NjQoKSB7CiAKICNbdGVzdF0KIGZu
IHRlc3Rfdm1zdGF0ZV9zdHJ1Y3RfdmFycmF5X3VpbnQ4KCkgewotICAgIGxldCBmb29fZmllbGRz
OiAmW1ZNU3RhdGVGaWVsZF0gPSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFU
RV9GT09CLmZpZWxkcywgNykgfTsKKyAgICBsZXQgZm9vX2ZpZWxkczogJltWTVN0YXRlRmllbGRd
ID0gdW5zYWZlIHsgc2xpY2U6OmZyb21fcmF3X3BhcnRzKFZNU1RBVEVfRk9PQi5nZXRfdm1zZF9y
ZWYoKS5maWVsZHMsIDcpIH07CiAKICAgICAvLyAzcmQgVk1TdGF0ZUZpZWxkICgiYXJyX2EiKSBp
biBWTVNUQVRFX0ZPT0IgKGNvcnJlc3BvbmRpbmcgdG8KICAgICAvLyBWTVNUQVRFX1NUUlVDVF9W
QVJSQVlfVUlOVDgpCkBAIC0yNDIsMTMgKzI0MSwxMyBAQCBmbiB0ZXN0X3Ztc3RhdGVfc3RydWN0
X3ZhcnJheV91aW50OCgpIHsKICAgICAgICAgZm9vX2ZpZWxkc1syXS5mbGFncy4wLAogICAgICAg
ICBWTVN0YXRlRmxhZ3M6OlZNU19TVFJVQ1QuMCB8IFZNU3RhdGVGbGFnczo6Vk1TX1ZBUlJBWV9V
SU5UOC4wCiAgICAgKTsKLSAgICBhc3NlcnRfZXEhKGZvb19maWVsZHNbMl0udm1zZCwgJlZNU1RB
VEVfRk9PQSk7CisgICAgYXNzZXJ0X2VxIShmb29fZmllbGRzWzJdLnZtc2QsIFZNU1RBVEVfRk9P
QS5nZXRfdm1zZF9yZWYoKSk7CiAgICAgYXNzZXJ0IShmb29fZmllbGRzWzJdLmZpZWxkX2V4aXN0
cy5pc19ub25lKCkpOwogfQogCiAjW3Rlc3RdCiBmbiB0ZXN0X3Ztc3RhdGVfc3RydWN0X3ZhcnJh
eV91aW50MzJfbXVsdGlwbHkoKSB7Ci0gICAgbGV0IGZvb19maWVsZHM6ICZbVk1TdGF0ZUZpZWxk
XSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9tX3Jhd19wYXJ0cyhWTVNUQVRFX0ZPT0IuZmllbGRzLCA3
KSB9OworICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3RhdGVGaWVsZF0gPSB1bnNhZmUgeyBzbGlj
ZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09CLmdldF92bXNkX3JlZigpLmZpZWxkcywgNykg
fTsKIAogICAgIC8vIDR0aCBWTVN0YXRlRmllbGQgKCJhcnJfYV9tdWwiKSBpbiBWTVNUQVRFX0ZP
T0IgKGNvcnJlc3BvbmRpbmcgdG8KICAgICAvLyAobm8gQyB2ZXJzaW9uKSBNVUxUSVBMWSB2YXJp
YW50IG9mIFZNU1RBVEVfU1RSVUNUX1ZBUlJBWV9VSU5UMzIpCkBAIC0yNjgsMTMgKzI2NywxMyBA
QCBmbiB0ZXN0X3Ztc3RhdGVfc3RydWN0X3ZhcnJheV91aW50MzJfbXVsdGlwbHkoKSB7CiAgICAg
ICAgICAgICB8IFZNU3RhdGVGbGFnczo6Vk1TX1ZBUlJBWV9VSU5UMzIuMAogICAgICAgICAgICAg
fCBWTVN0YXRlRmxhZ3M6OlZNU19NVUxUSVBMWV9FTEVNRU5UUy4wCiAgICAgKTsKLSAgICBhc3Nl
cnRfZXEhKGZvb19maWVsZHNbM10udm1zZCwgJlZNU1RBVEVfRk9PQSk7CisgICAgYXNzZXJ0X2Vx
IShmb29fZmllbGRzWzNdLnZtc2QsIFZNU1RBVEVfRk9PQS5nZXRfdm1zZF9yZWYoKSk7CiAgICAg
YXNzZXJ0IShmb29fZmllbGRzWzNdLmZpZWxkX2V4aXN0cy5pc19ub25lKCkpOwogfQogCiAjW3Rl
c3RdCiBmbiB0ZXN0X3Ztc3RhdGVfbWFjcm9fYXJyYXkoKSB7Ci0gICAgbGV0IGZvb19maWVsZHM6
ICZbVk1TdGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9tX3Jhd19wYXJ0cyhWTVNUQVRF
X0ZPT0IuZmllbGRzLCA3KSB9OworICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3RhdGVGaWVsZF0g
PSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09CLmdldF92bXNkX3Jl
ZigpLmZpZWxkcywgNykgfTsKIAogICAgIC8vIDV0aCBWTVN0YXRlRmllbGQgKCJhcnJfaTY0Iikg
aW4gVk1TVEFURV9GT09CIChjb3JyZXNwb25kaW5nIHRvCiAgICAgLy8gVk1TVEFURV9BUlJBWSkK
QEAgLTI5NSw3ICsyOTQsNyBAQCBmbiB0ZXN0X3Ztc3RhdGVfbWFjcm9fYXJyYXkoKSB7CiAKICNb
dGVzdF0KIGZuIHRlc3Rfdm1zdGF0ZV9zdHJ1Y3RfdmFycmF5X3VpbnQ4X3dyYXBwZXIoKSB7Ci0g
ICAgbGV0IGZvb19maWVsZHM6ICZbVk1TdGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9t
X3Jhd19wYXJ0cyhWTVNUQVRFX0ZPT0IuZmllbGRzLCA3KSB9OworICAgIGxldCBmb29fZmllbGRz
OiAmW1ZNU3RhdGVGaWVsZF0gPSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFU
RV9GT09CLmdldF92bXNkX3JlZigpLmZpZWxkcywgNykgfTsKICAgICBsZXQgbXV0IGZvb19iOiBG
b29CID0gRGVmYXVsdDo6ZGVmYXVsdCgpOwogICAgIGxldCBmb29fYl9wID0gc3RkOjpwdHI6OmFk
ZHJfb2ZfbXV0IShmb29fYikuY2FzdDo6PGNfdm9pZD4oKTsKIApAQCAtMzMyLDI2ICszMzEsMjgg
QEAgc3RydWN0IEZvb0MgewogICAgIGFycl9wdHJfd3JhcDogRm9vQ1dyYXBwZXIsCiB9CiAKLXN0
YXRpYyBWTVNUQVRFX0ZPT0M6IFZNU3RhdGVEZXNjcmlwdGlvbiA9IFZNU3RhdGVEZXNjcmlwdGlv
biB7Ci0gICAgbmFtZTogY19zdHIhKCJmb29fYyIpLmFzX3B0cigpLAotICAgIHZlcnNpb25faWQ6
IDMsCi0gICAgbWluaW11bV92ZXJzaW9uX2lkOiAxLAotICAgIGZpZWxkczogdm1zdGF0ZV9maWVs
ZHMhIHsKLSAgICAgICAgdm1zdGF0ZV9vZiEoRm9vQywgcHRyKS53aXRoX3ZlcnNpb25faWQoMiks
Ci0gICAgICAgIC8vIEZJWE1FOiBDdXJyZW50bHkgdm1zdGF0ZV9zdHJ1Y3QgZG9lc24ndCBzdXBw
b3J0IHRoZSBwb2ludGVyIHRvIHN0cnVjdHVyZS4KLSAgICAgICAgLy8gVk1TVEFURV9TVFJVQ1Rf
UE9JTlRFUjogdm1zdGF0ZV9zdHJ1Y3QhKEZvb0MsIHB0cl9hLCBWTVNUQVRFX0ZPT0EsIE5vbk51
bGw8Rm9vQT4pCi0gICAgICAgIHZtc3RhdGVfdW51c2VkIShzaXplX29mOjo8Tm9uTnVsbDxGb29B
Pj4oKSksCi0gICAgICAgIHZtc3RhdGVfb2YhKEZvb0MsIGFycl9wdHIpLAotICAgICAgICB2bXN0
YXRlX29mIShGb29DLCBhcnJfcHRyX3dyYXApLAotICAgIH0sCi0gICAgLi5aZXJvYWJsZTo6WkVS
TwotfTsKK3Vuc2FmZSBpbXBsIFN5bmMgZm9yIEZvb0Mge30KKworc3RhdGljIFZNU1RBVEVfRk9P
QzogVk1TdGF0ZURlc2NyaXB0aW9uPEZvb0M+ID0KKyAgICBWTVN0YXRlRGVzY3JpcHRpb25CdWls
ZGVyOjo8Rm9vQz46Om5ldygpCisgICAgICAgIC5uYW1lKGNfc3RyISgiZm9vX2MiKSkKKyAgICAg
ICAgLnZlcnNpb25faWQoMykKKyAgICAgICAgLm1pbmltdW1fdmVyc2lvbl9pZCgxKQorICAgICAg
ICAuZmllbGRzKHZtc3RhdGVfZmllbGRzISB7CisgICAgICAgICAgICB2bXN0YXRlX29mIShGb29D
LCBwdHIpLndpdGhfdmVyc2lvbl9pZCgyKSwKKyAgICAgICAgICAgIC8vIEZJWE1FOiBDdXJyZW50
bHkgdm1zdGF0ZV9zdHJ1Y3QgZG9lc24ndCBzdXBwb3J0IHRoZSBwb2ludGVyIHRvIHN0cnVjdHVy
ZS4KKyAgICAgICAgICAgIC8vIFZNU1RBVEVfU1RSVUNUX1BPSU5URVI6IHZtc3RhdGVfc3RydWN0
IShGb29DLCBwdHJfYSwgVk1TVEFURV9GT09BLCBOb25OdWxsPEZvb0E+KQorICAgICAgICAgICAg
dm1zdGF0ZV91bnVzZWQhKHNpemVfb2Y6OjxOb25OdWxsPEZvb0E+PigpKSwKKyAgICAgICAgICAg
IHZtc3RhdGVfb2YhKEZvb0MsIGFycl9wdHIpLAorICAgICAgICAgICAgdm1zdGF0ZV9vZiEoRm9v
QywgYXJyX3B0cl93cmFwKSwKKyAgICAgICAgfSkKKyAgICAgICAgLmJ1aWxkKCk7CiAKIGNvbnN0
IFBUUl9TSVpFOiB1c2l6ZSA9IHNpemVfb2Y6OjwqbXV0ICgpPigpOwogCiAjW3Rlc3RdCiBmbiB0
ZXN0X3Ztc3RhdGVfcG9pbnRlcigpIHsKLSAgICBsZXQgZm9vX2ZpZWxkczogJltWTVN0YXRlRmll
bGRdID0gdW5zYWZlIHsgc2xpY2U6OmZyb21fcmF3X3BhcnRzKFZNU1RBVEVfRk9PQy5maWVsZHMs
IDYpIH07CisgICAgbGV0IGZvb19maWVsZHM6ICZbVk1TdGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNs
aWNlOjpmcm9tX3Jhd19wYXJ0cyhWTVNUQVRFX0ZPT0MuZ2V0X3Ztc2RfcmVmKCkuZmllbGRzLCA2
KSB9OwogCiAgICAgLy8gMXN0IFZNU3RhdGVGaWVsZCAoInB0ciIpIGluIFZNU1RBVEVfRk9PQyAo
Y29ycmVzcG9uZGluZyB0byBWTVNUQVRFX1BPSU5URVIpCiAgICAgYXNzZXJ0X2VxISgKQEAgLTM3
NCw3ICszNzUsNyBAQCBmbiB0ZXN0X3Ztc3RhdGVfcG9pbnRlcigpIHsKIAogI1t0ZXN0XQogZm4g
dGVzdF92bXN0YXRlX21hY3JvX2FycmF5X29mX3BvaW50ZXIoKSB7Ci0gICAgbGV0IGZvb19maWVs
ZHM6ICZbVk1TdGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9tX3Jhd19wYXJ0cyhWTVNU
QVRFX0ZPT0MuZmllbGRzLCA2KSB9OworICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3RhdGVGaWVs
ZF0gPSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09DLmdldF92bXNk
X3JlZigpLmZpZWxkcywgNikgfTsKIAogICAgIC8vIDNyZCBWTVN0YXRlRmllbGQgKCJhcnJfcHRy
IikgaW4gVk1TVEFURV9GT09DIChjb3JyZXNwb25kaW5nIHRvCiAgICAgLy8gVk1TVEFURV9BUlJB
WV9PRl9QT0lOVEVSKQpAQCAtMzk4LDcgKzM5OSw3IEBAIGZuIHRlc3Rfdm1zdGF0ZV9tYWNyb19h
cnJheV9vZl9wb2ludGVyKCkgewogCiAjW3Rlc3RdCiBmbiB0ZXN0X3Ztc3RhdGVfbWFjcm9fYXJy
YXlfb2ZfcG9pbnRlcl93cmFwcGVkKCkgewotICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3RhdGVG
aWVsZF0gPSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09DLmZpZWxk
cywgNikgfTsKKyAgICBsZXQgZm9vX2ZpZWxkczogJltWTVN0YXRlRmllbGRdID0gdW5zYWZlIHsg
c2xpY2U6OmZyb21fcmF3X3BhcnRzKFZNU1RBVEVfRk9PQy5nZXRfdm1zZF9yZWYoKS5maWVsZHMs
IDYpIH07CiAKICAgICAvLyA0dGggVk1TdGF0ZUZpZWxkICgiYXJyX3B0cl93cmFwIikgaW4gVk1T
VEFURV9GT09DIChjb3JyZXNwb25kaW5nIHRvCiAgICAgLy8gVk1TVEFURV9BUlJBWV9PRl9QT0lO
VEVSKQpAQCAtNDQ3LDIxICs0NDgsMjEgQEAgZm4gdmFsaWRhdGVfZm9vZF8yKF9zdGF0ZTogJkZv
b0QsIF92ZXJzaW9uX2lkOiB1OCkgLT4gYm9vbCB7CiAgICAgdHJ1ZQogfQogCi1zdGF0aWMgVk1T
VEFURV9GT09EOiBWTVN0YXRlRGVzY3JpcHRpb24gPSBWTVN0YXRlRGVzY3JpcHRpb24gewotICAg
IG5hbWU6IGNfc3RyISgiZm9vX2QiKS5hc19wdHIoKSwKLSAgICB2ZXJzaW9uX2lkOiAzLAotICAg
IG1pbmltdW1fdmVyc2lvbl9pZDogMSwKLSAgICBmaWVsZHM6IHZtc3RhdGVfZmllbGRzISB7Ci0g
ICAgICAgIHZtc3RhdGVfdmFsaWRhdGUhKEZvb0QsIGNfc3RyISgiZm9vX2RfMCIpLCBGb29EOjp2
YWxpZGF0ZV9mb29kXzApLAotICAgICAgICB2bXN0YXRlX3ZhbGlkYXRlIShGb29ELCBjX3N0ciEo
ImZvb19kXzEiKSwgRm9vRDo6dmFsaWRhdGVfZm9vZF8xKSwKLSAgICAgICAgdm1zdGF0ZV92YWxp
ZGF0ZSEoRm9vRCwgY19zdHIhKCJmb29fZF8yIiksIHZhbGlkYXRlX2Zvb2RfMiksCi0gICAgfSwK
LSAgICAuLlplcm9hYmxlOjpaRVJPCi19Oworc3RhdGljIFZNU1RBVEVfRk9PRDogVk1TdGF0ZURl
c2NyaXB0aW9uPEZvb0Q+ID0KKyAgICBWTVN0YXRlRGVzY3JpcHRpb25CdWlsZGVyOjo8Rm9vRD46
Om5ldygpCisgICAgICAgIC5uYW1lKGNfc3RyISgiZm9vX2QiKSkKKyAgICAgICAgLnZlcnNpb25f
aWQoMykKKyAgICAgICAgLm1pbmltdW1fdmVyc2lvbl9pZCgxKQorICAgICAgICAuZmllbGRzKHZt
c3RhdGVfZmllbGRzISB7CisgICAgICAgICAgICB2bXN0YXRlX3ZhbGlkYXRlIShGb29ELCBjX3N0
ciEoImZvb19kXzAiKSwgRm9vRDo6dmFsaWRhdGVfZm9vZF8wKSwKKyAgICAgICAgICAgIHZtc3Rh
dGVfdmFsaWRhdGUhKEZvb0QsIGNfc3RyISgiZm9vX2RfMSIpLCBGb29EOjp2YWxpZGF0ZV9mb29k
XzEpLAorICAgICAgICAgICAgdm1zdGF0ZV92YWxpZGF0ZSEoRm9vRCwgY19zdHIhKCJmb29fZF8y
IiksIHZhbGlkYXRlX2Zvb2RfMiksCisgICAgICAgIH0pCisgICAgICAgIC5idWlsZCgpOwogCiAj
W3Rlc3RdCiBmbiB0ZXN0X3Ztc3RhdGVfdmFsaWRhdGUoKSB7Ci0gICAgbGV0IGZvb19maWVsZHM6
ICZbVk1TdGF0ZUZpZWxkXSA9IHVuc2FmZSB7IHNsaWNlOjpmcm9tX3Jhd19wYXJ0cyhWTVNUQVRF
X0ZPT0QuZmllbGRzLCA0KSB9OworICAgIGxldCBmb29fZmllbGRzOiAmW1ZNU3RhdGVGaWVsZF0g
PSB1bnNhZmUgeyBzbGljZTo6ZnJvbV9yYXdfcGFydHMoVk1TVEFURV9GT09ELmdldF92bXNkX3Jl
ZigpLmZpZWxkcywgNCkgfTsKICAgICBsZXQgbXV0IGZvb19kID0gRm9vRDsKICAgICBsZXQgZm9v
X2RfcCA9IHN0ZDo6cHRyOjphZGRyX29mX211dCEoZm9vX2QpLmNhc3Q6OjxjX3ZvaWQ+KCk7CiAK
LS0gCjIuNDkuMAoK
--000000000000363cd80632d4b835--


